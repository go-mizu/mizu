{{define "resources.rb.tmpl"}}# frozen_string_literal: true

# Code generated by sdkruby. DO NOT EDIT.

module {{.ModuleName}}
{{range $res := .Resources}}
  # Operations for {{$res.Name}}.
{{- if $res.Description}}
  #
  # {{$res.Description}}
{{- end}}
  class {{$res.ClassName}}
    # @api private
    def initialize(client)
      @client = client
    end
{{range $m := $res.Methods}}
{{- if $m.Description}}

    # {{$m.Description}}
{{- end}}
    #
{{- if $m.InputIsStruct}}
{{- range $f := $m.InputFields}}
    # @param {{$f.RubyName}} [{{$f.RubyType}}{{if or $f.Optional $f.Nullable}}, nil{{end}}]{{if $f.Description}} {{$f.Description}}{{end}}
{{- end}}
{{- else if $m.HasInput}}
    # @param request [Types::{{$m.InputType}}] Request object
{{- end}}
{{- if $m.IsStreaming}}
    # @yield [event] Each streaming event
    # @yieldparam event [Types::{{$m.StreamItemType}}] A streaming event
    # @return [Enumerator<Types::{{$m.StreamItemType}}>] if no block given
{{- else if $m.HasOutput}}
    # @return [Types::{{$m.OutputType}}] The response
{{- else}}
    # @return [nil]
{{- end}}
    # @raise [APIError] if the request fails
{{- if $m.IsStreaming}}
    def {{$m.RubyName}}({{if $m.InputIsStruct}}{{range $i, $f := $m.InputFields}}{{if $i}}, {{end}}{{$f.RubyName}}:{{if or $f.Optional $f.Nullable}} nil{{end}}{{end}}{{else if $m.HasInput}}request{{end}}, &block)
      body = {{if $m.InputIsStruct}}{
{{- range $f := $m.InputFields}}
        {{rubySymbol $f.JSONName}} => {{$f.RubyName}},
{{- end}}
        stream: true
      }.compact{{else if $m.HasInput}}request.to_h.merge(stream: true){{else}}{ stream: true }{{end}}

      if block_given?
        @client.stream(method: :{{$m.HTTPMethod | lower}}, path: {{rubyQuote $m.HTTPPath}}, body: body) do |event|
          yield Types::{{$m.StreamItemType}}.from_hash(event)
        end
      else
        Enumerator.new do |yielder|
          @client.stream(method: :{{$m.HTTPMethod | lower}}, path: {{rubyQuote $m.HTTPPath}}, body: body) do |event|
            yielder << Types::{{$m.StreamItemType}}.from_hash(event)
          end
        end
      end
    end
{{- else}}
    def {{$m.RubyName}}({{if $m.InputIsStruct}}{{range $i, $f := $m.InputFields}}{{if $i}}, {{end}}{{$f.RubyName}}:{{if or $f.Optional $f.Nullable}} nil{{end}}{{end}}{{else if $m.HasInput}}request{{end}})
      body = {{if $m.InputIsStruct}}{
{{- range $f := $m.InputFields}}
        {{rubySymbol $f.JSONName}} => {{$f.RubyName}},
{{- end}}
      }.compact{{else if $m.HasInput}}request.to_h{{else}}nil{{end}}

      response = @client.request(
        method: :{{$m.HTTPMethod | lower}},
        path: {{rubyQuote $m.HTTPPath}},
        body: body
      )
{{- if $m.HasOutput}}

      Types::{{$m.OutputType}}.from_hash(response)
{{- else}}

      nil
{{- end}}
    end
{{- end}}
{{end}}
  end

{{end}}
end
{{end}}
