{{define "config.hs.tmpl"}}{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE RecordWildCards #-}

-- | Code generated by sdkhaskell. DO NOT EDIT.
--
-- Configuration for the {{.ModuleName}} client.
module {{.ModuleName}}.Config
    ( -- * Types
      Config(..)
    , AuthMode(..)

      -- * Construction
    , defaultConfig
    , configFromEnv
    ) where

import Data.Text (Text)
import qualified Data.Text as T
import System.Environment (lookupEnv)

-- | Authentication mode for API requests.
data AuthMode
    = BearerAuth     -- ^ Bearer token in Authorization header
    | BasicAuth      -- ^ Basic authentication
    | HeaderAuth     -- ^ API key in X-Api-Key header
    | NoAuth         -- ^ No authentication
    deriving (Show, Eq)

-- | Client configuration.
--
-- == Fields
--
-- * 'apiKey' - API key for authentication
-- * 'baseUrl' - Base URL for API requests
-- * 'timeout' - Request timeout in seconds (default: 60)
-- * 'maxRetries' - Maximum retry attempts for transient errors (default: 2)
-- * 'authMode' - Authentication mode (default: 'BearerAuth')
-- * 'headers' - Additional headers to include in all requests
data Config = Config
    { apiKey      :: !(Maybe Text)
      -- ^ API key for authentication
    , baseUrl     :: !Text
      -- ^ Base URL for API requests
    , timeout     :: !Int
      -- ^ Request timeout in seconds (default: 60)
    , maxRetries  :: !Int
      -- ^ Maximum retry attempts for transient errors (default: 2)
    , authMode    :: !AuthMode
      -- ^ Authentication mode (default: 'BearerAuth')
    , headers     :: ![(Text, Text)]
      -- ^ Additional headers to include in all requests
    } deriving (Show, Eq)

-- | Default configuration.
--
-- @
-- defaultConfig = Config
--     { apiKey = Nothing
--     , baseUrl = {{haskellQuote .Client.BaseURL}}
--     , timeout = 60
--     , maxRetries = 2
--     , authMode = BearerAuth
--     , headers = [{{range $i, $h := .Client.Headers}}{{if $i}}, {{end}}({{haskellQuote $h.K}}, {{haskellQuote $h.V}}){{end}}]
--     }
-- @
defaultConfig :: Config
defaultConfig = Config
    { apiKey = Nothing
    , baseUrl = {{haskellQuote .Client.BaseURL}}
    , timeout = 60
    , maxRetries = 2
{{- if eq .Client.Auth "bearer"}}
    , authMode = BearerAuth
{{- else if eq .Client.Auth "basic"}}
    , authMode = BasicAuth
{{- else if eq .Client.Auth "header"}}
    , authMode = HeaderAuth
{{- else}}
    , authMode = BearerAuth
{{- end}}
    , headers = [{{range $i, $h := .Client.Headers}}{{if $i}}, {{end}}({{haskellQuote $h.K}}, {{haskellQuote $h.V}}){{end}}]
    }

-- | Load configuration from environment variables.
--
-- Reads:
--
-- * @{{.EnvPrefix}}_API_KEY@ - API key
-- * @{{.EnvPrefix}}_BASE_URL@ - Base URL (optional)
-- * @{{.EnvPrefix}}_TIMEOUT@ - Timeout in seconds (optional)
configFromEnv :: IO Config
configFromEnv = do
    mApiKey <- fmap T.pack <$> lookupEnv "{{.EnvPrefix}}_API_KEY"
    mBaseUrl <- fmap T.pack <$> lookupEnv "{{.EnvPrefix}}_BASE_URL"
    mTimeout <- fmap read <$> lookupEnv "{{.EnvPrefix}}_TIMEOUT"
    pure $ defaultConfig
        { apiKey = mApiKey
        , baseUrl = maybe (baseUrl defaultConfig) id mBaseUrl
        , timeout = maybe (timeout defaultConfig) id mTimeout
        }
{{end}}