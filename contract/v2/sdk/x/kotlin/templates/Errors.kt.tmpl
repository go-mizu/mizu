{{define "Errors.kt.tmpl"}}// Code generated by sdkkotlin. DO NOT EDIT.

package {{.Package}}

import kotlinx.serialization.json.Json
import kotlinx.serialization.json.JsonElement

/**
 * Base error type for all SDK errors.
 */
sealed class SDKException : Exception() {

    /**
     * Network connection failed.
     */
    data class ConnectionError(
        override val cause: Throwable
    ) : SDKException() {
        override val message: String = "Connection error: ${cause.message}"
    }

    /**
     * Server returned an error status code.
     */
    data class ApiError(
        /** HTTP status code. */
        val statusCode: Int,
        /** Error message from the server. */
        override val message: String,
        /** Raw response body, if available. */
        val body: String? = null
    ) : SDKException() {

        /**
         * Attempts to decode the error body as the specified type.
         */
        inline fun <reified T> decoded(): T? {
            return body?.let {
                try {
                    Json.decodeFromString<T>(it)
                } catch (_: Exception) {
                    null
                }
            }
        }

        /**
         * Attempts to decode the error body as a JsonElement.
         */
        fun decodedJson(): JsonElement? {
            return body?.let {
                try {
                    Json.parseToJsonElement(it)
                } catch (_: Exception) {
                    null
                }
            }
        }

        /** Returns true if this is a client error (4xx). */
        val isClientError: Boolean get() = statusCode in 400..499

        /** Returns true if this is a server error (5xx). */
        val isServerError: Boolean get() = statusCode in 500..599

        /** Returns true if this is a rate limit error (429). */
        val isRateLimitError: Boolean get() = statusCode == 429

        /** Returns true if this is an authentication error (401). */
        val isAuthenticationError: Boolean get() = statusCode == 401

        /** Returns true if this is a forbidden error (403). */
        val isForbiddenError: Boolean get() = statusCode == 403

        /** Returns true if this is a not found error (404). */
        val isNotFoundError: Boolean get() = statusCode == 404
    }

    /**
     * Request timed out.
     */
    data object Timeout : SDKException() {
        override val message: String = "Request timed out"
    }

    /**
     * Request was cancelled.
     */
    data object Cancelled : SDKException() {
        override val message: String = "Request was cancelled"
    }

    /**
     * Failed to encode request body.
     */
    data class EncodingError(
        override val cause: Throwable
    ) : SDKException() {
        override val message: String = "Encoding error: ${cause.message}"
    }

    /**
     * Failed to decode response body.
     */
    data class DecodingError(
        override val cause: Throwable
    ) : SDKException() {
        override val message: String = "Decoding error: ${cause.message}"
    }
}

/**
 * Extension function to check if an exception is retriable.
 */
fun SDKException.isRetriable(): Boolean = when (this) {
    is SDKException.ConnectionError -> true
    is SDKException.Timeout -> true
    is SDKException.ApiError -> statusCode in listOf(429, 500, 502, 503, 504)
    else -> false
}

/**
 * Extension function to get a user-friendly error description.
 */
fun SDKException.userFriendlyMessage(): String = when (this) {
    is SDKException.ConnectionError -> "Unable to connect to the server. Please check your internet connection."
    is SDKException.Timeout -> "The request took too long. Please try again."
    is SDKException.Cancelled -> "The request was cancelled."
    is SDKException.ApiError -> when {
        isRateLimitError -> "Too many requests. Please wait a moment and try again."
        isAuthenticationError -> "Authentication failed. Please check your API key."
        isForbiddenError -> "You don't have permission to perform this action."
        isNotFoundError -> "The requested resource was not found."
        isServerError -> "The server encountered an error. Please try again later."
        else -> message
    }
    is SDKException.EncodingError -> "Failed to prepare the request."
    is SDKException.DecodingError -> "Failed to process the response."
}
{{end}}
