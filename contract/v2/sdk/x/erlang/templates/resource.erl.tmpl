{{define "resource.erl.tmpl"}}%% Code generated by sdkerlang. DO NOT EDIT.

%% @doc {{if .Resource.Description}}{{.Resource.Description}}{{else}}Operations for {{.Resource.Name}}.{{end}}
-module({{.AppName}}_{{.Resource.ErlangName}}).

-export([
{{- $methods := .Resource.Methods}}
{{- range $i, $method := $methods}}
    {{$method.ErlangName}}/2,
    {{$method.ErlangName}}/3{{if lt $i (sub (len $methods) 1)}},{{end}}
{{- end}}
]).

-include("{{.AppName}}.hrl").
{{range $method := .Resource.Methods}}

%% @doc {{if $method.Description}}{{$method.Description}}{{else}}{{$method.Name}} operation.{{end}}
%%
{{- if $method.HasInput}}
%% == Parameters ==
%% <ul>
%%   <li>`Client' - The API client</li>
%%   <li>`Params' - Request parameters as a map</li>
%% </ul>
{{- end}}
%%
{{- if $method.IsStreaming}}
%% == Streaming ==
%% This method returns a stream. Use {{$.AppName}}_streaming functions to consume it.
%%
%% == Example ==
%% ```
%% {ok, Stream} = {{$.AppName}}_{{$.Resource.ErlangName}}:{{$method.ErlangName}}(Client, #{
%%     model => <<"model-name">>
%% }),
%% ok = {{$.AppName}}_streaming:foreach(Stream, fun(Event) ->
%%     io:format("~p~n", [Event])
%% end).
%% '''
{{- else}}
%% == Example ==
%% ```
%% {ok, Response} = {{$.AppName}}_{{$.Resource.ErlangName}}:{{$method.ErlangName}}(Client, #{
%%     model => <<"model-name">>
%% }).
%% '''
{{- end}}
%%
%% @param Client The API client
%% @param Params Request parameters as a map
%% @returns {ok, Response} | {ok, Stream} | {error, Reason}
{{- if $method.IsStreaming}}
-spec {{$method.ErlangName}}({{$.AppName}}_client:client(), map()) ->
    {ok, {{$.AppName}}_streaming:stream()} | {error, term()}.
{{- else if $method.HasOutput}}
-spec {{$method.ErlangName}}({{$.AppName}}_client:client(), map()) ->
    {ok, {{$method.OutputType}}()} | {error, term()}.
{{- else}}
-spec {{$method.ErlangName}}({{$.AppName}}_client:client(), map()) ->
    {ok, map() | undefined} | {error, term()}.
{{- end}}
{{$method.ErlangName}}(Client, Params) ->
    {{$method.ErlangName}}(Client, Params, []).

%% @doc Same as {{$method.ErlangName}}/2 with additional options.
%%
%% @param Client The API client
%% @param Params Request parameters as a map
%% @param Opts Additional options
%% @returns {ok, Response} | {ok, Stream} | {error, Reason}
{{- if $method.IsStreaming}}
-spec {{$method.ErlangName}}({{$.AppName}}_client:client(), map(), proplists:proplist()) ->
    {ok, {{$.AppName}}_streaming:stream()} | {error, term()}.
{{$method.ErlangName}}(Client, Params, _Opts) ->
    Body = maps:put(stream, true, Params),
    {{$.AppName}}_client:stream(Client, [
        {method, {{$method.HTTPMethod}}},
        {path, {{erlangBinary $method.HTTPPath}}},
        {body, Body}
    ]).
{{- else if $method.HasOutput}}
-spec {{$method.ErlangName}}({{$.AppName}}_client:client(), map(), proplists:proplist()) ->
    {ok, {{$method.OutputType}}()} | {error, term()}.
{{$method.ErlangName}}(Client, Params, Opts) ->
    case {{$.AppName}}_client:request(Client, [
        {method, {{$method.HTTPMethod}}},
        {path, {{erlangBinary $method.HTTPPath}}},
        {body, Params}
    ] ++ Opts) of
        {ok, Response} ->
            {ok, {{$.AppName}}_types:from_map({{$method.OutputType}}, Response)};
        {error, _} = Err ->
            Err
    end.
{{- else}}
-spec {{$method.ErlangName}}({{$.AppName}}_client:client(), map(), proplists:proplist()) ->
    {ok, map() | undefined} | {error, term()}.
{{$method.ErlangName}}(Client, Params, Opts) ->
    {{$.AppName}}_client:request(Client, [
        {method, {{$method.HTTPMethod}}},
        {path, {{erlangBinary $method.HTTPPath}}},
        {body, Params}
    ] ++ Opts).
{{- end}}
{{end}}
{{end}}
