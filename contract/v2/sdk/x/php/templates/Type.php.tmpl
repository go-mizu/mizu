{{define "Type.php.tmpl"}}<?php

declare(strict_types=1);

// Code generated by sdkphp. DO NOT EDIT.

namespace {{.Namespace}}\Types;
{{- $hasDateTime := false}}
{{- range .Type.Fields}}
{{- if eq .PHPType "\\DateTimeImmutable"}}{{$hasDateTime = true}}{{end}}
{{- if eq .PHPType "?\\DateTimeImmutable"}}{{$hasDateTime = true}}{{end}}
{{- end}}
{{- if $hasDateTime}}

use DateTimeImmutable;
{{- end}}

/**
{{- if .Type.Description}}
 * {{.Type.Description}}
{{- else}}
 * {{.Type.PHPName}} type.
{{- end}}
 */
final readonly class {{.Type.PHPName}} implements \JsonSerializable
{
    /**
{{- range .Type.Fields}}
     * @param {{.PHPDocType}} ${{.PHPName}}{{if .Description}} {{.Description}}{{end}}
{{- end}}
     */
    public function __construct(
{{- $fields := .Type.Fields}}
{{- $fieldCount := len $fields}}
{{- range $i, $f := $fields}}
        public {{$f.PHPType}} ${{$f.PHPName}}{{if or $f.Optional $f.Nullable}} = null{{end}},
{{- end}}
    ) {}

    /**
     * Creates an instance from an array.
     *
     * @param array<string, mixed> $data
     */
    public static function fromArray(array $data): self
    {
        return new self(
{{- range .Type.Fields}}
{{- if .IsArray}}
            {{.PHPName}}: isset($data[{{phpQuote .JSONName}}]) ? array_map(
                fn(array $item) => {{.ArrayOf}}::fromArray($item),
                $data[{{phpQuote .JSONName}}],
            ) : {{if or .Optional .Nullable}}null{{else}}[]{{end}},
{{- else if .IsMap}}
            {{.PHPName}}: $data[{{phpQuote .JSONName}}] ?? {{if or .Optional .Nullable}}null{{else}}[]{{end}},
{{- else if eq .PHPType "\\DateTimeImmutable"}}
            {{.PHPName}}: new \DateTimeImmutable($data[{{phpQuote .JSONName}}] ?? throw new \InvalidArgumentException('Missing {{.JSONName}}')),
{{- else if eq .PHPType "?\\DateTimeImmutable"}}
            {{.PHPName}}: isset($data[{{phpQuote .JSONName}}]) ? new \DateTimeImmutable($data[{{phpQuote .JSONName}}]) : null,
{{- else if or .Optional .Nullable}}
            {{.PHPName}}: $data[{{phpQuote .JSONName}}] ?? null,
{{- else}}
            {{.PHPName}}: $data[{{phpQuote .JSONName}}] ?? throw new \InvalidArgumentException('Missing {{.JSONName}}'),
{{- end}}
{{- end}}
        );
    }

    /**
     * Converts to an array for JSON serialization.
     *
     * @return array<string, mixed>
     */
    public function toArray(): array
    {
        $result = [];

{{- range .Type.Fields}}
{{- if or .Optional .Nullable}}

        if ($this->{{.PHPName}} !== null) {
{{- if .IsArray}}
            $result[{{phpQuote .JSONName}}] = array_map(
                fn({{.ArrayOf}} $item) => $item->toArray(),
                $this->{{.PHPName}},
            );
{{- else if .IsMap}}
            $result[{{phpQuote .JSONName}}] = $this->{{.PHPName}};
{{- else if eq .PHPType "?\\DateTimeImmutable"}}
            $result[{{phpQuote .JSONName}}] = $this->{{.PHPName}}->format(\DateTimeInterface::RFC3339);
{{- else}}
            $result[{{phpQuote .JSONName}}] = $this->{{.PHPName}};
{{- end}}
        }
{{- else}}
{{- if .IsArray}}
        $result[{{phpQuote .JSONName}}] = array_map(
            fn({{.ArrayOf}} $item) => $item->toArray(),
            $this->{{.PHPName}},
        );
{{- else if .IsMap}}
        $result[{{phpQuote .JSONName}}] = $this->{{.PHPName}};
{{- else if eq .PHPType "\\DateTimeImmutable"}}
        $result[{{phpQuote .JSONName}}] = $this->{{.PHPName}}->format(\DateTimeInterface::RFC3339);
{{- else}}
        $result[{{phpQuote .JSONName}}] = $this->{{.PHPName}};
{{- end}}
{{- end}}
{{- end}}

        return $result;
    }

    /**
     * @return array<string, mixed>
     */
    public function jsonSerialize(): array
    {
        return $this->toArray();
    }
}
{{end}}