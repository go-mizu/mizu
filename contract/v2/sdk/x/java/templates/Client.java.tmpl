{{define "Client.java.tmpl"}}// Code generated by sdkjava. DO NOT EDIT.

package {{.Package}};

import {{.Package}}.internal.HttpClientWrapper;
import {{.Package}}.resource.*;

/**
{{- if .Service.Description}}
 * {{.Service.Description}}
 *
{{- end}}
 * <p>This client is thread-safe and can be shared across threads.
 * It is recommended to create a single instance and reuse it.
 *
 * <p>Example usage:
 * <pre>{@code
 * var client = {{.Service.Sanitized}}Client.builder()
 *     .apiKey("your-api-key")
 *     .build();
 *
{{- if .Resources}}
 * var response = client.{{(index .Resources 0).JavaName}}().create(request);
{{- end}}
 * }</pre>
 */
public final class {{.Service.Sanitized}}Client implements AutoCloseable {

    private final ClientOptions options;
    private final HttpClientWrapper httpClient;

{{- range .Resources}}
    private final {{.ClassName}} {{.JavaName}};
{{- end}}

    private {{.Service.Sanitized}}Client(ClientOptions options) {
        this.options = options;
        this.httpClient = new HttpClientWrapper(options);
{{- range .Resources}}
        this.{{.JavaName}} = new {{.ClassName}}(this.httpClient);
{{- end}}
    }

    /**
     * Creates a new builder for configuring the client.
     *
     * @return a new builder instance
     */
    public static Builder builder() {
        return new Builder();
    }

{{range .Resources}}
    /**
     * Access to {{.Name}} operations.
{{- if .Description}}
     *
     * <p>{{.Description}}
{{- end}}
     *
     * @return the {{.Name}} resource
     */
    public {{.ClassName}} {{.JavaName}}() {
        return {{.JavaName}};
    }
{{end}}
    /**
     * Returns the client options.
     *
     * @return the client options
     */
    public ClientOptions getOptions() {
        return options;
    }

    /**
     * Creates a new client with modified configuration.
     *
     * @return a new builder pre-populated with this client's options
     */
    public Builder toBuilder() {
        return new Builder()
            .apiKey(options.getApiKey())
            .baseUrl(options.getBaseUrl())
            .timeout(options.getTimeout())
            .connectTimeout(options.getConnectTimeout())
            .maxRetries(options.getMaxRetries())
            .defaultHeaders(options.getDefaultHeaders())
            .authMode(options.getAuthMode());
    }

    @Override
    public void close() {
        httpClient.close();
    }

    /**
     * Builder for creating {{.Service.Sanitized}}Client instances.
     */
    public static final class Builder {
        private String apiKey;
        private String baseUrl = {{javaString .Client.BaseURL}};
        private java.time.Duration timeout = java.time.Duration.ofSeconds(60);
        private java.time.Duration connectTimeout = java.time.Duration.ofSeconds(10);
        private int maxRetries = 2;
        private java.util.Map<String, String> defaultHeaders = new java.util.HashMap<>();
        private AuthMode authMode = AuthMode.BEARER;
        private java.net.http.HttpClient httpClient;

        private Builder() {
{{- if .Client.Headers}}
            // Default headers from service definition
{{- range .Client.Headers}}
            this.defaultHeaders.put({{javaString .K}}, {{javaString .V}});
{{- end}}
{{- end}}
        }

        /**
         * Sets the API key for authentication.
         *
         * @param apiKey the API key
         * @return this builder
         */
        public Builder apiKey(String apiKey) {
            this.apiKey = apiKey;
            return this;
        }

        /**
         * Sets the base URL for API requests.
         *
         * @param baseUrl the base URL
         * @return this builder
         */
        public Builder baseUrl(String baseUrl) {
            this.baseUrl = baseUrl;
            return this;
        }

        /**
         * Sets the request timeout.
         *
         * @param timeout the request timeout
         * @return this builder
         */
        public Builder timeout(java.time.Duration timeout) {
            this.timeout = timeout;
            return this;
        }

        /**
         * Sets the connection timeout.
         *
         * @param connectTimeout the connection timeout
         * @return this builder
         */
        public Builder connectTimeout(java.time.Duration connectTimeout) {
            this.connectTimeout = connectTimeout;
            return this;
        }

        /**
         * Sets the maximum number of retry attempts.
         *
         * @param maxRetries the maximum retries
         * @return this builder
         */
        public Builder maxRetries(int maxRetries) {
            this.maxRetries = maxRetries;
            return this;
        }

        /**
         * Adds a default header to all requests.
         *
         * @param name the header name
         * @param value the header value
         * @return this builder
         */
        public Builder addHeader(String name, String value) {
            this.defaultHeaders.put(name, value);
            return this;
        }

        /**
         * Sets all default headers.
         *
         * @param headers the headers map
         * @return this builder
         */
        public Builder defaultHeaders(java.util.Map<String, String> headers) {
            this.defaultHeaders = new java.util.HashMap<>(headers);
            return this;
        }

        /**
         * Sets the authentication mode.
         *
         * @param authMode the authentication mode
         * @return this builder
         */
        public Builder authMode(AuthMode authMode) {
            this.authMode = authMode;
            return this;
        }

        /**
         * Sets a custom HTTP client.
         *
         * @param httpClient the HTTP client
         * @return this builder
         */
        public Builder httpClient(java.net.http.HttpClient httpClient) {
            this.httpClient = httpClient;
            return this;
        }

        /**
         * Builds the client with the configured options.
         *
         * @return a new {{.Service.Sanitized}}Client instance
         */
        public {{.Service.Sanitized}}Client build() {
            ClientOptions options = ClientOptions.builder()
                .apiKey(apiKey)
                .baseUrl(baseUrl)
                .timeout(timeout)
                .connectTimeout(connectTimeout)
                .maxRetries(maxRetries)
                .defaultHeaders(defaultHeaders)
                .authMode(authMode)
                .httpClient(httpClient)
                .build();
            return new {{.Service.Sanitized}}Client(options);
        }
    }
}
{{end}}
