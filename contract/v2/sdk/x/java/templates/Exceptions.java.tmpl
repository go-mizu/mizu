{{define "Exceptions.java.tmpl"}}// Code generated by sdkjava. DO NOT EDIT.

package {{.Package}}.exception;

import com.fasterxml.jackson.databind.ObjectMapper;

import java.util.List;
import java.util.Map;
import java.util.Optional;

/**
 * Base exception for all SDK errors.
 *
 * <p>This is a runtime exception to avoid cluttering code with checked exceptions.
 * All SDK errors extend this class.
 */
public class SDKException extends RuntimeException {

    /**
     * Creates a new SDK exception with the specified message.
     *
     * @param message the error message
     */
    public SDKException(String message) {
        super(message);
    }

    /**
     * Creates a new SDK exception with the specified message and cause.
     *
     * @param message the error message
     * @param cause the underlying cause
     */
    public SDKException(String message, Throwable cause) {
        super(message, cause);
    }
}

/**
 * Thrown when the API returns an error response (4xx/5xx status codes).
 *
 * <p>This exception contains the HTTP status code, error message, response body,
 * and response headers for debugging and error handling.
 */
class ApiException extends SDKException {

    private final int statusCode;
    private final String body;
    private final Map<String, List<String>> headers;

    /**
     * Creates a new API exception.
     *
     * @param statusCode the HTTP status code
     * @param message the error message
     * @param body the response body
     * @param headers the response headers
     */
    public ApiException(int statusCode, String message, String body, Map<String, List<String>> headers) {
        super(message);
        this.statusCode = statusCode;
        this.body = body;
        this.headers = headers;
    }

    /**
     * Returns the HTTP status code.
     *
     * @return the status code
     */
    public int getStatusCode() {
        return statusCode;
    }

    /**
     * Returns the response body.
     *
     * @return the response body, or null if empty
     */
    public String getBody() {
        return body;
    }

    /**
     * Returns the response headers.
     *
     * @return the response headers
     */
    public Map<String, List<String>> getHeaders() {
        return headers;
    }

    /**
     * Returns true if this is a client error (4xx status code).
     *
     * @return true if client error
     */
    public boolean isClientError() {
        return statusCode >= 400 && statusCode < 500;
    }

    /**
     * Returns true if this is a server error (5xx status code).
     *
     * @return true if server error
     */
    public boolean isServerError() {
        return statusCode >= 500;
    }

    /**
     * Returns true if this is a rate limit error (429 status code).
     *
     * @return true if rate limited
     */
    public boolean isRateLimitError() {
        return statusCode == 429;
    }

    /**
     * Returns true if this is an authentication error (401 status code).
     *
     * @return true if authentication error
     */
    public boolean isAuthenticationError() {
        return statusCode == 401;
    }

    /**
     * Returns true if this is an authorization error (403 status code).
     *
     * @return true if authorization error
     */
    public boolean isAuthorizationError() {
        return statusCode == 403;
    }

    /**
     * Returns true if this is a not found error (404 status code).
     *
     * @return true if not found
     */
    public boolean isNotFoundError() {
        return statusCode == 404;
    }

    /**
     * Returns true if this error is retriable.
     *
     * <p>Rate limit errors (429) and server errors (5xx) are typically retriable.
     *
     * @return true if the request can be retried
     */
    public boolean isRetriable() {
        return statusCode == 429 || statusCode >= 500;
    }

    /**
     * Attempts to decode the error body as a typed error response.
     *
     * @param <T> the type to decode to
     * @param type the class of the type to decode to
     * @param mapper the ObjectMapper to use for decoding
     * @return an Optional containing the decoded error, or empty if decoding fails
     */
    public <T> Optional<T> decodeAs(Class<T> type, ObjectMapper mapper) {
        if (body == null || body.isEmpty()) {
            return Optional.empty();
        }
        try {
            return Optional.of(mapper.readValue(body, type));
        } catch (Exception e) {
            return Optional.empty();
        }
    }

    /**
     * Returns a header value by name.
     *
     * @param name the header name (case-insensitive)
     * @return an Optional containing the first header value, or empty if not present
     */
    public Optional<String> getHeader(String name) {
        if (headers == null) {
            return Optional.empty();
        }
        return headers.entrySet().stream()
            .filter(e -> e.getKey().equalsIgnoreCase(name))
            .flatMap(e -> e.getValue().stream())
            .findFirst();
    }

    @Override
    public String toString() {
        return "ApiException{" +
            "statusCode=" + statusCode +
            ", message='" + getMessage() + '\'' +
            '}';
    }
}

/**
 * Thrown when a network connection error occurs.
 *
 * <p>This includes DNS resolution failures, connection refused, connection reset,
 * and other network-level errors.
 */
class ConnectionException extends SDKException {

    /**
     * Creates a new connection exception.
     *
     * @param message the error message
     * @param cause the underlying cause
     */
    public ConnectionException(String message, Throwable cause) {
        super(message, cause);
    }
}

/**
 * Thrown when a request times out.
 *
 * <p>This can occur when the connection timeout, read timeout, or overall
 * request timeout is exceeded.
 */
class TimeoutException extends SDKException {

    /**
     * Creates a new timeout exception.
     *
     * @param message the error message
     */
    public TimeoutException(String message) {
        super(message);
    }

    /**
     * Creates a new timeout exception with a cause.
     *
     * @param message the error message
     * @param cause the underlying cause
     */
    public TimeoutException(String message, Throwable cause) {
        super(message, cause);
    }
}

/**
 * Thrown when request encoding fails.
 *
 * <p>This typically indicates a bug in the SDK or an invalid request object
 * that cannot be serialized to JSON.
 */
class EncodingException extends SDKException {

    /**
     * Creates a new encoding exception.
     *
     * @param message the error message
     * @param cause the underlying cause
     */
    public EncodingException(String message, Throwable cause) {
        super(message, cause);
    }
}

/**
 * Thrown when response decoding fails.
 *
 * <p>This can occur when the API returns an unexpected response format
 * that cannot be deserialized to the expected type.
 */
class DecodingException extends SDKException {

    /**
     * Creates a new decoding exception.
     *
     * @param message the error message
     * @param cause the underlying cause
     */
    public DecodingException(String message, Throwable cause) {
        super(message, cause);
    }
}
{{end}}
