{{define "config.ml.tmpl"}}(** Code generated by sdkocaml. DO NOT EDIT.

    Configuration for the {{.ModuleName}} client.
*)

(** Authentication mode for API requests. *)
type auth_mode =
  | Bearer     (** Bearer token in Authorization header *)
  | Basic      (** Basic authentication *)
  | Api_key    (** API key in X-Api-Key header *)
  | No_auth    (** No authentication *)

let show_auth_mode = function
  | Bearer -> "Bearer"
  | Basic -> "Basic"
  | Api_key -> "Api_key"
  | No_auth -> "No_auth"

let equal_auth_mode a b = a = b

(** Client configuration. *)
type t = {
  api_key : string option;
  base_url : string;
  timeout : float;
  max_retries : int;
  auth_mode : auth_mode;
  headers : (string * string) list;
}

let show t =
  Printf.sprintf "{ api_key = %s; base_url = %s; timeout = %f; max_retries = %d; auth_mode = %s }"
    (match t.api_key with Some k -> "Some \"...\"" | None -> "None")
    t.base_url
    t.timeout
    t.max_retries
    (show_auth_mode t.auth_mode)

let equal a b =
  a.api_key = b.api_key &&
  a.base_url = b.base_url &&
  a.timeout = b.timeout &&
  a.max_retries = b.max_retries &&
  equal_auth_mode a.auth_mode b.auth_mode &&
  a.headers = b.headers

(** Default configuration. *)
let default = {
  api_key = None;
  base_url = {{if .Client.BaseURL}}{{.Client.BaseURL | ocamlQuote}}{{else}}"https://api.example.com"{{end}};
  timeout = 60.0;
  max_retries = 2;
  auth_mode = {{if eq .Client.Auth "bearer"}}Bearer{{else if eq .Client.Auth "basic"}}Basic{{else if eq .Client.Auth "header"}}Api_key{{else}}Bearer{{end}};
  headers = [
{{- range .Client.Headers}}
    ({{.K | ocamlQuote}}, {{.V | ocamlQuote}});
{{- end}}
  ];
}

(** Create a configuration with optional overrides. *)
let make
    ?api_key
    ?(base_url = default.base_url)
    ?(timeout = default.timeout)
    ?(max_retries = default.max_retries)
    ?(auth_mode = default.auth_mode)
    ?(headers = default.headers)
    () =
  { api_key; base_url; timeout; max_retries; auth_mode; headers }

(** Load configuration from environment variables. *)
let from_env () =
  let api_key = Sys.getenv_opt "{{.EnvPrefix}}_API_KEY" in
  let base_url =
    match Sys.getenv_opt "{{.EnvPrefix}}_BASE_URL" with
    | Some url -> url
    | None -> default.base_url
  in
  let timeout =
    match Sys.getenv_opt "{{.EnvPrefix}}_TIMEOUT" with
    | Some t -> (try float_of_string t with _ -> default.timeout)
    | None -> default.timeout
  in
  { default with api_key; base_url; timeout }
{{end}}