{{define "streaming.mli.tmpl"}}(** Code generated by sdkocaml. DO NOT EDIT.

    Server-Sent Events (SSE) streaming support.
*)

(** A parsed SSE event. *)
type 'a event =
  | Data of 'a        (** A data event with parsed payload *)
  | Done              (** Stream completion marker *)
  | Heartbeat         (** Keep-alive ping *)

val show_event : ('a -> string) -> 'a event -> string
val equal_event : ('a -> 'a -> bool) -> 'a event -> 'a event -> bool

(** Internal stream parsing state. *)
type state

(** Create initial parsing state. *)
val initial_state : unit -> state

(** Parse a chunk of SSE data.

    @param state Current parsing state
    @param chunk New data chunk
    @param decode JSON decoder for events
    @return List of parsed events
*)
val parse_chunk :
  state:state ->
  chunk:string ->
  decode:(Yojson.Safe.t -> 'a) ->
  'a event list

(** Create an SSE stream from a byte stream.

    {[
      let event_stream = sse_stream ~decode:Event.of_yojson byte_stream in
      Lwt_stream.iter_s handle_event event_stream
    ]}
*)
val sse_stream :
  decode:(Yojson.Safe.t -> 'a) ->
  string Lwt_stream.t ->
  'a event Lwt_stream.t

(** Collect all data events from a stream.

    {[
      let* events = collect_data event_stream in
      (* events : 'a list *)
    ]}
*)
val collect_data : 'a event Lwt_stream.t -> 'a list Lwt.t

(** Collect all text deltas from a stream.

    {[
      let* texts = collect_text ~extract_text event_stream in
      let full_text = String.concat "" texts
    ]}
*)
val collect_text :
  extract_text:('a -> string option) ->
  'a event Lwt_stream.t ->
  string list Lwt.t
{{end}}