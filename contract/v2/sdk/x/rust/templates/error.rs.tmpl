{{define "error.rs.tmpl"}}// Code generated by sdkrust. DO NOT EDIT.

//! Error types for the {{.Service.Name}} SDK.

use thiserror::Error;

/// Errors that can occur when using the SDK.
#[derive(Debug, Error)]
#[non_exhaustive]
pub enum Error {
    /// HTTP request failed.
    #[error("HTTP error: {status}")]
    Http {
        /// HTTP status code.
        status: u16,
        /// Response body, if available.
        body: Option<String>,
    },

    /// Request timed out.
    #[error("request timed out")]
    Timeout,

    /// Connection failed.
    #[error("connection error: {0}")]
    Connection(#[source] reqwest::Error),

    /// Request was cancelled.
    #[error("request cancelled")]
    Cancelled,

    /// Failed to serialize request body.
    #[error("serialization error: {0}")]
    Serialization(#[source] serde_json::Error),

    /// Failed to deserialize response body.
    #[error("deserialization error: {0}")]
    Deserialization(#[source] serde_json::Error),

    /// Streaming error.
    #[error("streaming error: {0}")]
    Stream(String),

    /// Invalid configuration.
    #[error("invalid configuration: {0}")]
    InvalidConfig(String),
}

/// A specialized Result type for SDK operations.
pub type Result<T> = std::result::Result<T, Error>;

impl Error {
    /// Returns true if this error is potentially retriable.
    #[must_use]
    pub fn is_retriable(&self) -> bool {
        match self {
            Self::Http { status, .. } => {
                *status >= 500 || *status == 429
            }
            Self::Timeout | Self::Connection(_) => true,
            _ => false,
        }
    }

    /// Returns the HTTP status code, if this is an HTTP error.
    #[must_use]
    pub fn status(&self) -> Option<u16> {
        match self {
            Self::Http { status, .. } => Some(*status),
            _ => None,
        }
    }

    /// Returns the response body, if available.
    #[must_use]
    pub fn body(&self) -> Option<&str> {
        match self {
            Self::Http { body, .. } => body.as_deref(),
            _ => None,
        }
    }

    /// Returns true if this is a rate limit error (HTTP 429).
    #[must_use]
    pub fn is_rate_limited(&self) -> bool {
        matches!(self, Self::Http { status: 429, .. })
    }

    /// Returns true if this is a server error (HTTP 5xx).
    #[must_use]
    pub fn is_server_error(&self) -> bool {
        matches!(self, Self::Http { status, .. } if *status >= 500)
    }

    /// Returns true if this is a client error (HTTP 4xx).
    #[must_use]
    pub fn is_client_error(&self) -> bool {
        matches!(self, Self::Http { status, .. } if *status >= 400 && *status < 500)
    }
}
{{end}}
