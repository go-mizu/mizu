{{define "Errors.swift.tmpl"}}// Code generated by sdkswift. DO NOT EDIT.

import Foundation

// MARK: - SDK Errors

/// Base error type for all SDK errors.
public enum SDKError: Error, Sendable {
    /// Network connection failed.
    case connectionError(underlying: Error)

    /// Request timed out.
    case timeout

    /// Request was cancelled.
    case cancelled

    /// Failed to encode request body.
    case encodingError(underlying: Error)

    /// Failed to decode response body.
    case decodingError(underlying: Error)
}

extension SDKError: LocalizedError {
    public var errorDescription: String? {
        switch self {
        case .connectionError(let underlying):
            return "Connection error: \(underlying.localizedDescription)"
        case .timeout:
            return "Request timed out"
        case .cancelled:
            return "Request was cancelled"
        case .encodingError(let underlying):
            return "Failed to encode request: \(underlying.localizedDescription)"
        case .decodingError(let underlying):
            return "Failed to decode response: \(underlying.localizedDescription)"
        }
    }
}

// MARK: - API Errors

/// Error returned by the API.
public struct APIError: Error, Sendable {
    /// HTTP status code.
    public let statusCode: Int

    /// Error message.
    public let message: String

    /// Raw error body (may be dictionary, string, or nil).
    public let body: Any?

    /// Creates a new API error.
    public init(statusCode: Int, message: String, body: Any? = nil) {
        self.statusCode = statusCode
        self.message = message
        self.body = body
    }

    /// Whether this is a client error (4xx).
    public var isClientError: Bool {
        statusCode >= 400 && statusCode < 500
    }

    /// Whether this is a server error (5xx).
    public var isServerError: Bool {
        statusCode >= 500
    }

    /// Whether this is a rate limit error (429).
    public var isRateLimitError: Bool {
        statusCode == 429
    }

    /// Whether this is an authentication error (401).
    public var isAuthenticationError: Bool {
        statusCode == 401
    }

    /// Whether this is an authorization error (403).
    public var isAuthorizationError: Bool {
        statusCode == 403
    }

    /// Whether this is a not found error (404).
    public var isNotFoundError: Bool {
        statusCode == 404
    }

    /// Attempts to decode the error body as the specified type.
    /// - Parameter type: The type to decode the body as.
    /// - Returns: The decoded value.
    /// - Throws: DecodingError if decoding fails.
    public func decoded<T: Decodable>(as type: T.Type) throws -> T {
        guard let body = body else {
            throw DecodingError.valueNotFound(
                T.self,
                DecodingError.Context(
                    codingPath: [],
                    debugDescription: "Error body is nil"
                )
            )
        }

        if let dict = body as? [String: Any] {
            let data = try JSONSerialization.data(withJSONObject: dict)
            return try JSONDecoder().decode(T.self, from: data)
        }

        if let string = body as? String {
            let data = Data(string.utf8)
            return try JSONDecoder().decode(T.self, from: data)
        }

        throw DecodingError.typeMismatch(
            T.self,
            DecodingError.Context(
                codingPath: [],
                debugDescription: "Cannot decode body of type \(type(of: body))"
            )
        )
    }

    /// Returns the error body as a dictionary if possible.
    public var bodyAsDictionary: [String: Any]? {
        body as? [String: Any]
    }

    /// Returns the error body as a string if possible.
    public var bodyAsString: String? {
        if let string = body as? String {
            return string
        }
        if let dict = body as? [String: Any] {
            if let data = try? JSONSerialization.data(withJSONObject: dict, options: .prettyPrinted) {
                return String(data: data, encoding: .utf8)
            }
        }
        return nil
    }
}

extension APIError: LocalizedError {
    public var errorDescription: String? {
        "API Error \(statusCode): \(message)"
    }
}

extension APIError: CustomStringConvertible {
    public var description: String {
        var desc = "APIError(statusCode: \(statusCode), message: \(message)"
        if let bodyString = bodyAsString {
            desc += ", body: \(bodyString)"
        }
        desc += ")"
        return desc
    }
}

// MARK: - Typed Error Response

/// Standard error response structure.
/// This can be used to decode common error response formats.
public struct ErrorResponse: Codable, Hashable, Sendable {
    /// Error type or code.
    public let type: String?

    /// Error code.
    public let code: String?

    /// Error message.
    public let message: String?

    /// Additional error details.
    public let error: ErrorDetail?

    public init(
        type: String? = nil,
        code: String? = nil,
        message: String? = nil,
        error: ErrorDetail? = nil
    ) {
        self.type = type
        self.code = code
        self.message = message
        self.error = error
    }
}

/// Error detail structure.
public struct ErrorDetail: Codable, Hashable, Sendable {
    /// Error type.
    public let type: String?

    /// Error message.
    public let message: String?

    public init(type: String? = nil, message: String? = nil) {
        self.type = type
        self.message = message
    }
}
{{end}}
