import{j as e,B as u,A as N,T as g,O as ee,Q as O,R as me,S as q,G as T,V as es,D as pe,e as E,M as b,W as ss,X as ts,Y as rs,w as je,d as de,f as he,b as xe,h as Y,y,q as be,Z as as,F as ns}from"./vendor-mantine-0E1e8SJ8.js";import{r as c}from"./vendor-react-CFPnf9wS.js";import{P as ls}from"./PageContainer-BJil4t7q.js";import{E as ye}from"./EmptyState-CjtLm1uN.js";import{C as we}from"./ConfirmModal-Ba3Tq8oS.js";import{P as is}from"./StatusBadge-s2x2FBsx.js";import{s as k}from"./storage-COHXYSuF.js";import{u as os}from"./index-Bwll0WcM.js";import{_ as cs,m as K,u as ds,$ as Se,a0 as Ie,a1 as fe,a2 as se,a3 as te,a4 as re,a5 as ae,a6 as ne,a7 as le,a8 as ie,a9 as oe,aa as Be,g as ce,ab as Fe,ac as De,q as Le,ad as Pe,ae as Ee,af as Te,ag as Ue,ah as We,ai as Me,aj as Oe,ak as Re,al as us,w as ps,am as ue,B as hs,Z as $e,an as xs,ao as Ce,k as ke,ap as ms,aq as fs,a as gs,X as js,t as bs,V as ys}from"./vendor-icons-rmXLq6rR.js";import"./client-CvoVCtJO.js";import"./vendor-state-Ud2phgVo.js";function ws(s){var p,h;const t=s.content_type||"",l=(p=s.name.split(".").pop())==null?void 0:p.toLowerCase(),n=((h=s.name.split("/").pop())==null?void 0:h.toLowerCase())||"";if(t.startsWith("image/"))return Se;if(t.startsWith("video/"))return Ie;if(t.startsWith("audio/"))return fe;if(t==="application/pdf")return se;if(t==="application/json")return te;if(t==="text/csv"||t==="application/csv")return re;if(t==="application/xml"||t==="text/xml")return ae;if(t==="application/sql"||t==="text/x-sql")return ne;if(t.includes("spreadsheet")||t.includes("excel"))return le;if(t.includes("presentation")||t.includes("powerpoint"))return ie;if(t.includes("wordprocessing")||t.includes("msword"))return oe;if(n==="dockerfile")return Be;if(n==="makefile")return ce;switch(l){case"js":case"jsx":case"ts":case"tsx":return Re;case"py":return Oe;case"rs":return Me;case"go":case"java":case"c":case"cpp":case"h":case"hpp":case"swift":case"kt":case"rb":case"php":return We;case"md":case"mdx":return Ue;case"json":return te;case"html":case"htm":return Te;case"css":case"scss":case"less":return Ee;case"zip":case"tar":case"gz":case"rar":case"7z":case"tgz":return Pe;case"txt":case"log":return Le;case"pdf":return se;case"csv":return re;case"xml":return ae;case"sql":return ne;case"xlsx":case"xls":return le;case"pptx":case"ppt":return ie;case"docx":case"doc":return oe;case"yaml":case"yml":case"toml":case"ini":case"conf":case"cfg":return De;case"sh":case"bash":case"zsh":return ce;default:return Fe}}function Cs(s){return s.name.endsWith("/")||!s.content_type}function ks(s){if(s===0)return"0 B";const t=1024,l=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+l[n]}function vs({path:s,items:t,selectedItem:l,loading:n,error:p,columnIndex:h,showBackButton:w,onItemSelect:C,onBack:v}){const f=s?s.split("/").pop()||s:"Root";return e.jsxs(u,{style:{minWidth:220,maxWidth:280,width:240,borderRight:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)",flexShrink:0},children:[e.jsxs(u,{px:"xs",py:6,style:{borderBottom:"1px solid var(--supabase-border)",display:"flex",alignItems:"center",gap:6,minHeight:36},children:[w&&e.jsx(N,{variant:"subtle",size:"sm",onClick:()=>v(h),style:{flexShrink:0},children:e.jsx(cs,{size:16})}),e.jsx(g,{size:"sm",fw:500,truncate:!0,style:{flex:1},children:f})]}),e.jsx(ee,{style:{flex:1},scrollbarSize:6,children:n?e.jsx(O,{py:"xl",children:e.jsx(me,{size:"sm"})}):p?e.jsx(O,{py:"xl",children:e.jsx(g,{size:"sm",c:"red",children:p})}):t.length===0?e.jsx(O,{py:"xl",children:e.jsx(g,{size:"sm",c:"dimmed",children:"Empty folder"})}):e.jsx(q,{gap:0,children:t.map(m=>{const z=Cs(m),S=z?K:ws(m),I=m.name.split("/").filter(Boolean).pop()||m.name,B=l===m.name;return e.jsxs(u,{px:"xs",py:6,style:{cursor:"pointer",borderLeft:B?"2px solid var(--supabase-brand)":"2px solid transparent",backgroundColor:B?"var(--supabase-brand-light)":"transparent",display:"flex",alignItems:"center",gap:8,transition:"background-color 0.1s ease"},onClick:()=>C(m,h),onMouseEnter:F=>{B||(F.currentTarget.style.backgroundColor="var(--supabase-bg-surface)")},onMouseLeave:F=>{B||(F.currentTarget.style.backgroundColor="transparent")},children:[e.jsx(S,{size:18,color:z?"var(--supabase-brand)":"var(--supabase-text-muted)",stroke:1.5,style:{flexShrink:0}}),e.jsxs(u,{style:{flex:1,minWidth:0},children:[e.jsx(g,{size:"sm",truncate:!0,children:I}),!z&&m.size>0&&e.jsx(g,{size:"xs",c:"dimmed",children:ks(m.size)})]}),z&&e.jsx(ds,{size:14,color:"var(--supabase-text-muted)",style:{flexShrink:0}})]},m.id||m.name)})})})]})}function zs({columns:s,onItemSelect:t,onBack:l}){return s.length===0?null:e.jsx(ee,{style:{flex:1,backgroundColor:"var(--supabase-bg)",pointerEvents:"auto"},scrollbarSize:6,type:"hover",children:e.jsx(u,{style:{display:"flex",minHeight:"100%"},children:s.map((n,p)=>e.jsx(vs,{path:n.path,items:n.items,selectedItem:n.selectedItem,loading:n.loading,error:n.error,columnIndex:p,showBackButton:p>0,onItemSelect:t,onBack:l},`${n.path}-${p}`))})})}function Ss(s){var p,h;const t=s.content_type||"",l=(p=s.name.split(".").pop())==null?void 0:p.toLowerCase(),n=((h=s.name.split("/").pop())==null?void 0:h.toLowerCase())||"";if(t.startsWith("image/"))return Se;if(t.startsWith("video/"))return Ie;if(t.startsWith("audio/"))return fe;if(t==="application/pdf")return se;if(t==="application/json")return te;if(t==="text/csv"||t==="application/csv")return re;if(t==="application/xml"||t==="text/xml")return ae;if(t==="application/sql"||t==="text/x-sql")return ne;if(t.includes("spreadsheet")||t.includes("excel"))return le;if(t.includes("presentation")||t.includes("powerpoint"))return ie;if(t.includes("wordprocessing")||t.includes("msword"))return oe;if(n==="dockerfile")return Be;if(n==="makefile")return ce;switch(l){case"js":case"jsx":case"ts":case"tsx":return Re;case"py":return Oe;case"rs":return Me;case"go":case"java":case"c":case"cpp":case"h":case"hpp":case"swift":case"kt":case"rb":case"php":return We;case"md":case"mdx":return Ue;case"json":return te;case"html":case"htm":return Te;case"css":case"scss":case"less":return Ee;case"zip":case"tar":case"gz":case"rar":case"7z":case"tgz":return Pe;case"txt":case"log":return Le;case"pdf":return se;case"csv":return re;case"xml":return ae;case"sql":return ne;case"xlsx":case"xls":return le;case"pptx":case"ppt":return ie;case"docx":case"doc":return oe;case"yaml":case"yml":case"toml":case"ini":case"conf":case"cfg":return De;case"sh":case"bash":case"zsh":return ce;default:return Fe}}function Is(s){return s?s.startsWith("image/"):!1}function Bs(s){return s?s.startsWith("video/"):!1}function Fs(s){return s?s.startsWith("audio/"):!1}function ve(s,t){var C,v;if(!s&&!t)return!1;if(s&&["text/plain","text/html","text/css","text/javascript","text/csv","text/markdown","text/typescript","text/x-python","text/x-go","text/x-rust","text/x-java","application/json","application/javascript","application/xml","application/sql","application/x-yaml","application/toml"].some(f=>s.includes(f)))return!0;const n=(C=t.split(".").pop())==null?void 0:C.toLowerCase(),p=((v=t.split("/").pop())==null?void 0:v.toLowerCase())||"";return["dockerfile","makefile","gemfile","rakefile","procfile"].includes(p)?!0:n?["txt","md","mdx","json","js","jsx","ts","tsx","py","go","rs","java","c","cpp","h","hpp","css","scss","less","html","htm","xml","yaml","yml","toml","ini","cfg","conf","sh","bash","zsh","sql","graphql","vue","svelte","astro","rb","php","swift","kt","gradle","env","gitignore","log","csv","tsv","properties"].includes(n):!1}function Ds(s){if(s===0)return"0 B";const t=1024,l=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+l[n]}function ze(s){return new Date(s).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function Ls({file:s,bucket:t,onClose:l,onDownload:n,onDelete:p,onCopyUrl:h}){const[w,C]=c.useState(null),[v,f]=c.useState(null),[m,z]=c.useState(!1),S=Ss(s),I=s.name.split("/").pop()||s.name,B=s.content_type||"Unknown";c.useEffect(()=>{if(t){const L=k.downloadObjectUrl(t.id,s.name);C(L),ve(s.content_type,s.name)?(z(!0),fetch(L).then(a=>a.text()).then(a=>{f(a.slice(0,1e4))}).catch(()=>f(null)).finally(()=>z(!1))):f(null)}},[s,t]);const F=()=>{if(Is(s.content_type)&&w)return e.jsx(u,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:16,display:"flex",alignItems:"center",justifyContent:"center",minHeight:200},children:e.jsx(ss,{src:w,alt:I,fit:"contain",style:{maxHeight:300},radius:"md"})});if(Bs(s.content_type)&&w)return e.jsx(u,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",overflow:"hidden"},children:e.jsx("video",{src:w,controls:!0,style:{width:"100%",maxHeight:300}})});if(Fs(s.content_type)&&w)return e.jsxs(u,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:24},children:[e.jsx(O,{mb:"md",children:e.jsx(fe,{size:48,color:"var(--supabase-text-muted)"})}),e.jsx("audio",{src:w,controls:!0,style:{width:"100%"}})]});if(ve(s.content_type,s.name)){if(m)return e.jsx(O,{py:"xl",children:e.jsx(me,{size:"sm"})});if(v)return e.jsx(ee,{h:300,children:e.jsx(ts,{block:!0,style:{backgroundColor:"var(--supabase-bg-surface)",fontSize:"0.75rem",lineHeight:1.5},children:v})})}return e.jsxs(u,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:48,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(S,{size:64,color:"var(--supabase-text-muted)",stroke:1}),e.jsx(g,{size:"sm",c:"dimmed",mt:"md",children:"Preview not available"})]})};return e.jsxs(u,{style:{width:320,minWidth:320,borderLeft:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)",flexShrink:0},children:[e.jsx(u,{px:"sm",py:"xs",style:{borderBottom:"1px solid var(--supabase-border)",minHeight:40,display:"flex",alignItems:"center"},children:e.jsx(T,{justify:"flex-end",style:{width:"100%"},children:e.jsx(es,{onClick:l})})}),e.jsx(ee,{style:{flex:1},scrollbarSize:6,children:e.jsxs(u,{p:"md",children:[F(),e.jsxs(u,{mt:"lg",children:[e.jsx(g,{fw:600,size:"sm",style:{wordBreak:"break-word"},children:I}),e.jsxs(g,{size:"xs",c:"dimmed",mt:4,children:[B," - ",Ds(s.size)]})]}),e.jsxs(q,{gap:"sm",mt:"lg",children:[e.jsxs(u,{children:[e.jsx(g,{size:"xs",c:"dimmed",children:"Added on"}),e.jsx(g,{size:"sm",children:s.created_at?ze(s.created_at):"Unknown"})]}),e.jsxs(u,{children:[e.jsx(g,{size:"xs",c:"dimmed",children:"Last modified"}),e.jsx(g,{size:"sm",children:s.updated_at?ze(s.updated_at):"Unknown"})]}),s.owner&&e.jsxs(u,{children:[e.jsx(g,{size:"xs",c:"dimmed",children:"Owner"}),e.jsx(g,{size:"sm",truncate:!0,children:s.owner})]})]}),e.jsx(pe,{my:"lg"}),e.jsxs(q,{gap:"xs",children:[e.jsx(E,{variant:"outline",leftSection:e.jsx(us,{size:16}),onClick:n,fullWidth:!0,children:"Download"}),e.jsxs(b,{position:"bottom-end",width:200,children:[e.jsx(b.Target,{children:e.jsx(E,{variant:"outline",leftSection:e.jsx(ue,{size:16}),rightSection:e.jsx(ps,{size:14}),fullWidth:!0,children:"Get URL"})}),e.jsxs(b.Dropdown,{children:[t.public&&e.jsx(b.Item,{leftSection:e.jsx(ue,{size:14}),onClick:()=>h("public"),children:"Copy public URL"}),e.jsx(b.Item,{leftSection:e.jsx(ue,{size:14}),onClick:()=>h("signed"),children:"Copy signed URL (1 hour)"}),e.jsx(b.Item,{leftSection:e.jsx(hs,{size:14}),onClick:()=>{const L=t.public?`${window.location.origin}${k.getPublicUrl(t.id,s.name)}`:k.downloadObjectUrl(t.id,s.name);window.open(L,"_blank")},children:"Open in new tab"})]})]}),e.jsx(pe,{my:"xs"}),e.jsx(E,{variant:"subtle",color:"red",leftSection:e.jsx($e,{size:16}),onClick:p,fullWidth:!0,children:"Delete file"})]})]})})]})}function Ps({bucketName:s,currentPath:t,viewMode:l,onRefresh:n,onUpload:p,onCreateFolder:h,onDeleteBucket:w,onViewModeChange:C,onSearch:v,onNavigateToPath:f,uploadLoading:m}){const[z,S]=c.useState(!1),[I,B]=c.useState(""),F=t?t.split("/").filter(Boolean):[],L=()=>{I.trim()&&v(I.trim()),S(!1),B("")};return e.jsxs(u,{px:"sm",py:"xs",style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)",minHeight:48,display:"flex",alignItems:"center"},children:[e.jsxs(T,{justify:"space-between",style:{flex:1},children:[e.jsxs(rs,{children:[e.jsx(je,{size:"sm",onClick:()=>f(""),style:{cursor:"pointer"},children:s}),F.map((a,o)=>e.jsx(je,{size:"sm",onClick:()=>{const d=F.slice(0,o+1).join("/");f(d)},style:{cursor:"pointer"},children:a},o))]}),e.jsxs(T,{gap:"sm",children:[e.jsx(de,{label:"Reload",children:e.jsx(N,{variant:"subtle",onClick:n,children:e.jsx(xs,{size:18})})}),e.jsxs(b,{position:"bottom-end",width:160,children:[e.jsx(b.Target,{children:e.jsx(de,{label:"View",children:e.jsx(N,{variant:"subtle",children:l==="columns"?e.jsx(Ce,{size:18}):e.jsx(ke,{size:18})})})}),e.jsxs(b.Dropdown,{children:[e.jsx(b.Item,{leftSection:e.jsx(Ce,{size:14}),onClick:()=>C("columns"),style:{backgroundColor:l==="columns"?"var(--supabase-brand-light)":void 0},children:"Column view"}),e.jsx(b.Item,{leftSection:e.jsx(ke,{size:14}),onClick:()=>C("list"),style:{backgroundColor:l==="list"?"var(--supabase-brand-light)":void 0},children:"List view"})]})]}),e.jsx(E,{variant:"outline",leftSection:e.jsx(ms,{size:16}),onClick:p,loading:m,size:"sm",children:"Upload files"}),e.jsx(E,{variant:"outline",leftSection:e.jsx(fs,{size:16}),onClick:h,size:"sm",children:"Create folder"}),e.jsx(de,{label:"Search",children:e.jsx(N,{variant:"subtle",onClick:()=>S(!0),children:e.jsx(gs,{size:18})})}),e.jsxs(b,{position:"bottom-end",children:[e.jsx(b.Target,{children:e.jsx(N,{variant:"subtle",children:e.jsx(js,{size:18})})}),e.jsxs(b.Dropdown,{children:[e.jsx(b.Item,{leftSection:e.jsx(bs,{size:14}),disabled:!0,children:"Bucket settings"}),e.jsx(b.Divider,{}),e.jsx(b.Item,{color:"red",leftSection:e.jsx($e,{size:14}),onClick:w,children:"Delete bucket"})]})]})]})]}),e.jsxs(he,{opened:z,onClose:()=>{S(!1),B("")},title:"Search files",size:"md",children:[e.jsx(xe,{placeholder:"Search by file name...",value:I,onChange:a=>B(a.target.value),onKeyDown:a=>{a.key==="Enter"&&L()},autoFocus:!0}),e.jsxs(T,{justify:"flex-end",mt:"md",children:[e.jsx(E,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(E,{onClick:L,children:"Search"})]})]})]})}function Es({bucketId:s,onFileSelect:t}){const[l,n]=c.useState([]),[p,h]=c.useState(null),[w,C]=c.useState(!1),v=c.useCallback(a=>a.name.endsWith("/")||!a.content_type,[]),f=c.useCallback(async a=>{if(!s)return[];try{return await k.listObjects(s,{prefix:a,limit:100})}catch(o){return console.error("Failed to fetch column items:",o),[]}},[s]);c.useEffect(()=>{(async()=>{if(!s){n([]),h(null);return}C(!0);try{const o=await f("");n([{path:"",items:o,selectedItem:null,loading:!1,error:null}]),h(null)}catch(o){n([{path:"",items:[],selectedItem:null,loading:!1,error:o.message||"Failed to load items"}])}finally{C(!1)}})()},[s,f]),c.useEffect(()=>{t==null||t(p)},[p,t]);const m=c.useCallback(async(a,o)=>{if(s){n(d=>{const i=d.slice(0,o+1);return i[o]&&(i[o]={...i[o],selectedItem:a}),i.push({path:a,items:[],selectedItem:null,loading:!0,error:null}),i}),h(null);try{const d=await f(a);n(i=>{var D;const x=i.length-1;if(((D=i[x])==null?void 0:D.path)===a){const P=[...i];return P[x]={...P[x],items:d,loading:!1},P}return i})}catch(d){n(i=>{var D;const x=i.length-1;if(((D=i[x])==null?void 0:D.path)===a){const P=[...i];return P[x]={...P[x],loading:!1,error:d.message||"Failed to load items"},P}return i})}}},[s,f]),z=c.useCallback((a,o)=>{if(v(a)){const d=a.name.replace(/\/$/,"");m(d,o)}else n(d=>{const i=d.slice(0,o+1);return i[o]&&(i[o]={...i[o],selectedItem:a.name}),i}),h(a)},[v,m]),S=c.useCallback(a=>{a!==0&&(n(o=>{const d=o.slice(0,a);if(d.length>0){const i=d.length-1;d[i]={...d[i],selectedItem:null}}return d}),h(null))},[]),I=c.useCallback(async a=>{if(!s||!l[a])return;const o=l[a];n(d=>{const i=[...d];return i[a]={...i[a],loading:!0,error:null},i});try{const d=await f(o.path);n(i=>{const x=[...i];return x[a]&&(x[a]={...x[a],items:d,loading:!1}),x})}catch(d){n(i=>{const x=[...i];return x[a]&&(x[a]={...x[a],loading:!1,error:d.message||"Failed to refresh"}),x})}},[s,l,f]),B=c.useCallback(()=>{l.forEach((a,o)=>{I(o)})},[l,I]),F=c.useCallback(()=>{h(null),n(a=>a.map(o=>({...o,selectedItem:null})))},[]),L=l.length>1?l[l.length-1].path:"";return{columns:l,selectedFile:p,loading:w,navigateToFolder:m,selectItem:z,navigateBack:S,refreshColumn:I,refreshAll:B,clearSelection:F,currentPath:L}}function Hs(){const{selectedBucket:s,setSelectedBucket:t}=os(),[l,n]=c.useState([]),[p,h]=c.useState(!0),[w,C]=c.useState(!1),[v,f]=c.useState("columns"),[m,{open:z,close:S}]=Y(!1),[I,{open:B,close:F}]=Y(!1),[L,{open:a,close:o}]=Y(!1),[d,{open:i,close:x}]=Y(!1),[D,P]=c.useState({name:"",public:!1}),[Q,ge]=c.useState(""),[X,W]=c.useState(!1),R=c.useRef(null),{columns:$,selectedFile:U,navigateToFolder:_e,selectItem:qe,navigateBack:Ae,refreshAll:H,clearSelection:Z,currentPath:V}=Es({bucketId:s}),J=c.useCallback(async()=>{h(!0);try{const r=await k.listBuckets();n(r),r.length>0&&!s&&t(r[0].id)}catch(r){y.show({title:"Error",message:r.message||"Failed to load buckets",color:"red"})}finally{h(!1)}},[s,t]);c.useEffect(()=>{J()},[J]);const Ne=async()=>{if(!D.name){y.show({title:"Validation Error",message:"Bucket name is required",color:"red"});return}W(!0);try{await k.createBucket({name:D.name,public:D.public}),y.show({title:"Success",message:"Bucket created successfully",color:"green"}),S(),P({name:"",public:!1}),J()}catch(r){y.show({title:"Error",message:r.message||"Failed to create bucket",color:"red"})}finally{W(!1)}},He=async()=>{if(s){W(!0);try{await k.deleteBucket(s),y.show({title:"Success",message:"Bucket deleted successfully",color:"green"}),F(),t(null),J()}catch(r){y.show({title:"Error",message:r.message||"Failed to delete bucket",color:"red"})}finally{W(!1)}}},Ve=async r=>{if(!(!s||r.length===0)){C(!0);try{for(const j of r){const A=V?`${V}/${j.name}`:j.name;await k.uploadObject(s,A,j)}y.show({title:"Success",message:`${r.length} file(s) uploaded successfully`,color:"green"}),H()}catch(j){y.show({title:"Error",message:j.message||"Failed to upload files",color:"red"})}finally{C(!1)}}},Ge=async()=>{if(!(!s||!U)){W(!0);try{await k.deleteObject(s,U.name),y.show({title:"Success",message:"File deleted successfully",color:"green"}),o(),Z(),H()}catch(r){y.show({title:"Error",message:r.message||"Failed to delete file",color:"red"})}finally{W(!1)}}},Ke=async()=>{if(!s||!Q.trim()){y.show({title:"Validation Error",message:"Folder name is required",color:"red"});return}W(!0);try{const r=V?`${V}/${Q.trim()}/.keep`:`${Q.trim()}/.keep`,j=new File([""],".keep",{type:"text/plain"});await k.uploadObject(s,r,j),y.show({title:"Success",message:"Folder created successfully",color:"green"}),x(),ge(""),H()}catch(r){y.show({title:"Error",message:r.message||"Failed to create folder",color:"red"})}finally{W(!1)}},Qe=r=>{if(!s)return;const j=k.downloadObjectUrl(s,r.name);window.open(j,"_blank")},Xe=async(r,j)=>{if(!s)return;const A=l.find(G=>G.id===s);let M;if(j==="public"&&(A!=null&&A.public))M=`${window.location.origin}${k.getPublicUrl(s,r.name)}`;else try{M=(await k.createSignedUrl(s,r.name,3600)).signedURL}catch{M=k.downloadObjectUrl(s,r.name)}navigator.clipboard.writeText(M),y.show({title:"Copied",message:"URL copied to clipboard",color:"green"})},Ze=async r=>{if(s)try{const j=await k.listObjects(s,{prefix:"",search:r,limit:100});y.show({title:"Search Results",message:`Found ${j.length} matching files`,color:"blue"})}catch(j){y.show({title:"Search Error",message:j.message||"Failed to search files",color:"red"})}},Je=r=>{if(r==="")H();else{const j=r.split("/");if($.findIndex(M=>M.path===r)>=0)Z();else{const M=j.slice(0,-1).join("/"),G=$.findIndex(Ye=>Ye.path===M);G>=0&&_e(r,G)}}},_=l.find(r=>r.id===s);return e.jsxs(ls,{title:"Storage",description:"Manage files and buckets",fullWidth:!0,noPadding:!0,children:[e.jsxs(u,{style:{display:"flex",height:"calc(100vh - 140px)"},children:[e.jsxs(u,{style:{width:240,borderRight:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)",flexShrink:0},children:[e.jsx(u,{px:"md",pt:"md",children:e.jsx(g,{size:"xs",fw:600,tt:"uppercase",c:"dimmed",style:{letterSpacing:"0.05em",fontSize:"0.6875rem"},children:"Manage"})}),e.jsx(u,{p:"xs",children:e.jsx(q,{gap:2,children:e.jsx(be,{p:"xs",style:{cursor:"pointer",backgroundColor:"var(--supabase-brand-light)",borderRadius:6},children:e.jsxs(T,{gap:"xs",children:[e.jsx(K,{size:16,color:"var(--supabase-brand)"}),e.jsx(g,{size:"sm",fw:500,children:"Files"})]})})})}),e.jsx(pe,{mx:"md",my:"xs"}),e.jsx(u,{px:"md",pt:"xs",children:e.jsxs(T,{justify:"space-between",mb:"xs",children:[e.jsx(g,{size:"xs",c:"dimmed",children:"Buckets"}),e.jsx(N,{variant:"subtle",onClick:z,size:"sm",children:e.jsx(ys,{size:14})})]})}),e.jsx(u,{style:{flex:1,overflow:"auto"},px:"xs",pb:"sm",children:p?e.jsx(O,{py:"xl",children:e.jsx(me,{size:"sm"})}):l.length===0?e.jsx(g,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No buckets yet"}):e.jsx(q,{gap:2,children:l.map(r=>e.jsx(be,{p:"xs",style:{cursor:"pointer",backgroundColor:s===r.id?"var(--supabase-bg-surface)":"transparent",borderRadius:6},onClick:()=>{t(r.id),Z()},children:e.jsxs(T,{justify:"space-between",wrap:"nowrap",children:[e.jsxs(T,{gap:"xs",wrap:"nowrap",children:[e.jsx(K,{size:16,color:"var(--supabase-text-muted)"}),e.jsx(g,{size:"sm",truncate:!0,style:{maxWidth:120},children:r.name})]}),e.jsx(is,{isPublic:r.public})]})},r.id))})})]}),e.jsx(u,{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:s&&_?e.jsxs(e.Fragment,{children:[e.jsx(Ps,{bucketName:_.name,currentPath:V,viewMode:v,onRefresh:H,onUpload:()=>{var r;return(r=R.current)==null?void 0:r.call(R)},onCreateFolder:i,onDeleteBucket:B,onViewModeChange:f,onSearch:Ze,onNavigateToPath:Je,uploadLoading:w}),e.jsxs(u,{style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx(as,{onDrop:Ve,openRef:R,activateOnClick:!1,styles:{root:{border:"none",backgroundColor:"transparent",flex:1,display:"flex",minWidth:0,padding:0,pointerEvents:"auto"},inner:{pointerEvents:"none",display:"flex",flex:1,padding:0,minWidth:0}},children:$.length===0||$.length===1&&$[0].items.length===0&&!$[0].loading?e.jsx(O,{style:{flex:1,pointerEvents:"auto"},children:e.jsx(ye,{icon:e.jsx(K,{size:32}),title:"No files",description:"Upload files or create a folder to get started",action:{label:"Upload files",onClick:()=>{var r;return(r=R.current)==null?void 0:r.call(R)}}})}):e.jsx(zs,{columns:$,onItemSelect:qe,onBack:Ae})}),U&&_&&e.jsx(Ls,{file:U,bucket:_,onClose:Z,onDownload:()=>Qe(U),onDelete:a,onCopyUrl:r=>Xe(U,r)})]})]}):e.jsx(O,{style:{flex:1},children:e.jsx(ye,{icon:e.jsx(K,{size:32}),title:"Select a bucket",description:"Choose a bucket from the sidebar or create a new one",action:{label:"Create bucket",onClick:z}})})})]}),e.jsx(he,{opened:m,onClose:S,title:"Create bucket",size:"md",children:e.jsxs(q,{gap:"md",children:[e.jsx(xe,{label:"Name",placeholder:"my-bucket",value:D.name,onChange:r=>P({...D,name:r.target.value}),required:!0}),e.jsx(ns,{label:"Public bucket",description:"Allow public access to files without authentication",checked:D.public,onChange:r=>P({...D,public:r.target.checked})}),e.jsxs(T,{justify:"flex-end",mt:"md",children:[e.jsx(E,{variant:"outline",onClick:S,children:"Cancel"}),e.jsx(E,{onClick:Ne,loading:X,children:"Create bucket"})]})]})}),e.jsx(he,{opened:d,onClose:x,title:"Create folder",size:"md",children:e.jsxs(q,{gap:"md",children:[e.jsx(xe,{label:"Folder name",placeholder:"my-folder",value:Q,onChange:r=>ge(r.target.value),required:!0}),e.jsxs(T,{justify:"flex-end",mt:"md",children:[e.jsx(E,{variant:"outline",onClick:x,children:"Cancel"}),e.jsx(E,{onClick:Ke,loading:X,children:"Create folder"})]})]})}),e.jsx(we,{opened:I,onClose:F,onConfirm:He,title:"Delete bucket",message:`Are you sure you want to delete "${_==null?void 0:_.name}"? All files in this bucket will be permanently deleted.`,confirmLabel:"Delete",danger:!0,loading:X}),e.jsx(we,{opened:L,onClose:o,onConfirm:Ge,title:"Delete file",message:`Are you sure you want to delete "${U==null?void 0:U.name.split("/").pop()}"?`,confirmLabel:"Delete",danger:!0,loading:X})]})}export{Hs as StoragePage};
