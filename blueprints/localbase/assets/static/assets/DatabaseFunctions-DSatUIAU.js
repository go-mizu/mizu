import{h as V,j as e,B as c,X as k,G as a,a8 as N,a as n,a3 as B,b as O,d as f,A as T,I as q,t as G,V as S,x as r,T as t,_ as o,f as K,S as Q}from"./vendor-mantine-aKbh6G_O.js";import{r as l}from"./vendor-react-CA6k1jPF.js";import{p as U}from"./pgmeta-Ch70PY3U.js";import{g as b,a as Y,ao as H,o as M,f as P,d as W}from"./vendor-icons-BYOfSTr6.js";import"./client-CvoVCtJO.js";function se(){const[j,w]=l.useState([]),[z,u]=l.useState(!0),[m,g]=l.useState(null),[d,v]=l.useState(""),[h,C]=l.useState("public"),[i,I]=l.useState(null),[E,{open:_,close:F}]=V(!1),p=async()=>{try{u(!0),g(null);const s=await U.listDatabaseFunctions();w(s)}catch(s){g(s instanceof Error?s.message:"Failed to load functions")}finally{u(!1)}};l.useEffect(()=>{p()},[]);const R=s=>{I(s),_()},A=[...new Set(j.map(s=>s.schema))].sort(),x=j.filter(s=>{var y;const D=s.name.toLowerCase().includes(d.toLowerCase())||((y=s.definition)==null?void 0:y.toLowerCase().includes(d.toLowerCase())),L=h==="all"||s.schema===h;return D&&L});return z?e.jsx(c,{p:"xl",style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(k,{size:"lg"})}):e.jsxs(c,{p:"md",children:[e.jsxs(a,{justify:"space-between",mb:"lg",children:[e.jsxs(a,{gap:"xs",children:[e.jsx(b,{size:24,style:{color:"var(--mantine-color-green-6)"}}),e.jsx(N,{order:3,children:"Database Functions"}),e.jsx(n,{variant:"light",color:"gray",children:x.length})]}),e.jsxs(a,{children:[e.jsx(B,{size:"sm",placeholder:"Schema",value:h,onChange:s=>C(s||"public"),data:[{value:"all",label:"All schemas"},...A.map(s=>({value:s,label:s}))],style:{width:150}}),e.jsx(O,{placeholder:"Search functions...",leftSection:e.jsx(Y,{size:16}),value:d,onChange:s=>v(s.target.value),style:{width:300}}),e.jsx(f,{label:"Refresh",children:e.jsx(T,{variant:"light",onClick:p,children:e.jsx(H,{size:18})})})]})]}),m&&e.jsx(q,{icon:e.jsx(M,{size:16}),color:"red",mb:"md",children:m}),e.jsx(G,{withBorder:!0,padding:0,children:e.jsx(S,{children:e.jsxs(r,{striped:!0,highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"Name"}),e.jsx(r.Th,{children:"Schema"}),e.jsx(r.Th,{children:"Arguments"}),e.jsx(r.Th,{children:"Returns"}),e.jsx(r.Th,{children:"Language"}),e.jsx(r.Th,{children:"Type"}),e.jsx(r.Th,{style:{width:80},children:"Actions"})]})}),e.jsxs(r.Tbody,{children:[x.map(s=>e.jsxs(r.Tr,{children:[e.jsx(r.Td,{children:e.jsxs(a,{gap:"xs",children:[e.jsx(b,{size:14,style:{color:"var(--mantine-color-gray-5)"}}),e.jsx(t,{size:"sm",fw:500,children:s.name})]})}),e.jsx(r.Td,{children:e.jsx(n,{variant:"light",color:"gray",size:"sm",children:s.schema})}),e.jsx(r.Td,{children:e.jsx(t,{size:"xs",c:"dimmed",lineClamp:1,style:{maxWidth:200},children:s.argument_types||"none"})}),e.jsx(r.Td,{children:e.jsx(o,{style:{fontSize:"11px"},children:s.return_type})}),e.jsx(r.Td,{children:e.jsx(n,{variant:"light",color:s.language==="plpgsql"?"blue":s.language==="sql"?"green":"gray",size:"sm",children:s.language})}),e.jsx(r.Td,{children:e.jsx(n,{variant:"outline",color:s.is_security_definer?"orange":"gray",size:"xs",children:s.is_security_definer?"DEFINER":"INVOKER"})}),e.jsx(r.Td,{children:e.jsx(f,{label:"View definition",children:e.jsx(T,{variant:"subtle",onClick:()=>R(s),children:e.jsx(P,{size:16})})})})]},s.id)),x.length===0&&e.jsx(r.Tr,{children:e.jsx(r.Td,{colSpan:7,children:e.jsx(t,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No functions found"})})})]})]})})}),e.jsx(K,{opened:E,onClose:F,title:e.jsxs(a,{gap:"xs",children:[e.jsx(W,{size:18}),e.jsx(t,{fw:600,children:i==null?void 0:i.name})]}),size:"xl",children:i&&e.jsxs(Q,{gap:"md",children:[e.jsxs(a,{children:[e.jsx(n,{variant:"light",color:"gray",children:i.schema}),e.jsx(n,{variant:"light",color:"blue",children:i.language}),e.jsx(n,{variant:"outline",color:i.is_security_definer?"orange":"gray",children:i.is_security_definer?"SECURITY DEFINER":"SECURITY INVOKER"})]}),e.jsxs(c,{children:[e.jsx(t,{size:"sm",fw:500,mb:"xs",children:"Arguments"}),e.jsx(o,{block:!0,style:{fontSize:"12px"},children:i.argument_types||"none"})]}),e.jsxs(c,{children:[e.jsx(t,{size:"sm",fw:500,mb:"xs",children:"Returns"}),e.jsx(o,{block:!0,style:{fontSize:"12px"},children:i.return_type})]}),e.jsxs(c,{children:[e.jsx(t,{size:"sm",fw:500,mb:"xs",children:"Definition"}),e.jsx(S,{h:300,children:e.jsx(o,{block:!0,style:{fontSize:"12px",whiteSpace:"pre-wrap"},children:i.definition})})]})]})})]})}export{se as DatabaseFunctionsPage};
