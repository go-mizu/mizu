import{a9 as ge,h as oe,aa as ke,F as U,j as e,B as a,T as i,V as Q,q as E,a as O,e as R,b as ne,D as M,N as f,G as y,A as q,a3 as z,M as C,W as ce,X as Le,x as n,H as N,S as Ie,_ as h,d as Ee}from"./vendor-mantine-aKbh6G_O.js";import{r as o}from"./vendor-react-CA6k1jPF.js";import{E as Oe}from"./EmptyState-s1kxp5xn.js";import{a as c}from"./client-CvoVCtJO.js";import{W as Re,x as de,v as xe,b4 as pe,I as $,a as he,ao as qe,p as Ne,am as $e,$ as Be,au as De,a_ as Fe,d as Ae,n as Pe,b5 as Ue,j as Qe}from"./vendor-icons-BYOfSTr6.js";function ue(s){const r=new URLSearchParams;return s.source&&r.set("source",s.source),s.severity&&r.set("severity",s.severity),s.severities&&s.severities.length>0&&r.set("severities",s.severities.join(",")),s.status_min&&r.set("status_min",s.status_min.toString()),s.status_max&&r.set("status_max",s.status_max.toString()),s.method&&r.set("method",s.method),s.methods&&s.methods.length>0&&r.set("methods",s.methods.join(",")),s.path_pattern&&r.set("path",s.path_pattern),s.query&&r.set("query",s.query),s.regex&&r.set("regex",s.regex),s.user_id&&r.set("user_id",s.user_id),s.request_id&&r.set("request_id",s.request_id),s.from&&r.set("from",s.from),s.to&&r.set("to",s.to),s.time_range&&r.set("time_range",s.time_range),s.limit&&r.set("limit",s.limit.toString()),s.offset&&r.set("offset",s.offset.toString()),r}const _={listLogs:s=>{const d=(s?ue(s):new URLSearchParams).toString();return c.get(`/api/logs${d?`?${d}`:""}`)},getLog:s=>c.get(`/api/logs/${s}`),getHistogram:(s,r)=>{const d=s?ue(s):new URLSearchParams;r&&d.set("interval",r);const u=d.toString();return c.get(`/api/logs/histogram${u?`?${u}`:""}`)},listSources:()=>c.get("/api/logs/sources"),searchLogs:s=>c.post("/api/logs/search",s),exportLogs:async s=>{const r=new URLSearchParams;return r.set("format",s.format),s.source&&r.set("source",s.source),s.from&&r.set("from",s.from),s.to&&r.set("to",s.to),s.time_range&&r.set("time_range",s.time_range),c.get(`/api/logs/export?${r.toString()}`,{responseType:"blob"})},listSavedQueries:()=>c.get("/api/logs/queries"),createSavedQuery:s=>c.post("/api/logs/queries",s),getSavedQuery:s=>c.get(`/api/logs/queries/${s}`),updateSavedQuery:(s,r)=>c.put(`/api/logs/queries/${s}`,r),deleteSavedQuery:s=>c.delete(`/api/logs/queries/${s}`),listQueryTemplates:()=>c.get("/api/logs/templates")},Me={edge:e.jsx(pe,{size:16}),postgres:e.jsx($,{size:16}),postgrest:e.jsx($,{size:16}),pooler:e.jsx($,{size:16}),auth:e.jsx(Qe,{size:16}),storage:e.jsx(Ue,{size:16}),realtime:e.jsx(Pe,{size:16}),functions:e.jsx(Ae,{size:16}),cron:e.jsx(Fe,{size:16})},me=s=>s?s>=500?"red":s>=400?"orange":s>=300?"yellow":s>=200?"green":"gray":"gray",je=s=>{switch(s){case"DEBUG":return"gray";case"INFO":return"blue";case"NOTICE":return"cyan";case"WARNING":return"yellow";case"ERROR":return"orange";case"FATAL":return"red";case"PANIC":return"red";default:return"gray"}},Ge=["DEBUG","INFO","NOTICE","WARNING","ERROR","FATAL","PANIC"],T=s=>{const r=new Date(s),d=r.getDate(),u=r.toLocaleString("en-US",{month:"short"}),B=String(r.getFullYear()).slice(-2),x=r.toLocaleTimeString("en-US",{hour12:!1});return`${d} ${u} ${B} ${x}`};function He({bucket:s,maxCount:r}){const d=ge(),u=r>0?Math.max(4,s.count/r*60):0;return e.jsx(Ee,{label:`${s.count} events at ${T(s.timestamp)}`,children:e.jsx(a,{style:{width:8,height:60,display:"flex",alignItems:"flex-end",cursor:"pointer"},children:e.jsx(a,{style:{width:"100%",height:u,backgroundColor:d.colors.green[5],borderRadius:2}})})})}function Ke(){const s=ge(),[r,d]=o.useState([]),[u,B]=o.useState([]),[x,ye]=o.useState([]),[G,fe]=o.useState([]),[be,H]=o.useState(!0),[g,W]=o.useState(null),[b,V]=o.useState(""),[k,Se]=o.useState("1h"),[m,J]=o.useState(null),[S,X]=o.useState(null),[v,Y]=o.useState(null),[D,{toggle:ve}]=oe(!0),[F,{toggle:we}]=oe(!0),[l,K]=o.useState(null),[Z,ze]=o.useState("details"),[ee]=o.useState(!1),A=ke(()=>L(),5e3),[se,j]=o.useState(0),P=25,te=o.useCallback(()=>{const t={time_range:k,limit:P,offset:se};return g&&(t.source=g),b&&(t.query=b),m&&(m==="2xx"?(t.status_min=200,t.status_max=299):m==="3xx"?(t.status_min=300,t.status_max=399):m==="4xx"?(t.status_min=400,t.status_max=499):m==="5xx"&&(t.status_min=500,t.status_max=599)),S&&(t.method=S),v&&(t.severity=v),t},[g,b,k,m,S,v,se]),re=o.useCallback(async()=>{try{const t=await _.listSources();B(t)}catch(t){console.error("Failed to load sources:",t)}},[]),L=o.useCallback(async()=>{H(!0);try{const t=te(),[p,I]=await Promise.all([_.listLogs(t),_.getHistogram(t,"5m")]);d(p.logs||[]),ye(I.buckets||[])}catch(t){U.show({title:"Error",message:t.message||"Failed to load logs",color:"red"})}finally{H(!1)}},[te]),ie=o.useCallback(async()=>{try{const t=await _.listSavedQueries();fe(t||[])}catch(t){console.error("Failed to load queries:",t)}},[]);o.useEffect(()=>{re(),ie()},[re,ie]),o.useEffect(()=>{L()},[L]),o.useEffect(()=>(ee?A.start():A.stop(),()=>A.stop()),[ee]);const ae=async t=>{try{const p=await _.exportLogs({format:t,source:g||void 0,time_range:k}),I=URL.createObjectURL(p),w=document.createElement("a");w.href=I,w.download=`logs-${new Date().toISOString()}.${t}`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(I),U.show({title:"Success",message:"Logs exported successfully",color:"green"})}catch(p){U.show({title:"Error",message:p.message||"Failed to export logs",color:"red"})}},Ce=()=>{W(null),V(""),J(null),X(null),Y(null),j(0)},_e=()=>{j(t=>t+P)},Te=Math.max(...x.map(t=>t.count),1),le=g||b||m||S||v;return e.jsxs(a,{style:{display:"flex",height:"calc(100vh - 60px)",overflow:"hidden"},children:[e.jsxs(a,{style:{width:240,borderRight:`1px solid ${s.colors.gray[3]}`,display:"flex",flexDirection:"column",backgroundColor:s.white},children:[e.jsx(a,{p:"md",children:e.jsx(i,{fw:600,size:"lg",children:"Logs & Analytics"})}),e.jsxs(Q,{style:{flex:1},p:"xs",children:[e.jsxs(E,{withBorder:!0,p:"sm",mb:"md",style:{backgroundColor:s.colors.gray[0]},children:[e.jsx(O,{size:"xs",mb:"xs",children:"COMING SOON"}),e.jsx(i,{size:"sm",fw:500,children:"New logs"}),e.jsx(i,{size:"xs",c:"dimmed",mb:"xs",children:"Get early access"}),e.jsx(R,{size:"xs",variant:"outline",children:"Early access"})]}),e.jsxs(a,{mb:"md",children:[e.jsx(i,{size:"sm",fw:500,c:"dimmed",mb:"xs",children:"Templates"}),e.jsx(ne,{placeholder:"Search collections...",size:"xs",rightSection:e.jsx(Re,{size:14})})]}),e.jsx(M,{my:"sm"}),e.jsx(f,{label:"COLLECTIONS",childrenOffset:0,defaultOpened:!0,opened:D,onClick:ve,rightSection:D?e.jsx(de,{size:14}):e.jsx(xe,{size:14}),styles:{label:{fontSize:11,fontWeight:600,color:s.colors.gray[6]}}}),D&&e.jsx(a,{ml:"xs",children:u.map(t=>e.jsx(f,{label:t.name,leftSection:Me[t.id]||e.jsx(pe,{size:16}),active:g===t.id,onClick:()=>{W(g===t.id?null:t.id),j(0)},styles:{root:{borderRadius:4,padding:"6px 8px"},label:{fontSize:13}}},t.id))}),e.jsx(M,{my:"sm"}),e.jsx(f,{label:"DATABASE OPERATIONS",childrenOffset:0,defaultOpened:!1,styles:{label:{fontSize:11,fontWeight:600,color:s.colors.gray[6]}},children:e.jsx(f,{label:"Postgres Version Upgrade",leftSection:e.jsx($,{size:16}),styles:{root:{borderRadius:4},label:{fontSize:13}}})}),e.jsx(M,{my:"sm"}),e.jsx(f,{label:"QUERIES",childrenOffset:0,opened:F,onClick:we,rightSection:F?e.jsx(de,{size:14}):e.jsx(xe,{size:14}),styles:{label:{fontSize:11,fontWeight:600,color:s.colors.gray[6]}}}),F&&e.jsx(a,{ml:"xs",p:"sm",children:G.length===0?e.jsxs(a,{ta:"center",py:"md",children:[e.jsx(i,{size:"xs",c:"dimmed",mb:"xs",children:"No queries created yet"}),e.jsx(i,{size:"xs",c:"dimmed",mb:"sm",children:"Create and save your queries to use them in the explorer"}),e.jsx(R,{size:"xs",variant:"outline",children:"Create query"})]}):G.map(t=>e.jsx(f,{label:t.name,styles:{root:{borderRadius:4},label:{fontSize:13}}},t.id))})]})]}),e.jsxs(a,{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(a,{p:"sm",style:{borderBottom:`1px solid ${s.colors.gray[3]}`},children:e.jsxs(y,{justify:"space-between",children:[e.jsxs(y,{gap:"sm",children:[e.jsx(ne,{placeholder:"Search events",value:b,onChange:t=>{V(t.target.value),j(0)},leftSection:e.jsx(he,{size:16}),w:200,size:"sm"}),e.jsx(q,{variant:"subtle",onClick:L,children:e.jsx(qe,{size:18})}),e.jsx(z,{value:k,onChange:t=>{Se(t||"1h"),j(0)},data:[{value:"1h",label:"Last hour"},{value:"24h",label:"Last 24 hours"},{value:"7d",label:"Last 7 days"},{value:"30d",label:"Last 30 days"}],size:"sm",w:130}),e.jsx(z,{placeholder:"Status",value:m,onChange:t=>{J(t),j(0)},data:[{value:"2xx",label:"2xx Success"},{value:"3xx",label:"3xx Redirect"},{value:"4xx",label:"4xx Client Error"},{value:"5xx",label:"5xx Server Error"}],size:"sm",w:130,clearable:!0}),e.jsx(z,{placeholder:"Method",value:S,onChange:t=>{X(t),j(0)},data:["GET","POST","PUT","PATCH","DELETE","OPTIONS","HEAD"],size:"sm",w:100,clearable:!0}),e.jsx(z,{placeholder:"Severity",value:v,onChange:t=>{Y(t),j(0)},data:Ge.map(t=>({value:t,label:t})),size:"sm",w:110,clearable:!0}),e.jsx(q,{variant:"subtle",children:e.jsx(Ne,{size:18})}),e.jsxs(C,{position:"bottom-end",children:[e.jsx(C.Target,{children:e.jsx(q,{variant:"subtle",children:e.jsx($e,{size:18})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Item,{onClick:()=>ae("json"),children:"Export as JSON"}),e.jsx(C.Item,{onClick:()=>ae("csv"),children:"Export as CSV"})]})]})]}),e.jsx(y,{gap:"sm",children:e.jsx(z,{value:"primary",data:[{value:"primary",label:"Primary Database"}],size:"sm",w:150})})]})}),e.jsxs(a,{px:"sm",py:"xs",style:{borderBottom:`1px solid ${s.colors.gray[2]}`},children:[e.jsx(y,{gap:2,align:"flex-end",style:{height:70},children:x.length>0?x.map((t,p)=>e.jsx(He,{bucket:t,maxCount:Te},p)):e.jsx(i,{size:"xs",c:"dimmed",children:"No data for histogram"})}),e.jsxs(y,{justify:"space-between",mt:"xs",children:[e.jsx(i,{size:"xs",c:"dimmed",children:x[0]?T(x[0].timestamp):""}),e.jsx(i,{size:"xs",c:"dimmed",children:x[x.length-1]?T(x[x.length-1].timestamp):""})]})]}),e.jsxs(a,{style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx(a,{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:be&&r.length===0?e.jsx(ce,{py:"xl",style:{flex:1},children:e.jsx(Le,{size:"lg"})}):r.length===0?e.jsx(ce,{style:{flex:1},children:e.jsx(Oe,{icon:e.jsx(he,{size:48}),title:"No logs found",description:le?"Try adjusting your filters":"Logs will appear here as they are generated",action:le?{label:"Clear filters",onClick:Ce}:void 0})}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{style:{flex:1},children:e.jsxs(n,{striped:!0,highlightOnHover:!0,stickyHeader:!0,children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(n.Th,{w:160,children:"Timestamp"}),e.jsx(n.Th,{w:80,children:"Severity"}),e.jsx(n.Th,{w:60,children:"Status"}),e.jsx(n.Th,{w:70,children:"Method"}),e.jsx(n.Th,{children:"Path / Message"})]})}),e.jsx(n.Tbody,{children:r.map(t=>e.jsxs(n.Tr,{style:{cursor:"pointer",backgroundColor:(l==null?void 0:l.id)===t.id?s.colors.blue[0]:void 0},onClick:()=>K(t),children:[e.jsx(n.Td,{children:e.jsx(i,{size:"sm",c:"dimmed",style:{fontFamily:"monospace"},children:T(t.timestamp)})}),e.jsx(n.Td,{children:t.severity?e.jsx(O,{size:"xs",color:je(t.severity),variant:"light",children:t.severity}):e.jsx(i,{size:"sm",c:"dimmed",children:"-"})}),e.jsx(n.Td,{children:e.jsx(i,{size:"sm",c:me(t.status_code),fw:500,children:t.status_code||"-"})}),e.jsx(n.Td,{children:e.jsx(i,{size:"sm",children:t.method||"-"})}),e.jsx(n.Td,{children:e.jsx(i,{size:"sm",truncate:!0,style:{maxWidth:350},children:t.path||t.event_message||"-"})})]},t.id))})]})}),e.jsx(a,{p:"sm",style:{borderTop:`1px solid ${s.colors.gray[3]}`},children:e.jsxs(y,{justify:"space-between",children:[e.jsx(R,{variant:"subtle",size:"xs",leftSection:e.jsx(Be,{size:14}),onClick:_e,disabled:r.length<P,children:"Load older"}),e.jsxs(i,{size:"xs",c:"dimmed",children:["Showing ",r.length," results"]})]})})]})}),l&&e.jsxs(a,{style:{width:400,borderLeft:`1px solid ${s.colors.gray[3]}`,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(y,{justify:"space-between",p:"sm",style:{borderBottom:`1px solid ${s.colors.gray[3]}`},children:[e.jsx(N,{value:Z,onChange:ze,children:e.jsxs(N.List,{children:[e.jsx(N.Tab,{value:"details",children:"Details"}),e.jsx(N.Tab,{value:"raw",children:"Raw"})]})}),e.jsx(q,{variant:"subtle",onClick:()=>K(null),children:e.jsx(De,{size:16})})]}),e.jsx(Q,{style:{flex:1},p:"sm",children:Z==="details"?e.jsxs(Ie,{gap:"md",children:[e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"id"}),e.jsx(h,{style:{wordBreak:"break-all"},children:l.id})]}),e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"source"}),e.jsx(O,{size:"sm",variant:"light",children:l.source})]}),l.severity&&e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"severity"}),e.jsx(O,{size:"sm",color:je(l.severity),variant:"light",children:l.severity})]}),e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"status"}),e.jsx(i,{c:me(l.status_code),fw:500,children:l.status_code||"-"})]}),e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"timestamp"}),e.jsx(i,{children:T(l.timestamp)})]}),e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"method"}),e.jsx(i,{children:l.method||"-"})]}),e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"path"}),e.jsx(h,{style:{wordBreak:"break-all"},children:l.path||"-"})]}),l.request_id&&e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"request_id"}),e.jsx(h,{style:{wordBreak:"break-all"},children:l.request_id})]}),l.duration_ms!==void 0&&l.duration_ms>0&&e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"duration_ms"}),e.jsxs(i,{children:[l.duration_ms,"ms"]})]}),e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"user_agent"}),e.jsx(h,{style:{wordBreak:"break-all"},children:l.user_agent||"-"})]}),e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"apikey"}),e.jsx(h,{style:{wordBreak:"break-all"},children:l.apikey||"-"})]}),e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"event_message"}),e.jsx(E,{withBorder:!0,p:"sm",style:{backgroundColor:s.colors.gray[0]},children:e.jsx(h,{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:l.event_message||"-"})})]}),l.metadata&&Object.keys(l.metadata).length>0&&e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"metadata"}),e.jsx(E,{withBorder:!0,p:"sm",style:{backgroundColor:s.colors.gray[0]},children:e.jsx(h,{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(l.metadata,null,2)})})]}),l.request_headers&&Object.keys(l.request_headers).length>0&&e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",mb:4,children:"request_headers"}),e.jsx(E,{withBorder:!0,p:"sm",style:{backgroundColor:s.colors.gray[0]},children:e.jsx(h,{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(l.request_headers,null,2)})})]}),e.jsx(R,{variant:"subtle",fullWidth:!0,children:"Expand"})]}):e.jsx(h,{block:!0,style:{whiteSpace:"pre-wrap"},children:JSON.stringify(l,null,2)})})]})]})]})]})}export{Ke as LogsExplorerPage};
