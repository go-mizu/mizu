import{F as S,j as e,B as l,b as J,A as y,V as Q,S as j,U as b,G as c,T as n,C as I,D as Y,e as f,d as z,a as $,a2 as Xe,M as d,a3 as ge,K as fe,W as G,X as be,q as X,x as v,f as Z,a7 as Ze,J as Se,O as es,s as ee,a4 as ss}from"./vendor-mantine-aKbh6G_O.js";import{r as o}from"./vendor-react-CA6k1jPF.js";import{F as rs}from"./vendor-monaco-D2wf_90s.js";import{P as ts}from"./PageContainer-BshQiLl_.js";import{d as se}from"./database-Co5xRXKh.js";import{u as is}from"./index-BweS2InR.js";import{W as F,a as Ce,x as O,v as D,aF as ns,aG as as,aH as ls,ac as Ee,au as os,aI as ze,d as cs,aJ as ds,aK as xs,am as re,J as ve,aL as us,a4 as hs,aM as we,r as ms,p as ps,aN as js,K as ys,aO as gs,Y as fs,m as bs,aP as Ss,aQ as Cs,_ as zs}from"./vendor-icons-BYOfSTr6.js";import"./client-CvoVCtJO.js";import"./vendor-state-6LbO6gDb.js";const vs=[{category:"Common",items:[{name:"Select all",query:"SELECT * FROM table_name LIMIT 100;"},{name:"Count rows",query:"SELECT COUNT(*) FROM table_name;"},{name:"Insert row",query:`INSERT INTO table_name (column1, column2)
VALUES ('value1', 'value2');`},{name:"Update row",query:`UPDATE table_name
SET column1 = 'new_value'
WHERE id = 1;`},{name:"Delete row",query:"DELETE FROM table_name WHERE id = 1;"}]},{category:"Auth",items:[{name:"List users",query:"SELECT id, email, created_at FROM auth.users ORDER BY created_at DESC LIMIT 100;"},{name:"User by email",query:"SELECT * FROM auth.users WHERE email = 'user@example.com';"}]},{category:"Database",items:[{name:"List tables",query:"SELECT table_name FROM information_schema.tables WHERE table_schema = 'public';"},{name:"Table columns",query:"SELECT column_name, data_type FROM information_schema.columns WHERE table_name = 'table_name';"},{name:"Table size",query:"SELECT pg_size_pretty(pg_total_relation_size('table_name'));"},{name:"Active connections",query:"SELECT count(*) FROM pg_stat_activity;"}]},{category:"RLS",items:[{name:"List policies",query:"SELECT * FROM pg_policies;"},{name:"Enable RLS",query:"ALTER TABLE table_name ENABLE ROW LEVEL SECURITY;"},{name:"Create policy",query:`CREATE POLICY policy_name ON table_name
FOR SELECT
USING (auth.uid() = user_id);`}]}],ws=[{name:"Hello World",query:"SELECT 'Hello, World!' AS greeting;"},{name:"Current time",query:"SELECT NOW() AS current_time;"},{name:"PostgreSQL version",query:"SELECT version();"},{name:"Database size",query:"SELECT pg_size_pretty(pg_database_size(current_database())) AS db_size;"}];function As(){const{savedQueries:_,addSavedQuery:A,removeSavedQuery:R}=is(),[p,x]=o.useState([{id:crypto.randomUUID(),name:"New query",query:"",selectedText:null,isDirty:!1,isTransient:!0,result:null,error:null,loading:!1,executionRole:"postgres"}]),[u,C]=o.useState(p[0].id),[g,Ie]=o.useState(new Set(["PRIVATE"])),[U,Re]=o.useState(""),[P,H]=o.useState("results"),[Le,L]=o.useState(!1),[N,te]=o.useState(""),[w,ke]=o.useState("postgres"),[ie,Oe]=o.useState(new Set),[De,W]=o.useState(!1),[ne,ae]=o.useState([]),[_e,le]=o.useState(!1),[B,V]=o.useState(14),[Ae,oe]=o.useState(!1),[ce,Ne]=o.useState(!0),[de,qe]=o.useState(!1),[Me,q]=o.useState(!1),[Qe,xe]=o.useState(""),[T,Fe]=o.useState(!1),M=o.useRef(null),Ue=o.useRef(null),a=p.find(s=>s.id===u)||p[0],Pe=o.useCallback(async()=>{le(!0);try{const s=await se.getQueryHistory(100,0);ae(s)}catch(s){console.error("Failed to load query history:",s)}finally{le(!1)}},[]),E=s=>{Ie(t=>{const r=new Set(t);return r.has(s)?r.delete(s):r.add(s),r})},ue=()=>{const s={id:crypto.randomUUID(),name:"New query",query:"",selectedText:null,isDirty:!1,isTransient:!0,result:null,error:null,loading:!1,executionRole:w};x([...p,s]),C(s.id)},He=s=>{if(p.length===1){x([{id:crypto.randomUUID(),name:"New query",query:"",selectedText:null,isDirty:!1,isTransient:!0,result:null,error:null,loading:!1,executionRole:w}]),C(p[0].id);return}const t=p.findIndex(i=>i.id===s),r=p.filter(i=>i.id!==s);if(x(r),u===s){const i=Math.max(0,t-1);C(r[i].id)}},We=s=>{x(t=>t.map(r=>r.id===u?{...r,query:s,isDirty:s!==""}:r))},Be=()=>{if(M.current){const s=M.current.getSelection(),t=M.current.getModel();if(s&&t&&!s.isEmpty()){const r=t.getValueInRange(s);x(i=>i.map(m=>m.id===u?{...m,selectedText:r}:m))}else x(r=>r.map(i=>i.id===u?{...i,selectedText:null}:i))}},K=o.useCallback(async(s=!1)=>{const t=a.selectedText||a.query;if(!t.trim()){S.show({title:"Error",message:"Please enter a query",color:"red"});return}x(r=>r.map(i=>i.id===u?{...i,loading:!0,error:null,result:null}:i));try{const r=await se.executeQuery(t,{role:w,explain:s});x(i=>i.map(m=>m.id===u?{...m,loading:!1,result:r}:m)),H(s?"explain":"results")}catch(r){const i=r.message||"Query execution failed";x(m=>m.map(h=>h.id===u?{...h,loading:!1,error:i}:h)),S.show({title:"Query Error",message:i,color:"red"})}},[a,u,w]),Ve=()=>{if(!N.trim()){S.show({title:"Error",message:"Please enter a name",color:"red"});return}A(N,a.query),L(!1),te(""),S.show({title:"Saved",message:"Query saved successfully",color:"green"}),x(s=>s.map(t=>t.id===u?{...t,name:N,isDirty:!1,isTransient:!1}:t))},k=(s,t)=>{x(r=>r.map(i=>i.id===u?{...i,name:s,query:t,isDirty:!1,isTransient:!1}:i))},he=(s,t)=>{const r={id:crypto.randomUUID(),name:s,query:t,selectedText:null,isDirty:!1,isTransient:!1,result:null,error:null,loading:!1,executionRole:w};x([...p,r]),C(r.id)},me=s=>{Oe(t=>{const r=new Set(t);return r.has(s)?r.delete(s):r.add(s),r})},Ke=()=>{if(!a.result)return;const s=[a.result.columns.join(","),...a.result.rows.map(m=>a.result.columns.map(h=>JSON.stringify(m[h]??"")).join(","))].join(`
`),t=new Blob([s],{type:"text/csv"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download="query_results.csv",i.click(),URL.revokeObjectURL(r)},Je=()=>{if(!a.result)return;const s=JSON.stringify(a.result.rows,null,2),t=new Blob([s],{type:"application/json"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download="query_results.json",i.click(),URL.revokeObjectURL(r)},Ye=()=>{if(!a.result||a.result.rows.length===0)return;const s=a.result.columns,t=a.result.rows.map(r=>{const i=s.map(m=>{const h=r[m];return h===null?"NULL":typeof h=="string"?`'${h.replace(/'/g,"''")}'`:typeof h=="boolean"?h?"TRUE":"FALSE":typeof h=="object"?`'${JSON.stringify(h).replace(/'/g,"''")}'`:String(h)});return`INSERT INTO table_name (${s.join(", ")}) VALUES (${i.join(", ")});`});navigator.clipboard.writeText(t.join(`
`)),S.show({title:"Copied",message:"SQL INSERT statements copied to clipboard",color:"green"})},pe=_.filter(s=>s.name.toLowerCase().includes(U.toLowerCase())||s.query.toLowerCase().includes(U.toLowerCase())),je=_.filter(s=>ie.has(s.id)),$e=(s,t)=>{M.current=s,Ue.current=t,s.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.Enter,()=>K()),s.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.KeyK,()=>q(!0)),s.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.KeyS,()=>L(!0)),s.onDidChangeCursorSelection(()=>{Be()})},ye=s=>s<1?`${(s*1e3).toFixed(0)}µs`:s<1e3?`${s.toFixed(2)}ms`:`${(s/1e3).toFixed(2)}s`,Ge=s=>{const t=new Date(s),i=new Date().getTime()-t.getTime();return i<6e4?"Just now":i<36e5?`${Math.floor(i/6e4)}m ago`:i<864e5?`${Math.floor(i/36e5)}h ago`:t.toLocaleDateString()};return e.jsxs(ts,{title:"SQL Editor",description:"",fullWidth:!0,noPadding:!0,noHeader:!0,children:[e.jsxs(l,{style:{display:"flex",height:"calc(100vh - 60px)"},children:[e.jsxs(l,{style:{width:280,minWidth:280,borderRight:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg-surface)"},children:[e.jsx(l,{p:"sm",pb:0,children:e.jsx(J,{placeholder:"Search queries...",size:"xs",leftSection:e.jsx(Ce,{size:14}),value:U,onChange:s=>Re(s.target.value),rightSection:e.jsx(y,{size:"xs",variant:"subtle",onClick:ue,children:e.jsx(F,{size:14})})})}),e.jsx(Q,{style:{flex:1},p:"sm",children:e.jsxs(j,{gap:"xs",children:[e.jsxs(l,{children:[e.jsx(b,{onClick:()=>E("SHARED"),style:{width:"100%"},children:e.jsxs(c,{gap:"xs",py:4,children:[g.has("SHARED")?e.jsx(O,{size:12}):e.jsx(D,{size:12}),e.jsx(n,{size:"xs",fw:600,c:"dimmed",style:{letterSpacing:.5},children:"SHARED"})]})}),e.jsx(I,{in:g.has("SHARED"),children:e.jsx(l,{pl:"md",py:"xs",children:e.jsx(n,{size:"xs",c:"dimmed",children:"No shared queries yet"})})})]}),e.jsxs(l,{children:[e.jsx(b,{onClick:()=>E("FAVORITES"),style:{width:"100%"},children:e.jsxs(c,{gap:"xs",py:4,children:[g.has("FAVORITES")?e.jsx(O,{size:12}):e.jsx(D,{size:12}),e.jsx(n,{size:"xs",fw:600,c:"dimmed",style:{letterSpacing:.5},children:"FAVORITES"})]})}),e.jsx(I,{in:g.has("FAVORITES"),children:e.jsx(j,{gap:2,pl:"xs",py:"xs",children:je.length===0?e.jsx(n,{size:"xs",c:"dimmed",pl:"md",children:"No favorites yet"}):je.map(s=>e.jsx(Te,{query:s,isFavorite:!0,onLoad:()=>k(s.name,s.query),onLoadNewTab:()=>he(s.name,s.query),onToggleFavorite:()=>me(s.id),onDelete:()=>R(s.id)},s.id))})})]}),e.jsxs(l,{children:[e.jsx(b,{onClick:()=>E("PRIVATE"),style:{width:"100%"},children:e.jsxs(c,{gap:"xs",py:4,children:[g.has("PRIVATE")?e.jsx(O,{size:12}):e.jsx(D,{size:12}),e.jsx(n,{size:"xs",fw:600,c:"dimmed",style:{letterSpacing:.5},children:"PRIVATE"})]})}),e.jsx(I,{in:g.has("PRIVATE"),children:e.jsx(j,{gap:2,pl:"xs",py:"xs",children:pe.length===0?e.jsxs(l,{py:"md",ta:"center",children:[e.jsx(n,{size:"xs",c:"dimmed",mb:"xs",children:"No private queries created yet"}),e.jsx(n,{size:"xs",c:"dimmed",children:"Save queries to see them here"})]}):pe.map(s=>e.jsx(Te,{query:s,isFavorite:ie.has(s.id),onLoad:()=>k(s.name,s.query),onLoadNewTab:()=>he(s.name,s.query),onToggleFavorite:()=>me(s.id),onDelete:()=>R(s.id)},s.id))})})]}),e.jsx(Y,{my:"xs"}),e.jsxs(l,{children:[e.jsx(b,{onClick:()=>E("COMMUNITY"),style:{width:"100%"},children:e.jsxs(c,{gap:"xs",py:4,children:[g.has("COMMUNITY")?e.jsx(O,{size:12}):e.jsx(D,{size:12}),e.jsx(n,{size:"xs",fw:600,c:"dimmed",style:{letterSpacing:.5},children:"COMMUNITY"})]})}),e.jsx(I,{in:g.has("COMMUNITY"),children:e.jsxs(j,{gap:2,pl:"xs",py:"xs",children:[e.jsx(b,{onClick:()=>E("Templates"),style:{padding:"6px 8px",borderRadius:4},children:e.jsxs(c,{gap:"xs",children:[e.jsx(ns,{size:14}),e.jsx(n,{size:"sm",children:"Templates"})]})}),e.jsx(I,{in:g.has("Templates"),children:e.jsx(j,{gap:2,pl:"md",children:vs.map(s=>e.jsxs(l,{children:[e.jsx(n,{size:"xs",c:"dimmed",fw:500,py:4,children:s.category}),s.items.map(t=>e.jsx(b,{onClick:()=>k(t.name,t.query),style:{display:"block",width:"100%",padding:"4px 8px",borderRadius:4},children:e.jsx(n,{size:"xs",children:t.name})},t.name))]},s.category))})}),e.jsx(b,{onClick:()=>E("Quickstarts"),style:{padding:"6px 8px",borderRadius:4},children:e.jsxs(c,{gap:"xs",children:[e.jsx(as,{size:14}),e.jsx(n,{size:"sm",children:"Quickstarts"})]})}),e.jsx(I,{in:g.has("Quickstarts"),children:e.jsx(j,{gap:2,pl:"md",children:ws.map(s=>e.jsx(b,{onClick:()=>k(s.name,s.query),style:{display:"block",width:"100%",padding:"4px 8px",borderRadius:4},children:e.jsx(n,{size:"xs",children:s.name})},s.name))})})]})})]})]})}),e.jsx(l,{p:"sm",style:{borderTop:"1px solid var(--supabase-border)"},children:e.jsx(f,{variant:"subtle",fullWidth:!0,size:"xs",leftSection:e.jsx(ls,{size:14}),onClick:()=>{Pe(),W(!0)},children:"Query History"})})]}),e.jsxs(l,{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:[e.jsx(l,{style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)",display:"flex",alignItems:"center"},children:e.jsx(Q,{style:{flex:1},scrollbarSize:4,type:"scroll",children:e.jsxs(c,{gap:0,wrap:"nowrap",px:"xs",children:[p.map(s=>e.jsxs(l,{onClick:()=>C(s.id),onDoubleClick:()=>{x(t=>t.map(r=>r.id===s.id?{...r,isTransient:!1}:r))},style:{padding:"8px 12px",cursor:"pointer",borderBottom:u===s.id?"2px solid var(--supabase-brand)":"2px solid transparent",backgroundColor:u===s.id?"var(--supabase-bg-surface)":"transparent",display:"flex",alignItems:"center",gap:8,whiteSpace:"nowrap"},children:[e.jsx(Ee,{size:14}),e.jsxs(n,{size:"sm",style:{fontStyle:s.isTransient?"italic":"normal"},children:[s.name,s.isDirty&&" *"]}),e.jsx(y,{size:"xs",variant:"subtle",onClick:t=>{t.stopPropagation(),He(s.id)},children:e.jsx(os,{size:12})})]},s.id)),e.jsx(z,{label:"New query",children:e.jsx(y,{variant:"subtle",size:"sm",onClick:ue,mx:"xs",children:e.jsx(F,{size:16})})})]})})}),e.jsx(l,{px:"sm",py:6,style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)"},children:e.jsxs(c,{justify:"space-between",children:[e.jsxs(c,{gap:"xs",children:[e.jsx(z,{label:"AI Assistant (⌘K)",children:e.jsx(y,{variant:"subtle",size:"sm",onClick:()=>q(!0),children:e.jsx(ze,{size:16})})}),e.jsx(z,{label:"Format SQL",children:e.jsx(y,{variant:"subtle",size:"sm",children:e.jsx(cs,{size:16})})}),e.jsx(Y,{orientation:"vertical"}),e.jsx(z,{label:"Decrease font size",children:e.jsx(y,{variant:"subtle",size:"sm",onClick:()=>V(s=>Math.max(10,s-1)),children:e.jsx(ds,{size:14})})}),e.jsxs(n,{size:"xs",w:40,ta:"center",children:[B,"px"]}),e.jsx(z,{label:"Increase font size",children:e.jsx(y,{variant:"subtle",size:"sm",onClick:()=>V(s=>Math.min(24,s+1)),children:e.jsx(F,{size:14})})}),e.jsx(z,{label:"Settings",children:e.jsx(y,{variant:"subtle",size:"sm",onClick:()=>oe(!0),children:e.jsx(xs,{size:16})})})]}),e.jsxs(c,{gap:"xs",children:[a.selectedText&&e.jsx($,{size:"xs",variant:"light",color:"blue",children:"Selection active"}),e.jsx(f,{size:"xs",variant:"subtle",leftSection:e.jsx(re,{size:14}),onClick:()=>L(!0),children:"Save"})]})]})}),e.jsx(l,{style:{flex:T?1:"0 0 50%",borderBottom:"1px solid var(--supabase-border)"},children:e.jsx(rs,{height:"100%",defaultLanguage:"sql",value:a.query,onChange:s=>We(s||""),theme:"vs-light",options:{minimap:{enabled:de},fontSize:B,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,wordWrap:ce?"on":"off"},onMount:$e})}),e.jsxs(l,{style:{flex:T?0:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(l,{px:"sm",py:"xs",style:{borderBottom:T?"none":"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)"},children:e.jsxs(c,{justify:"space-between",children:[e.jsxs(c,{gap:"xs",children:[e.jsx(y,{size:"xs",variant:"subtle",onClick:()=>Fe(!T),children:T?e.jsx(O,{size:14}):e.jsx(D,{size:14,style:{transform:"rotate(90deg)"}})}),e.jsx(Xe,{size:"xs",value:P,onChange:s=>H(s),data:[{label:"Results",value:"results"},{label:"Explain",value:"explain"},{label:"Chart",value:"chart"}]}),a.result&&e.jsxs($,{size:"sm",variant:"light",color:"green",children:[a.result.row_count," rows in ",ye(a.result.duration_ms)]})]}),e.jsxs(c,{gap:"xs",children:[a.result&&a.result.rows.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{position:"bottom-end",children:[e.jsx(d.Target,{children:e.jsx(f,{size:"xs",variant:"subtle",leftSection:e.jsx(ve,{size:14}),children:"Copy"})}),e.jsxs(d.Dropdown,{children:[e.jsx(d.Item,{leftSection:e.jsx(ve,{size:14}),onClick:()=>{var s;navigator.clipboard.writeText(JSON.stringify((s=a.result)==null?void 0:s.rows,null,2)),S.show({message:"Copied as JSON",color:"green"})},children:"Copy as JSON"}),e.jsx(d.Item,{leftSection:e.jsx(us,{size:14}),onClick:Ye,children:"Copy as SQL INSERT"})]})]}),e.jsxs(d,{position:"bottom-end",children:[e.jsx(d.Target,{children:e.jsx(f,{size:"xs",variant:"subtle",leftSection:e.jsx(re,{size:14}),children:"Export"})}),e.jsxs(d.Dropdown,{children:[e.jsx(d.Item,{leftSection:e.jsx(re,{size:14}),onClick:Ke,children:"Export as CSV"}),e.jsx(d.Item,{leftSection:e.jsx(hs,{size:14}),onClick:Je,children:"Export as JSON"})]})]})]}),e.jsx(Y,{orientation:"vertical"}),e.jsx(ge,{size:"xs",value:"primary",data:[{value:"primary",label:"Primary Database"}],w:150,styles:{input:{fontSize:12}}}),e.jsx(ge,{size:"xs",value:w,onChange:s=>s&&ke(s),data:[{value:"postgres",label:"postgres"},{value:"anon",label:"anon"},{value:"authenticated",label:"authenticated"},{value:"service_role",label:"service_role"}],w:130,leftSection:e.jsx(n,{size:"xs",c:"dimmed",children:"Role"}),styles:{input:{fontSize:12,paddingLeft:40}}}),e.jsx(z,{label:"Run with EXPLAIN",children:e.jsx(y,{variant:"subtle",size:"sm",onClick:()=>K(!0),loading:a.loading,children:e.jsx(we,{size:16})})}),e.jsx(f,{size:"xs",onClick:()=>K(!1),loading:a.loading,leftSection:e.jsx(ms,{size:14}),rightSection:e.jsxs(c,{gap:2,children:[e.jsx(fe,{size:"xs",children:"⌘"}),e.jsx(fe,{size:"xs",children:"↵"})]}),children:"Run"})]})]})}),!T&&e.jsx(Q,{style:{flex:1},children:a.loading?e.jsx(G,{py:"xl",children:e.jsx(be,{size:"sm"})}):a.error?e.jsx(l,{p:"md",children:e.jsx(X,{p:"md",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)"},children:e.jsx(n,{size:"sm",c:"red",children:a.error})})}):P==="results"?a.result?a.result.rows.length>0?e.jsxs(v,{striped:!0,highlightOnHover:!0,children:[e.jsx(v.Thead,{children:e.jsx(v.Tr,{children:a.result.columns.map(s=>e.jsx(v.Th,{children:s},s))})}),e.jsx(v.Tbody,{children:a.result.rows.map((s,t)=>e.jsx(v.Tr,{children:a.result.columns.map(r=>e.jsx(v.Td,{children:e.jsx(n,{size:"sm",style:{maxWidth:300,fontFamily:"monospace"},truncate:!0,children:s[r]===null?e.jsx(n,{span:!0,c:"dimmed",fs:"italic",children:"NULL"}):typeof s[r]=="object"?JSON.stringify(s[r]):String(s[r])})},r))},t))})]}):e.jsx(l,{p:"xl",ta:"center",children:e.jsx(n,{c:"dimmed",children:"Query executed successfully. No rows returned."})}):e.jsx(l,{p:"xl",ta:"center",children:e.jsx(n,{c:"dimmed",children:"Click Run to execute your query."})}):P==="explain"?a.result?e.jsx(l,{p:"md",children:e.jsx(X,{p:"md",withBorder:!0,children:e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:12},children:JSON.stringify(a.result.rows,null,2)})})}):e.jsxs(l,{p:"xl",ta:"center",children:[e.jsx(we,{size:32,style:{opacity:.3}}),e.jsx(n,{c:"dimmed",mt:"sm",children:"Click the Explain button to see the query plan"})]}):e.jsxs(l,{p:"xl",ta:"center",children:[e.jsx(ps,{size:32,style:{opacity:.3}}),e.jsx(n,{c:"dimmed",mt:"sm",children:"Chart visualization coming soon"})]})})]})]})]}),e.jsx(Z,{opened:Le,onClose:()=>L(!1),title:"Save query",size:"sm",children:e.jsxs(j,{gap:"md",children:[e.jsx(J,{label:"Query name",placeholder:"My query",value:N,onChange:s=>te(s.target.value),autoFocus:!0}),e.jsxs(c,{justify:"flex-end",children:[e.jsx(f,{variant:"subtle",onClick:()=>L(!1),children:"Cancel"}),e.jsx(f,{onClick:Ve,children:"Save"})]})]})}),e.jsx(Z,{opened:Ae,onClose:()=>oe(!1),title:"Editor Settings",size:"sm",children:e.jsxs(j,{gap:"md",children:[e.jsxs(l,{children:[e.jsx(n,{size:"sm",fw:500,mb:"xs",children:"Font Size"}),e.jsx(Ze,{value:B,onChange:V,min:10,max:24,step:1,marks:[{value:10,label:"10"},{value:14,label:"14"},{value:18,label:"18"},{value:24,label:"24"}]})]}),e.jsx(Se,{label:"Word wrap",checked:ce,onChange:s=>Ne(s.currentTarget.checked)}),e.jsx(Se,{label:"Show minimap",checked:de,onChange:s=>qe(s.currentTarget.checked)})]})}),e.jsx(Z,{opened:Me,onClose:()=>q(!1),title:e.jsxs(c,{gap:"xs",children:[e.jsx(ee,{size:"sm",variant:"light",color:"violet",children:e.jsx(ze,{size:14})}),e.jsx(n,{children:"AI Assistant"})]}),size:"md",children:e.jsxs(j,{gap:"md",children:[e.jsx(n,{size:"sm",c:"dimmed",children:"Describe what you want to query and AI will generate the SQL for you."}),e.jsx(es,{placeholder:"e.g., Select all users who signed up in the last 7 days",value:Qe,onChange:s=>xe(s.target.value),minRows:3,autoFocus:!0}),e.jsx(n,{size:"xs",c:"dimmed",children:"Examples:"}),e.jsx(j,{gap:4,children:["Select all active users","Count orders by status","Find products with low inventory","List users who haven't logged in for 30 days"].map(s=>e.jsx(b,{onClick:()=>xe(s),style:{padding:"4px 8px",borderRadius:4},children:e.jsx(n,{size:"xs",c:"blue",children:s})},s))}),e.jsxs(c,{justify:"flex-end",children:[e.jsx(f,{variant:"subtle",onClick:()=>q(!1),children:"Cancel"}),e.jsx(f,{leftSection:e.jsx(js,{size:14}),onClick:()=>{S.show({title:"Coming Soon",message:"AI query generation is not yet implemented",color:"blue"})},children:"Generate SQL"})]})]})}),e.jsx(ss,{opened:De,onClose:()=>W(!1),title:"Query History",position:"right",size:"md",children:e.jsxs(j,{gap:"md",children:[e.jsxs(c,{justify:"space-between",children:[e.jsx(J,{placeholder:"Search history...",size:"xs",leftSection:e.jsx(Ce,{size:14}),style:{flex:1}}),e.jsx(f,{size:"xs",variant:"subtle",color:"red",onClick:async()=>{await se.clearQueryHistory(),ae([]),S.show({message:"History cleared",color:"green"})},children:"Clear"})]}),_e?e.jsx(G,{py:"xl",children:e.jsx(be,{size:"sm"})}):ne.length===0?e.jsx(G,{py:"xl",children:e.jsx(n,{c:"dimmed",children:"No query history yet"})}):e.jsx(Q,{style:{height:"calc(100vh - 200px)"},children:e.jsx(j,{gap:"xs",children:ne.map(s=>e.jsxs(X,{p:"sm",withBorder:!0,style:{cursor:"pointer"},onClick:()=>{k("History query",s.query),W(!1)},children:[e.jsxs(c,{justify:"space-between",mb:4,children:[e.jsxs(c,{gap:"xs",children:[s.success?e.jsx(ee,{size:"xs",color:"green",variant:"light",children:e.jsx(ys,{size:12})}):e.jsx(ee,{size:"xs",color:"red",variant:"light",children:e.jsx(gs,{size:12})}),e.jsx($,{size:"xs",variant:"light",children:s.role})]}),e.jsx(n,{size:"xs",c:"dimmed",children:Ge(s.executed_at)})]}),e.jsx(n,{size:"xs",lineClamp:2,style:{fontFamily:"monospace"},children:s.query}),e.jsxs(c,{gap:"xs",mt:4,children:[e.jsx(n,{size:"xs",c:"dimmed",children:ye(s.duration_ms)}),s.success&&e.jsxs(n,{size:"xs",c:"dimmed",children:["• ",s.row_count," rows"]}),s.error&&e.jsx(n,{size:"xs",c:"red",lineClamp:1,children:s.error})]})]},s.id))})})]})})]})}function Te({query:_,isFavorite:A,onLoad:R,onLoadNewTab:p,onToggleFavorite:x,onDelete:u}){return e.jsxs(c,{gap:4,wrap:"nowrap",style:{padding:"4px 8px",borderRadius:4,cursor:"pointer"},className:"query-item",children:[e.jsx(Ee,{size:14,style:{flexShrink:0}}),e.jsx(b,{onClick:R,style:{flex:1,minWidth:0},children:e.jsx(n,{size:"sm",truncate:!0,children:_.name})}),e.jsxs(d,{position:"right-start",withinPortal:!0,children:[e.jsx(d.Target,{children:e.jsx(y,{size:"xs",variant:"subtle",onClick:C=>C.stopPropagation(),children:e.jsx(fs,{size:12})})}),e.jsxs(d.Dropdown,{children:[e.jsx(d.Item,{leftSection:e.jsx(bs,{size:14}),onClick:R,children:"Open"}),e.jsx(d.Item,{leftSection:e.jsx(F,{size:14}),onClick:p,children:"Open in new tab"}),e.jsx(d.Item,{leftSection:A?e.jsx(Ss,{size:14}):e.jsx(Cs,{size:14}),onClick:x,children:A?"Remove from favorites":"Add to favorites"}),e.jsx(d.Divider,{}),e.jsx(d.Item,{leftSection:e.jsx(zs,{size:14}),color:"red",onClick:u,children:"Delete"})]})]})]})}export{As as SQLEditorPage};
