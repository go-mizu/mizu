import{j as e,B as S,S as L,G as b,a8 as M,T as k,a3 as P,d as E,A as _,H as w,L as q,p as z,q as D,a as H,r as R}from"./vendor-mantine-aKbh6G_O.js";import{r as p}from"./vendor-react-CA6k1jPF.js";import{a as h}from"./client-CvoVCtJO.js";import{ao as G,s as U,d as V,n as W,m as X,l as Y,I as A,b6 as J,b7 as N}from"./vendor-icons-BYOfSTr6.js";import{af as x,am as $,ah as g,ai as j,aj as f,ak as v,an as I,ao as Q,ap as Z,aq as ee,ag as se,al as te}from"./vendor-charts-X2wGYlzF.js";function B(s){const a=new URLSearchParams;return s!=null&&s.from&&a.set("from",s.from),s!=null&&s.to&&a.set("to",s.to),s!=null&&s.time_range&&a.set("time_range",s.time_range),s!=null&&s.interval&&a.set("interval",s.interval),a}const C={listReportTypes:()=>h.get("/api/reports"),getReport:(s,a)=>{const i=B(a).toString();return h.get(`/api/reports/${s}${i?`?${i}`:""}`)},getReportChart:(s,a,o)=>{const n=B(o).toString();return h.get(`/api/reports/${s}/chart/${a}${n?`?${n}`:""}`)},listReportConfigs:()=>h.get("/api/reports/configs"),getReportConfig:s=>h.get(`/api/reports/configs/${s}`),getPrometheusMetrics:()=>h.get("/customer/v1/privileged/metrics")},ae=[{value:"1h",label:"Last hour"},{value:"3h",label:"Last 3 hours"},{value:"6h",label:"Last 6 hours"},{value:"12h",label:"Last 12 hours"},{value:"24h",label:"Last 24 hours"},{value:"7d",label:"Last 7 days"},{value:"30d",label:"Last 30 days"}],re={database:A,auth:Y,storage:X,realtime:W,functions:V,api:U},u={primary:"#3ECF8E",secondary:"#6366F1",tertiary:"#F59E0B",quaternary:"#EF4444",error:"#EF4444",success:"#10B981"};function oe(s){const a=new Date(s);return(new Date().getTime()-a.getTime())/(1e3*60*60)<24?a.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}):a.toLocaleDateString(void 0,{month:"short",day:"numeric"})}function y(s,a){return a==="%"?`${s.toFixed(1)}%`:a==="ms"?`${s.toFixed(0)}ms`:a==="bytes"?s>=1024*1024?`${(s/(1024*1024)).toFixed(1)} MB`:s>=1024?`${(s/1024).toFixed(1)} KB`:`${s} B`:s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toFixed(0)}function ne(s){if(s.length<2)return{change:0,isPositive:!0};const a=Math.floor(s.length/2),o=s.slice(0,a),i=s.slice(a),n=o.reduce((t,c)=>t+c.value,0)/o.length,m=i.reduce((t,c)=>t+c.value,0)/i.length;if(n===0)return{change:0,isPositive:!0};const d=(m-n)/n*100;return{change:Math.abs(d),isPositive:d>=0}}function ie({chart:s}){const a=s.data.map(t=>({...t,timestamp:oe(t.timestamp),...t.values})),o=s.data.length>0?s.data[s.data.length-1].value:0,i=ne(s.data),n=s.metrics&&s.metrics.length>0,m=n?s.metrics.map(t=>t.split(".").pop()||t):["value"],d=()=>{switch(s.type){case"line":return e.jsx(x,{width:"100%",height:200,children:e.jsxs($,{data:a,children:[e.jsx(g,{strokeDasharray:"3 3",stroke:"var(--supabase-border)"}),e.jsx(j,{dataKey:"timestamp",stroke:"var(--supabase-text-muted)",fontSize:11,tickLine:!1}),e.jsx(f,{stroke:"var(--supabase-text-muted)",fontSize:11,tickLine:!1,width:50,tickFormatter:t=>y(t,s.unit)}),e.jsx(v,{contentStyle:{backgroundColor:"var(--supabase-bg-surface)",border:"1px solid var(--supabase-border)",borderRadius:8},labelStyle:{color:"var(--supabase-text)"}}),m.map((t,c)=>e.jsx(I,{type:"monotone",dataKey:n?t:"value",stroke:Object.values(u)[c%Object.values(u).length],strokeWidth:2,dot:!1,name:t},t))]})});case"area":case"stacked_area":return e.jsx(x,{width:"100%",height:200,children:e.jsxs(se,{data:a,children:[e.jsx(g,{strokeDasharray:"3 3",stroke:"var(--supabase-border)"}),e.jsx(j,{dataKey:"timestamp",stroke:"var(--supabase-text-muted)",fontSize:11,tickLine:!1}),e.jsx(f,{stroke:"var(--supabase-text-muted)",fontSize:11,tickLine:!1,width:50,tickFormatter:t=>y(t,s.unit)}),e.jsx(v,{contentStyle:{backgroundColor:"var(--supabase-bg-surface)",border:"1px solid var(--supabase-border)",borderRadius:8},labelStyle:{color:"var(--supabase-text)"}}),m.map((t,c)=>e.jsx(te,{type:"monotone",dataKey:n?t:"value",stackId:s.type==="stacked_area"?"1":void 0,stroke:Object.values(u)[c%Object.values(u).length],fill:Object.values(u)[c%Object.values(u).length],fillOpacity:.3,name:t},t))]})});case"bar":case"stacked_bar":return e.jsx(x,{width:"100%",height:200,children:e.jsxs(Q,{data:a,children:[e.jsx(g,{strokeDasharray:"3 3",stroke:"var(--supabase-border)"}),e.jsx(j,{dataKey:"timestamp",stroke:"var(--supabase-text-muted)",fontSize:11,tickLine:!1}),e.jsx(f,{stroke:"var(--supabase-text-muted)",fontSize:11,tickLine:!1,width:50,tickFormatter:t=>y(t,s.unit)}),e.jsx(v,{contentStyle:{backgroundColor:"var(--supabase-bg-surface)",border:"1px solid var(--supabase-border)",borderRadius:8},labelStyle:{color:"var(--supabase-text)"}}),e.jsx(Z,{}),m.map((t,c)=>e.jsx(ee,{dataKey:n?t:"value",stackId:s.type==="stacked_bar"?"1":void 0,fill:Object.values(u)[c%Object.values(u).length],name:t,radius:[4,4,0,0]},t))]})});default:return e.jsx(x,{width:"100%",height:200,children:e.jsxs($,{data:a,children:[e.jsx(g,{strokeDasharray:"3 3",stroke:"var(--supabase-border)"}),e.jsx(j,{dataKey:"timestamp",stroke:"var(--supabase-text-muted)",fontSize:11}),e.jsx(f,{stroke:"var(--supabase-text-muted)",fontSize:11,width:50}),e.jsx(v,{}),e.jsx(I,{type:"monotone",dataKey:"value",stroke:u.primary,strokeWidth:2,dot:!1})]})})}};return e.jsx(D,{p:"md",radius:"md",style:{backgroundColor:"var(--supabase-bg)",border:"1px solid var(--supabase-border)"},children:e.jsxs(L,{gap:"md",children:[e.jsxs(b,{justify:"space-between",children:[e.jsx(k,{size:"sm",fw:500,c:"dimmed",children:s.title}),!n&&e.jsxs(b,{gap:"xs",children:[e.jsx(k,{size:"lg",fw:600,children:y(o,s.unit)}),i.change>.1&&e.jsxs(H,{size:"sm",variant:"light",color:i.isPositive?"green":"red",leftSection:i.isPositive?e.jsx(J,{size:12}):e.jsx(N,{size:12}),children:[i.change.toFixed(1),"%"]})]})]}),d()]})})}function de(){return e.jsx(D,{p:"md",radius:"md",style:{backgroundColor:"var(--supabase-bg)",border:"1px solid var(--supabase-border)"},children:e.jsxs(L,{gap:"md",children:[e.jsxs(b,{justify:"space-between",children:[e.jsx(R,{height:16,width:120}),e.jsx(R,{height:24,width:80})]}),e.jsx(R,{height:200})]})})}function he(){const[s,a]=p.useState([]),[o,i]=p.useState(null),[n,m]=p.useState("24h"),[d,t]=p.useState(null),[c,T]=p.useState(!0),[K,F]=p.useState(!1);p.useEffect(()=>{async function r(){try{const l=await C.listReportTypes();a(l),l.length>0&&!o&&i(l[0].id)}catch(l){console.error("Failed to load report types:",l)}}r()},[]),p.useEffect(()=>{async function r(){if(o){T(!0);try{const l=await C.getReport(o,{time_range:n});t(l)}catch(l){console.error("Failed to load report:",l)}finally{T(!1)}}}r()},[o,n]);const O=async()=>{if(o){F(!0);try{const r=await C.getReport(o,{time_range:n});t(r)}catch(r){console.error("Failed to refresh report:",r)}finally{F(!1)}}};return e.jsx(S,{p:"lg",children:e.jsxs(L,{gap:"lg",children:[e.jsxs(b,{justify:"space-between",children:[e.jsxs(S,{children:[e.jsx(M,{order:2,style:{color:"var(--supabase-text)"},children:"Reports"}),e.jsx(k,{size:"sm",c:"dimmed",children:"Monitor your project's performance metrics and health"})]}),e.jsxs(b,{children:[e.jsx(P,{size:"sm",value:n,onChange:r=>r&&m(r),data:ae,w:150,styles:{input:{backgroundColor:"var(--supabase-bg)",borderColor:"var(--supabase-border)"}}}),e.jsx(E,{label:"Refresh data",children:e.jsx(_,{variant:"subtle",onClick:O,loading:K,style:{color:"var(--supabase-text-muted)"},children:e.jsx(G,{size:18})})})]})]}),e.jsx(w,{value:o,onChange:i,children:e.jsx(w.List,{style:{borderBottom:"1px solid var(--supabase-border)",gap:0},children:s.map(r=>{const l=re[r.id]||A;return e.jsx(w.Tab,{value:r.id,leftSection:e.jsx(l,{size:16}),style:{color:o===r.id?"var(--supabase-brand)":"var(--supabase-text-muted)",borderBottom:o===r.id?"2px solid var(--supabase-brand)":"none"},children:r.name},r.id)})})}),e.jsxs(S,{pos:"relative",children:[e.jsx(q,{visible:c&&!d}),d&&e.jsx(z,{cols:{base:1,md:2},spacing:"md",children:d.charts.map(r=>e.jsx(ie,{chart:r},r.id))}),c&&!d&&e.jsx(z,{cols:{base:1,md:2},spacing:"md",children:[1,2,3,4].map(r=>e.jsx(de,{},r))})]}),d&&e.jsxs(k,{size:"xs",c:"dimmed",ta:"center",children:["Data from ",new Date(d.from).toLocaleString()," to"," ",new Date(d.to).toLocaleString()," (interval: ",d.interval,")"]})]})})}export{he as ReportsPage};
