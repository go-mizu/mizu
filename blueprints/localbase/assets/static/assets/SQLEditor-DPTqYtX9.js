import{y as R,j as e,B as n,b as H,A as f,Y as O,S as j,U as p,G as d,T as t,C as S,D as Y,e as C,d as D,a1 as ce,a as ue,$ as K,K as X,O as xe,Q as me,q as pe,a2 as g,f as he,M as h}from"./vendor-mantine-C8lHRUHi.js";import{r as m}from"./vendor-react-CFPnf9wS.js";import{F as ye}from"./vendor-monaco-B9a4sr1d.js";import{P as je}from"./PageContainer-Czy__zFQ.js";import{d as ge}from"./database-CiK1Mmeb.js";import{u as be}from"./index-DZJ0JtLk.js";import{V as q,a as Se,w as I,u as L,ao as fe,ap as Ee,aq as Ce,a9 as J,an as ve,H as Te,a2 as ze,ar as we,p as Re,X as Ie,m as Le,as as _e,at as ke,Z as Ae}from"./vendor-icons-rGG861t1.js";import"./client-CvoVCtJO.js";import"./vendor-state-Ud2phgVo.js";const Oe=[{category:"Common",items:[{name:"Select all",query:"SELECT * FROM table_name LIMIT 100;"},{name:"Count rows",query:"SELECT COUNT(*) FROM table_name;"},{name:"Insert row",query:`INSERT INTO table_name (column1, column2)
VALUES ('value1', 'value2');`},{name:"Update row",query:`UPDATE table_name
SET column1 = 'new_value'
WHERE id = 1;`},{name:"Delete row",query:"DELETE FROM table_name WHERE id = 1;"}]},{category:"Auth",items:[{name:"List users",query:"SELECT id, email, created_at FROM auth.users ORDER BY created_at DESC LIMIT 100;"},{name:"User by email",query:"SELECT * FROM auth.users WHERE email = 'user@example.com';"}]},{category:"Database",items:[{name:"List tables",query:"SELECT table_name FROM information_schema.tables WHERE table_schema = 'public';"},{name:"Table columns",query:"SELECT column_name, data_type FROM information_schema.columns WHERE table_name = 'table_name';"},{name:"Table size",query:"SELECT pg_size_pretty(pg_total_relation_size('table_name'));"},{name:"Active connections",query:"SELECT count(*) FROM pg_stat_activity;"}]},{category:"RLS",items:[{name:"List policies",query:"SELECT * FROM pg_policies;"},{name:"Enable RLS",query:"ALTER TABLE table_name ENABLE ROW LEVEL SECURITY;"},{name:"Create policy",query:`CREATE POLICY policy_name ON table_name
FOR SELECT
USING (auth.uid() = user_id);`}]}],De=[{name:"Hello World",query:"SELECT 'Hello, World!' AS greeting;"},{name:"Current time",query:"SELECT NOW() AS current_time;"},{name:"PostgreSQL version",query:"SELECT version();"},{name:"Database size",query:"SELECT pg_size_pretty(pg_database_size(current_database())) AS db_size;"}];function We(){const{savedQueries:v,addSavedQuery:T,removeSavedQuery:E}=be(),[c,u]=m.useState([{id:crypto.randomUUID(),name:"New query",query:"",isDirty:!1,result:null,error:null,loading:!1}]),[o,y]=m.useState(c[0].id),[x,Z]=m.useState(new Set(["PRIVATE"])),[_,$]=m.useState(""),[k,ee]=m.useState("results"),[se,A]=m.useState(!1),[z,N]=m.useState(""),[re,ae]=m.useState("postgres"),[M,ie]=m.useState(new Set),i=c.find(s=>s.id===o)||c[0],b=s=>{Z(r=>{const a=new Set(r);return a.has(s)?a.delete(s):a.add(s),a})},Q=()=>{const s={id:crypto.randomUUID(),name:"New query",query:"",isDirty:!1,result:null,error:null,loading:!1};u([...c,s]),y(s.id)},ne=s=>{if(c.length===1){u([{id:crypto.randomUUID(),name:"New query",query:"",isDirty:!1,result:null,error:null,loading:!1}]),y(c[0].id);return}const r=c.findIndex(l=>l.id===s),a=c.filter(l=>l.id!==s);if(u(a),o===s){const l=Math.max(0,r-1);y(a[l].id)}},F=s=>{u(r=>r.map(a=>a.id===o?{...a,query:s,isDirty:s!==""}:a))},U=m.useCallback(async()=>{if(!i.query.trim()){R.show({title:"Error",message:"Please enter a query",color:"red"});return}u(s=>s.map(r=>r.id===o?{...r,loading:!0,error:null,result:null}:r));try{const s=await ge.executeQuery(i.query);u(r=>r.map(a=>a.id===o?{...a,loading:!1,result:s}:a))}catch(s){const r=s.message||"Query execution failed";u(a=>a.map(l=>l.id===o?{...l,loading:!1,error:r}:l)),R.show({title:"Query Error",message:r,color:"red"})}},[i,o]),te=()=>{if(!z.trim()){R.show({title:"Error",message:"Please enter a name",color:"red"});return}T(z,i.query),A(!1),N(""),R.show({title:"Saved",message:"Query saved successfully",color:"green"}),u(s=>s.map(r=>r.id===o?{...r,name:z,isDirty:!1}:r))},w=(s,r)=>{u(a=>a.map(l=>l.id===o?{...l,name:s,query:r,isDirty:!1}:l))},P=(s,r)=>{const a={id:crypto.randomUUID(),name:s,query:r,isDirty:!1,result:null,error:null,loading:!1};u([...c,a]),y(a.id)},B=s=>{ie(r=>{const a=new Set(r);return a.has(s)?a.delete(s):a.add(s),a})},le=()=>{if(!i.result)return;const s=[i.result.columns.join(","),...i.result.rows.map(oe=>i.result.columns.map(de=>JSON.stringify(oe[de]??"")).join(","))].join(`
`),r=new Blob([s],{type:"text/csv"}),a=URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download="query_results.csv",l.click(),URL.revokeObjectURL(a)},V=v.filter(s=>s.name.toLowerCase().includes(_.toLowerCase())||s.query.toLowerCase().includes(_.toLowerCase())),W=v.filter(s=>M.has(s.id));return e.jsxs(je,{title:"SQL Editor",description:"",fullWidth:!0,noPadding:!0,noHeader:!0,children:[e.jsxs(n,{style:{display:"flex",height:"calc(100vh - 60px)"},children:[e.jsxs(n,{style:{width:280,minWidth:280,borderRight:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg-surface)"},children:[e.jsx(n,{p:"sm",pb:0,children:e.jsx(H,{placeholder:"Search queries...",size:"xs",leftSection:e.jsx(Se,{size:14}),value:_,onChange:s=>$(s.target.value),rightSection:e.jsx(f,{size:"xs",variant:"subtle",onClick:Q,children:e.jsx(q,{size:14})})})}),e.jsx(O,{style:{flex:1},p:"sm",children:e.jsxs(j,{gap:"xs",children:[e.jsxs(n,{children:[e.jsx(p,{onClick:()=>b("SHARED"),style:{width:"100%"},children:e.jsxs(d,{gap:"xs",py:4,children:[x.has("SHARED")?e.jsx(I,{size:12}):e.jsx(L,{size:12}),e.jsx(t,{size:"xs",fw:600,c:"dimmed",style:{letterSpacing:.5},children:"SHARED"})]})}),e.jsx(S,{in:x.has("SHARED"),children:e.jsx(n,{pl:"md",py:"xs",children:e.jsx(t,{size:"xs",c:"dimmed",children:"No shared queries yet"})})})]}),e.jsxs(n,{children:[e.jsx(p,{onClick:()=>b("FAVORITES"),style:{width:"100%"},children:e.jsxs(d,{gap:"xs",py:4,children:[x.has("FAVORITES")?e.jsx(I,{size:12}):e.jsx(L,{size:12}),e.jsx(t,{size:"xs",fw:600,c:"dimmed",style:{letterSpacing:.5},children:"FAVORITES"})]})}),e.jsx(S,{in:x.has("FAVORITES"),children:e.jsx(j,{gap:2,pl:"xs",py:"xs",children:W.length===0?e.jsx(t,{size:"xs",c:"dimmed",pl:"md",children:"No favorites yet"}):W.map(s=>e.jsx(G,{query:s,isFavorite:!0,onLoad:()=>w(s.name,s.query),onLoadNewTab:()=>P(s.name,s.query),onToggleFavorite:()=>B(s.id),onDelete:()=>E(s.id)},s.id))})})]}),e.jsxs(n,{children:[e.jsx(p,{onClick:()=>b("PRIVATE"),style:{width:"100%"},children:e.jsxs(d,{gap:"xs",py:4,children:[x.has("PRIVATE")?e.jsx(I,{size:12}):e.jsx(L,{size:12}),e.jsx(t,{size:"xs",fw:600,c:"dimmed",style:{letterSpacing:.5},children:"PRIVATE"})]})}),e.jsx(S,{in:x.has("PRIVATE"),children:e.jsx(j,{gap:2,pl:"xs",py:"xs",children:V.length===0?e.jsxs(n,{py:"md",ta:"center",children:[e.jsx(t,{size:"xs",c:"dimmed",mb:"xs",children:"No private queries created yet"}),e.jsx(t,{size:"xs",c:"dimmed",children:"Queries will be automatically saved once you start writing in the editor"})]}):V.map(s=>e.jsx(G,{query:s,isFavorite:M.has(s.id),onLoad:()=>w(s.name,s.query),onLoadNewTab:()=>P(s.name,s.query),onToggleFavorite:()=>B(s.id),onDelete:()=>E(s.id)},s.id))})})]}),e.jsx(Y,{my:"xs"}),e.jsxs(n,{children:[e.jsx(p,{onClick:()=>b("COMMUNITY"),style:{width:"100%"},children:e.jsxs(d,{gap:"xs",py:4,children:[x.has("COMMUNITY")?e.jsx(I,{size:12}):e.jsx(L,{size:12}),e.jsx(t,{size:"xs",fw:600,c:"dimmed",style:{letterSpacing:.5},children:"COMMUNITY"})]})}),e.jsx(S,{in:x.has("COMMUNITY"),children:e.jsxs(j,{gap:2,pl:"xs",py:"xs",children:[e.jsx(p,{onClick:()=>b("Templates"),style:{padding:"6px 8px",borderRadius:4},children:e.jsxs(d,{gap:"xs",children:[e.jsx(fe,{size:14}),e.jsx(t,{size:"sm",children:"Templates"})]})}),e.jsx(S,{in:x.has("Templates"),children:e.jsx(j,{gap:2,pl:"md",children:Oe.map(s=>e.jsxs(n,{children:[e.jsx(t,{size:"xs",c:"dimmed",fw:500,py:4,children:s.category}),s.items.map(r=>e.jsx(p,{onClick:()=>w(r.name,r.query),style:{display:"block",width:"100%",padding:"4px 8px",borderRadius:4},children:e.jsx(t,{size:"xs",children:r.name})},r.name))]},s.category))})}),e.jsx(p,{onClick:()=>b("Quickstarts"),style:{padding:"6px 8px",borderRadius:4},children:e.jsxs(d,{gap:"xs",children:[e.jsx(Ee,{size:14}),e.jsx(t,{size:"sm",children:"Quickstarts"})]})}),e.jsx(S,{in:x.has("Quickstarts"),children:e.jsx(j,{gap:2,pl:"md",children:De.map(s=>e.jsx(p,{onClick:()=>w(s.name,s.query),style:{display:"block",width:"100%",padding:"4px 8px",borderRadius:4},children:e.jsx(t,{size:"xs",children:s.name})},s.name))})})]})})]})]})}),e.jsx(n,{p:"sm",style:{borderTop:"1px solid var(--supabase-border)"},children:e.jsx(C,{variant:"subtle",fullWidth:!0,size:"xs",leftSection:e.jsx(Ce,{size:14}),children:"View running queries"})})]}),e.jsxs(n,{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:[e.jsx(n,{style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)",display:"flex",alignItems:"center"},children:e.jsx(O,{style:{flex:1},scrollbarSize:4,type:"scroll",children:e.jsxs(d,{gap:0,wrap:"nowrap",px:"xs",children:[c.map(s=>e.jsxs(n,{onClick:()=>y(s.id),style:{padding:"8px 12px",cursor:"pointer",borderBottom:o===s.id?"2px solid var(--supabase-brand)":"2px solid transparent",backgroundColor:o===s.id?"var(--supabase-bg-surface)":"transparent",display:"flex",alignItems:"center",gap:8,whiteSpace:"nowrap"},children:[e.jsx(J,{size:14}),e.jsxs(t,{size:"sm",children:[s.name,s.isDirty&&" *"]}),e.jsx(f,{size:"xs",variant:"subtle",onClick:r=>{r.stopPropagation(),ne(s.id)},children:e.jsx(ve,{size:12})})]},s.id)),e.jsx(D,{label:"New query",children:e.jsx(f,{variant:"subtle",size:"sm",onClick:Q,mx:"xs",children:e.jsx(q,{size:16})})})]})})}),e.jsx(n,{style:{flex:"0 0 50%",borderBottom:"1px solid var(--supabase-border)"},children:e.jsx(ye,{height:"100%",defaultLanguage:"sql",value:i.query,onChange:s=>F(s||""),theme:"vs-light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,wordWrap:"on",placeholder:"Hit CMD+K to generate query or just start typing"},onMount:(s,r)=>{s.addCommand(r.KeyMod.CtrlCmd|r.KeyCode.Enter,()=>U()),i.query||s.getModel()}})}),e.jsxs(n,{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(n,{px:"sm",py:"xs",style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)"},children:e.jsxs(d,{justify:"space-between",children:[e.jsxs(d,{gap:"xs",children:[e.jsx(ce,{size:"xs",value:k,onChange:s=>ee(s),data:[{label:"Results",value:"results"},{label:"Explain",value:"explain"},{label:"Chart",value:"chart"}]}),i.result&&e.jsxs(ue,{size:"sm",variant:"light",color:"green",children:[i.result.row_count," rows in ",i.result.duration_ms.toFixed(2),"ms"]})]}),e.jsxs(d,{gap:"xs",children:[i.result&&i.result.rows.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(D,{label:"Copy as CSV",children:e.jsx(f,{variant:"subtle",size:"sm",children:e.jsx(Te,{size:14})})}),e.jsx(D,{label:"Export as CSV",children:e.jsx(f,{variant:"subtle",size:"sm",onClick:le,children:e.jsx(ze,{size:14})})})]}),e.jsx(Y,{orientation:"vertical"}),e.jsx(K,{size:"xs",value:"primary",data:[{value:"primary",label:"Primary Database"}],w:150,styles:{input:{fontSize:12}}}),e.jsx(K,{size:"xs",value:re,onChange:s=>s&&ae(s),data:[{value:"postgres",label:"postgres"},{value:"anon",label:"anon"},{value:"authenticated",label:"authenticated"},{value:"service_role",label:"service_role"}],w:130,leftSection:e.jsx(t,{size:"xs",c:"dimmed",children:"Role"}),styles:{input:{fontSize:12,paddingLeft:40}}}),e.jsx(C,{size:"xs",onClick:U,loading:i.loading,rightSection:e.jsxs(d,{gap:2,children:[e.jsx(X,{size:"xs",children:"⌘"}),e.jsx(X,{size:"xs",children:"↵"})]}),children:"Run"})]})]})}),e.jsx(O,{style:{flex:1},children:i.loading?e.jsx(xe,{py:"xl",children:e.jsx(me,{size:"sm"})}):i.error?e.jsx(n,{p:"md",children:e.jsx(pe,{p:"md",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)"},children:e.jsx(t,{size:"sm",c:"red",children:i.error})})}):k==="results"?i.result?i.result.rows.length>0?e.jsxs(g,{striped:!0,highlightOnHover:!0,children:[e.jsx(g.Thead,{children:e.jsx(g.Tr,{children:i.result.columns.map(s=>e.jsx(g.Th,{children:s},s))})}),e.jsx(g.Tbody,{children:i.result.rows.map((s,r)=>e.jsx(g.Tr,{children:i.result.columns.map(a=>e.jsx(g.Td,{children:e.jsx(t,{size:"sm",style:{maxWidth:300},truncate:!0,children:s[a]===null?"NULL":typeof s[a]=="object"?JSON.stringify(s[a]):String(s[a])})},a))},r))})]}):e.jsx(n,{p:"xl",ta:"center",children:e.jsx(t,{c:"dimmed",children:"Query executed successfully. No rows returned."})}):e.jsx(n,{p:"xl",ta:"center",children:e.jsx(t,{c:"dimmed",children:"Click Run to execute your query."})}):k==="explain"?e.jsxs(n,{p:"xl",ta:"center",children:[e.jsx(we,{size:32,style:{opacity:.3}}),e.jsx(t,{c:"dimmed",mt:"sm",children:"Query plan will be shown here after running EXPLAIN"}),e.jsx(C,{variant:"subtle",size:"xs",mt:"md",onClick:()=>{const s=`EXPLAIN (ANALYZE, COSTS, VERBOSE, BUFFERS, FORMAT JSON)
${i.query}`;F(s)},children:"Run with EXPLAIN"})]}):e.jsxs(n,{p:"xl",ta:"center",children:[e.jsx(Re,{size:32,style:{opacity:.3}}),e.jsx(t,{c:"dimmed",mt:"sm",children:"Chart visualization coming soon"})]})})]})]})]}),e.jsx(he,{opened:se,onClose:()=>A(!1),title:"Save query",size:"sm",children:e.jsxs(j,{gap:"md",children:[e.jsx(H,{label:"Query name",placeholder:"My query",value:z,onChange:s=>N(s.target.value),autoFocus:!0}),e.jsxs(d,{justify:"flex-end",children:[e.jsx(C,{variant:"subtle",onClick:()=>A(!1),children:"Cancel"}),e.jsx(C,{onClick:te,children:"Save"})]})]})})]})}function G({query:v,isFavorite:T,onLoad:E,onLoadNewTab:c,onToggleFavorite:u,onDelete:o}){return e.jsxs(d,{gap:4,wrap:"nowrap",style:{padding:"4px 8px",borderRadius:4,cursor:"pointer"},className:"query-item",children:[e.jsx(J,{size:14,style:{flexShrink:0}}),e.jsx(p,{onClick:E,style:{flex:1,minWidth:0},children:e.jsx(t,{size:"sm",truncate:!0,children:v.name})}),e.jsxs(h,{position:"right-start",withinPortal:!0,children:[e.jsx(h.Target,{children:e.jsx(f,{size:"xs",variant:"subtle",onClick:y=>y.stopPropagation(),children:e.jsx(Ie,{size:12})})}),e.jsxs(h.Dropdown,{children:[e.jsx(h.Item,{leftSection:e.jsx(Le,{size:14}),onClick:E,children:"Open"}),e.jsx(h.Item,{leftSection:e.jsx(q,{size:14}),onClick:c,children:"Open in new tab"}),e.jsx(h.Item,{leftSection:T?e.jsx(_e,{size:14}):e.jsx(ke,{size:14}),onClick:u,children:T?"Remove from favorites":"Add to favorites"}),e.jsx(h.Divider,{}),e.jsx(h.Item,{leftSection:e.jsx(Ae,{size:14}),color:"red",onClick:o,children:"Delete"})]})]})]})}export{We as SQLEditorPage};
