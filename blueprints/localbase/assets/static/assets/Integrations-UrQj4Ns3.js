import{h as N,j as e,z as l,S as u,E as z,G as a,T as n,e as d,q as j,a2 as i,X as t,a as U,d as g,A as p,p as b,t as E,s as P,B as h,F as V,f as H,b as k,H as W,y as f}from"./vendor-mantine-0E1e8SJ8.js";import{r as m}from"./vendor-react-CFPnf9wS.js";import{P as O}from"./PageContainer-BJil4t7q.js";import{aA as _,aU as T,s as I,W as S,V as q,aV as X,aM as Z,Z as L,an as $,B as J}from"./vendor-icons-rmXLq6rR.js";function ne(){const[Q,C]=m.useState("cron"),[B,{open:w,close:y}]=N(!1),[o,v]=m.useState([{id:"1",name:"cleanup_old_sessions",schedule:"0 0 * * *",command:"SELECT delete_old_sessions('30 days')",enabled:!0,lastRun:"2025-01-16 00:00:00",nextRun:"2025-01-17 00:00:00"},{id:"2",name:"send_daily_digest",schedule:"0 9 * * *",command:"SELECT send_daily_digest()",enabled:!0,lastRun:"2025-01-16 09:00:00",nextRun:"2025-01-17 09:00:00"}]),[M]=m.useState([{id:"1",name:"email_notifications",pendingMessages:5,processingMessages:2,completedMessages:1543,failedMessages:3},{id:"2",name:"image_processing",pendingMessages:12,processingMessages:4,completedMessages:892,failedMessages:1}]),[A]=m.useState([{name:"pg_cron",description:"Job scheduling for PostgreSQL",version:"1.6.0",enabled:!0},{name:"pgmq",description:"A lightweight message queue for PostgreSQL",version:"1.0.0",enabled:!0},{name:"pg_net",description:"Async HTTP/HTTPS requests",version:"0.7.0",enabled:!0},{name:"pg_graphql",description:"GraphQL support for PostgreSQL",version:"1.5.0",enabled:!1},{name:"vector",description:"Vector similarity search (pgvector)",version:"0.5.0",enabled:!1},{name:"postgis",description:"Geographic objects support",version:"3.4.0",enabled:!1}]),[r,x]=m.useState({name:"",schedule:"",command:""}),R=()=>{if(!r.name||!r.schedule||!r.command){f.show({title:"Validation Error",message:"All fields are required",color:"red"});return}const s={id:crypto.randomUUID(),name:r.name,schedule:r.schedule,command:r.command,enabled:!0};v([...o,s]),y(),x({name:"",schedule:"",command:""}),f.show({title:"Success",message:"Cron job created successfully",color:"green"})},D=s=>{v(o.map(c=>c.id===s?{...c,enabled:!c.enabled}:c))},F=s=>{v(o.filter(c=>c.id!==s)),f.show({title:"Deleted",message:"Cron job deleted",color:"green"})},G=s=>{f.show({title:"Extension Update",message:`Extension ${s} would be toggled. This requires running SQL.`,color:"blue"})};return e.jsxs(O,{title:"Integrations",description:"Manage cron jobs, queues, and database extensions",children:[e.jsxs(l,{value:Q,onChange:C,children:[e.jsxs(l.List,{mb:"lg",children:[e.jsx(l.Tab,{value:"cron",leftSection:e.jsx(_,{size:16}),children:"Cron Jobs"}),e.jsx(l.Tab,{value:"queues",leftSection:e.jsx(T,{size:16}),children:"Queues"}),e.jsx(l.Tab,{value:"extensions",leftSection:e.jsx(I,{size:16}),children:"Extensions"})]}),e.jsx(l.Panel,{value:"cron",children:e.jsxs(u,{gap:"lg",children:[e.jsx(z,{icon:e.jsx(S,{size:16}),color:"blue",children:"Cron jobs use pg_cron to schedule recurring SQL commands. Make sure the pg_cron extension is enabled."}),e.jsxs(a,{justify:"space-between",children:[e.jsx(n,{fw:500,children:"Scheduled Jobs"}),e.jsx(d,{size:"xs",leftSection:e.jsx(q,{size:14}),onClick:w,children:"Create job"})]}),o.length===0?e.jsxs(j,{p:"xl",ta:"center",withBorder:!0,children:[e.jsx(_,{size:32,style:{opacity:.3}}),e.jsx(n,{c:"dimmed",mt:"sm",children:"No cron jobs configured"}),e.jsx(d,{size:"xs",variant:"light",mt:"md",onClick:w,children:"Create your first job"})]}):e.jsx(j,{withBorder:!0,children:e.jsxs(i,{children:[e.jsx(i.Thead,{children:e.jsxs(i.Tr,{children:[e.jsx(i.Th,{children:"Name"}),e.jsx(i.Th,{children:"Schedule"}),e.jsx(i.Th,{children:"Command"}),e.jsx(i.Th,{children:"Last Run"}),e.jsx(i.Th,{children:"Status"}),e.jsx(i.Th,{w:100,children:"Actions"})]})}),e.jsx(i.Tbody,{children:o.map(s=>e.jsxs(i.Tr,{children:[e.jsx(i.Td,{children:e.jsx(n,{size:"sm",fw:500,children:s.name})}),e.jsx(i.Td,{children:e.jsx(t,{children:s.schedule})}),e.jsx(i.Td,{children:e.jsx(n,{size:"sm",truncate:!0,style:{maxWidth:200},children:s.command})}),e.jsx(i.Td,{children:e.jsx(n,{size:"sm",c:"dimmed",children:s.lastRun||"Never"})}),e.jsx(i.Td,{children:e.jsx(U,{size:"sm",variant:"light",color:s.enabled?"green":"gray",children:s.enabled?"Active":"Disabled"})}),e.jsx(i.Td,{children:e.jsxs(a,{gap:4,children:[e.jsx(g,{label:s.enabled?"Disable":"Enable",children:e.jsx(p,{size:"sm",variant:"subtle",onClick:()=>D(s.id),children:s.enabled?e.jsx(X,{size:14}):e.jsx(Z,{size:14})})}),e.jsx(g,{label:"Delete",children:e.jsx(p,{size:"sm",variant:"subtle",color:"red",onClick:()=>F(s.id),children:e.jsx(L,{size:14})})})]})})]},s.id))})]})}),e.jsxs(j,{p:"md",withBorder:!0,children:[e.jsx(n,{size:"sm",fw:500,mb:"sm",children:"Common Cron Schedules"}),e.jsxs(b,{cols:{base:1,sm:2,lg:4},spacing:"sm",children:[e.jsxs(t,{block:!0,children:["* * * * * - Every minute",`
`,"*/5 * * * * - Every 5 minutes"]}),e.jsxs(t,{block:!0,children:["0 * * * * - Every hour",`
`,"0 0 * * * - Every day at midnight"]}),e.jsxs(t,{block:!0,children:["0 9 * * * - Every day at 9am",`
`,"0 0 * * 0 - Every Sunday"]}),e.jsxs(t,{block:!0,children:["0 0 1 * * - First of month",`
`,"0 0 1 1 * - First of year"]})]})]})]})}),e.jsx(l.Panel,{value:"queues",children:e.jsxs(u,{gap:"lg",children:[e.jsx(z,{icon:e.jsx(S,{size:16}),color:"blue",children:"Message queues use pgmq (PostgreSQL Message Queue) for async task processing."}),e.jsxs(a,{justify:"space-between",children:[e.jsx(n,{fw:500,children:"Message Queues"}),e.jsx(d,{size:"xs",leftSection:e.jsx(q,{size:14}),children:"Create queue"})]}),M.length===0?e.jsxs(j,{p:"xl",ta:"center",withBorder:!0,children:[e.jsx(T,{size:32,style:{opacity:.3}}),e.jsx(n,{c:"dimmed",mt:"sm",children:"No queues configured"})]}):e.jsx(b,{cols:{base:1,sm:2},spacing:"md",children:M.map(s=>e.jsxs(E,{padding:"md",withBorder:!0,children:[e.jsxs(a,{justify:"space-between",mb:"md",children:[e.jsxs(a,{gap:"sm",children:[e.jsx(P,{size:"sm",radius:"xl",variant:"light",color:"blue",children:e.jsx(T,{size:14})}),e.jsx(n,{fw:500,children:s.name})]}),e.jsxs(a,{gap:4,children:[e.jsx(g,{label:"Refresh",children:e.jsx(p,{size:"sm",variant:"subtle",children:e.jsx($,{size:14})})}),e.jsx(g,{label:"Delete",children:e.jsx(p,{size:"sm",variant:"subtle",color:"red",children:e.jsx(L,{size:14})})})]})]}),e.jsxs(b,{cols:2,spacing:"sm",children:[e.jsxs(h,{children:[e.jsx(n,{size:"xs",c:"dimmed",children:"Pending"}),e.jsx(n,{fw:500,children:s.pendingMessages})]}),e.jsxs(h,{children:[e.jsx(n,{size:"xs",c:"dimmed",children:"Processing"}),e.jsx(n,{fw:500,children:s.processingMessages})]}),e.jsxs(h,{children:[e.jsx(n,{size:"xs",c:"dimmed",children:"Completed"}),e.jsx(n,{fw:500,c:"green",children:s.completedMessages})]}),e.jsxs(h,{children:[e.jsx(n,{size:"xs",c:"dimmed",children:"Failed"}),e.jsx(n,{fw:500,c:s.failedMessages>0?"red":"dimmed",children:s.failedMessages})]})]})]},s.id))})]})}),e.jsx(l.Panel,{value:"extensions",children:e.jsxs(u,{gap:"lg",children:[e.jsx(z,{icon:e.jsx(S,{size:16}),color:"blue",children:"PostgreSQL extensions add powerful functionality to your database. Enable only the extensions you need."}),e.jsx(b,{cols:{base:1,sm:2,lg:3},spacing:"md",children:A.map(s=>e.jsxs(E,{padding:"md",withBorder:!0,children:[e.jsxs(a,{justify:"space-between",mb:"sm",children:[e.jsxs(a,{gap:"sm",children:[e.jsx(P,{size:"sm",radius:"xl",variant:"light",color:s.enabled?"green":"gray",children:e.jsx(I,{size:14})}),e.jsxs(h,{children:[e.jsx(n,{fw:500,children:s.name}),e.jsxs(n,{size:"xs",c:"dimmed",children:["v",s.version]})]})]}),e.jsx(V,{checked:s.enabled,onChange:()=>G(s.name),size:"sm"})]}),e.jsx(n,{size:"sm",c:"dimmed",children:s.description}),s.name==="pg_cron"&&e.jsx(d,{size:"xs",variant:"subtle",mt:"sm",rightSection:e.jsx(J,{size:12}),onClick:()=>C("cron"),children:"Manage cron jobs"}),s.name==="pgmq"&&e.jsx(d,{size:"xs",variant:"subtle",mt:"sm",rightSection:e.jsx(J,{size:12}),onClick:()=>C("queues"),children:"Manage queues"})]},s.name))})]})})]}),e.jsx(H,{opened:B,onClose:y,title:"Create Cron Job",size:"md",children:e.jsxs(u,{gap:"md",children:[e.jsx(k,{label:"Job Name",placeholder:"cleanup_old_records",value:r.name,onChange:s=>x({...r,name:s.target.value}),required:!0}),e.jsx(k,{label:"Schedule (Cron Expression)",placeholder:"0 0 * * *",description:"Use cron syntax: minute hour day month weekday",value:r.schedule,onChange:s=>x({...r,schedule:s.target.value}),required:!0}),e.jsx(W,{label:"SQL Command",placeholder:"SELECT cleanup_old_records();",minRows:3,value:r.command,onChange:s=>x({...r,command:s.target.value}),required:!0,styles:{input:{fontFamily:"monospace"}}}),e.jsxs(a,{justify:"flex-end",mt:"md",children:[e.jsx(d,{variant:"outline",onClick:y,children:"Cancel"}),e.jsx(d,{onClick:R,children:"Create Job"})]})]})})]})}export{ne as IntegrationsPage};
