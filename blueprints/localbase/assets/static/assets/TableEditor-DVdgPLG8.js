import{j as e,B as C,G as d,M as w,T as b,Y as Ls,d as X,A as R,q as Fa,S as T,a2 as He,a3 as M,b as P,e as y,a4 as Ws,V as Y,a as E,g as Aa,D as Os,O as ve,f as le,y as ye,a5 as Pe,h as U,a6 as Ba,F as k,i as Ss,C as Na,W as re,X as ks,J as Ds}from"./vendor-mantine-aKbh6G_O.js";import{r as l}from"./vendor-react-CA6k1jPF.js";import{P as Ta}from"./PageContainer-BshQiLl_.js";import{E as Ue}from"./EmptyState-s1kxp5xn.js";import{C as Is}from"./ConfirmModal-vPtHsZos.js";import{c as fe,W as Ce,aw as Me,_ as ne,V as Ve,H as oe,J as La,am as qs,ax as Wa,ai as Oa,a8 as qa,ay as je,a as $s,f as $a,az as Pa,aA as Rs,aB as Es,j as _s,h as Fs,n as As,ao as Ua,Y as Bs,aC as Ma,aD as Va,x as Ha,aE as Ja,Z as Ns,au as Ka,w as Qa,v as Xa}from"./vendor-icons-BYOfSTr6.js";import{d as N}from"./database-Co5xRXKh.js";import{u as Ya}from"./index-BweS2InR.js";import"./client-CvoVCtJO.js";import"./vendor-state-6LbO6gDb.js";function Za({tabs:o,activeTabId:h,onTabClick:n,onTabDoubleClick:v,onTabClose:_,onAddTab:S}){const[F,z]=l.useState(null),m=l.useRef(null),L=(c,i)=>{c.preventDefault(),z(i)},f=c=>{o.forEach(i=>{i.id!==c&&_(i.id)}),z(null)},g=c=>{const i=o.findIndex(j=>j.id===c);o.forEach((j,A)=>{A>i&&_(j.id)}),z(null)};return o.length===0?null:e.jsxs(C,{ref:m,style:{borderBottom:"1px solid var(--lb-border-default)",backgroundColor:"var(--lb-bg-primary)",display:"flex",alignItems:"center",paddingLeft:12,paddingRight:8,minHeight:40,gap:0,overflowX:"auto"},children:[e.jsx(d,{gap:0,style:{flex:1,minWidth:0},wrap:"nowrap",children:o.map(c=>{const i=c.id===h;return e.jsxs(w,{opened:F===c.id,onClose:()=>z(null),position:"bottom-start",shadow:"md",withinPortal:!0,children:[e.jsx(w.Target,{children:e.jsxs(C,{px:"sm",py:8,onContextMenu:j=>L(j,c.id),onClick:()=>n(c.id),onDoubleClick:()=>v(c.id),style:{borderBottom:i?"2px solid var(--lb-brand)":"2px solid transparent",marginBottom:-1,cursor:"pointer",backgroundColor:"transparent",transition:"var(--lb-transition-fast)",maxWidth:200,minWidth:0,display:"flex",alignItems:"center",gap:6},onMouseEnter:j=>{i||(j.currentTarget.style.backgroundColor="var(--lb-bg-secondary)")},onMouseLeave:j=>{i||(j.currentTarget.style.backgroundColor="transparent")},children:[e.jsxs(d,{gap:6,wrap:"nowrap",style:{flex:1,minWidth:0},children:[e.jsx(fe,{size:14,style:{flexShrink:0,color:i?"var(--lb-brand)":"var(--lb-text-muted)"}}),e.jsx(b,{size:"sm",fw:i?500:400,truncate:!0,style:{color:i?"var(--lb-brand)":"var(--lb-text-primary)",fontStyle:c.isTransient?"italic":"normal"},children:c.table}),c.isDirty&&e.jsx(C,{style:{width:6,height:6,borderRadius:"50%",backgroundColor:"var(--lb-warning)",flexShrink:0}})]}),e.jsx(Ls,{size:"xs",variant:"subtle",onClick:j=>{j.stopPropagation(),_(c.id)},style:{opacity:i?.7:.3,flexShrink:0}})]})}),e.jsxs(w.Dropdown,{children:[e.jsx(w.Item,{onClick:()=>_(c.id),children:"Close"}),e.jsx(w.Item,{onClick:()=>f(c.id),children:"Close Others"}),e.jsx(w.Item,{onClick:()=>g(c.id),children:"Close to the Right"})]})]},c.id)})}),S&&e.jsx(X,{label:"Open table in new tab",children:e.jsx(R,{variant:"subtle",size:"sm",ml:4,onClick:S,style:{opacity:.5,flexShrink:0},children:e.jsx(Ce,{size:14})})})]})}const Ga=o=>{const h=[{value:"eq",label:"equals"},{value:"neq",label:"not equals"}],n={value:"is",label:"is null/true/false"};return o.includes("text")||o.includes("varchar")||o.includes("char")?[...h,{value:"like",label:"contains"},{value:"ilike",label:"contains (case insensitive)"},n]:o.includes("int")||o.includes("numeric")||o.includes("decimal")||o.includes("real")||o.includes("double")||o.includes("float")?[...h,{value:"gt",label:"greater than"},{value:"gte",label:"greater than or equal"},{value:"lt",label:"less than"},{value:"lte",label:"less than or equal"},n]:o.includes("timestamp")||o.includes("date")||o.includes("time")?[...h,{value:"gt",label:"after"},{value:"gte",label:"on or after"},{value:"lt",label:"before"},{value:"lte",label:"on or before"},n]:o==="boolean"?[{value:"is",label:"is"}]:o.includes("uuid")?[...h,n]:o.includes("json")?[{value:"cs",label:"contains"},{value:"cd",label:"contained by"},n]:[...h,{value:"like",label:"contains"},{value:"ilike",label:"contains (case insensitive)"},n]},et=(o,h)=>h==="is"?[{value:"null",label:"NULL"},{value:"true",label:"TRUE"},{value:"false",label:"FALSE"}]:o==="boolean"?[{value:"true",label:"true"},{value:"false",label:"false"}]:null;function st({columns:o,filters:h,logic:n,onChange:v,onApply:_,onClear:S,onClose:F}){const z=()=>{var c;const g={id:crypto.randomUUID(),column:((c=o[0])==null?void 0:c.name)||"",operator:"eq",value:""};v([...h,g],n)},m=(g,c)=>{const i=h.map(j=>j.id===g?{...j,...c}:j);v(i,n)},L=g=>{v(h.filter(c=>c.id!==g),n)},f=g=>{const c=o.find(i=>i.name===g);return(c==null?void 0:c.type)||"text"};return e.jsxs(Fa,{p:"md",withBorder:!0,style:{backgroundColor:"var(--lb-bg-secondary)",borderColor:"var(--lb-border-default)",borderRadius:"var(--lb-radius-md)"},children:[e.jsxs(d,{justify:"space-between",mb:"sm",children:[e.jsxs(d,{gap:"xs",children:[e.jsx(Me,{size:16,style:{color:"var(--lb-brand)"}}),e.jsx(b,{size:"sm",fw:600,children:"Filter rows"})]}),F&&e.jsx(Ls,{size:"sm",onClick:F})]}),h.length>0&&e.jsx(T,{gap:"xs",mb:"sm",children:h.map((g,c)=>{const i=f(g.column),j=Ga(i),A=et(i,g.operator);return e.jsxs(d,{gap:"xs",wrap:"nowrap",align:"flex-start",children:[c>0&&e.jsx(C,{w:60,children:e.jsx(He,{size:"xs",value:n,onChange:r=>v(h,r),data:[{value:"AND",label:"AND"},{value:"OR",label:"OR"}],styles:{root:{backgroundColor:"var(--lb-bg-primary)",border:"1px solid var(--lb-border-default)"}}})}),c===0&&e.jsx(C,{w:60}),e.jsx(M,{size:"xs",value:g.column,onChange:r=>r&&m(g.id,{column:r}),data:o.map(r=>({value:r.name,label:r.name})),searchable:!0,style:{flex:1},styles:{input:{backgroundColor:"var(--lb-bg-primary)",borderColor:"var(--lb-border-default)"}}}),e.jsx(M,{size:"xs",value:g.operator,onChange:r=>r&&m(g.id,{operator:r}),data:j,w:180,styles:{input:{backgroundColor:"var(--lb-bg-primary)",borderColor:"var(--lb-border-default)"}}}),A?e.jsx(M,{size:"xs",value:g.value,onChange:r=>r&&m(g.id,{value:r}),data:A,style:{flex:1},styles:{input:{backgroundColor:"var(--lb-bg-primary)",borderColor:"var(--lb-border-default)"}}}):e.jsx(P,{size:"xs",value:g.value,onChange:r=>m(g.id,{value:r.target.value}),placeholder:"Enter value...",style:{flex:1},styles:{input:{backgroundColor:"var(--lb-bg-primary)",borderColor:"var(--lb-border-default)"}}}),e.jsx(R,{size:"sm",variant:"subtle",color:"red",onClick:()=>L(g.id),children:e.jsx(ne,{size:14})})]},g.id)})}),e.jsxs(d,{justify:"space-between",children:[e.jsx(y,{size:"xs",variant:"subtle",leftSection:e.jsx(Ce,{size:14}),onClick:z,children:"Add filter"}),e.jsxs(d,{gap:"xs",children:[h.length>0&&e.jsx(y,{size:"xs",variant:"subtle",color:"red",onClick:S,children:"Clear all"}),e.jsx(y,{size:"xs",disabled:h.length===0,onClick:_,styles:{root:{backgroundColor:"var(--lb-brand)",transition:"var(--lb-transition-fast)","&:hover":{backgroundColor:"var(--lb-brand-hover)"}}},children:"Apply filters"})]})]})]})}function at({opened:o,onClose:h,columns:n,row:v,onSave:_,readOnly:S=!1}){const[F,z]=l.useState({}),[m,L]=l.useState(!1),[f,g]=l.useState(!1);l.useEffect(()=>{if(v){const r={};n.forEach(u=>{const p=v[u.name];p===null?r[u.name]="":typeof p=="object"?r[u.name]=JSON.stringify(p,null,2):r[u.name]=String(p)}),z(r),g(!1)}},[v,n]);const c=(r,u)=>{z(p=>({...p,[r]:u})),g(!0)},i=async()=>{L(!0);try{const r={};n.forEach(u=>{const p=F[u.name];if(p===""&&u.is_nullable)r[u.name]=null;else if(u.type.includes("json"))try{r[u.name]=JSON.parse(p)}catch{r[u.name]=p}else u.type==="boolean"?r[u.name]=p==="true"||p===!0:u.type.includes("int")||u.type.includes("numeric")||u.type.includes("decimal")?r[u.name]=p===""?null:Number(p):r[u.name]=p}),await _(r),g(!1)}finally{L(!1)}},j=(r,u)=>{if(r==null)return"NULL";if(typeof r=="boolean")return r?"true":"false";if(typeof r=="object")return JSON.stringify(r,null,2);if(u.includes("timestamp"))try{return new Date(r).toLocaleString()}catch{return String(r)}return String(r)},A=r=>{const u=F[r.name]??"";return r.type==="boolean"?e.jsx(M,{size:"sm",value:u,onChange:p=>c(r.name,p),data:[{value:"",label:"(null)"},{value:"true",label:"true"},{value:"false",label:"false"}],disabled:S||r.is_primary_key,styles:{input:{backgroundColor:"var(--lb-bg-primary)",borderColor:"var(--lb-border-default)"}}}):r.type.includes("json")?e.jsx(ve,{size:"sm",value:u,onChange:p=>c(r.name,p.target.value),minRows:3,maxRows:10,autosize:!0,disabled:S,styles:{input:{fontFamily:"monospace",fontSize:"12px",backgroundColor:"var(--lb-bg-primary)",borderColor:"var(--lb-border-default)"}}}):r.type==="text"&&String(u).length>100?e.jsx(ve,{size:"sm",value:u,onChange:p=>c(r.name,p.target.value),minRows:2,maxRows:6,autosize:!0,disabled:S,styles:{input:{backgroundColor:"var(--lb-bg-primary)",borderColor:"var(--lb-border-default)"}}}):e.jsx(P,{size:"sm",value:u,onChange:p=>c(r.name,p.target.value),disabled:S||r.is_primary_key,styles:{input:{fontFamily:r.type.includes("uuid")||r.type.includes("int")?"monospace":void 0,backgroundColor:"var(--lb-bg-primary)",borderColor:"var(--lb-border-default)"}}})};return e.jsxs(Ws,{opened:o,onClose:h,title:e.jsxs(d,{gap:"xs",children:[e.jsx(b,{fw:600,children:"Row Details"}),f&&e.jsx(E,{size:"xs",color:"yellow",children:"Unsaved changes"})]}),position:"right",size:"lg",padding:"md",styles:{header:{borderBottom:"1px solid var(--lb-border-default)",paddingBottom:12},body:{padding:0}},children:[e.jsx(Y,{style:{height:"calc(100vh - 140px)"},p:"md",children:e.jsx(T,{gap:"md",children:n.map(r=>e.jsxs(C,{children:[e.jsxs(d,{gap:"xs",mb:4,justify:"space-between",children:[e.jsxs(d,{gap:"xs",children:[r.is_primary_key&&e.jsx(Ve,{size:14,color:"var(--lb-brand)"}),e.jsx(b,{size:"sm",fw:500,children:r.name}),e.jsx(b,{size:"xs",style:{color:"var(--lb-text-secondary)"},children:r.type})]}),e.jsxs(d,{gap:4,children:[r.is_primary_key&&e.jsx(E,{size:"xs",color:"blue",children:"PK"}),!r.is_nullable&&e.jsx(E,{size:"xs",color:"red",variant:"light",children:"Required"}),r.is_unique&&e.jsx(E,{size:"xs",color:"violet",variant:"light",children:"Unique"}),e.jsx(Aa,{value:j(v==null?void 0:v[r.name],r.type),children:({copied:u,copy:p})=>e.jsx(X,{label:u?"Copied!":"Copy value",children:e.jsx(R,{size:"xs",variant:"subtle",onClick:p,children:u?e.jsx(oe,{size:12}):e.jsx(La,{size:12})})})})]})]}),A(r),r.default_value&&e.jsxs(b,{size:"xs",style:{color:"var(--lb-text-secondary)"},mt:2,children:["Default: ",r.default_value]})]},r.name))})}),!S&&e.jsxs(e.Fragment,{children:[e.jsx(Os,{}),e.jsxs(d,{justify:"flex-end",p:"md",children:[e.jsx(y,{variant:"outline",onClick:h,children:"Cancel"}),e.jsx(y,{onClick:i,loading:m,disabled:!f,styles:{root:{backgroundColor:"var(--lb-brand)",transition:"var(--lb-transition-fast)","&:hover":{backgroundColor:"var(--lb-brand-hover)"}}},children:"Save changes"})]})]})]})}function tt({opened:o,onClose:h,schema:n,table:v,totalRows:_,selectedRows:S,filters:F}){const[z,m]=l.useState("csv"),[L,f]=l.useState(!1),g=()=>{const j=L&&S>0?F:void 0,A=N.exportTableData(n,v,z,j),r=localStorage.getItem("supabase_service_key")||"",u=document.createElement("a");u.href=`${A}&apikey=${encodeURIComponent(r)}`,u.download=`${v}_export.${z}`,document.body.appendChild(u),u.click(),document.body.removeChild(u),h()},c=()=>{switch(z){case"csv":return e.jsx(qa,{size:20});case"sql":return e.jsx(Oa,{size:20});default:return e.jsx(Wa,{size:20})}},i=()=>{switch(z){case"csv":return"Export as CSV file, compatible with Excel and spreadsheet applications.";case"sql":return"Export as SQL INSERT statements that can be used to recreate the data.";default:return"Export as JSON array, ideal for programmatic use and API testing."}};return e.jsx(le,{opened:o,onClose:h,title:e.jsxs(d,{gap:"xs",children:[e.jsx(qs,{size:20}),e.jsx(b,{fw:600,children:"Export Data"})]}),size:"md",children:e.jsxs(T,{gap:"lg",children:[e.jsxs(T,{gap:"xs",children:[e.jsx(b,{size:"sm",fw:500,children:"Export format"}),e.jsx(He,{value:z,onChange:j=>m(j),data:[{value:"csv",label:"CSV"},{value:"json",label:"JSON"},{value:"sql",label:"SQL"}],fullWidth:!0,styles:{root:{backgroundColor:"var(--lb-bg-secondary)",border:"1px solid var(--lb-border-default)"},indicator:{backgroundColor:"var(--lb-bg-primary)",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}}}),e.jsx(b,{size:"xs",style:{color:"var(--lb-text-secondary)"},children:i()})]}),e.jsxs(T,{gap:"xs",children:[e.jsx(b,{size:"sm",fw:500,children:"Rows to export"}),e.jsxs(d,{children:[e.jsxs(E,{variant:"light",color:"blue",children:[_," total rows"]}),S>0&&e.jsxs(E,{variant:"light",color:"green",children:[S," selected"]})]}),S>0&&e.jsx(ye,{label:`Export only selected rows (${S})`,checked:L,onChange:j=>f(j.currentTarget.checked)})]}),e.jsxs(d,{justify:"flex-end",mt:"md",children:[e.jsx(y,{variant:"outline",onClick:h,children:"Cancel"}),e.jsxs(y,{leftSection:c(),onClick:g,styles:{root:{backgroundColor:"var(--lb-brand)",transition:"var(--lb-transition-fast)","&:hover":{backgroundColor:"var(--lb-brand-hover)"}}},children:["Export ",z.toUpperCase()]})]})]})})}function rt({columns:o,visibleColumns:h,columnOrder:n,onVisibilityChange:v,onToggleAll:_}){const[S,F]=l.useState(!1),[z,m]=l.useState(""),f=[...o].sort((i,j)=>{const A=n.indexOf(i.name),r=n.indexOf(j.name);return A===-1&&r===-1?0:A===-1?1:r===-1?-1:A-r}).filter(i=>i.name.toLowerCase().includes(z.toLowerCase())),g=o.every(i=>h.has(i.name)),c=o.every(i=>!h.has(i.name));return e.jsxs(Pe,{opened:S,onClose:()=>F(!1),position:"bottom-end",shadow:"md",width:280,children:[e.jsx(Pe.Target,{children:e.jsx(y,{size:"xs",variant:"outline",leftSection:e.jsx(je,{size:14}),onClick:()=>F(!S),styles:{root:{borderColor:"var(--lb-border-default)",color:"var(--lb-text-primary)",fontWeight:400,"&:hover":{backgroundColor:"var(--lb-bg-secondary)"}}},children:"Columns"})}),e.jsx(Pe.Dropdown,{p:"xs",style:{backgroundColor:"var(--lb-bg-primary)",borderColor:"var(--lb-border-default)",borderRadius:"var(--lb-radius-md)"},children:e.jsxs(T,{gap:"xs",children:[e.jsx(P,{size:"xs",placeholder:"Search columns...",value:z,onChange:i=>m(i.target.value),leftSection:e.jsx($s,{size:14}),styles:{input:{backgroundColor:"var(--lb-bg-secondary)",borderColor:"var(--lb-border-default)"}}}),e.jsxs(d,{justify:"space-between",children:[e.jsxs(b,{size:"xs",style:{color:"var(--lb-text-secondary)"},children:[h.size," of ",o.length," visible"]}),e.jsxs(d,{gap:4,children:[e.jsx(y,{size:"compact-xs",variant:"subtle",onClick:()=>_(!0),disabled:g,children:"Show all"}),e.jsx(y,{size:"compact-xs",variant:"subtle",onClick:()=>_(!1),disabled:c,children:"Hide all"})]})]}),e.jsx(Os,{}),e.jsx(Y,{style:{maxHeight:300},children:e.jsx(T,{gap:4,children:f.map(i=>e.jsxs(d,{gap:"xs",py:4,px:6,wrap:"nowrap",style:{borderRadius:"var(--lb-radius-sm)",cursor:"pointer",transition:"var(--lb-transition-fast)",backgroundColor:h.has(i.name)?"transparent":"var(--lb-bg-secondary)"},children:[e.jsx(ye,{size:"xs",checked:h.has(i.name),onChange:j=>v(i.name,j.currentTarget.checked),styles:{input:{cursor:"pointer"}}}),e.jsxs(C,{style:{flex:1,minWidth:0},children:[e.jsx(b,{size:"xs",truncate:!0,fw:500,children:i.name}),e.jsx(b,{size:"xs",style:{color:"var(--lb-text-secondary)"},truncate:!0,children:i.type})]}),e.jsx(R,{size:"xs",variant:"subtle",onClick:()=>v(i.name,!h.has(i.name)),children:h.has(i.name)?e.jsx($a,{size:12}):e.jsx(Pa,{size:12})})]},i.name))})}),f.length===0&&e.jsxs(b,{size:"xs",style:{color:"var(--lb-text-secondary)"},ta:"center",py:"sm",children:['No columns match "',z,'"']})]})})]})}const lt=[{value:"uuid",label:"uuid"},{value:"text",label:"text"},{value:"varchar",label:"varchar"},{value:"integer",label:"integer"},{value:"bigint",label:"bigint"},{value:"smallint",label:"smallint"},{value:"decimal",label:"decimal"},{value:"numeric",label:"numeric"},{value:"real",label:"real"},{value:"double precision",label:"double precision"},{value:"boolean",label:"boolean"},{value:"date",label:"date"},{value:"time",label:"time"},{value:"timestamp",label:"timestamp"},{value:"timestamptz",label:"timestamptz"},{value:"json",label:"json"},{value:"jsonb",label:"jsonb"},{value:"bytea",label:"bytea"},{value:"uuid[]",label:"uuid[]"},{value:"text[]",label:"text[]"},{value:"integer[]",label:"integer[]"}],nt=150,Ts=400;function gt(){const{selectedSchema:o,setSelectedSchema:h,selectedTable:n,setSelectedTable:v}=Ya(),[_,S]=l.useState([]),[F,z]=l.useState([]),[m,L]=l.useState([]),[f,g]=l.useState([]),[c,i]=l.useState(!0),[j,A]=l.useState(!1),[r,u]=l.useState(new Set),[p,ie]=l.useState(null),[J,we]=l.useState(""),[Z,Ps]=l.useState(null),[ee,Je]=l.useState("asc"),[Us,{open:Ke,close:ze}]=U(!1),[Ms,{open:Qe,close:Xe}]=U(!1),[Vs,{open:Se,close:ke}]=U(!1),[Hs,{open:Js,close:De}]=U(!1),[Ks,{open:Qs,close:Ye}]=U(!1),[Xs,{open:Ie,close:Re}]=U(!1),[Ys,{open:Ze,close:Zs}]=U(!1),[Gs,{open:ea,close:Ge}]=U(!1),[H,{open:es,close:Ee}]=U(!1),[W,de]=l.useState([]),[_e,se]=l.useState(null),[G,ss]=l.useState([]),[sa,aa]=l.useState("AND"),[ce,ue]=l.useState(new Set),[ta,as]=l.useState([]),[Fe,ra]=l.useState(null),[la,na]=l.useState(0),[D,ae]=l.useState(null),[Ae,ts]=l.useState(""),[K,B]=l.useState(!1),[I,O]=l.useState({}),[rs,ls]=l.useState(null),[ns,os]=l.useState(null),[Be,is]=l.useState(""),[ds,cs]=l.useState("text"),[us,xs]=l.useState(""),[bs,ps]=l.useState(!0),[hs,ms]=l.useState(!1),oa=l.useRef(null),ia=l.useCallback((s,a,t=!0)=>{const x=W.find(Q=>Q.schema===s&&Q.table===a);if(x){se(x.id);return}const te=W.findIndex(Q=>Q.isTransient),$e={id:crypto.randomUUID(),schema:s,table:a,isTransient:t};if(te!==-1&&t){const Q=[...W];Q[te]=$e,de(Q)}else de([...W,$e]);se($e.id)},[W]),da=l.useCallback(s=>{const a=W.findIndex(x=>x.id===s),t=W.filter(x=>x.id!==s);if(de(t),_e===s)if(t.length>0){const x=Math.min(a,t.length-1);se(t[x].id),v(t[x].table),t[x].schema!==o&&h(t[x].schema)}else se(null),v(null)},[W,_e,o,h,v]),ca=l.useCallback(s=>{de(W.map(a=>a.id===s?{...a,isTransient:!1}:a))},[W]);l.useEffect(()=>{m.length>0&&ce.size===0&&(ue(new Set(m.map(s=>s.name))),as(m.map(s=>s.name)))},[m,ce.size]);const Ne=l.useCallback(()=>{if(G.length===0)return{};const s={};return G.forEach(a=>{a.column&&a.value!==""&&(s[a.column]=`${a.operator}.${a.value}`)}),s},[G]);Ba([["ArrowUp",()=>{D&&D.row>0&&ae({row:D.row-1,col:D.col})}],["ArrowDown",()=>{D&&D.row<f.length-1&&ae({row:D.row+1,col:D.col})}],["ArrowLeft",()=>{D&&D.col>0&&ae({row:D.row,col:D.col-1})}],["ArrowRight",()=>{D&&D.col<m.length-1&&ae({row:D.row,col:D.col+1})}],["Enter",()=>{if(D&&!p){const s=m[D.col],a=f[D.row];s&&a&&fs(D.row,s.name,a[s.name])}}],["Escape",()=>{p&&Le(),ae(null)}],["mod+r",()=>q()],["mod+n",()=>{O({}),Se()}],["mod+f",()=>{H?Ee():es()}],["mod+shift+e",()=>Ze()]]);const gs=l.useCallback(async()=>{try{const s=await N.listSchemas();S(s??[])}catch(s){k.show({title:"Error",message:s.message||"Failed to load schemas",color:"red"})}},[]),xe=l.useCallback(async()=>{i(!0);try{const s=await N.listTables(o);z(s??[]),((s==null?void 0:s.length)??0)>0&&!n&&v(s[0].name)}catch(s){k.show({title:"Error",message:s.message||"Failed to load tables",color:"red"})}finally{i(!1)}},[o,n,v]),q=l.useCallback(async()=>{if(n){A(!0);try{const s={limit:100,includeCount:!0};Z&&(s.order=`${Z}.${ee}`);const a=Ne();Object.keys(a).length>0&&(s.filters=a);const[t,x]=await Promise.all([N.listColumns(o,n),N.getTableData(o,n,s)]);L(t??[]),g(x.data??[]),x.totalCount!==void 0&&na(x.totalCount),u(new Set),ie(null)}catch(s){k.show({title:"Error",message:s.message||"Failed to load table data",color:"red"}),L([]),g([])}finally{A(!1)}}},[o,n,Z,ee,Ne]);l.useEffect(()=>{gs()},[gs]),l.useEffect(()=>{xe()},[xe]),l.useEffect(()=>{n&&q()},[n,q]);const be=m.find(s=>s.is_primary_key),pe=s=>{if(be){const a=s[be.name];return typeof a=="string"?`${be.name}=eq.${a}`:`${be.name}=eq.${a}`}return m.map(a=>`${a.name}=eq.${s[a.name]}`).join("&")},ua=async()=>{if(!Ae.trim()){k.show({title:"Validation Error",message:"Table name is required",color:"red"});return}B(!0);try{await N.createTable({schema:o,name:Ae,columns:[{name:"id",type:"uuid",is_primary_key:!0,is_nullable:!1,is_unique:!0,default_value:"gen_random_uuid()"},{name:"created_at",type:"timestamptz",is_nullable:!1,is_primary_key:!1,is_unique:!1,default_value:"now()"}]}),k.show({title:"Success",message:"Table created successfully",color:"green"}),ze(),ts(""),xe()}catch(s){k.show({title:"Error",message:s.message||"Failed to create table",color:"red"})}finally{B(!1)}},xa=async()=>{if(n){B(!0);try{await N.dropTable(o,n),k.show({title:"Success",message:"Table deleted successfully",color:"green"}),Xe(),v(null),xe()}catch(s){k.show({title:"Error",message:s.message||"Failed to delete table",color:"red"})}finally{B(!1)}}},ba=async()=>{B(!0);try{const s={};for(const a of m){const t=I[a.name];if(t!==void 0&&t!=="")if(a.type==="integer"||a.type==="bigint"||a.type==="smallint")s[a.name]=parseInt(t,10);else if(a.type==="numeric"||a.type==="decimal"||a.type==="real"||a.type==="double precision")s[a.name]=parseFloat(t);else if(a.type==="boolean")s[a.name]=t==="true"||t===!0;else if(a.type==="json"||a.type==="jsonb")try{s[a.name]=JSON.parse(t)}catch{s[a.name]=t}else s[a.name]=t}await N.insertRow(n,s),k.show({title:"Success",message:"Row inserted successfully",color:"green"}),ke(),O({}),q()}catch(s){k.show({title:"Error",message:s.message||"Failed to insert row",color:"red"})}finally{B(!1)}},pa=async()=>{if(rs){B(!0);try{const s=pe(rs),a={};for(const t of m){const x=I[t.name];if(x!==void 0)if(x===""||x===null)a[t.name]=null;else if(t.type==="integer"||t.type==="bigint"||t.type==="smallint")a[t.name]=parseInt(x,10);else if(t.type==="numeric"||t.type==="decimal"||t.type==="real"||t.type==="double precision")a[t.name]=parseFloat(x);else if(t.type==="boolean")a[t.name]=x==="true"||x===!0;else if(t.type==="json"||t.type==="jsonb")try{a[t.name]=JSON.parse(x)}catch{a[t.name]=x}else a[t.name]=x}await N.updateRow(n,s,a),k.show({title:"Success",message:"Row updated successfully",color:"green"}),De(),O({}),ls(null),q()}catch(s){k.show({title:"Error",message:s.message||"Failed to update row",color:"red"})}finally{B(!1)}}},ha=async()=>{if(ns!==null){B(!0);try{const s=f[ns],a=pe(s);await N.deleteRow(n,a),k.show({title:"Success",message:"Row deleted successfully",color:"green"}),Ye(),os(null),q()}catch(s){k.show({title:"Error",message:s.message||"Failed to delete row",color:"red"})}finally{B(!1)}}},ma=async()=>{if(r.size!==0){B(!0);try{const s=Array.from(r).map(a=>{const t=f[a],x=pe(t);return N.deleteRow(n,x)});await Promise.all(s),k.show({title:"Success",message:`${r.size} row(s) deleted successfully`,color:"green"}),u(new Set),q()}catch(s){k.show({title:"Error",message:s.message||"Failed to delete rows",color:"red"})}finally{B(!1)}}},ga=async()=>{if(!Be.trim()){k.show({title:"Validation Error",message:"Column name is required",color:"red"});return}B(!0);try{await N.addColumn(o,n,{name:Be,type:ds,default_value:us||void 0,is_nullable:bs,is_unique:hs}),k.show({title:"Success",message:"Column added successfully",color:"green"}),Re(),Te(),q()}catch(s){k.show({title:"Error",message:s.message||"Failed to add column",color:"red"})}finally{B(!1)}},Te=()=>{is(""),cs("text"),xs(""),ps(!0),ms(!1)},fs=(s,a,t)=>{ie({rowIndex:s,column:a}),we(t===null?"":String(t))},js=async()=>{if(!p)return;const s=f[p.rowIndex],a=m.find(t=>t.name===p.column);if(a)try{const t=pe(s);let x=J;J===""&&a.is_nullable?x=null:a.type==="integer"||a.type==="bigint"||a.type==="smallint"?x=parseInt(J,10):a.type==="numeric"||a.type==="decimal"||a.type==="real"||a.type==="double precision"?x=parseFloat(J):a.type==="boolean"&&(x=J==="true"||J==="1"),await N.updateRow(n,t,{[p.column]:x});const te=[...f];te[p.rowIndex]={...s,[p.column]:x},g(te),ie(null)}catch(t){k.show({title:"Error",message:t.message||"Failed to update cell",color:"red"})}},Le=()=>{ie(null),we("")},fa=s=>{const a=new Set(r);a.has(s)?a.delete(s):a.add(s),u(a)},ja=()=>{r.size===f.length?u(new Set):u(new Set(f.map((s,a)=>a)))},va=s=>{ls(s);const a={};m.forEach(t=>{a[t.name]=s[t.name]===null?"":s[t.name]}),O(a),Js()},ya=s=>{os(s),Qs()},Ca=s=>{Z===s?Je(ee==="asc"?"desc":"asc"):(Ps(s),Je("asc"))},V=F.find(s=>s.name===n),wa=s=>s.type.includes("text")||s.type.includes("varchar")?200:s.type.includes("json")?250:s.type.includes("timestamp")||s.type.includes("date")?200:s.type.includes("uuid")?300:nt,za=s=>{const a=s.map(t=>t.toString(16).padStart(2,"0")).join("");return`${a.slice(0,8)}-${a.slice(8,12)}-${a.slice(12,16)}-${a.slice(16,20)}-${a.slice(20)}`},Sa=s=>Array.isArray(s)&&s.length===16&&s.every(a=>typeof a=="number"&&a>=0&&a<=255),ka=(s,a)=>{if(s===null)return"NULL";if(typeof s=="boolean")return s?"true":"false";if(Sa(s))return za(s);if(a!=null&&a.includes("timestamp")&&typeof s=="string")try{const t=new Date(s);if(!isNaN(t.getTime()))return t.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{}if(a!=null&&a.includes("date")&&!(a!=null&&a.includes("timestamp"))&&typeof s=="string")try{const t=new Date(s);if(!isNaN(t.getTime()))return t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{}if(typeof s=="object")try{return JSON.stringify(s,null,2)}catch{return String(s)}return String(s)},Da=s=>s!=null&&s.includes("json")?{fontFamily:"monospace",fontSize:"0.75rem",whiteSpace:"pre-wrap"}:s!=null&&s.includes("uuid")?{fontFamily:"monospace",fontSize:"0.75rem"}:s!=null&&s.includes("numeric")||s!=null&&s.includes("integer")||s!=null&&s.includes("decimal")||s!=null&&s.includes("bigint")?{fontFamily:"monospace",textAlign:"right"}:{},[We,Oe]=l.useState(1),[vs,Ia]=l.useState(100),he=Math.ceil(((f==null?void 0:f.length)??0)/vs),[me,Ra]=l.useState(""),[ys,Ea]=l.useState("data"),$=Ss("(max-width: 768px)"),ge=Ss("(max-width: 1024px)"),[_a,{open:Cs,close:ws}]=U(!1),qe=F.filter(s=>me===""||s.name.toLowerCase().includes(me.toLowerCase())),zs=({onTableSelect:s})=>e.jsxs(e.Fragment,{children:[e.jsxs(C,{p:"sm",style:{borderBottom:"1px solid var(--supabase-border)"},children:[e.jsx(b,{size:"xs",fw:600,tt:"uppercase",mb:"xs",style:{color:"var(--supabase-text-muted)",letterSpacing:"0.05em",fontSize:"0.6875rem"},children:"Table Editor"}),e.jsx(M,{size:"xs",value:o,onChange:a=>{a&&(h(a),v(null))},data:(_??[]).map(a=>({value:a,label:`schema ${a}`})),placeholder:"Select schema",leftSection:e.jsx(b,{size:"xs",c:"dimmed",children:"schema"}),styles:{input:{backgroundColor:"var(--supabase-bg-surface)"}}})]}),e.jsx(C,{px:"sm",py:"xs",children:e.jsx(y,{size:"xs",variant:"outline",fullWidth:!0,leftSection:e.jsx(Ce,{size:14}),onClick:Ke,styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",justifyContent:"flex-start",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"New table"})}),e.jsx(C,{px:"sm",pb:"xs",children:e.jsx(P,{size:"xs",placeholder:"Search tables...",leftSection:e.jsx($s,{size:14}),value:me,onChange:a=>Ra(a.target.value),styles:{input:{backgroundColor:"var(--supabase-bg-surface)"}}})}),e.jsx(Y,{style:{flex:1},px:"sm",pb:"sm",children:c?e.jsx(re,{py:"xl",children:e.jsx(ks,{size:"sm"})}):!qe||qe.length===0?e.jsx(b,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:me?"No tables match your search":`No tables in ${o}`}):e.jsx(T,{gap:2,children:qe.map(a=>e.jsx(C,{py:6,px:8,style:{cursor:"pointer",backgroundColor:n===a.name?"var(--supabase-brand-light)":"transparent",borderRadius:4,transition:"background-color 0.1s ease"},onClick:()=>{v(a.name),s==null||s()},onMouseEnter:t=>{n!==a.name&&(t.currentTarget.style.backgroundColor="var(--supabase-bg-surface-hover)")},onMouseLeave:t=>{n!==a.name&&(t.currentTarget.style.backgroundColor="transparent")},children:e.jsxs(d,{justify:"space-between",wrap:"nowrap",gap:8,children:[e.jsxs(d,{gap:8,wrap:"nowrap",style:{minWidth:0,flex:1},children:[e.jsx(fe,{size:16,style:{flexShrink:0,color:n===a.name?"var(--supabase-brand)":"var(--supabase-text-muted)"}}),e.jsx(b,{size:"sm",truncate:!0,style:{color:n===a.name?"var(--supabase-brand)":"var(--supabase-text)"},children:a.name})]}),e.jsxs(w,{position:"right-start",shadow:"md",withinPortal:!0,children:[e.jsx(w.Target,{children:e.jsx(R,{size:"xs",variant:"subtle",onClick:t=>t.stopPropagation(),style:{opacity:.5},children:e.jsx(Bs,{size:14})})}),e.jsxs(w.Dropdown,{children:[e.jsx(w.Item,{leftSection:e.jsx(Ns,{size:14}),children:"Edit table"}),e.jsx(w.Item,{color:"red",leftSection:e.jsx(ne,{size:14}),onClick:t=>{t.stopPropagation(),v(a.name),Qe()},children:"Delete table"})]})]})]})},a.name))})})]});return e.jsxs(Ta,{title:"Table Editor",description:"View and edit your database tables",fullWidth:!0,noPadding:!0,noHeader:!0,children:[e.jsx(Ws,{opened:_a,onClose:ws,title:"Tables",size:"280px",padding:"0",styles:{body:{padding:0,height:"calc(100% - 60px)",display:"flex",flexDirection:"column"},header:{borderBottom:"1px solid var(--supabase-border)"}},children:e.jsx(zs,{onTableSelect:ws})}),e.jsxs(C,{style:{display:"flex",height:"calc(100vh - 96px)"},children:[!$&&e.jsx(C,{style:{width:ge?220:280,minWidth:ge?220:280,borderRight:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)"},children:e.jsx(zs,{})}),e.jsx(C,{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:n?e.jsxs(e.Fragment,{children:[e.jsxs(C,{style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)",display:"flex",alignItems:"center",paddingLeft:$?8:0,paddingRight:8,minHeight:40,gap:8},children:[$&&e.jsx(X,{label:"Show tables",children:e.jsx(R,{variant:"subtle",size:"sm",onClick:Cs,children:e.jsx(Rs,{size:16})})}),W.length>0?e.jsx(Za,{tabs:W,activeTabId:_e,onTabClick:s=>{const a=W.find(t=>t.id===s);a&&(se(s),v(a.table),a.schema!==o&&h(a.schema))},onTabDoubleClick:ca,onTabClose:da,onAddTab:()=>{}}):e.jsxs(d,{gap:0,style:{flex:1,minWidth:0},pl:12,children:[e.jsx(C,{px:"sm",py:8,style:{borderBottom:"2px solid var(--supabase-brand)",marginBottom:-1,minWidth:0},children:e.jsxs(d,{gap:6,wrap:"nowrap",children:[e.jsx(fe,{size:14,color:"var(--supabase-brand)",style:{flexShrink:0}}),e.jsx(b,{size:"sm",fw:500,truncate:!0,style:{color:"var(--supabase-brand)"},children:n})]})}),!$&&e.jsx(R,{variant:"subtle",size:"sm",ml:4,style:{opacity:.5},onClick:()=>ia(o,n,!1),children:e.jsx(Ce,{size:14})})]})]}),e.jsx(C,{px:"sm",py:8,style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)"},children:e.jsxs(d,{justify:"space-between",wrap:$?"wrap":"nowrap",gap:8,children:[e.jsxs(d,{gap:8,wrap:"nowrap",children:[!$&&e.jsxs(e.Fragment,{children:[e.jsx(y,{size:"xs",variant:H?"filled":"outline",leftSection:e.jsx(Me,{size:14}),onClick:()=>H?Ee():es(),rightSection:G.length>0?e.jsx(E,{size:"xs",variant:"filled",color:"green",circle:!0,children:G.length}):void 0,styles:{root:{borderColor:H?"var(--supabase-brand)":"var(--supabase-border)",backgroundColor:H?"var(--supabase-brand)":"transparent",color:H?"white":"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:H?"var(--supabase-brand-hover)":"var(--supabase-bg-surface)"}}},children:"Filter"}),e.jsx(y,{size:"xs",variant:"outline",leftSection:e.jsx(Es,{size:14}),rightSection:Z?e.jsx(E,{size:"xs",variant:"light",color:"blue",children:ee==="asc"?"A-Z":"Z-A"}):void 0,styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"Sort"}),e.jsx(rt,{columns:m,visibleColumns:ce,columnOrder:ta,onVisibilityChange:(s,a)=>{const t=new Set(ce);a?t.add(s):t.delete(s),ue(t)},onToggleAll:s=>{ue(s?new Set(m.map(a=>a.name)):new Set)},onReorder:as}),e.jsx(y,{size:"xs",variant:"outline",leftSection:e.jsx(qs,{size:14}),onClick:Ze,styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"Export"})]}),e.jsx(y,{size:"xs",leftSection:e.jsx(C,{style:{display:"flex",alignItems:"center",justifyContent:"center",width:16,height:16,backgroundColor:"rgba(255, 255, 255, 0.2)",borderRadius:3},children:e.jsx(oe,{size:10})}),onClick:()=>{O({}),Se()},styles:{root:{backgroundColor:"var(--supabase-brand)","&:hover":{backgroundColor:"var(--supabase-brand-hover)"}}},children:"Insert"}),r.size>0&&e.jsx(y,{size:"xs",color:"red",variant:"light",leftSection:e.jsx(ne,{size:14}),onClick:ma,loading:K,children:$?r.size:`Delete (${r.size})`})]}),e.jsxs(d,{gap:8,wrap:"nowrap",children:[!$&&!ge&&e.jsxs(e.Fragment,{children:[e.jsx(y,{size:"xs",variant:"outline",leftSection:e.jsx(_s,{size:14}),rightSection:V!=null&&V.rls_enabled?e.jsx(E,{size:"xs",variant:"light",color:"green",style:{marginLeft:4},children:"Enabled"}):void 0,styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"RLS policies"}),e.jsx(y,{size:"xs",variant:"outline",leftSection:e.jsx(Fs,{size:14}),styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"Index Advisor"}),e.jsx(y,{size:"xs",variant:"outline",leftSection:e.jsx(As,{size:14}),styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"Enable Realtime"}),e.jsx(M,{size:"xs",value:"postgres",data:[{value:"postgres",label:"postgres"},{value:"anon",label:"anon"},{value:"authenticated",label:"authenticated"}],leftSection:e.jsx(b,{size:"xs",c:"dimmed",children:"Role"}),w:150,styles:{input:{backgroundColor:"var(--supabase-bg)",borderColor:"var(--supabase-border)"}}})]}),e.jsx(X,{label:"Refresh",children:e.jsx(R,{variant:"subtle",onClick:q,children:e.jsx(Ua,{size:18})})}),e.jsxs(w,{position:"bottom-end",children:[e.jsx(w.Target,{children:e.jsx(R,{variant:"subtle",children:e.jsx(Bs,{size:18})})}),e.jsxs(w.Dropdown,{children:[($||ge)&&e.jsxs(e.Fragment,{children:[e.jsx(w.Item,{leftSection:e.jsx(Me,{size:14}),children:"Filter"}),e.jsx(w.Item,{leftSection:e.jsx(Es,{size:14}),children:"Sort"}),e.jsx(w.Item,{leftSection:e.jsx(_s,{size:14}),children:"RLS policies"}),e.jsx(w.Item,{leftSection:e.jsx(Fs,{size:14}),children:"Index Advisor"}),e.jsx(w.Item,{leftSection:e.jsx(As,{size:14}),children:"Enable Realtime"}),e.jsx(w.Divider,{})]}),e.jsx(w.Item,{leftSection:e.jsx(je,{size:14}),onClick:Ie,children:"Add column"}),e.jsx(w.Divider,{}),e.jsx(w.Item,{color:"red",leftSection:e.jsx(ne,{size:14}),onClick:Qe,children:"Delete table"})]})]})]})]})}),e.jsx(Na,{in:H,children:e.jsx(C,{px:"md",pb:"md",children:e.jsx(st,{columns:m,filters:G,logic:sa,onChange:(s,a)=>{ss(s),aa(a)},onApply:()=>{q()},onClear:()=>{ss([]),q()},onClose:Ee})})}),e.jsx(C,{style:{flex:1,overflow:"hidden"},children:j?e.jsx(re,{py:"xl",children:e.jsx(ks,{size:"sm"})}):ys==="definition"?e.jsx(Y,{style:{height:"100%"},p:"md",children:e.jsxs(C,{style:{maxWidth:800},children:[e.jsxs(b,{size:"sm",fw:600,mb:"md",style:{color:"var(--supabase-text)"},children:["Table Definition: ",n]}),e.jsx(C,{style:{border:"1px solid var(--supabase-border)",borderRadius:"var(--supabase-radius-lg)",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"var(--supabase-bg-surface)"},children:[e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Column"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Type"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Default"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Nullable"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Primary"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Unique"})]})}),e.jsx("tbody",{children:m.map((s,a)=>e.jsxs("tr",{style:{backgroundColor:a%2===0?"var(--supabase-bg)":"var(--supabase-bg-surface)"},children:[e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)"},children:e.jsxs(d,{gap:6,children:[s.is_primary_key&&e.jsx(Ve,{size:14,color:"var(--supabase-brand)"}),e.jsx(b,{size:"sm",fw:500,children:s.name})]})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)"},children:e.jsx(E,{size:"sm",variant:"light",color:"gray",children:s.type})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)",fontFamily:"monospace",fontSize:12},children:s.default_value||e.jsx(b,{size:"xs",c:"dimmed",children:"-"})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)",textAlign:"center"},children:s.is_nullable?e.jsx(E,{size:"xs",variant:"light",color:"gray",children:"Yes"}):e.jsx(E,{size:"xs",variant:"light",color:"red",children:"No"})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)",textAlign:"center"},children:s.is_primary_key&&e.jsx(oe,{size:16,color:"var(--supabase-brand)"})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)",textAlign:"center"},children:s.is_unique&&e.jsx(oe,{size:16,color:"var(--supabase-info)"})})]},s.name))})]})}),e.jsxs(C,{mt:"lg",children:[e.jsx(b,{size:"sm",fw:600,mb:"sm",style:{color:"var(--supabase-text)"},children:"Table Information"}),e.jsxs(T,{gap:"xs",children:[e.jsxs(d,{gap:"xs",children:[e.jsx(b,{size:"sm",c:"dimmed",style:{width:120},children:"Schema:"}),e.jsx(b,{size:"sm",fw:500,children:o})]}),e.jsxs(d,{gap:"xs",children:[e.jsx(b,{size:"sm",c:"dimmed",style:{width:120},children:"Table name:"}),e.jsx(b,{size:"sm",fw:500,children:n})]}),e.jsxs(d,{gap:"xs",children:[e.jsx(b,{size:"sm",c:"dimmed",style:{width:120},children:"Columns:"}),e.jsx(b,{size:"sm",fw:500,children:m.length})]}),e.jsxs(d,{gap:"xs",children:[e.jsx(b,{size:"sm",c:"dimmed",style:{width:120},children:"RLS:"}),e.jsx(E,{size:"sm",variant:"light",color:V!=null&&V.rls_enabled?"green":"gray",children:V!=null&&V.rls_enabled?"Enabled":"Disabled"})]})]})]}),e.jsx(d,{mt:"lg",gap:"sm",children:e.jsx(y,{size:"xs",variant:"outline",leftSection:e.jsx(je,{size:14}),onClick:Ie,children:"Add Column"})})]})}):!m||m.length===0?e.jsx(re,{py:"xl",children:e.jsx(Ue,{icon:e.jsx(je,{size:32}),title:"No columns",description:"Add columns to this table to start storing data",action:{label:"Add column",onClick:Ie}})}):!f||f.length===0?e.jsx(re,{py:"xl",children:e.jsx(Ue,{icon:e.jsx(Ma,{size:32}),title:"No rows",description:"Insert rows to start adding data",action:{label:"Insert row",onClick:()=>{O({}),Se()}}})}):e.jsx(Y,{ref:oa,style:{height:"100%"},scrollbarSize:8,type:"always",children:e.jsx(C,{style:{minWidth:"max-content"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"var(--supabase-bg-surface)"},children:[e.jsx("th",{style:{width:40,minWidth:40,padding:"8px 12px",borderBottom:"1px solid var(--supabase-border)",position:"sticky",left:0,backgroundColor:"var(--supabase-bg-surface)",zIndex:2},children:e.jsx(ye,{size:"xs",checked:r.size===f.length&&f.length>0,indeterminate:r.size>0&&r.size<f.length,onChange:ja})}),e.jsx("th",{style:{width:60,minWidth:60,padding:"8px 4px",borderBottom:"1px solid var(--supabase-border)",position:"sticky",left:40,backgroundColor:"var(--supabase-bg-surface)",zIndex:2}}),m.map(s=>e.jsx("th",{style:{minWidth:wa(s),maxWidth:Ts,padding:"8px 12px",borderBottom:"1px solid var(--supabase-border)",textAlign:"left",cursor:"pointer",userSelect:"none"},onClick:()=>Ca(s.name),children:e.jsxs(d,{gap:4,wrap:"nowrap",justify:"space-between",children:[e.jsxs(d,{gap:4,wrap:"nowrap",children:[s.is_primary_key&&e.jsx(Ve,{size:12,color:"var(--supabase-brand)"}),e.jsx(b,{size:"xs",fw:600,children:s.name}),e.jsx(b,{size:"xs",c:"dimmed",fw:400,children:s.type})]}),Z===s.name&&(ee==="asc"?e.jsx(Va,{size:14}):e.jsx(Ha,{size:14}))]})},s.name))]})}),e.jsx("tbody",{children:f.map((s,a)=>e.jsxs("tr",{style:{backgroundColor:r.has(a)?"var(--supabase-brand-light)":a%2===0?"var(--supabase-bg)":"var(--supabase-bg-surface)"},children:[e.jsx("td",{style:{padding:"8px 12px",borderBottom:"1px solid var(--supabase-border)",position:"sticky",left:0,backgroundColor:"inherit",zIndex:1},children:e.jsx(ye,{size:"xs",checked:r.has(a),onChange:()=>fa(a)})}),e.jsx("td",{style:{padding:"4px",borderBottom:"1px solid var(--supabase-border)",position:"sticky",left:40,backgroundColor:"inherit",zIndex:1},children:e.jsxs(d,{gap:2,wrap:"nowrap",children:[e.jsx(X,{label:"Expand row",children:e.jsx(R,{size:"xs",variant:"subtle",onClick:()=>{ra(s),ea()},children:e.jsx(Ja,{size:14})})}),e.jsx(X,{label:"Edit row",children:e.jsx(R,{size:"xs",variant:"subtle",onClick:()=>va(s),children:e.jsx(Ns,{size:14})})}),e.jsx(X,{label:"Delete row",children:e.jsx(R,{size:"xs",variant:"subtle",color:"red",onClick:()=>ya(a),children:e.jsx(ne,{size:14})})})]})}),m.map(t=>e.jsx("td",{style:{padding:"8px 12px",borderBottom:"1px solid var(--supabase-border)",maxWidth:Ts,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"pointer"},onDoubleClick:()=>fs(a,t.name,s[t.name]),children:(p==null?void 0:p.rowIndex)===a&&(p==null?void 0:p.column)===t.name?e.jsxs(d,{gap:4,wrap:"nowrap",children:[e.jsx(P,{size:"xs",value:J,onChange:x=>we(x.target.value),onKeyDown:x=>{x.key==="Enter"&&js(),x.key==="Escape"&&Le()},autoFocus:!0,style:{flex:1}}),e.jsx(R,{size:"xs",color:"green",onClick:js,children:e.jsx(oe,{size:12})}),e.jsx(R,{size:"xs",color:"red",onClick:Le,children:e.jsx(Ka,{size:12})})]}):e.jsx(b,{size:"sm",c:s[t.name]===null?"dimmed":void 0,style:{fontStyle:s[t.name]===null?"italic":"normal",...Da(t.type)},children:ka(s[t.name],t.type)})},t.name))]},a))})]})})})}),f&&f.length>0&&e.jsxs(C,{px:"sm",py:8,style:{borderTop:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(d,{gap:8,children:[e.jsx(R,{size:"sm",variant:"outline",disabled:We===1,onClick:()=>Oe(s=>Math.max(1,s-1)),styles:{root:{borderColor:"var(--supabase-border)","&:hover:not(:disabled)":{backgroundColor:"var(--supabase-bg-surface)"}}},children:e.jsx(Qa,{size:14})}),e.jsxs(d,{gap:4,children:[e.jsx(b,{size:"xs",c:"dimmed",children:"Page"}),e.jsx(P,{size:"xs",value:We,onChange:s=>{const a=parseInt(s.target.value,10);!isNaN(a)&&a>=1&&a<=he&&Oe(a)},w:40,styles:{input:{textAlign:"center",padding:"4px"}}}),e.jsxs(b,{size:"xs",c:"dimmed",children:["of ",he||1]})]}),e.jsx(R,{size:"sm",variant:"outline",disabled:We>=he,onClick:()=>Oe(s=>Math.min(he,s+1)),styles:{root:{borderColor:"var(--supabase-border)","&:hover:not(:disabled)":{backgroundColor:"var(--supabase-bg-surface)"}}},children:e.jsx(Xa,{size:14})})]}),e.jsxs(d,{gap:16,children:[e.jsx(d,{gap:4,children:e.jsx(M,{size:"xs",value:String(vs),onChange:s=>s&&Ia(parseInt(s,10)),data:[{value:"50",label:"50 rows"},{value:"100",label:"100 rows"},{value:"200",label:"200 rows"}],w:100,styles:{input:{backgroundColor:"var(--supabase-bg)",borderColor:"var(--supabase-border)"}}})}),!$&&e.jsxs(b,{size:"xs",c:"dimmed",children:[f.length," records"]}),e.jsx(He,{size:"xs",value:ys,onChange:s=>Ea(s),data:[{label:"Data",value:"data"},{label:"Definition",value:"definition"}],styles:{root:{backgroundColor:"var(--supabase-bg-surface)",border:"1px solid var(--supabase-border)"},indicator:{backgroundColor:"var(--supabase-bg)",boxShadow:"var(--supabase-shadow-sm)"}}})]})]})]}):e.jsx(re,{style:{flex:1},children:e.jsxs(T,{align:"center",gap:"lg",children:[e.jsx(Ue,{icon:e.jsx(fe,{size:32}),title:"Select a table",description:$?"Tap the button below to browse tables":"Choose a table from the sidebar or create a new one",action:{label:"Create table",onClick:Ke}}),$&&e.jsx(y,{variant:"outline",leftSection:e.jsx(Rs,{size:16}),onClick:Cs,styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)"}},children:"Browse tables"})]})})})]}),e.jsx(le,{opened:Us,onClose:ze,title:"Create table",size:"md",children:e.jsxs(T,{gap:"md",children:[e.jsx(P,{label:"Table name",placeholder:"my_table",value:Ae,onChange:s=>ts(s.target.value),required:!0}),e.jsx(b,{size:"xs",c:"dimmed",children:"The table will be created with default columns: id (uuid, primary key) and created_at (timestamptz)."}),e.jsxs(d,{justify:"flex-end",mt:"md",children:[e.jsx(y,{variant:"outline",onClick:ze,children:"Cancel"}),e.jsx(y,{onClick:ua,loading:K,children:"Create table"})]})]})}),e.jsx(Is,{opened:Ms,onClose:Xe,onConfirm:xa,title:"Delete table",message:`Are you sure you want to delete "${n}"? All data in this table will be permanently deleted.`,confirmLabel:"Delete",danger:!0,loading:K}),e.jsxs(le,{opened:Vs,onClose:ke,title:"Insert row",size:"lg",children:[e.jsx(Y,{style:{maxHeight:"calc(100vh - 300px)"},children:e.jsx(T,{gap:"sm",children:m.map(s=>e.jsxs(C,{children:[e.jsxs(d,{gap:"xs",mb:4,children:[e.jsx(b,{size:"sm",fw:500,children:s.name}),e.jsx(b,{size:"xs",c:"dimmed",children:s.type}),s.is_primary_key&&e.jsx(E,{size:"xs",color:"blue",children:"Primary Key"}),s.default_value&&e.jsxs(E,{size:"xs",variant:"light",children:["Default: ",s.default_value]})]}),s.type==="boolean"?e.jsx(M,{size:"sm",value:I[s.name]??"",onChange:a=>O({...I,[s.name]:a}),data:[{value:"",label:"(null)"},{value:"true",label:"true"},{value:"false",label:"false"}],placeholder:s.default_value?`Default: ${s.default_value}`:"Select value"}):s.type==="json"||s.type==="jsonb"?e.jsx(ve,{size:"sm",value:I[s.name]??"",onChange:a=>O({...I,[s.name]:a.target.value}),placeholder:s.default_value?`Default: ${s.default_value}`:"{}",minRows:2,styles:{input:{fontFamily:"monospace"}}}):e.jsx(P,{size:"sm",value:I[s.name]??"",onChange:a=>O({...I,[s.name]:a.target.value}),placeholder:s.default_value?`Default: ${s.default_value}`:`Enter ${s.type}`})]},s.name))})}),e.jsxs(d,{justify:"flex-end",mt:"md",children:[e.jsx(y,{variant:"outline",onClick:ke,children:"Cancel"}),e.jsx(y,{onClick:ba,loading:K,children:"Insert"})]})]}),e.jsxs(le,{opened:Hs,onClose:De,title:"Edit row",size:"lg",children:[e.jsx(Y,{style:{maxHeight:"calc(100vh - 300px)"},children:e.jsx(T,{gap:"sm",children:m.map(s=>e.jsxs(C,{children:[e.jsxs(d,{gap:"xs",mb:4,children:[e.jsx(b,{size:"sm",fw:500,children:s.name}),e.jsx(b,{size:"xs",c:"dimmed",children:s.type}),s.is_primary_key&&e.jsx(E,{size:"xs",color:"blue",children:"Primary Key"})]}),s.type==="boolean"?e.jsx(M,{size:"sm",value:String(I[s.name]??""),onChange:a=>O({...I,[s.name]:a}),data:[{value:"",label:"(null)"},{value:"true",label:"true"},{value:"false",label:"false"}]}):s.type==="json"||s.type==="jsonb"?e.jsx(ve,{size:"sm",value:typeof I[s.name]=="object"?JSON.stringify(I[s.name],null,2):I[s.name]??"",onChange:a=>O({...I,[s.name]:a.target.value}),minRows:2,styles:{input:{fontFamily:"monospace"}}}):e.jsx(P,{size:"sm",value:String(I[s.name]??""),onChange:a=>O({...I,[s.name]:a.target.value}),disabled:s.is_primary_key})]},s.name))})}),e.jsxs(d,{justify:"flex-end",mt:"md",children:[e.jsx(y,{variant:"outline",onClick:De,children:"Cancel"}),e.jsx(y,{onClick:pa,loading:K,children:"Save"})]})]}),e.jsx(Is,{opened:Ks,onClose:Ye,onConfirm:ha,title:"Delete row",message:"Are you sure you want to delete this row? This action cannot be undone.",confirmLabel:"Delete",danger:!0,loading:K}),e.jsx(le,{opened:Xs,onClose:()=>{Re(),Te()},title:"Add column",size:"md",children:e.jsxs(T,{gap:"md",children:[e.jsx(P,{label:"Column name",placeholder:"my_column",value:Be,onChange:s=>is(s.target.value),required:!0}),e.jsx(M,{label:"Type",value:ds,onChange:s=>s&&cs(s),data:lt,searchable:!0}),e.jsx(P,{label:"Default value",placeholder:"Optional",value:us,onChange:s=>xs(s.target.value)}),e.jsxs(d,{children:[e.jsx(Ds,{label:"Allow NULL",checked:bs,onChange:s=>ps(s.currentTarget.checked)}),e.jsx(Ds,{label:"Unique",checked:hs,onChange:s=>ms(s.currentTarget.checked)})]}),e.jsxs(d,{justify:"flex-end",mt:"md",children:[e.jsx(y,{variant:"outline",onClick:()=>{Re(),Te()},children:"Cancel"}),e.jsx(y,{onClick:ga,loading:K,children:"Add column"})]})]})}),e.jsx(tt,{opened:Ys,onClose:Zs,schema:o,table:n||"",totalRows:la||f.length,selectedRows:r.size,filters:Ne()}),e.jsx(at,{opened:Gs,onClose:Ge,columns:m,row:Fe,onSave:async s=>{if(!Fe||!n)return;const a=m.find(x=>x.is_primary_key);if(!a)return;const t=Fe[a.name];await N.updateRow(n,`${a.name}=eq.${t}`,s),k.show({title:"Success",message:"Row updated successfully",color:"green"}),Ge(),q()}})]})}export{gt as TableEditorPage};
