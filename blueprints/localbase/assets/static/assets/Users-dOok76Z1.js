import{j as e,x as l,r as V,B as M,y as ae,G as o,T as a,z as Ie,E as Ue,b as I,h as O,F as b,H as k,e as S,S as T,I as te,p as Q,t as le,s as oe,J as G,q,a as Y,O as Ee,Q as de,f as J,R as X,d as De,M as B,A as Ae}from"./vendor-mantine-aKbh6G_O.js";import{r as d}from"./vendor-react-CA6k1jPF.js";import{P as Le}from"./PageContainer-BshQiLl_.js";import{E as Be}from"./EmptyState-s1kxp5xn.js";import{C as Me}from"./ConfirmModal-vPtHsZos.js";import{a as _e,O as Z,P as Fe,Q as Ge,R as Oe,S as qe,T as $e,U as Ne,l as ce,V as he,u as ue,W as We,X as me,j as He,Y as Re,Z as Ve,_ as Qe}from"./vendor-icons-BYOfSTr6.js";import{a as $}from"./auth-CFnvc1BQ.js";import"./client-CvoVCtJO.js";function Ye({data:p,columns:C,loading:U=!1,emptyState:E,selectable:f=!1,selectedRows:m=[],onSelectionChange:P,onRowClick:z,pagination:h,getRowKey:w,stickyHeader:v=!1,maxHeight:D}){const g=d.useMemo(()=>new Set(m.map(w)),[m,w]),A=p.length>0&&p.every(r=>g.has(w(r))),t=p.some(r=>g.has(w(r)))&&!A,_=()=>{P&&P(A?[]:[...p])},N=r=>{if(!P)return;const j=w(r);g.has(j)?P(m.filter(n=>w(n)!==j)):P([...m,r])};return U?e.jsxs(l,{style:{border:"1px solid var(--lb-border-default)",borderRadius:"var(--lb-radius-lg)",overflow:"hidden"},children:[e.jsx(l.Thead,{style:{backgroundColor:"var(--lb-table-header-bg)"},children:e.jsxs(l.Tr,{children:[f&&e.jsx(l.Th,{style:{width:40,padding:"12px 16px"},children:e.jsx(V,{height:20,width:20})}),C.map(r=>e.jsx(l.Th,{style:{width:r.width,padding:"12px 16px",fontSize:"var(--lb-text-sm)",fontWeight:500,color:"var(--lb-text-secondary)",textTransform:"uppercase",letterSpacing:"0.05em"},children:r.header},r.key))]})}),e.jsx(l.Tbody,{children:Array.from({length:5}).map((r,j)=>e.jsxs(l.Tr,{children:[f&&e.jsx(l.Td,{style:{padding:"12px 16px"},children:e.jsx(V,{height:20,width:20})}),C.map(n=>e.jsx(l.Td,{style:{padding:"12px 16px"},children:e.jsx(V,{height:20})},n.key))]},j))})]}):p.length===0&&E?e.jsx(e.Fragment,{children:E}):e.jsxs(M,{children:[e.jsx(M,{style:{overflow:"auto",maxHeight:D,border:"1px solid var(--lb-border-default)",borderRadius:"var(--lb-radius-lg)"},children:e.jsxs(l,{stickyHeader:v,highlightOnHover:!!z,style:{minWidth:"100%"},children:[e.jsx(l.Thead,{style:{backgroundColor:"var(--lb-table-header-bg)"},children:e.jsxs(l.Tr,{children:[f&&e.jsx(l.Th,{style:{width:40,padding:"12px 16px"},children:e.jsx(ae,{checked:A,indeterminate:t,onChange:_})}),C.map(r=>e.jsx(l.Th,{style:{width:r.width,padding:"12px 16px",fontSize:"var(--lb-text-sm)",fontWeight:500,color:"var(--lb-text-secondary)",textTransform:"uppercase",letterSpacing:"0.05em",borderBottom:"1px solid var(--lb-border-default)"},children:r.header},r.key))]})}),e.jsx(l.Tbody,{children:p.map(r=>{const j=w(r),n=g.has(j);return e.jsxs(l.Tr,{onClick:()=>z==null?void 0:z(r),style:{cursor:z?"pointer":void 0,backgroundColor:n?"var(--lb-table-row-selected)":void 0,transition:"background-color var(--lb-transition-fast)"},children:[f&&e.jsx(l.Td,{onClick:c=>c.stopPropagation(),style:{padding:"12px 16px",borderBottom:"1px solid var(--lb-border-muted)"},children:e.jsx(ae,{checked:n,onChange:()=>N(r)})}),C.map(c=>e.jsx(l.Td,{style:{padding:"12px 16px",fontSize:"var(--lb-text-md)",color:"var(--lb-text-primary)",borderBottom:"1px solid var(--lb-border-muted)"},children:c.render?c.render(r):String(r[c.key]??"")},c.key))]},j)})})]})}),h&&h.totalPages>1&&e.jsxs(o,{justify:"space-between",mt:"md",children:[e.jsxs(a,{size:"sm",style:{color:"var(--lb-text-secondary)",fontSize:"var(--lb-text-sm)"},children:["Showing ",p.length," of ",h.total," items"]}),e.jsx(Ie,{value:h.page,onChange:h.onPageChange,total:h.totalPages,size:"sm"})]})]})}function Je({value:p,onChange:C,placeholder:U="Search...",debounceMs:E=300}){const f=Ue(m=>{C(m)},E);return e.jsx(I,{placeholder:U,leftSection:e.jsx(_e,{size:16}),defaultValue:p,onChange:m=>f(m.target.value),style:{width:280}})}const Xe=[{id:"email",name:"Email",icon:Z,enabled:!0,description:"Allow users to sign up and sign in with email and password",category:"email"},{id:"phone",name:"Phone",icon:Fe,enabled:!1,description:"Allow users to sign up and sign in with phone number and OTP",category:"phone"},{id:"google",name:"Google",icon:Ge,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their Google account",category:"social"},{id:"github",name:"GitHub",icon:Oe,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their GitHub account",category:"social"},{id:"apple",name:"Apple",icon:qe,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their Apple ID",category:"social"},{id:"twitter",name:"Twitter",icon:$e,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their Twitter account",category:"social"},{id:"discord",name:"Discord",icon:Ne,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their Discord account",category:"social"}];function ts(){const[p,C]=d.useState("users"),[U,E]=d.useState([]),[f,m]=d.useState([]),[P,z]=d.useState(!0),[h,w]=d.useState(""),[v,D]=d.useState(null),[g,A]=d.useState(Xe),[t,_]=d.useState(null),[N,{open:r,close:j}]=O(!1),[n,c]=d.useState({siteUrl:"http://localhost:3000",redirectUrls:"http://localhost:3000/**",jwtExpiry:3600,enableSignUp:!0,enableConfirmation:!0,enableDoubleConfirmation:!1,minimumPasswordLength:8}),[xe,{open:K,close:W}]=O(!1),[pe,{open:ge,close:H}]=O(!1),[je,{open:be,close:ee}]=O(!1),[i,y]=d.useState({email:"",password:"",phone:""}),[R,L]=d.useState(!1),F=d.useCallback(async()=>{z(!0);try{const s=await $.listUsers(1,100);E(s.users),m(s.users)}catch{b.show({title:"Error",message:"Failed to load users",color:"red"})}finally{z(!1)}},[]);d.useEffect(()=>{F()},[F]),d.useEffect(()=>{if(h){const s=h.toLowerCase();m(U.filter(u=>{var x,ie;return((x=u.email)==null?void 0:x.toLowerCase().includes(s))||((ie=u.phone)==null?void 0:ie.toLowerCase().includes(s))}))}else m(U)},[h,U]);const fe=async()=>{if(!i.email||!i.password){b.show({title:"Validation Error",message:"Email and password are required",color:"red"});return}L(!0);try{await $.createUser({email:i.email,password:i.password,phone:i.phone||void 0}),b.show({title:"Success",message:"User created successfully",color:"green"}),W(),y({email:"",password:"",phone:""}),F()}catch(s){b.show({title:"Error",message:s.message||"Failed to create user",color:"red"})}finally{L(!1)}},we=async()=>{if(v){L(!0);try{await $.updateUser(v.id,{email:i.email||void 0,phone:i.phone||void 0,password:i.password||void 0}),b.show({title:"Success",message:"User updated successfully",color:"green"}),H(),y({email:"",password:"",phone:""}),D(null),F()}catch(s){b.show({title:"Error",message:s.message||"Failed to update user",color:"red"})}finally{L(!1)}}},ve=async()=>{if(v){L(!0);try{await $.deleteUser(v.id),b.show({title:"Success",message:"User deleted successfully",color:"green"}),ee(),D(null),F()}catch(s){b.show({title:"Error",message:s.message||"Failed to delete user",color:"red"})}finally{L(!1)}}},ye=s=>{D(s),y({email:s.email||"",password:"",phone:s.phone||""}),ge()},Se=s=>{D(s),be()},se=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",re=s=>{var u;A(g.map(x=>x.id===s?{...x,enabled:!x.enabled}:x)),b.show({title:"Provider Updated",message:`Provider ${s} has been ${(u=g.find(x=>x.id===s))!=null&&u.enabled?"disabled":"enabled"}`,color:"green"})},Ce=s=>{_(s),r()},Pe=()=>{t&&(A(g.map(s=>s.id===t.id?t:s)),j(),b.show({title:"Provider Saved",message:`${t.name} settings have been updated`,color:"green"}))},ze=()=>{b.show({title:"Settings Saved",message:"Authentication settings have been updated",color:"green"})},ke=[{key:"email",header:"Email",render:s=>e.jsxs(o,{gap:"xs",children:[e.jsx(a,{size:"sm",fw:500,children:s.email||"-"}),s.email_confirmed_at&&e.jsx(De,{label:"Email verified",children:e.jsx(Y,{size:"xs",color:"green",variant:"light",children:"Verified"})})]})},{key:"phone",header:"Phone",render:s=>e.jsx(a,{size:"sm",children:s.phone||"-"})},{key:"provider",header:"Provider",render:s=>{var x;const u=((x=s.app_metadata)==null?void 0:x.provider)||"email";return e.jsx(Y,{size:"sm",variant:"light",color:"gray",children:u})}},{key:"created_at",header:"Created",render:s=>e.jsx(a,{size:"sm",c:"dimmed",children:se(s.created_at)})},{key:"last_sign_in_at",header:"Last Sign In",render:s=>e.jsx(a,{size:"sm",c:"dimmed",children:se(s.last_sign_in_at)})},{key:"actions",header:"",width:50,render:s=>e.jsxs(B,{position:"bottom-end",withinPortal:!0,children:[e.jsx(B.Target,{children:e.jsx(Ae,{variant:"subtle",color:"gray",onClick:u=>u.stopPropagation(),children:e.jsx(Re,{size:16})})}),e.jsxs(B.Dropdown,{children:[e.jsx(B.Item,{leftSection:e.jsx(Ve,{size:14}),onClick:u=>{u.stopPropagation(),ye(s)},children:"Edit user"}),e.jsx(B.Divider,{}),e.jsx(B.Item,{color:"red",leftSection:e.jsx(Qe,{size:14}),onClick:u=>{u.stopPropagation(),Se(s)},children:"Delete user"})]})]})}],ne=g.filter(s=>s.enabled),Te=g.filter(s=>s.category==="social");return e.jsxs(Le,{title:"Authentication",description:"Manage users, providers, and authentication settings",children:[e.jsxs(k,{value:p,onChange:C,children:[e.jsxs(k.List,{mb:"lg",children:[e.jsx(k.Tab,{value:"users",leftSection:e.jsx(ce,{size:16}),children:"Users"}),e.jsx(k.Tab,{value:"providers",leftSection:e.jsx(he,{size:16}),children:"Providers"}),e.jsx(k.Tab,{value:"settings",leftSection:e.jsx(ue,{size:16}),children:"Settings"})]}),e.jsxs(k.Panel,{value:"users",children:[e.jsxs(o,{justify:"space-between",mb:"lg",children:[e.jsxs(o,{children:[e.jsx(Je,{value:h,onChange:w,placeholder:"Search by email or phone..."}),e.jsxs(a,{size:"sm",c:"dimmed",children:[f.length," user",f.length!==1?"s":""]})]}),e.jsx(S,{leftSection:e.jsx(We,{size:16}),onClick:K,children:"Add user"})]}),e.jsx(Ye,{data:f,columns:ke,loading:P,getRowKey:s=>s.id,emptyState:e.jsx(Be,{icon:e.jsx(ce,{size:32}),title:"No users found",description:h?"No users match your search criteria":"Get started by creating your first user",action:h?void 0:{label:"Add user",onClick:K}})})]}),e.jsx(k.Panel,{value:"providers",children:e.jsxs(T,{gap:"lg",children:[e.jsx(te,{icon:e.jsx(me,{size:16}),color:"blue",children:"Configure authentication providers for your application. Enable the providers you want to allow users to sign in with."}),e.jsxs(M,{children:[e.jsx(a,{fw:600,mb:"md",children:"Email & Phone"}),e.jsx(Q,{cols:{base:1,sm:2},spacing:"md",children:g.filter(s=>s.category==="email"||s.category==="phone").map(s=>e.jsx(le,{padding:"md",withBorder:!0,children:e.jsxs(o,{justify:"space-between",children:[e.jsxs(o,{gap:"sm",children:[e.jsx(oe,{size:"lg",radius:"md",variant:"light",color:s.enabled?"green":"gray",children:e.jsx(s.icon,{size:20})}),e.jsxs(M,{children:[e.jsx(a,{fw:500,children:s.name}),e.jsx(a,{size:"xs",c:"dimmed",children:s.description})]})]}),e.jsx(G,{checked:s.enabled,onChange:()=>re(s.id)})]})},s.id))})]}),e.jsxs(M,{children:[e.jsx(a,{fw:600,mb:"md",children:"Social Providers"}),e.jsx(Q,{cols:{base:1,sm:2,lg:3},spacing:"md",children:Te.map(s=>e.jsxs(le,{padding:"md",withBorder:!0,children:[e.jsxs(o,{justify:"space-between",mb:"sm",children:[e.jsxs(o,{gap:"sm",children:[e.jsx(oe,{size:"lg",radius:"md",variant:"light",color:s.enabled?"green":"gray",children:e.jsx(s.icon,{size:20})}),e.jsx(a,{fw:500,children:s.name})]}),e.jsx(G,{checked:s.enabled,onChange:()=>re(s.id)})]}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:s.description}),s.enabled&&e.jsx(S,{size:"xs",variant:"light",fullWidth:!0,onClick:()=>Ce(s),children:"Configure"})]},s.id))})]}),e.jsxs(q,{p:"md",withBorder:!0,children:[e.jsx(a,{fw:600,mb:"sm",children:"Active Providers"}),ne.length===0?e.jsx(a,{size:"sm",c:"dimmed",children:"No providers enabled. Enable at least one provider to allow users to sign in."}):e.jsx(o,{gap:"xs",children:ne.map(s=>e.jsx(Y,{size:"lg",variant:"light",leftSection:e.jsx(s.icon,{size:14}),children:s.name},s.id))})]})]})}),e.jsx(k.Panel,{value:"settings",children:e.jsxs(T,{gap:"lg",children:[e.jsxs(Q,{cols:{base:1,lg:2},spacing:"lg",children:[e.jsxs(q,{p:"md",withBorder:!0,children:[e.jsxs(o,{gap:"xs",mb:"md",children:[e.jsx(He,{size:18}),e.jsx(a,{fw:600,children:"URL Configuration"})]}),e.jsxs(T,{gap:"md",children:[e.jsx(I,{label:"Site URL",description:"The base URL of your application",value:n.siteUrl,onChange:s=>c({...n,siteUrl:s.target.value})}),e.jsx(Ee,{label:"Redirect URLs",description:"Allowed redirect URLs (one per line, supports wildcards)",value:n.redirectUrls,onChange:s=>c({...n,redirectUrls:s.target.value}),minRows:3})]})]}),e.jsxs(q,{p:"md",withBorder:!0,children:[e.jsxs(o,{gap:"xs",mb:"md",children:[e.jsx(he,{size:18}),e.jsx(a,{fw:600,children:"Security"})]}),e.jsxs(T,{gap:"md",children:[e.jsx(de,{label:"JWT Expiry (seconds)",description:"How long access tokens are valid",value:n.jwtExpiry,onChange:s=>c({...n,jwtExpiry:Number(s)||3600}),min:60,max:604800}),e.jsx(de,{label:"Minimum Password Length",description:"Required minimum characters for passwords",value:n.minimumPasswordLength,onChange:s=>c({...n,minimumPasswordLength:Number(s)||8}),min:6,max:128})]})]})]}),e.jsxs(q,{p:"md",withBorder:!0,children:[e.jsxs(o,{gap:"xs",mb:"md",children:[e.jsx(ue,{size:18}),e.jsx(a,{fw:600,children:"Features"})]}),e.jsxs(T,{gap:"md",children:[e.jsx(G,{label:"Enable Sign-ups",description:"Allow new users to create accounts",checked:n.enableSignUp,onChange:s=>c({...n,enableSignUp:s.currentTarget.checked})}),e.jsx(G,{label:"Email Confirmation",description:"Require email verification before allowing sign-in",checked:n.enableConfirmation,onChange:s=>c({...n,enableConfirmation:s.currentTarget.checked})}),e.jsx(G,{label:"Double Confirmation",description:"Require confirmation when changing email addresses",checked:n.enableDoubleConfirmation,onChange:s=>c({...n,enableDoubleConfirmation:s.currentTarget.checked})})]})]}),e.jsx(o,{justify:"flex-end",children:e.jsx(S,{onClick:ze,children:"Save Settings"})})]})})]}),e.jsx(J,{opened:xe,onClose:W,title:"Create new user",size:"md",children:e.jsxs(T,{gap:"md",children:[e.jsx(I,{label:"Email",placeholder:"user@example.com",value:i.email,onChange:s=>y({...i,email:s.target.value}),required:!0,leftSection:e.jsx(Z,{size:16})}),e.jsx(X,{label:"Password",placeholder:"Minimum 8 characters",value:i.password,onChange:s=>y({...i,password:s.target.value}),required:!0}),e.jsx(I,{label:"Phone (optional)",placeholder:"+1234567890",value:i.phone,onChange:s=>y({...i,phone:s.target.value})}),e.jsxs(o,{justify:"flex-end",mt:"md",children:[e.jsx(S,{variant:"outline",onClick:W,children:"Cancel"}),e.jsx(S,{onClick:fe,loading:R,children:"Create user"})]})]})}),e.jsx(J,{opened:pe,onClose:H,title:"Edit user",size:"md",children:e.jsxs(T,{gap:"md",children:[e.jsx(I,{label:"Email",placeholder:"user@example.com",value:i.email,onChange:s=>y({...i,email:s.target.value}),leftSection:e.jsx(Z,{size:16})}),e.jsx(X,{label:"New Password (leave empty to keep current)",placeholder:"Minimum 8 characters",value:i.password,onChange:s=>y({...i,password:s.target.value})}),e.jsx(I,{label:"Phone",placeholder:"+1234567890",value:i.phone,onChange:s=>y({...i,phone:s.target.value})}),e.jsxs(o,{justify:"flex-end",mt:"md",children:[e.jsx(S,{variant:"outline",onClick:H,children:"Cancel"}),e.jsx(S,{onClick:we,loading:R,children:"Save changes"})]})]})}),e.jsx(Me,{opened:je,onClose:ee,onConfirm:ve,title:"Delete user",message:`Are you sure you want to delete ${(v==null?void 0:v.email)||"this user"}? This action cannot be undone.`,confirmLabel:"Delete",danger:!0,loading:R}),e.jsx(J,{opened:N,onClose:j,title:`Configure ${t==null?void 0:t.name}`,size:"md",children:t&&e.jsxs(T,{gap:"md",children:[e.jsxs(te,{icon:e.jsx(me,{size:16}),color:"blue",children:["Get your OAuth credentials from the"," ",e.jsxs(a,{component:"a",href:"#",c:"blue",style:{textDecoration:"underline"},children:[t.name," Developer Console"]})]}),e.jsx(I,{label:"Client ID",placeholder:`Your ${t.name} Client ID`,value:t.clientId||"",onChange:s=>_({...t,clientId:s.target.value})}),e.jsx(X,{label:"Client Secret",placeholder:`Your ${t.name} Client Secret`,value:t.clientSecret||"",onChange:s=>_({...t,clientSecret:s.target.value})}),e.jsxs(M,{children:[e.jsx(a,{size:"sm",fw:500,mb:4,children:"Callback URL"}),e.jsx(I,{value:`${n.siteUrl}/auth/v1/callback`,readOnly:!0,styles:{input:{fontFamily:"monospace",fontSize:12}}}),e.jsxs(a,{size:"xs",c:"dimmed",mt:4,children:["Add this URL to your ",t.name," app's authorized redirect URIs"]})]}),e.jsxs(o,{justify:"flex-end",mt:"md",children:[e.jsx(S,{variant:"outline",onClick:j,children:"Cancel"}),e.jsx(S,{onClick:Pe,children:"Save"})]})]})})]})}export{ts as UsersPage};
