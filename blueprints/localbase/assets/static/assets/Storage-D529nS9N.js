import{h as A,y as d,j as e,B as r,T as o,S as D,q as Z,G as p,D as J,A as C,O as _,Q as K,R as qe,w as oe,d as M,e as y,M as m,V as Ae,f as ce,b as de,F as Me,W as Ne,X as Ve,Y as He,Z as Ge}from"./vendor-mantine-C8lHRUHi.js";import{r as i}from"./vendor-react-CFPnf9wS.js";import{P as Xe}from"./PageContainer-Czy__zFQ.js";import{E as ue}from"./EmptyState-BPjdg75G.js";import{C as pe}from"./ConfirmModal-Bj3_kAmk.js";import{P as Ze}from"./StatusBadge-BrK_xGSF.js";import{s as x}from"./storage-DhEGvAq2.js";import{u as Je}from"./index-DnlGV0oa.js";import{m as R,V as Ke,_ as Qe,$ as Ye,f as es,a0 as ss,a1 as ts,X as xe,Z as Q,a2 as ze,a3 as Y,a4 as as,a5 as rs,a6 as Ie,a7 as me,a8 as he,a9 as fe,aa as je,ab as ge,ac as be,ad as ye,ae as we,af as ns,g as ke,ag as ls,ah as is,q as os,ai as cs,aj as ds,ak as us,al as ps,am as xs,an as ms,ao as hs,ap as fs,w as js,B as gs}from"./vendor-icons-BaFQZaXW.js";import"./client-CvoVCtJO.js";import"./vendor-state-Ud2phgVo.js";function Se(t){var h,v;const a=t.content_type||"",n=(h=t.name.split(".").pop())==null?void 0:h.toLowerCase(),c=((v=t.name.split("/").pop())==null?void 0:v.toLowerCase())||"";if(a.startsWith("image/"))return as;if(a.startsWith("video/"))return rs;if(a.startsWith("audio/"))return Ie;if(a==="application/pdf")return me;if(a==="application/json")return he;if(a==="text/csv"||a==="application/csv")return fe;if(a==="application/xml"||a==="text/xml")return je;if(a==="application/sql"||a==="text/x-sql")return ge;if(a.includes("spreadsheet")||a.includes("excel"))return be;if(a.includes("presentation")||a.includes("powerpoint"))return ye;if(a.includes("wordprocessing")||a.includes("msword"))return we;if(c==="dockerfile")return ns;if(c==="makefile")return ke;switch(n){case"js":case"jsx":case"ts":case"tsx":return fs;case"py":return hs;case"rs":return ms;case"go":case"java":case"c":case"cpp":case"h":case"hpp":case"swift":case"kt":case"rb":case"php":return xs;case"md":case"mdx":return ps;case"json":return he;case"html":case"htm":return us;case"css":case"scss":case"less":return ds;case"zip":case"tar":case"gz":case"rar":case"7z":case"tgz":return cs;case"txt":case"log":return os;case"pdf":return me;case"csv":return fe;case"xml":return je;case"sql":return ge;case"xlsx":case"xls":return be;case"pptx":case"ppt":return ye;case"docx":case"doc":return we;case"yaml":case"yml":case"toml":case"ini":case"conf":case"cfg":return is;case"sh":case"bash":case"zsh":return ke;default:return ls}}function bs(t){return t?t.startsWith("image/"):!1}function ys(t){return t?t.startsWith("video/"):!1}function ws(t){return t?t.startsWith("audio/"):!1}function Ce(t,a){var z,I;if(!t&&!a)return!1;if(t&&["text/plain","text/html","text/css","text/javascript","text/csv","text/markdown","text/typescript","text/x-python","text/x-go","text/x-rust","text/x-java","application/json","application/javascript","application/xml","application/sql","application/x-yaml","application/toml"].some(S=>t.includes(S)))return!0;const c=(z=a.split(".").pop())==null?void 0:z.toLowerCase(),h=((I=a.split("/").pop())==null?void 0:I.toLowerCase())||"";return["dockerfile","makefile","gemfile","rakefile","procfile"].includes(h)?!0:c?["txt","md","mdx","json","js","jsx","ts","tsx","py","go","rs","java","c","cpp","h","hpp","css","scss","less","html","htm","xml","yaml","yml","toml","ini","cfg","conf","sh","bash","zsh","sql","graphql","vue","svelte","astro","rb","php","swift","kt","gradle","env","gitignore","log","csv","tsv","properties"].includes(c):!1}function Fe(t){if(t===0)return"0 B";const a=1024,n=["B","KB","MB","GB","TB"],c=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,c)).toFixed(2))+" "+n[c]}function ve(t){return new Date(t).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function ks({file:t,bucket:a,onClose:n,onDownload:c,onDelete:h,onCopyUrl:v}){const[j,z]=i.useState(null),[I,S]=i.useState(null),[N,O]=i.useState(!1),V=Se(t),E=t.name.split("/").pop()||t.name,u=t.content_type||"Unknown";i.useEffect(()=>{if(a){const P=x.downloadObjectUrl(a.id,t.name);z(P),Ce(t.content_type,t.name)&&(O(!0),fetch(P).then(L=>L.text()).then(L=>{S(L.slice(0,1e4))}).catch(()=>S(null)).finally(()=>O(!1)))}},[t,a]);const f=()=>{if(bs(t.content_type)&&j)return e.jsx(r,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:16,display:"flex",alignItems:"center",justifyContent:"center",minHeight:200},children:e.jsx(Ve,{src:j,alt:E,fit:"contain",style:{maxHeight:300},radius:"md"})});if(ys(t.content_type)&&j)return e.jsx(r,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",overflow:"hidden"},children:e.jsx("video",{src:j,controls:!0,style:{width:"100%",maxHeight:300}})});if(ws(t.content_type)&&j)return e.jsxs(r,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:24},children:[e.jsx(_,{mb:"md",children:e.jsx(Ie,{size:48,color:"var(--supabase-text-muted)"})}),e.jsx("audio",{src:j,controls:!0,style:{width:"100%"}})]});if(Ce(t.content_type,t.name)){if(N)return e.jsx(_,{py:"xl",children:e.jsx(K,{size:"sm"})});if(I)return e.jsx(He,{h:300,children:e.jsx(Ge,{block:!0,style:{backgroundColor:"var(--supabase-bg-surface)",fontSize:"0.75rem",lineHeight:1.5},children:I})})}return e.jsxs(r,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:48,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(V,{size:64,color:"var(--supabase-text-muted)",stroke:1}),e.jsx(o,{size:"sm",c:"dimmed",mt:"md",children:"Preview not available"})]})};return e.jsxs(r,{style:{width:320,borderLeft:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)"},children:[e.jsx(r,{p:"md",style:{borderBottom:"1px solid var(--supabase-border)"},children:e.jsx(p,{justify:"flex-end",children:e.jsx(Ne,{onClick:n})})}),e.jsxs(r,{p:"md",style:{flex:1,overflow:"auto"},children:[f(),e.jsxs(r,{mt:"lg",children:[e.jsx(o,{fw:600,size:"sm",style:{wordBreak:"break-word"},children:E}),e.jsxs(o,{size:"xs",c:"dimmed",mt:4,children:[u," - ",Fe(t.size)]})]}),e.jsxs(D,{gap:"sm",mt:"lg",children:[e.jsxs(r,{children:[e.jsx(o,{size:"xs",c:"dimmed",children:"Added on"}),e.jsx(o,{size:"sm",children:t.created_at?ve(t.created_at):"Unknown"})]}),e.jsxs(r,{children:[e.jsx(o,{size:"xs",c:"dimmed",children:"Last modified"}),e.jsx(o,{size:"sm",children:t.updated_at?ve(t.updated_at):"Unknown"})]}),t.owner&&e.jsxs(r,{children:[e.jsx(o,{size:"xs",c:"dimmed",children:"Owner"}),e.jsx(o,{size:"sm",truncate:!0,children:t.owner})]})]}),e.jsx(J,{my:"lg"}),e.jsxs(D,{gap:"xs",children:[e.jsx(y,{variant:"outline",leftSection:e.jsx(ze,{size:16}),onClick:c,fullWidth:!0,children:"Download"}),e.jsxs(m,{position:"bottom-end",width:200,children:[e.jsx(m.Target,{children:e.jsx(y,{variant:"outline",leftSection:e.jsx(Y,{size:16}),rightSection:e.jsx(js,{size:14}),fullWidth:!0,children:"Get URL"})}),e.jsxs(m.Dropdown,{children:[e.jsx(m.Item,{leftSection:e.jsx(Y,{size:14}),onClick:v,children:"Copy URL"}),a.public&&e.jsx(m.Item,{leftSection:e.jsx(gs,{size:14}),onClick:()=>{const P=`${window.location.origin}${x.getPublicUrl(a.id,t.name)}`;window.open(P,"_blank")},children:"Open in new tab"})]})]}),e.jsx(J,{my:"xs"}),e.jsx(y,{variant:"subtle",color:"red",leftSection:e.jsx(Q,{size:16}),onClick:h,fullWidth:!0,children:"Delete file"})]})]})]})}function Os(){const{selectedBucket:t,setSelectedBucket:a,currentPath:n,setCurrentPath:c}=Je(),[h,v]=i.useState([]),[j,z]=i.useState([]),[I,S]=i.useState(!0),[N,O]=i.useState(!1),[V,E]=i.useState(!1),[u,f]=i.useState(null),[P,{open:L,close:H}]=A(!1),[Be,{open:De,close:ee}]=A(!1),[Pe,{open:se,close:te}]=A(!1),[Le,{open:Ue,close:G}]=A(!1),[F,X]=i.useState({name:"",public:!1}),[$,ae]=i.useState(""),[W,w]=i.useState(!1),B=i.useRef(null),q=i.useCallback(async()=>{S(!0);try{const s=await x.listBuckets();v(s),s.length>0&&!t&&a(s[0].id)}catch(s){d.show({title:"Error",message:s.message||"Failed to load buckets",color:"red"})}finally{S(!1)}},[t,a]),U=i.useCallback(async()=>{if(t){O(!0);try{const s=await x.listObjects(t,{prefix:n,limit:100});z(s)}catch(s){d.show({title:"Error",message:s.message||"Failed to load objects",color:"red"}),z([])}finally{O(!1)}}},[t,n]);i.useEffect(()=>{q()},[q]),i.useEffect(()=>{t&&(U(),f(null))},[t,n,U]);const Oe=async()=>{if(!F.name){d.show({title:"Validation Error",message:"Bucket name is required",color:"red"});return}w(!0);try{await x.createBucket({name:F.name,public:F.public}),d.show({title:"Success",message:"Bucket created successfully",color:"green"}),H(),X({name:"",public:!1}),q()}catch(s){d.show({title:"Error",message:s.message||"Failed to create bucket",color:"red"})}finally{w(!1)}},Ee=async()=>{if(t){w(!0);try{await x.deleteBucket(t),d.show({title:"Success",message:"Bucket deleted successfully",color:"green"}),ee(),a(null),q()}catch(s){d.show({title:"Error",message:s.message||"Failed to delete bucket",color:"red"})}finally{w(!1)}}},Te=async s=>{if(!(!t||s.length===0)){E(!0);try{for(const l of s){const b=n?`${n}/${l.name}`:l.name;await x.uploadObject(t,b,l)}d.show({title:"Success",message:`${s.length} file(s) uploaded successfully`,color:"green"}),U()}catch(l){d.show({title:"Error",message:l.message||"Failed to upload files",color:"red"})}finally{E(!1)}}},Re=async()=>{if(!(!t||!u)){w(!0);try{await x.deleteObject(t,u.name),d.show({title:"Success",message:"File deleted successfully",color:"green"}),te(),f(null),U()}catch(s){d.show({title:"Error",message:s.message||"Failed to delete file",color:"red"})}finally{w(!1)}}},_e=async()=>{if(!t||!$.trim()){d.show({title:"Validation Error",message:"Folder name is required",color:"red"});return}w(!0);try{const s=n?`${n}/${$.trim()}/.keep`:`${$.trim()}/.keep`,l=new File([""],".keep",{type:"text/plain"});await x.uploadObject(t,s,l),d.show({title:"Success",message:"Folder created successfully",color:"green"}),G(),ae(""),U()}catch(s){d.show({title:"Error",message:s.message||"Failed to create folder",color:"red"})}finally{w(!1)}},re=s=>{if(!t)return;const l=x.downloadObjectUrl(t,s.name);window.open(l,"_blank")},ne=async s=>{if(!t)return;const l=h.find(g=>g.id===t);let b;if(l!=null&&l.public)b=`${window.location.origin}${x.getPublicUrl(t,s.name)}`;else try{b=(await x.createSignedUrl(t,s.name,3600)).signedURL}catch{b=x.downloadObjectUrl(t,s.name)}navigator.clipboard.writeText(b),d.show({title:"Copied",message:"URL copied to clipboard",color:"green"})},le=s=>{c(s),f(null)},$e=()=>{if(!n)return;const s=n.split("/");s.pop(),c(s.join("/")),f(null)},ie=n?n.split("/"):[],k=h.find(s=>s.id===t),T=s=>s.name.endsWith("/")||!s.content_type,We=s=>{T(s)?le(s.name.replace(/\/$/,"")):f(s)};return e.jsxs(Xe,{title:"Storage",description:"Manage files and buckets",fullWidth:!0,noPadding:!0,children:[e.jsxs(r,{style:{display:"flex",height:"calc(100vh - 140px)"},children:[e.jsxs(r,{style:{width:240,borderRight:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)"},children:[e.jsx(r,{px:"md",pt:"md",children:e.jsx(o,{size:"xs",fw:600,tt:"uppercase",c:"dimmed",style:{letterSpacing:"0.05em",fontSize:"0.6875rem"},children:"Manage"})}),e.jsx(r,{p:"xs",children:e.jsx(D,{gap:2,children:e.jsx(Z,{p:"xs",style:{cursor:"pointer",backgroundColor:"var(--supabase-brand-light)",borderRadius:6},children:e.jsxs(p,{gap:"xs",children:[e.jsx(R,{size:16,color:"var(--supabase-brand)"}),e.jsx(o,{size:"sm",fw:500,children:"Files"})]})})})}),e.jsx(J,{mx:"md",my:"xs"}),e.jsx(r,{px:"md",pt:"xs",children:e.jsxs(p,{justify:"space-between",mb:"xs",children:[e.jsx(o,{size:"xs",c:"dimmed",children:"Buckets"}),e.jsx(C,{variant:"subtle",onClick:L,size:"sm",children:e.jsx(Ke,{size:14})})]})}),e.jsx(r,{style:{flex:1,overflow:"auto"},px:"xs",pb:"sm",children:I?e.jsx(_,{py:"xl",children:e.jsx(K,{size:"sm"})}):h.length===0?e.jsx(o,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No buckets yet"}):e.jsx(D,{gap:2,children:h.map(s=>e.jsx(Z,{p:"xs",style:{cursor:"pointer",backgroundColor:t===s.id?"var(--supabase-bg-surface)":"transparent",borderRadius:6},onClick:()=>{a(s.id),c(""),f(null)},children:e.jsxs(p,{justify:"space-between",wrap:"nowrap",children:[e.jsxs(p,{gap:"xs",wrap:"nowrap",children:[e.jsx(R,{size:16,color:"var(--supabase-text-muted)"}),e.jsx(o,{size:"sm",truncate:!0,style:{maxWidth:120},children:s.name})]}),e.jsx(Ze,{isPublic:s.public})]})},s.id))})})]}),e.jsx(r,{style:{flex:1,display:"flex",flexDirection:"column"},children:t?e.jsxs(e.Fragment,{children:[e.jsx(r,{p:"md",style:{borderBottom:"1px solid var(--supabase-border)"},children:e.jsxs(p,{justify:"space-between",children:[e.jsxs(p,{gap:"xs",children:[n&&e.jsx(C,{variant:"subtle",onClick:$e,children:e.jsx(Qe,{size:18})}),e.jsxs(qe,{children:[e.jsx(oe,{size:"sm",onClick:()=>{c(""),f(null)},style:{cursor:"pointer"},children:(k==null?void 0:k.name)||t}),ie.map((s,l)=>e.jsx(oe,{size:"sm",onClick:()=>{le(ie.slice(0,l+1).join("/"))},style:{cursor:"pointer"},children:s},l))]})]}),e.jsxs(p,{gap:"sm",children:[e.jsx(M,{label:"Reload",children:e.jsx(C,{variant:"subtle",onClick:U,children:e.jsx(Ye,{size:18})})}),e.jsx(M,{label:"View",children:e.jsx(C,{variant:"subtle",children:e.jsx(es,{size:18})})}),e.jsx(y,{variant:"outline",leftSection:e.jsx(ss,{size:16}),onClick:()=>{var s;return(s=B.current)==null?void 0:s.call(B)},loading:V,size:"sm",children:"Upload files"}),e.jsx(y,{variant:"outline",leftSection:e.jsx(ts,{size:16}),onClick:Ue,size:"sm",children:"Create folder"}),e.jsxs(m,{position:"bottom-end",children:[e.jsx(m.Target,{children:e.jsx(C,{variant:"subtle",children:e.jsx(xe,{size:18})})}),e.jsx(m.Dropdown,{children:e.jsx(m.Item,{color:"red",leftSection:e.jsx(Q,{size:14}),onClick:De,children:"Delete bucket"})})]})]})]})}),e.jsxs(r,{style:{flex:1,display:"flex"},children:[e.jsx(r,{style:{flex:1,overflow:"auto"},p:"md",children:e.jsx(Ae,{onDrop:Te,openRef:B,activateOnClick:!1,styles:{root:{border:"none",backgroundColor:"transparent",minHeight:"100%"}},children:N?e.jsx(_,{py:"xl",children:e.jsx(K,{size:"sm"})}):j.length===0?e.jsx(ue,{icon:e.jsx(R,{size:32}),title:"No files",description:"Upload files or create a folder to get started",action:{label:"Upload files",onClick:()=>{var s;return(s=B.current)==null?void 0:s.call(B)}}}):e.jsx(D,{gap:4,children:j.map(s=>{const l=T(s)?R:Se(s),b=(u==null?void 0:u.id)===s.id;return e.jsx(Z,{p:"sm",style:{cursor:"pointer",border:b?"1px solid var(--supabase-brand)":"1px solid var(--supabase-border)",backgroundColor:b?"var(--supabase-brand-light)":"transparent",borderRadius:6},onClick:()=>We(s),children:e.jsxs(p,{justify:"space-between",wrap:"nowrap",children:[e.jsxs(p,{gap:"sm",wrap:"nowrap",children:[e.jsx(l,{size:20,color:T(s)?"var(--supabase-brand)":"var(--supabase-text-muted)",stroke:1.5}),e.jsxs(r,{children:[e.jsx(o,{size:"sm",fw:500,truncate:!0,style:{maxWidth:400},children:s.name.split("/").pop()||s.name}),!T(s)&&e.jsxs(o,{size:"xs",c:"dimmed",children:[Fe(s.size)," ",s.content_type&&`- ${s.content_type}`]})]})]}),!T(s)&&e.jsxs(p,{gap:"xs",children:[e.jsx(M,{label:"Download",children:e.jsx(C,{variant:"subtle",onClick:g=>{g.stopPropagation(),re(s)},children:e.jsx(ze,{size:16})})}),e.jsx(M,{label:"Copy URL",children:e.jsx(C,{variant:"subtle",onClick:g=>{g.stopPropagation(),ne(s)},children:e.jsx(Y,{size:16})})}),e.jsxs(m,{position:"bottom-end",children:[e.jsx(m.Target,{children:e.jsx(C,{variant:"subtle",onClick:g=>g.stopPropagation(),children:e.jsx(xe,{size:16})})}),e.jsx(m.Dropdown,{children:e.jsx(m.Item,{color:"red",leftSection:e.jsx(Q,{size:14}),onClick:g=>{g.stopPropagation(),f(s),se()},children:"Delete"})})]})]})]})},s.id)})})})}),u&&k&&e.jsx(ks,{file:u,bucket:k,onClose:()=>f(null),onDownload:()=>re(u),onDelete:()=>se(),onCopyUrl:()=>ne(u)})]})]}):e.jsx(_,{style:{flex:1},children:e.jsx(ue,{icon:e.jsx(R,{size:32}),title:"Select a bucket",description:"Choose a bucket from the sidebar or create a new one",action:{label:"Create bucket",onClick:L}})})})]}),e.jsx(ce,{opened:P,onClose:H,title:"Create bucket",size:"md",children:e.jsxs(D,{gap:"md",children:[e.jsx(de,{label:"Name",placeholder:"my-bucket",value:F.name,onChange:s=>X({...F,name:s.target.value}),required:!0}),e.jsx(Me,{label:"Public bucket",description:"Allow public access to files without authentication",checked:F.public,onChange:s=>X({...F,public:s.target.checked})}),e.jsxs(p,{justify:"flex-end",mt:"md",children:[e.jsx(y,{variant:"outline",onClick:H,children:"Cancel"}),e.jsx(y,{onClick:Oe,loading:W,children:"Create bucket"})]})]})}),e.jsx(ce,{opened:Le,onClose:G,title:"Create folder",size:"md",children:e.jsxs(D,{gap:"md",children:[e.jsx(de,{label:"Folder name",placeholder:"my-folder",value:$,onChange:s=>ae(s.target.value),required:!0}),e.jsxs(p,{justify:"flex-end",mt:"md",children:[e.jsx(y,{variant:"outline",onClick:G,children:"Cancel"}),e.jsx(y,{onClick:_e,loading:W,children:"Create folder"})]})]})}),e.jsx(pe,{opened:Be,onClose:ee,onConfirm:Ee,title:"Delete bucket",message:`Are you sure you want to delete "${k==null?void 0:k.name}"? All files in this bucket will be permanently deleted.`,confirmLabel:"Delete",danger:!0,loading:W}),e.jsx(pe,{opened:Pe,onClose:te,onConfirm:Re,title:"Delete file",message:`Are you sure you want to delete "${u==null?void 0:u.name.split("/").pop()}"?`,confirmLabel:"Delete",danger:!0,loading:W})]})}export{Os as StoragePage};
