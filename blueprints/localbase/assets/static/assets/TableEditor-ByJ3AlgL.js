import{h as _,y as d,i as He,j as e,_ as Vs,B as c,d as V,A as w,G as l,T as n,e as x,a as k,$ as F,M as p,Q as W,R as Ve,O as L,S as E,a0 as Ke,b as D,a1 as Ks,f as K,H as Je,F as Qe}from"./vendor-mantine-0E1e8SJ8.js";import{r}from"./vendor-react-CFPnf9wS.js";import{P as Js}from"./PageContainer-BJil4t7q.js";import{E as de}from"./EmptyState-CjtLm1uN.js";import{C as Ge}from"./ConfirmModal-Ba3Tq8oS.js";import{d as y}from"./database-CiK1Mmeb.js";import{u as Qs}from"./index-Bwll0WcM.js";import{ar as Xe,c as ce,V as Ye,as as Ze,at as es,G as J,Z as Q,j as ss,h as as,n as ts,an as Gs,X as rs,au as ue,U as ls,av as Xs,aw as Ys,w as Zs,Y as ns,ax as ea,v as sa,u as aa,a as ta}from"./vendor-icons-rmXLq6rR.js";import"./client-CvoVCtJO.js";import"./vendor-state-Ud2phgVo.js";const ra=[{value:"uuid",label:"uuid"},{value:"text",label:"text"},{value:"varchar",label:"varchar"},{value:"integer",label:"integer"},{value:"bigint",label:"bigint"},{value:"smallint",label:"smallint"},{value:"decimal",label:"decimal"},{value:"numeric",label:"numeric"},{value:"real",label:"real"},{value:"double precision",label:"double precision"},{value:"boolean",label:"boolean"},{value:"date",label:"date"},{value:"time",label:"time"},{value:"timestamp",label:"timestamp"},{value:"timestamptz",label:"timestamptz"},{value:"json",label:"json"},{value:"jsonb",label:"jsonb"},{value:"bytea",label:"bytea"},{value:"uuid[]",label:"uuid[]"},{value:"text[]",label:"text[]"},{value:"integer[]",label:"integer[]"}],la=150,is=400;function ma(){const{selectedSchema:C,setSelectedSchema:os,selectedTable:i,setSelectedTable:A}=Qs(),[ds,cs]=r.useState([]),[xe,us]=r.useState([]),[h,pe]=r.useState([]),[u,G]=r.useState([]),[xs,be]=r.useState(!0),[ps,he]=r.useState(!1),[g,B]=r.useState(new Set),[f,P]=r.useState(null),[I,X]=r.useState(""),[N,bs]=r.useState(null),[$,me]=r.useState("asc"),[hs,{open:ge,close:Y}]=_(!1),[ms,{open:fe,close:je}]=_(!1),[gs,{open:ye,close:Z}]=_(!1),[fs,{open:js,close:ee}]=_(!1),[ys,{open:vs,close:ve}]=_(!1),[ws,{open:se,close:ae}]=_(!1),[te,we]=r.useState(""),[R,m]=r.useState(!1),[b,v]=r.useState({}),[Ce,ze]=r.useState(null),[Se,ke]=r.useState(null),[re,De]=r.useState(""),[Ie,Re]=r.useState("text"),[_e,Ee]=r.useState(""),[Ae,Fe]=r.useState(!0),[Be,Ne]=r.useState(!1),Cs=r.useRef(null),We=r.useCallback(async()=>{try{const s=await y.listSchemas();cs(s??[])}catch(s){d.show({title:"Error",message:s.message||"Failed to load schemas",color:"red"})}},[]),O=r.useCallback(async()=>{be(!0);try{const s=await y.listTables(C);us(s??[]),((s==null?void 0:s.length)??0)>0&&!i&&A(s[0].name)}catch(s){d.show({title:"Error",message:s.message||"Failed to load tables",color:"red"})}finally{be(!1)}},[C,i,A]),S=r.useCallback(async()=>{if(i){he(!0);try{let s="limit=100";N&&(s+=`&order=${N}.${$}`);const[a,t]=await Promise.all([y.listColumns(C,i),y.selectTable(i,s)]);pe(a??[]),G(t??[]),B(new Set),P(null)}catch(s){d.show({title:"Error",message:s.message||"Failed to load table data",color:"red"}),pe([]),G([])}finally{he(!1)}}},[C,i,N,$]);r.useEffect(()=>{We()},[We]),r.useEffect(()=>{O()},[O]),r.useEffect(()=>{i&&S()},[i,S]);const q=h.find(s=>s.is_primary_key),U=s=>{if(q){const a=s[q.name];return typeof a=="string"?`${q.name}=eq.${a}`:`${q.name}=eq.${a}`}return h.map(a=>`${a.name}=eq.${s[a.name]}`).join("&")},zs=async()=>{if(!te.trim()){d.show({title:"Validation Error",message:"Table name is required",color:"red"});return}m(!0);try{await y.createTable({schema:C,name:te,columns:[{name:"id",type:"uuid",is_primary_key:!0,is_nullable:!1,is_unique:!0,default_value:"gen_random_uuid()"},{name:"created_at",type:"timestamptz",is_nullable:!1,is_primary_key:!1,is_unique:!1,default_value:"now()"}]}),d.show({title:"Success",message:"Table created successfully",color:"green"}),Y(),we(""),O()}catch(s){d.show({title:"Error",message:s.message||"Failed to create table",color:"red"})}finally{m(!1)}},Ss=async()=>{if(i){m(!0);try{await y.dropTable(C,i),d.show({title:"Success",message:"Table deleted successfully",color:"green"}),je(),A(null),O()}catch(s){d.show({title:"Error",message:s.message||"Failed to delete table",color:"red"})}finally{m(!1)}}},ks=async()=>{m(!0);try{const s={};for(const a of h){const t=b[a.name];if(t!==void 0&&t!=="")if(a.type==="integer"||a.type==="bigint"||a.type==="smallint")s[a.name]=parseInt(t,10);else if(a.type==="numeric"||a.type==="decimal"||a.type==="real"||a.type==="double precision")s[a.name]=parseFloat(t);else if(a.type==="boolean")s[a.name]=t==="true"||t===!0;else if(a.type==="json"||a.type==="jsonb")try{s[a.name]=JSON.parse(t)}catch{s[a.name]=t}else s[a.name]=t}await y.insertRow(i,s),d.show({title:"Success",message:"Row inserted successfully",color:"green"}),Z(),v({}),S()}catch(s){d.show({title:"Error",message:s.message||"Failed to insert row",color:"red"})}finally{m(!1)}},Ds=async()=>{if(Ce){m(!0);try{const s=U(Ce),a={};for(const t of h){const o=b[t.name];if(o!==void 0)if(o===""||o===null)a[t.name]=null;else if(t.type==="integer"||t.type==="bigint"||t.type==="smallint")a[t.name]=parseInt(o,10);else if(t.type==="numeric"||t.type==="decimal"||t.type==="real"||t.type==="double precision")a[t.name]=parseFloat(o);else if(t.type==="boolean")a[t.name]=o==="true"||o===!0;else if(t.type==="json"||t.type==="jsonb")try{a[t.name]=JSON.parse(o)}catch{a[t.name]=o}else a[t.name]=o}await y.updateRow(i,s,a),d.show({title:"Success",message:"Row updated successfully",color:"green"}),ee(),v({}),ze(null),S()}catch(s){d.show({title:"Error",message:s.message||"Failed to update row",color:"red"})}finally{m(!1)}}},Is=async()=>{if(Se!==null){m(!0);try{const s=u[Se],a=U(s);await y.deleteRow(i,a),d.show({title:"Success",message:"Row deleted successfully",color:"green"}),ve(),ke(null),S()}catch(s){d.show({title:"Error",message:s.message||"Failed to delete row",color:"red"})}finally{m(!1)}}},Rs=async()=>{if(g.size!==0){m(!0);try{const s=Array.from(g).map(a=>{const t=u[a],o=U(t);return y.deleteRow(i,o)});await Promise.all(s),d.show({title:"Success",message:`${g.size} row(s) deleted successfully`,color:"green"}),B(new Set),S()}catch(s){d.show({title:"Error",message:s.message||"Failed to delete rows",color:"red"})}finally{m(!1)}}},_s=async()=>{if(!re.trim()){d.show({title:"Validation Error",message:"Column name is required",color:"red"});return}m(!0);try{await y.addColumn(C,i,{name:re,type:Ie,default_value:_e||void 0,is_nullable:Ae,is_unique:Be}),d.show({title:"Success",message:"Column added successfully",color:"green"}),ae(),le(),S()}catch(s){d.show({title:"Error",message:s.message||"Failed to add column",color:"red"})}finally{m(!1)}},le=()=>{De(""),Re("text"),Ee(""),Fe(!0),Ne(!1)},Es=(s,a,t)=>{P({rowIndex:s,column:a}),X(t===null?"":String(t))},Le=async()=>{if(!f)return;const s=u[f.rowIndex],a=h.find(t=>t.name===f.column);if(a)try{const t=U(s);let o=I;I===""&&a.is_nullable?o=null:a.type==="integer"||a.type==="bigint"||a.type==="smallint"?o=parseInt(I,10):a.type==="numeric"||a.type==="decimal"||a.type==="real"||a.type==="double precision"?o=parseFloat(I):a.type==="boolean"&&(o=I==="true"||I==="1"),await y.updateRow(i,t,{[f.column]:o});const Te=[...u];Te[f.rowIndex]={...s,[f.column]:o},G(Te),P(null)}catch(t){d.show({title:"Error",message:t.message||"Failed to update cell",color:"red"})}},Pe=()=>{P(null),X("")},As=s=>{const a=new Set(g);a.has(s)?a.delete(s):a.add(s),B(a)},Fs=()=>{g.size===u.length?B(new Set):B(new Set(u.map((s,a)=>a)))},Bs=s=>{ze(s);const a={};h.forEach(t=>{a[t.name]=s[t.name]===null?"":s[t.name]}),v(a),js()},Ns=s=>{ke(s),vs()},Ws=s=>{N===s?me($==="asc"?"desc":"asc"):(bs(s),me("asc"))},z=xe.find(s=>s.name===i),Ls=s=>s.type.includes("text")||s.type.includes("varchar")?200:s.type.includes("json")?250:s.type.includes("timestamp")||s.type.includes("date")?200:s.type.includes("uuid")?300:la,Ps=s=>{const a=s.map(t=>t.toString(16).padStart(2,"0")).join("");return`${a.slice(0,8)}-${a.slice(8,12)}-${a.slice(12,16)}-${a.slice(16,20)}-${a.slice(20)}`},$s=s=>Array.isArray(s)&&s.length===16&&s.every(a=>typeof a=="number"&&a>=0&&a<=255),Os=(s,a)=>{if(s===null)return"NULL";if(typeof s=="boolean")return s?"true":"false";if($s(s))return Ps(s);if(a!=null&&a.includes("timestamp")&&typeof s=="string")try{const t=new Date(s);if(!isNaN(t.getTime()))return t.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{}if(a!=null&&a.includes("date")&&!(a!=null&&a.includes("timestamp"))&&typeof s=="string")try{const t=new Date(s);if(!isNaN(t.getTime()))return t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{}if(typeof s=="object")try{return JSON.stringify(s,null,2)}catch{return String(s)}return String(s)},qs=s=>s!=null&&s.includes("json")?{fontFamily:"monospace",fontSize:"0.75rem",whiteSpace:"pre-wrap"}:s!=null&&s.includes("uuid")?{fontFamily:"monospace",fontSize:"0.75rem"}:s!=null&&s.includes("numeric")||s!=null&&s.includes("integer")||s!=null&&s.includes("decimal")||s!=null&&s.includes("bigint")?{fontFamily:"monospace",textAlign:"right"}:{},[ne,ie]=r.useState(1),[$e,Us]=r.useState(100),M=Math.ceil(((u==null?void 0:u.length)??0)/$e),[T,Ms]=r.useState(""),[Oe,Ts]=r.useState("data"),j=He("(max-width: 768px)"),H=He("(max-width: 1024px)"),[Hs,{open:qe,close:Ue}]=_(!1),oe=xe.filter(s=>T===""||s.name.toLowerCase().includes(T.toLowerCase())),Me=({onTableSelect:s})=>e.jsxs(e.Fragment,{children:[e.jsxs(c,{p:"sm",style:{borderBottom:"1px solid var(--supabase-border)"},children:[e.jsx(n,{size:"xs",fw:600,tt:"uppercase",mb:"xs",style:{color:"var(--supabase-text-muted)",letterSpacing:"0.05em",fontSize:"0.6875rem"},children:"Table Editor"}),e.jsx(F,{size:"xs",value:C,onChange:a=>{a&&(os(a),A(null))},data:(ds??[]).map(a=>({value:a,label:`schema ${a}`})),placeholder:"Select schema",leftSection:e.jsx(n,{size:"xs",c:"dimmed",children:"schema"}),styles:{input:{backgroundColor:"var(--supabase-bg-surface)"}}})]}),e.jsx(c,{px:"sm",py:"xs",children:e.jsx(x,{size:"xs",variant:"outline",fullWidth:!0,leftSection:e.jsx(Ye,{size:14}),onClick:ge,styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",justifyContent:"flex-start",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"New table"})}),e.jsx(c,{px:"sm",pb:"xs",children:e.jsx(D,{size:"xs",placeholder:"Search tables...",leftSection:e.jsx(ta,{size:14}),value:T,onChange:a=>Ms(a.target.value),styles:{input:{backgroundColor:"var(--supabase-bg-surface)"}}})}),e.jsx(L,{style:{flex:1},px:"sm",pb:"sm",children:xs?e.jsx(W,{py:"xl",children:e.jsx(Ve,{size:"sm"})}):!oe||oe.length===0?e.jsx(n,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:T?"No tables match your search":`No tables in ${C}`}):e.jsx(E,{gap:2,children:oe.map(a=>e.jsx(c,{py:6,px:8,style:{cursor:"pointer",backgroundColor:i===a.name?"var(--supabase-brand-light)":"transparent",borderRadius:4,transition:"background-color 0.1s ease"},onClick:()=>{A(a.name),s==null||s()},onMouseEnter:t=>{i!==a.name&&(t.currentTarget.style.backgroundColor="var(--supabase-bg-surface-hover)")},onMouseLeave:t=>{i!==a.name&&(t.currentTarget.style.backgroundColor="transparent")},children:e.jsxs(l,{justify:"space-between",wrap:"nowrap",gap:8,children:[e.jsxs(l,{gap:8,wrap:"nowrap",style:{minWidth:0,flex:1},children:[e.jsx(ce,{size:16,style:{flexShrink:0,color:i===a.name?"var(--supabase-brand)":"var(--supabase-text-muted)"}}),e.jsx(n,{size:"sm",truncate:!0,style:{color:i===a.name?"var(--supabase-brand)":"var(--supabase-text)"},children:a.name})]}),e.jsxs(p,{position:"right-start",shadow:"md",withinPortal:!0,children:[e.jsx(p.Target,{children:e.jsx(w,{size:"xs",variant:"subtle",onClick:t=>t.stopPropagation(),style:{opacity:.5},children:e.jsx(rs,{size:14})})}),e.jsxs(p.Dropdown,{children:[e.jsx(p.Item,{leftSection:e.jsx(ns,{size:14}),children:"Edit table"}),e.jsx(p.Item,{color:"red",leftSection:e.jsx(Q,{size:14}),onClick:t=>{t.stopPropagation(),A(a.name),fe()},children:"Delete table"})]})]})]})},a.name))})})]});return e.jsxs(Js,{title:"Table Editor",description:"View and edit your database tables",fullWidth:!0,noPadding:!0,noHeader:!0,children:[e.jsx(Vs,{opened:Hs,onClose:Ue,title:"Tables",size:"280px",padding:"0",styles:{body:{padding:0,height:"calc(100% - 60px)",display:"flex",flexDirection:"column"},header:{borderBottom:"1px solid var(--supabase-border)"}},children:e.jsx(Me,{onTableSelect:Ue})}),e.jsxs(c,{style:{display:"flex",height:"calc(100vh - 96px)"},children:[!j&&e.jsx(c,{style:{width:H?220:280,minWidth:H?220:280,borderRight:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)"},children:e.jsx(Me,{})}),e.jsx(c,{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:i?e.jsxs(e.Fragment,{children:[e.jsxs(c,{style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)",display:"flex",alignItems:"center",paddingLeft:j?8:12,paddingRight:8,minHeight:40,gap:8},children:[j&&e.jsx(V,{label:"Show tables",children:e.jsx(w,{variant:"subtle",size:"sm",onClick:qe,children:e.jsx(Xe,{size:16})})}),e.jsxs(l,{gap:0,style:{flex:1,minWidth:0},children:[e.jsx(c,{px:"sm",py:8,style:{borderBottom:"2px solid var(--supabase-brand)",marginBottom:-1,minWidth:0},children:e.jsxs(l,{gap:6,wrap:"nowrap",children:[e.jsx(ce,{size:14,color:"var(--supabase-brand)",style:{flexShrink:0}}),e.jsx(n,{size:"sm",fw:500,truncate:!0,style:{color:"var(--supabase-brand)"},children:i})]})}),!j&&e.jsx(w,{variant:"subtle",size:"sm",ml:4,style:{opacity:.5},children:e.jsx(Ye,{size:14})})]})]}),e.jsx(c,{px:"sm",py:8,style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)"},children:e.jsxs(l,{justify:"space-between",wrap:j?"wrap":"nowrap",gap:8,children:[e.jsxs(l,{gap:8,wrap:"nowrap",children:[!j&&e.jsxs(e.Fragment,{children:[e.jsx(x,{size:"xs",variant:"outline",leftSection:e.jsx(Ze,{size:14}),styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"Filter"}),e.jsx(x,{size:"xs",variant:"outline",leftSection:e.jsx(es,{size:14}),styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"Sort"})]}),e.jsx(x,{size:"xs",leftSection:e.jsx(c,{style:{display:"flex",alignItems:"center",justifyContent:"center",width:16,height:16,backgroundColor:"rgba(255, 255, 255, 0.2)",borderRadius:3},children:e.jsx(J,{size:10})}),onClick:()=>{v({}),ye()},styles:{root:{backgroundColor:"var(--supabase-brand)","&:hover":{backgroundColor:"var(--supabase-brand-hover)"}}},children:"Insert"}),g.size>0&&e.jsx(x,{size:"xs",color:"red",variant:"light",leftSection:e.jsx(Q,{size:14}),onClick:Rs,loading:R,children:j?g.size:`Delete (${g.size})`})]}),e.jsxs(l,{gap:8,wrap:"nowrap",children:[!j&&!H&&e.jsxs(e.Fragment,{children:[e.jsx(x,{size:"xs",variant:"outline",leftSection:e.jsx(ss,{size:14}),rightSection:z!=null&&z.rls_enabled?e.jsx(k,{size:"xs",variant:"light",color:"green",style:{marginLeft:4},children:"Enabled"}):void 0,styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"RLS policies"}),e.jsx(x,{size:"xs",variant:"outline",leftSection:e.jsx(as,{size:14}),styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"Index Advisor"}),e.jsx(x,{size:"xs",variant:"outline",leftSection:e.jsx(ts,{size:14}),styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)",fontWeight:400,"&:hover":{backgroundColor:"var(--supabase-bg-surface)"}}},children:"Enable Realtime"}),e.jsx(F,{size:"xs",value:"postgres",data:[{value:"postgres",label:"postgres"},{value:"anon",label:"anon"},{value:"authenticated",label:"authenticated"}],leftSection:e.jsx(n,{size:"xs",c:"dimmed",children:"Role"}),w:150,styles:{input:{backgroundColor:"var(--supabase-bg)",borderColor:"var(--supabase-border)"}}})]}),e.jsx(V,{label:"Refresh",children:e.jsx(w,{variant:"subtle",onClick:S,children:e.jsx(Gs,{size:18})})}),e.jsxs(p,{position:"bottom-end",children:[e.jsx(p.Target,{children:e.jsx(w,{variant:"subtle",children:e.jsx(rs,{size:18})})}),e.jsxs(p.Dropdown,{children:[(j||H)&&e.jsxs(e.Fragment,{children:[e.jsx(p.Item,{leftSection:e.jsx(Ze,{size:14}),children:"Filter"}),e.jsx(p.Item,{leftSection:e.jsx(es,{size:14}),children:"Sort"}),e.jsx(p.Item,{leftSection:e.jsx(ss,{size:14}),children:"RLS policies"}),e.jsx(p.Item,{leftSection:e.jsx(as,{size:14}),children:"Index Advisor"}),e.jsx(p.Item,{leftSection:e.jsx(ts,{size:14}),children:"Enable Realtime"}),e.jsx(p.Divider,{})]}),e.jsx(p.Item,{leftSection:e.jsx(ue,{size:14}),onClick:se,children:"Add column"}),e.jsx(p.Divider,{}),e.jsx(p.Item,{color:"red",leftSection:e.jsx(Q,{size:14}),onClick:fe,children:"Delete table"})]})]})]})]})}),e.jsx(c,{style:{flex:1,overflow:"hidden"},children:ps?e.jsx(W,{py:"xl",children:e.jsx(Ve,{size:"sm"})}):Oe==="definition"?e.jsx(L,{style:{height:"100%"},p:"md",children:e.jsxs(c,{style:{maxWidth:800},children:[e.jsxs(n,{size:"sm",fw:600,mb:"md",style:{color:"var(--supabase-text)"},children:["Table Definition: ",i]}),e.jsx(c,{style:{border:"1px solid var(--supabase-border)",borderRadius:"var(--supabase-radius-lg)",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"var(--supabase-bg-surface)"},children:[e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Column"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Type"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Default"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Nullable"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Primary"}),e.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid var(--supabase-border)",fontWeight:600},children:"Unique"})]})}),e.jsx("tbody",{children:h.map((s,a)=>e.jsxs("tr",{style:{backgroundColor:a%2===0?"var(--supabase-bg)":"var(--supabase-bg-surface)"},children:[e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)"},children:e.jsxs(l,{gap:6,children:[s.is_primary_key&&e.jsx(ls,{size:14,color:"var(--supabase-brand)"}),e.jsx(n,{size:"sm",fw:500,children:s.name})]})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)"},children:e.jsx(k,{size:"sm",variant:"light",color:"gray",children:s.type})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)",fontFamily:"monospace",fontSize:12},children:s.default_value||e.jsx(n,{size:"xs",c:"dimmed",children:"-"})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)",textAlign:"center"},children:s.is_nullable?e.jsx(k,{size:"xs",variant:"light",color:"gray",children:"Yes"}):e.jsx(k,{size:"xs",variant:"light",color:"red",children:"No"})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)",textAlign:"center"},children:s.is_primary_key&&e.jsx(J,{size:16,color:"var(--supabase-brand)"})}),e.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid var(--supabase-border)",textAlign:"center"},children:s.is_unique&&e.jsx(J,{size:16,color:"var(--supabase-info)"})})]},s.name))})]})}),e.jsxs(c,{mt:"lg",children:[e.jsx(n,{size:"sm",fw:600,mb:"sm",style:{color:"var(--supabase-text)"},children:"Table Information"}),e.jsxs(E,{gap:"xs",children:[e.jsxs(l,{gap:"xs",children:[e.jsx(n,{size:"sm",c:"dimmed",style:{width:120},children:"Schema:"}),e.jsx(n,{size:"sm",fw:500,children:C})]}),e.jsxs(l,{gap:"xs",children:[e.jsx(n,{size:"sm",c:"dimmed",style:{width:120},children:"Table name:"}),e.jsx(n,{size:"sm",fw:500,children:i})]}),e.jsxs(l,{gap:"xs",children:[e.jsx(n,{size:"sm",c:"dimmed",style:{width:120},children:"Columns:"}),e.jsx(n,{size:"sm",fw:500,children:h.length})]}),e.jsxs(l,{gap:"xs",children:[e.jsx(n,{size:"sm",c:"dimmed",style:{width:120},children:"RLS:"}),e.jsx(k,{size:"sm",variant:"light",color:z!=null&&z.rls_enabled?"green":"gray",children:z!=null&&z.rls_enabled?"Enabled":"Disabled"})]})]})]}),e.jsx(l,{mt:"lg",gap:"sm",children:e.jsx(x,{size:"xs",variant:"outline",leftSection:e.jsx(ue,{size:14}),onClick:se,children:"Add Column"})})]})}):!h||h.length===0?e.jsx(W,{py:"xl",children:e.jsx(de,{icon:e.jsx(ue,{size:32}),title:"No columns",description:"Add columns to this table to start storing data",action:{label:"Add column",onClick:se}})}):!u||u.length===0?e.jsx(W,{py:"xl",children:e.jsx(de,{icon:e.jsx(Xs,{size:32}),title:"No rows",description:"Insert rows to start adding data",action:{label:"Insert row",onClick:()=>{v({}),ye()}}})}):e.jsx(L,{ref:Cs,style:{height:"100%"},scrollbarSize:8,type:"always",children:e.jsx(c,{style:{minWidth:"max-content"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"var(--supabase-bg-surface)"},children:[e.jsx("th",{style:{width:40,minWidth:40,padding:"8px 12px",borderBottom:"1px solid var(--supabase-border)",position:"sticky",left:0,backgroundColor:"var(--supabase-bg-surface)",zIndex:2},children:e.jsx(Ke,{size:"xs",checked:g.size===u.length&&u.length>0,indeterminate:g.size>0&&g.size<u.length,onChange:Fs})}),e.jsx("th",{style:{width:60,minWidth:60,padding:"8px 4px",borderBottom:"1px solid var(--supabase-border)",position:"sticky",left:40,backgroundColor:"var(--supabase-bg-surface)",zIndex:2}}),h.map(s=>e.jsx("th",{style:{minWidth:Ls(s),maxWidth:is,padding:"8px 12px",borderBottom:"1px solid var(--supabase-border)",textAlign:"left",cursor:"pointer",userSelect:"none"},onClick:()=>Ws(s.name),children:e.jsxs(l,{gap:4,wrap:"nowrap",justify:"space-between",children:[e.jsxs(l,{gap:4,wrap:"nowrap",children:[s.is_primary_key&&e.jsx(ls,{size:12,color:"var(--supabase-brand)"}),e.jsx(n,{size:"xs",fw:600,children:s.name}),e.jsx(n,{size:"xs",c:"dimmed",fw:400,children:s.type})]}),N===s.name&&($==="asc"?e.jsx(Ys,{size:14}):e.jsx(Zs,{size:14}))]})},s.name))]})}),e.jsx("tbody",{children:u.map((s,a)=>e.jsxs("tr",{style:{backgroundColor:g.has(a)?"var(--supabase-brand-light)":a%2===0?"var(--supabase-bg)":"var(--supabase-bg-surface)"},children:[e.jsx("td",{style:{padding:"8px 12px",borderBottom:"1px solid var(--supabase-border)",position:"sticky",left:0,backgroundColor:"inherit",zIndex:1},children:e.jsx(Ke,{size:"xs",checked:g.has(a),onChange:()=>As(a)})}),e.jsx("td",{style:{padding:"4px",borderBottom:"1px solid var(--supabase-border)",position:"sticky",left:40,backgroundColor:"inherit",zIndex:1},children:e.jsxs(l,{gap:2,wrap:"nowrap",children:[e.jsx(V,{label:"Edit row",children:e.jsx(w,{size:"xs",variant:"subtle",onClick:()=>Bs(s),children:e.jsx(ns,{size:14})})}),e.jsx(V,{label:"Delete row",children:e.jsx(w,{size:"xs",variant:"subtle",color:"red",onClick:()=>Ns(a),children:e.jsx(Q,{size:14})})})]})}),h.map(t=>e.jsx("td",{style:{padding:"8px 12px",borderBottom:"1px solid var(--supabase-border)",maxWidth:is,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"pointer"},onDoubleClick:()=>Es(a,t.name,s[t.name]),children:(f==null?void 0:f.rowIndex)===a&&(f==null?void 0:f.column)===t.name?e.jsxs(l,{gap:4,wrap:"nowrap",children:[e.jsx(D,{size:"xs",value:I,onChange:o=>X(o.target.value),onKeyDown:o=>{o.key==="Enter"&&Le(),o.key==="Escape"&&Pe()},autoFocus:!0,style:{flex:1}}),e.jsx(w,{size:"xs",color:"green",onClick:Le,children:e.jsx(J,{size:12})}),e.jsx(w,{size:"xs",color:"red",onClick:Pe,children:e.jsx(ea,{size:12})})]}):e.jsx(n,{size:"sm",c:s[t.name]===null?"dimmed":void 0,style:{fontStyle:s[t.name]===null?"italic":"normal",...qs(t.type)},children:Os(s[t.name],t.type)})},t.name))]},a))})]})})})}),u&&u.length>0&&e.jsxs(c,{px:"sm",py:8,style:{borderTop:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(l,{gap:8,children:[e.jsx(w,{size:"sm",variant:"outline",disabled:ne===1,onClick:()=>ie(s=>Math.max(1,s-1)),styles:{root:{borderColor:"var(--supabase-border)","&:hover:not(:disabled)":{backgroundColor:"var(--supabase-bg-surface)"}}},children:e.jsx(sa,{size:14})}),e.jsxs(l,{gap:4,children:[e.jsx(n,{size:"xs",c:"dimmed",children:"Page"}),e.jsx(D,{size:"xs",value:ne,onChange:s=>{const a=parseInt(s.target.value,10);!isNaN(a)&&a>=1&&a<=M&&ie(a)},w:40,styles:{input:{textAlign:"center",padding:"4px"}}}),e.jsxs(n,{size:"xs",c:"dimmed",children:["of ",M||1]})]}),e.jsx(w,{size:"sm",variant:"outline",disabled:ne>=M,onClick:()=>ie(s=>Math.min(M,s+1)),styles:{root:{borderColor:"var(--supabase-border)","&:hover:not(:disabled)":{backgroundColor:"var(--supabase-bg-surface)"}}},children:e.jsx(aa,{size:14})})]}),e.jsxs(l,{gap:16,children:[e.jsx(l,{gap:4,children:e.jsx(F,{size:"xs",value:String($e),onChange:s=>s&&Us(parseInt(s,10)),data:[{value:"50",label:"50 rows"},{value:"100",label:"100 rows"},{value:"200",label:"200 rows"}],w:100,styles:{input:{backgroundColor:"var(--supabase-bg)",borderColor:"var(--supabase-border)"}}})}),!j&&e.jsxs(n,{size:"xs",c:"dimmed",children:[u.length," records"]}),e.jsx(Ks,{size:"xs",value:Oe,onChange:s=>Ts(s),data:[{label:"Data",value:"data"},{label:"Definition",value:"definition"}],styles:{root:{backgroundColor:"var(--supabase-bg-surface)",border:"1px solid var(--supabase-border)"},indicator:{backgroundColor:"var(--supabase-bg)",boxShadow:"var(--supabase-shadow-sm)"}}})]})]})]}):e.jsx(W,{style:{flex:1},children:e.jsxs(E,{align:"center",gap:"lg",children:[e.jsx(de,{icon:e.jsx(ce,{size:32}),title:"Select a table",description:j?"Tap the button below to browse tables":"Choose a table from the sidebar or create a new one",action:{label:"Create table",onClick:ge}}),j&&e.jsx(x,{variant:"outline",leftSection:e.jsx(Xe,{size:16}),onClick:qe,styles:{root:{borderColor:"var(--supabase-border)",color:"var(--supabase-text)"}},children:"Browse tables"})]})})})]}),e.jsx(K,{opened:hs,onClose:Y,title:"Create table",size:"md",children:e.jsxs(E,{gap:"md",children:[e.jsx(D,{label:"Table name",placeholder:"my_table",value:te,onChange:s=>we(s.target.value),required:!0}),e.jsx(n,{size:"xs",c:"dimmed",children:"The table will be created with default columns: id (uuid, primary key) and created_at (timestamptz)."}),e.jsxs(l,{justify:"flex-end",mt:"md",children:[e.jsx(x,{variant:"outline",onClick:Y,children:"Cancel"}),e.jsx(x,{onClick:zs,loading:R,children:"Create table"})]})]})}),e.jsx(Ge,{opened:ms,onClose:je,onConfirm:Ss,title:"Delete table",message:`Are you sure you want to delete "${i}"? All data in this table will be permanently deleted.`,confirmLabel:"Delete",danger:!0,loading:R}),e.jsxs(K,{opened:gs,onClose:Z,title:"Insert row",size:"lg",children:[e.jsx(L,{style:{maxHeight:"calc(100vh - 300px)"},children:e.jsx(E,{gap:"sm",children:h.map(s=>e.jsxs(c,{children:[e.jsxs(l,{gap:"xs",mb:4,children:[e.jsx(n,{size:"sm",fw:500,children:s.name}),e.jsx(n,{size:"xs",c:"dimmed",children:s.type}),s.is_primary_key&&e.jsx(k,{size:"xs",color:"blue",children:"Primary Key"}),s.default_value&&e.jsxs(k,{size:"xs",variant:"light",children:["Default: ",s.default_value]})]}),s.type==="boolean"?e.jsx(F,{size:"sm",value:b[s.name]??"",onChange:a=>v({...b,[s.name]:a}),data:[{value:"",label:"(null)"},{value:"true",label:"true"},{value:"false",label:"false"}],placeholder:s.default_value?`Default: ${s.default_value}`:"Select value"}):s.type==="json"||s.type==="jsonb"?e.jsx(Je,{size:"sm",value:b[s.name]??"",onChange:a=>v({...b,[s.name]:a.target.value}),placeholder:s.default_value?`Default: ${s.default_value}`:"{}",minRows:2,styles:{input:{fontFamily:"monospace"}}}):e.jsx(D,{size:"sm",value:b[s.name]??"",onChange:a=>v({...b,[s.name]:a.target.value}),placeholder:s.default_value?`Default: ${s.default_value}`:`Enter ${s.type}`})]},s.name))})}),e.jsxs(l,{justify:"flex-end",mt:"md",children:[e.jsx(x,{variant:"outline",onClick:Z,children:"Cancel"}),e.jsx(x,{onClick:ks,loading:R,children:"Insert"})]})]}),e.jsxs(K,{opened:fs,onClose:ee,title:"Edit row",size:"lg",children:[e.jsx(L,{style:{maxHeight:"calc(100vh - 300px)"},children:e.jsx(E,{gap:"sm",children:h.map(s=>e.jsxs(c,{children:[e.jsxs(l,{gap:"xs",mb:4,children:[e.jsx(n,{size:"sm",fw:500,children:s.name}),e.jsx(n,{size:"xs",c:"dimmed",children:s.type}),s.is_primary_key&&e.jsx(k,{size:"xs",color:"blue",children:"Primary Key"})]}),s.type==="boolean"?e.jsx(F,{size:"sm",value:String(b[s.name]??""),onChange:a=>v({...b,[s.name]:a}),data:[{value:"",label:"(null)"},{value:"true",label:"true"},{value:"false",label:"false"}]}):s.type==="json"||s.type==="jsonb"?e.jsx(Je,{size:"sm",value:typeof b[s.name]=="object"?JSON.stringify(b[s.name],null,2):b[s.name]??"",onChange:a=>v({...b,[s.name]:a.target.value}),minRows:2,styles:{input:{fontFamily:"monospace"}}}):e.jsx(D,{size:"sm",value:String(b[s.name]??""),onChange:a=>v({...b,[s.name]:a.target.value}),disabled:s.is_primary_key})]},s.name))})}),e.jsxs(l,{justify:"flex-end",mt:"md",children:[e.jsx(x,{variant:"outline",onClick:ee,children:"Cancel"}),e.jsx(x,{onClick:Ds,loading:R,children:"Save"})]})]}),e.jsx(Ge,{opened:ys,onClose:ve,onConfirm:Is,title:"Delete row",message:"Are you sure you want to delete this row? This action cannot be undone.",confirmLabel:"Delete",danger:!0,loading:R}),e.jsx(K,{opened:ws,onClose:()=>{ae(),le()},title:"Add column",size:"md",children:e.jsxs(E,{gap:"md",children:[e.jsx(D,{label:"Column name",placeholder:"my_column",value:re,onChange:s=>De(s.target.value),required:!0}),e.jsx(F,{label:"Type",value:Ie,onChange:s=>s&&Re(s),data:ra,searchable:!0}),e.jsx(D,{label:"Default value",placeholder:"Optional",value:_e,onChange:s=>Ee(s.target.value)}),e.jsxs(l,{children:[e.jsx(Qe,{label:"Allow NULL",checked:Ae,onChange:s=>Fe(s.currentTarget.checked)}),e.jsx(Qe,{label:"Unique",checked:Be,onChange:s=>Ne(s.currentTarget.checked)})]}),e.jsxs(l,{justify:"flex-end",mt:"md",children:[e.jsx(x,{variant:"outline",onClick:()=>{ae(),le()},children:"Cancel"}),e.jsx(x,{onClick:_s,loading:R,children:"Add column"})]})]})})]})}export{ma as TableEditorPage};
