import{j as e,a as Bs,B as C,A as V,T as g,V as le,W as A,X as be,S as N,G as M,Y as Fs,D as Y,e as _,M as I,Z as Ds,_ as Ts,$ as Ms,w as Ve,d as ze,f as ie,b as oe,J as Be,Q as _s,a0 as Es,F as S,x as L,y as Ge,h as X,q as Ke,a1 as Ls}from"./vendor-mantine-aKbh6G_O.js";import{r as o}from"./vendor-react-CA6k1jPF.js";import{P as Ps}from"./PageContainer-BshQiLl_.js";import{E as Ze}from"./EmptyState-s1kxp5xn.js";import{C as Se}from"./ConfirmModal-vPtHsZos.js";import{s as T}from"./storage-B8Q3p-Gp.js";import{u as Os}from"./index-BweS2InR.js";import{$ as Rs,m as ee,v as Ws,a0 as Fe,a1 as De,a2 as we,a3 as ce,a4 as se,a5 as he,a6 as xe,a7 as me,a8 as fe,a9 as ge,aa as je,ab as es,g as ye,ac as Te,ad as ss,q as Me,ae as ts,af as ns,ag as as,ah as _e,ai as Ee,aj as rs,ak as Le,al as Pe,am as Oe,x as Us,an as pe,C as As,_ as ke,ao as $s,ap as Je,k as Qe,aq as Ns,ar as qs,a as Hs,Y as ls,u as Vs,as as Gs,at as Ks,Z as Zs,au as Js,av as Qs,J as Xs,W as Ys}from"./vendor-icons-BYOfSTr6.js";import"./client-CvoVCtJO.js";import"./vendor-state-6LbO6gDb.js";function et({isPublic:s}){return e.jsx(Bs,{variant:"light",color:s?"blue":"gray",size:"sm",style:{textTransform:"none",fontWeight:500},children:s?"Public":"Private"})}function st(s){var p,c;const t=s.content_type||"",l=(p=s.name.split(".").pop())==null?void 0:p.toLowerCase(),a=((c=s.name.split("/").pop())==null?void 0:c.toLowerCase())||"";if(t.startsWith("image/"))return Fe;if(t.startsWith("video/"))return De;if(t.startsWith("audio/"))return we;if(t==="application/pdf")return ce;if(t==="application/json")return se;if(t==="text/csv"||t==="application/csv")return he;if(t==="application/xml"||t==="text/xml")return xe;if(t==="application/sql"||t==="text/x-sql")return me;if(t.includes("spreadsheet")||t.includes("excel"))return fe;if(t.includes("presentation")||t.includes("powerpoint"))return ge;if(t.includes("wordprocessing")||t.includes("msword"))return je;if(a==="dockerfile")return es;if(a==="makefile")return ye;switch(l){case"js":case"jsx":case"ts":case"tsx":return Pe;case"py":return Le;case"rs":return rs;case"go":case"java":case"c":case"cpp":case"h":case"hpp":case"swift":case"kt":case"rb":case"php":return Ee;case"md":case"mdx":return _e;case"json":return se;case"html":case"htm":return as;case"css":case"scss":case"less":return ns;case"zip":case"tar":case"gz":case"rar":case"7z":case"tgz":return ts;case"txt":case"log":return Me;case"pdf":return ce;case"csv":return he;case"xml":return xe;case"sql":return me;case"xlsx":case"xls":return fe;case"pptx":case"ppt":return ge;case"docx":case"doc":return je;case"yaml":case"yml":case"toml":case"ini":case"conf":case"cfg":return ss;case"sh":case"bash":case"zsh":return ye;default:return Te}}function tt(s){return s.name.endsWith("/")||!s.content_type}function nt(s){if(s===0)return"0 B";const t=1024,l=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,a)).toFixed(2))+" "+l[a]}function at({path:s,items:t,selectedItem:l,loading:a,error:p,columnIndex:c,showBackButton:j,onItemSelect:B,onBack:y}){const b=s?s.split("/").pop()||s:"Root";return e.jsxs(C,{style:{minWidth:220,maxWidth:280,width:240,borderRight:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)",flexShrink:0},children:[e.jsxs(C,{px:"xs",py:6,style:{borderBottom:"1px solid var(--supabase-border)",display:"flex",alignItems:"center",gap:6,minHeight:36},children:[j&&e.jsx(V,{variant:"subtle",size:"sm",onClick:()=>y(c),style:{flexShrink:0},children:e.jsx(Rs,{size:16})}),e.jsx(g,{size:"sm",fw:500,truncate:!0,style:{flex:1},children:b})]}),e.jsx(le,{style:{flex:1},scrollbarSize:6,children:a?e.jsx(A,{py:"xl",children:e.jsx(be,{size:"sm"})}):p?e.jsx(A,{py:"xl",children:e.jsx(g,{size:"sm",c:"red",children:p})}):t.length===0?e.jsx(A,{py:"xl",children:e.jsx(g,{size:"sm",c:"dimmed",children:"Empty folder"})}):e.jsx(N,{gap:0,children:t.map(m=>{const f=tt(m),v=f?ee:st(m),z=m.name.split("/").filter(Boolean).pop()||m.name,F=l===m.name;return e.jsxs(C,{px:"xs",py:6,style:{cursor:"pointer",borderLeft:F?"2px solid var(--supabase-brand)":"2px solid transparent",backgroundColor:F?"var(--supabase-brand-light)":"transparent",display:"flex",alignItems:"center",gap:8,transition:"background-color 0.1s ease"},onClick:()=>B(m,c),onMouseEnter:h=>{F||(h.currentTarget.style.backgroundColor="var(--supabase-bg-surface)")},onMouseLeave:h=>{F||(h.currentTarget.style.backgroundColor="transparent")},children:[e.jsx(v,{size:18,color:f?"var(--supabase-brand)":"var(--supabase-text-muted)",stroke:1.5,style:{flexShrink:0}}),e.jsxs(C,{style:{flex:1,minWidth:0},children:[e.jsx(g,{size:"sm",truncate:!0,children:z}),!f&&m.size>0&&e.jsx(g,{size:"xs",c:"dimmed",children:nt(m.size)})]}),f&&e.jsx(Ws,{size:14,color:"var(--supabase-text-muted)",style:{flexShrink:0}})]},m.id||m.name)})})})]})}function rt({columns:s,onItemSelect:t,onBack:l}){return s.length===0?null:e.jsx(le,{style:{flex:1,backgroundColor:"var(--supabase-bg)",pointerEvents:"auto"},scrollbarSize:6,type:"hover",children:e.jsx(C,{style:{display:"flex",minHeight:"100%"},children:s.map((a,p)=>e.jsx(at,{path:a.path,items:a.items,selectedItem:a.selectedItem,loading:a.loading,error:a.error,columnIndex:p,showBackButton:p>0,onItemSelect:t,onBack:l},`${a.path}-${p}`))})})}function lt(s){var p,c;const t=s.content_type||"",l=(p=s.name.split(".").pop())==null?void 0:p.toLowerCase(),a=((c=s.name.split("/").pop())==null?void 0:c.toLowerCase())||"";if(t.startsWith("image/"))return Fe;if(t.startsWith("video/"))return De;if(t.startsWith("audio/"))return we;if(t==="application/pdf")return ce;if(t==="application/json")return se;if(t==="text/csv"||t==="application/csv")return he;if(t==="application/xml"||t==="text/xml")return xe;if(t==="application/sql"||t==="text/x-sql")return me;if(t.includes("spreadsheet")||t.includes("excel"))return fe;if(t.includes("presentation")||t.includes("powerpoint"))return ge;if(t.includes("wordprocessing")||t.includes("msword"))return je;if(a==="dockerfile")return es;if(a==="makefile")return ye;switch(l){case"js":case"jsx":case"ts":case"tsx":return Pe;case"py":return Le;case"rs":return rs;case"go":case"java":case"c":case"cpp":case"h":case"hpp":case"swift":case"kt":case"rb":case"php":return Ee;case"md":case"mdx":return _e;case"json":return se;case"html":case"htm":return as;case"css":case"scss":case"less":return ns;case"zip":case"tar":case"gz":case"rar":case"7z":case"tgz":return ts;case"txt":case"log":return Me;case"pdf":return ce;case"csv":return he;case"xml":return xe;case"sql":return me;case"xlsx":case"xls":return fe;case"pptx":case"ppt":return ge;case"docx":case"doc":return je;case"yaml":case"yml":case"toml":case"ini":case"conf":case"cfg":return ss;case"sh":case"bash":case"zsh":return ye;default:return Te}}function it(s){return s?s.startsWith("image/"):!1}function ot(s){return s?s.startsWith("video/"):!1}function ct(s){return s?s.startsWith("audio/"):!1}function Xe(s,t){var B,y;if(!s&&!t)return!1;if(s&&["text/plain","text/html","text/css","text/javascript","text/csv","text/markdown","text/typescript","text/x-python","text/x-go","text/x-rust","text/x-java","application/json","application/javascript","application/xml","application/sql","application/x-yaml","application/toml"].some(b=>s.includes(b)))return!0;const a=(B=t.split(".").pop())==null?void 0:B.toLowerCase(),p=((y=t.split("/").pop())==null?void 0:y.toLowerCase())||"";return["dockerfile","makefile","gemfile","rakefile","procfile"].includes(p)?!0:a?["txt","md","mdx","json","js","jsx","ts","tsx","py","go","rs","java","c","cpp","h","hpp","css","scss","less","html","htm","xml","yaml","yml","toml","ini","cfg","conf","sh","bash","zsh","sql","graphql","vue","svelte","astro","rb","php","swift","kt","gradle","env","gitignore","log","csv","tsv","properties"].includes(a):!1}function dt(s){if(s===0)return"0 B";const t=1024,l=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,a)).toFixed(2))+" "+l[a]}function Ye(s){return new Date(s).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function ut({file:s,bucket:t,onClose:l,onDownload:a,onDelete:p,onCopyUrl:c}){const[j,B]=o.useState(null),[y,b]=o.useState(null),[m,f]=o.useState(!1),v=lt(s),z=s.name.split("/").pop()||s.name,F=s.content_type||"Unknown";o.useEffect(()=>{if(t){const O=T.downloadObjectUrl(t.id,s.name);B(O),Xe(s.content_type,s.name)?(f(!0),fetch(O).then(i=>i.text()).then(i=>{b(i.slice(0,1e4))}).catch(()=>b(null)).finally(()=>f(!1))):b(null)}},[s,t]);const h=()=>{if(it(s.content_type)&&j)return e.jsx(C,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:16,display:"flex",alignItems:"center",justifyContent:"center",minHeight:200},children:e.jsx(Ds,{src:j,alt:z,fit:"contain",style:{maxHeight:300},radius:"md"})});if(ot(s.content_type)&&j)return e.jsx(C,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",overflow:"hidden"},children:e.jsx("video",{src:j,controls:!0,style:{width:"100%",maxHeight:300}})});if(ct(s.content_type)&&j)return e.jsxs(C,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:24},children:[e.jsx(A,{mb:"md",children:e.jsx(we,{size:48,color:"var(--supabase-text-muted)"})}),e.jsx("audio",{src:j,controls:!0,style:{width:"100%"}})]});if(Xe(s.content_type,s.name)){if(m)return e.jsx(A,{py:"xl",children:e.jsx(be,{size:"sm"})});if(y)return e.jsx(le,{h:300,children:e.jsx(Ts,{block:!0,style:{backgroundColor:"var(--supabase-bg-surface)",fontSize:"0.75rem",lineHeight:1.5},children:y})})}return e.jsxs(C,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:48,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(v,{size:64,color:"var(--supabase-text-muted)",stroke:1}),e.jsx(g,{size:"sm",c:"dimmed",mt:"md",children:"Preview not available"})]})};return e.jsxs(C,{style:{width:320,minWidth:320,borderLeft:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)",flexShrink:0},children:[e.jsx(C,{px:"sm",py:"xs",style:{borderBottom:"1px solid var(--supabase-border)",minHeight:40,display:"flex",alignItems:"center"},children:e.jsx(M,{justify:"flex-end",style:{width:"100%"},children:e.jsx(Fs,{onClick:l})})}),e.jsx(le,{style:{flex:1},scrollbarSize:6,children:e.jsxs(C,{p:"md",children:[h(),e.jsxs(C,{mt:"lg",children:[e.jsx(g,{fw:600,size:"sm",style:{wordBreak:"break-word"},children:z}),e.jsxs(g,{size:"xs",c:"dimmed",mt:4,children:[F," - ",dt(s.size)]})]}),e.jsxs(N,{gap:"sm",mt:"lg",children:[e.jsxs(C,{children:[e.jsx(g,{size:"xs",c:"dimmed",children:"Added on"}),e.jsx(g,{size:"sm",children:s.created_at?Ye(s.created_at):"Unknown"})]}),e.jsxs(C,{children:[e.jsx(g,{size:"xs",c:"dimmed",children:"Last modified"}),e.jsx(g,{size:"sm",children:s.updated_at?Ye(s.updated_at):"Unknown"})]}),s.owner&&e.jsxs(C,{children:[e.jsx(g,{size:"xs",c:"dimmed",children:"Owner"}),e.jsx(g,{size:"sm",truncate:!0,children:s.owner})]})]}),e.jsx(Y,{my:"lg"}),e.jsxs(N,{gap:"xs",children:[e.jsx(_,{variant:"outline",leftSection:e.jsx(Oe,{size:16}),onClick:a,fullWidth:!0,children:"Download"}),e.jsxs(I,{position:"bottom-end",width:200,children:[e.jsx(I.Target,{children:e.jsx(_,{variant:"outline",leftSection:e.jsx(pe,{size:16}),rightSection:e.jsx(Us,{size:14}),fullWidth:!0,children:"Get URL"})}),e.jsxs(I.Dropdown,{children:[t.public&&e.jsx(I.Item,{leftSection:e.jsx(pe,{size:14}),onClick:()=>c("public"),children:"Copy public URL"}),e.jsx(I.Item,{leftSection:e.jsx(pe,{size:14}),onClick:()=>c("signed"),children:"Copy signed URL (1 hour)"}),e.jsx(I.Item,{leftSection:e.jsx(As,{size:14}),onClick:()=>{const O=t.public?`${window.location.origin}${T.getPublicUrl(t.id,s.name)}`:T.downloadObjectUrl(t.id,s.name);window.open(O,"_blank")},children:"Open in new tab"})]})]}),e.jsx(Y,{my:"xs"}),e.jsx(_,{variant:"subtle",color:"red",leftSection:e.jsx(ke,{size:16}),onClick:p,fullWidth:!0,children:"Delete file"})]})]})})]})}function pt({bucketName:s,currentPath:t,viewMode:l,onRefresh:a,onUpload:p,onCreateFolder:c,onDeleteBucket:j,onEditBucket:B,onViewModeChange:y,onSearch:b,onNavigateToPath:m,uploadLoading:f}){const[v,z]=o.useState(!1),[F,h]=o.useState(""),O=t?t.split("/").filter(Boolean):[],i=()=>{F.trim()&&b(F.trim()),z(!1),h("")};return e.jsxs(C,{px:"sm",py:"xs",style:{borderBottom:"1px solid var(--supabase-border)",backgroundColor:"var(--supabase-bg)",minHeight:48,display:"flex",alignItems:"center"},children:[e.jsxs(M,{justify:"space-between",style:{flex:1},children:[e.jsxs(Ms,{children:[e.jsx(Ve,{size:"sm",onClick:()=>m(""),style:{cursor:"pointer"},children:s}),O.map((d,x)=>e.jsx(Ve,{size:"sm",onClick:()=>{const r=O.slice(0,x+1).join("/");m(r)},style:{cursor:"pointer"},children:d},x))]}),e.jsxs(M,{gap:"sm",children:[e.jsx(ze,{label:"Reload",children:e.jsx(V,{variant:"subtle",onClick:a,children:e.jsx($s,{size:18})})}),e.jsxs(I,{position:"bottom-end",width:160,children:[e.jsx(I.Target,{children:e.jsx(ze,{label:"View",children:e.jsx(V,{variant:"subtle",children:l==="columns"?e.jsx(Je,{size:18}):e.jsx(Qe,{size:18})})})}),e.jsxs(I.Dropdown,{children:[e.jsx(I.Item,{leftSection:e.jsx(Je,{size:14}),onClick:()=>y("columns"),style:{backgroundColor:l==="columns"?"var(--supabase-brand-light)":void 0},children:"Column view"}),e.jsx(I.Item,{leftSection:e.jsx(Qe,{size:14}),onClick:()=>y("list"),style:{backgroundColor:l==="list"?"var(--supabase-brand-light)":void 0},children:"List view"})]})]}),e.jsx(_,{variant:"outline",leftSection:e.jsx(Ns,{size:16}),onClick:p,loading:f,size:"sm",children:"Upload files"}),e.jsx(_,{variant:"outline",leftSection:e.jsx(qs,{size:16}),onClick:c,size:"sm",children:"Create folder"}),e.jsx(ze,{label:"Search",children:e.jsx(V,{variant:"subtle",onClick:()=>z(!0),children:e.jsx(Hs,{size:18})})}),e.jsxs(I,{position:"bottom-end",children:[e.jsx(I.Target,{children:e.jsx(V,{variant:"subtle",children:e.jsx(ls,{size:18})})}),e.jsxs(I.Dropdown,{children:[e.jsx(I.Item,{leftSection:e.jsx(Vs,{size:14}),onClick:B,children:"Bucket settings"}),e.jsx(I.Divider,{}),e.jsx(I.Item,{color:"red",leftSection:e.jsx(ke,{size:14}),onClick:j,children:"Delete bucket"})]})]})]})]}),e.jsxs(ie,{opened:v,onClose:()=>{z(!1),h("")},title:"Search files",size:"md",children:[e.jsx(oe,{placeholder:"Search by file name...",value:F,onChange:d=>h(d.target.value),onKeyDown:d=>{d.key==="Enter"&&i()},autoFocus:!0}),e.jsxs(M,{justify:"flex-end",mt:"md",children:[e.jsx(_,{variant:"outline",onClick:()=>z(!1),children:"Cancel"}),e.jsx(_,{onClick:i,children:"Search"})]})]})]})}const ht=[{value:"image/*",label:"All images (image/*)"},{value:"video/*",label:"All videos (video/*)"},{value:"audio/*",label:"All audio (audio/*)"},{value:"application/pdf",label:"PDF documents"},{value:"text/*",label:"All text files (text/*)"},{value:"application/json",label:"JSON files"},{value:"application/zip",label:"ZIP archives"},{value:"*/*",label:"All file types (*/*) "}],xt=[{value:1024*1024,label:"1 MB"},{value:5*1024*1024,label:"5 MB"},{value:10*1024*1024,label:"10 MB"},{value:50*1024*1024,label:"50 MB"},{value:100*1024*1024,label:"100 MB"},{value:500*1024*1024,label:"500 MB"}];function mt({bucket:s,opened:t,onClose:l,onSave:a}){const[p,c]=o.useState(!1),[j,B]=o.useState(null),[y,b]=o.useState(!0),[m,f]=o.useState([]),[v,z]=o.useState(!1);o.useEffect(()=>{s&&(c(s.public),B(s.file_size_limit||null),b(!s.file_size_limit),f(s.allowed_mime_types||[]))},[s]);const F=async()=>{if(s){z(!0);try{await T.updateBucket(s.id,{public:p,file_size_limit:y?void 0:j||void 0,allowed_mime_types:m.length>0?m:void 0}),S.show({title:"Success",message:"Bucket settings updated",color:"green"}),a(),l()}catch(h){S.show({title:"Error",message:h.message||"Failed to update bucket",color:"red"})}finally{z(!1)}}};return s?e.jsx(ie,{opened:t,onClose:l,title:"Edit Bucket Settings",size:"md",children:e.jsxs(N,{gap:"md",children:[e.jsx(oe,{label:"Bucket name",value:s.name,disabled:!0,description:"Bucket name cannot be changed after creation"}),e.jsx(Y,{my:"xs"}),e.jsx(Be,{label:"Public bucket",description:"Allow public access to files without authentication",checked:p,onChange:h=>c(h.currentTarget.checked)}),e.jsx(Y,{my:"xs"}),e.jsxs(N,{gap:"xs",children:[e.jsx(g,{size:"sm",fw:500,children:"File size limit"}),e.jsx(Be,{label:"No limit",checked:y,onChange:h=>b(h.currentTarget.checked)}),!y&&e.jsx(_s,{placeholder:"Max file size in bytes",value:j||"",onChange:h=>B(h),min:1024,step:1024*1024,suffix:" bytes",description:j?`Approximately ${ft(j)}`:"Enter maximum file size"}),!y&&e.jsx(M,{gap:"xs",children:xt.map(h=>e.jsx(_,{size:"xs",variant:j===h.value?"filled":"outline",onClick:()=>B(h.value),children:h.label},h.value))})]}),e.jsx(Y,{my:"xs"}),e.jsx(Es,{label:"Allowed MIME types",description:"Leave empty to allow all file types",placeholder:"Select or type MIME types",data:ht,value:m,onChange:f,searchable:!0,clearable:!0}),e.jsx(Y,{my:"md"}),e.jsxs(M,{justify:"flex-end",children:[e.jsx(_,{variant:"outline",onClick:l,children:"Cancel"}),e.jsx(_,{onClick:F,loading:v,children:"Save changes"})]})]})}):null}function ft(s){if(s===0)return"0 B";const t=1024,l=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,a)).toFixed(2))+" "+l[a]}function gt(s){var a;const t=s.content_type||"",l=(a=s.name.split(".").pop())==null?void 0:a.toLowerCase();if(t.startsWith("image/"))return Fe;if(t.startsWith("video/"))return De;if(t.startsWith("audio/"))return we;if(t==="application/pdf")return ce;if(t==="application/json")return se;switch(l){case"js":case"jsx":case"ts":case"tsx":return Pe;case"py":return Le;case"md":case"mdx":return _e;case"json":return se;case"go":case"java":case"c":case"cpp":return Ee;case"txt":case"log":return Me;default:return Te}}function Ie(s){return s.name.endsWith("/")||!s.content_type}function jt(s){if(s===0)return"-";const t=1024,l=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,a)).toFixed(2))+" "+l[a]}function yt(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function bt({items:s,loading:t,error:l,selectedItems:a,onItemSelect:p,onItemCheck:c,onSelectAll:j,onDownload:B,onCopyUrl:y,onRename:b,onDelete:m}){const[f,v]=o.useState("name"),[z,F]=o.useState("asc"),h=r=>{f===r?F(u=>u==="asc"?"desc":"asc"):(v(r),F("asc"))},O=o.useMemo(()=>[...s].sort((r,u)=>{const R=Ie(r),P=Ie(u);if(R&&!P)return-1;if(!R&&P)return 1;let W=0;switch(f){case"name":W=r.name.localeCompare(u.name);break;case"size":W=r.size-u.size;break;case"type":W=(r.content_type||"").localeCompare(u.content_type||"");break;case"updated_at":W=new Date(r.updated_at).getTime()-new Date(u.updated_at).getTime();break}return z==="asc"?W:-W}),[s,f,z]),i=s.length>0&&a.size===s.length,d=a.size>0&&a.size<s.length,x=z==="asc"?Gs:Ks;return t?e.jsx(A,{style:{flex:1},py:"xl",children:e.jsx(be,{size:"md"})}):l?e.jsx(A,{style:{flex:1},py:"xl",children:e.jsx(g,{c:"red",children:l})}):s.length===0?e.jsx(A,{style:{flex:1},py:"xl",children:e.jsx(g,{c:"dimmed",children:"No files in this folder"})}):e.jsx(le,{style:{flex:1},children:e.jsxs(L,{striped:!0,highlightOnHover:!0,children:[e.jsx(L.Thead,{style:{backgroundColor:"var(--supabase-bg-surface)",position:"sticky",top:0,zIndex:1},children:e.jsxs(L.Tr,{children:[e.jsx(L.Th,{style:{width:40},children:e.jsx(Ge,{checked:i,indeterminate:d,onChange:r=>j(r.currentTarget.checked),"aria-label":"Select all"})}),e.jsx(L.Th,{style:{cursor:"pointer"},onClick:()=>h("name"),children:e.jsxs(M,{gap:"xs",children:["Name",f==="name"&&e.jsx(x,{size:14})]})}),e.jsx(L.Th,{style:{cursor:"pointer",width:100},onClick:()=>h("size"),children:e.jsxs(M,{gap:"xs",children:["Size",f==="size"&&e.jsx(x,{size:14})]})}),e.jsx(L.Th,{style:{cursor:"pointer",width:150},onClick:()=>h("type"),children:e.jsxs(M,{gap:"xs",children:["Type",f==="type"&&e.jsx(x,{size:14})]})}),e.jsx(L.Th,{style:{cursor:"pointer",width:130},onClick:()=>h("updated_at"),children:e.jsxs(M,{gap:"xs",children:["Modified",f==="updated_at"&&e.jsx(x,{size:14})]})}),e.jsx(L.Th,{style:{width:50}})]})}),e.jsx(L.Tbody,{children:O.map(r=>{const u=Ie(r),R=u?ee:gt(r),P=r.name.split("/").filter(Boolean).pop()||r.name,W=a.has(r.id||r.name);return e.jsxs(L.Tr,{style:{backgroundColor:W?"var(--supabase-brand-light)":void 0,cursor:"pointer"},onClick:()=>p(r),children:[e.jsx(L.Td,{onClick:G=>G.stopPropagation(),children:e.jsx(Ge,{checked:W,onChange:G=>c(r,G.currentTarget.checked),"aria-label":`Select ${P}`})}),e.jsx(L.Td,{children:e.jsxs(M,{gap:"xs",children:[e.jsx(R,{size:18,color:u?"var(--supabase-brand)":"var(--supabase-text-muted)",stroke:1.5}),e.jsx(g,{size:"sm",children:P})]})}),e.jsx(L.Td,{children:e.jsx(g,{size:"sm",c:"dimmed",children:u?"-":jt(r.size)})}),e.jsx(L.Td,{children:e.jsx(g,{size:"sm",c:"dimmed",truncate:!0,style:{maxWidth:130},children:u?"folder":r.content_type||"Unknown"})}),e.jsx(L.Td,{children:e.jsx(g,{size:"sm",c:"dimmed",children:r.updated_at?yt(r.updated_at):"-"})}),e.jsx(L.Td,{onClick:G=>G.stopPropagation(),children:e.jsxs(I,{position:"bottom-end",children:[e.jsx(I.Target,{children:e.jsx(V,{variant:"subtle",size:"sm",children:e.jsx(ls,{size:16})})}),e.jsxs(I.Dropdown,{children:[!u&&e.jsxs(e.Fragment,{children:[e.jsx(I.Item,{leftSection:e.jsx(Oe,{size:14}),onClick:()=>B(r),children:"Download"}),e.jsx(I.Item,{leftSection:e.jsx(pe,{size:14}),onClick:()=>y(r),children:"Copy URL"}),e.jsx(I.Divider,{})]}),e.jsx(I.Item,{leftSection:e.jsx(Zs,{size:14}),onClick:()=>b(r),children:"Rename"}),e.jsx(I.Item,{leftSection:e.jsx(ke,{size:14}),color:"red",onClick:()=>m(r),children:"Delete"})]})]})})]},r.id||r.name)})})]})})}function wt({opened:s,item:t,bucketId:l,onClose:a,onRename:p}){const[c,j]=o.useState(""),[B,y]=o.useState(!1);o.useEffect(()=>{if(t){const v=t.name.split("/").filter(Boolean).pop()||t.name;j(v)}},[t]);const b=async()=>{if(!t||!l||!c.trim())return;if(c.includes("/")){S.show({title:"Invalid name",message:"File name cannot contain slashes",color:"red"});return}const v=t.name.split("/");v.pop();const z=v.length>0?`${v.join("/")}/${c.trim()}`:c.trim();if(t.name===z){a();return}y(!0);try{await T.renameObject(l,t.name,z),S.show({title:"Success",message:"File renamed successfully",color:"green"}),p(),a()}catch(F){S.show({title:"Error",message:F.message||"Failed to rename file",color:"red"})}finally{y(!1)}},m=(t==null?void 0:t.name.endsWith("/"))||!(t!=null&&t.content_type),f=(t==null?void 0:t.name.split("/").filter(Boolean).pop())||"";return e.jsx(ie,{opened:s,onClose:a,title:`Rename ${m?"folder":"file"}`,size:"md",children:e.jsxs(N,{gap:"md",children:[e.jsxs(g,{size:"sm",c:"dimmed",children:["Current name: ",e.jsx("strong",{children:f})]}),e.jsx(oe,{label:"New name",placeholder:"Enter new name",value:c,onChange:v=>j(v.target.value),onKeyDown:v=>{v.key==="Enter"&&b()},autoFocus:!0}),e.jsxs(M,{justify:"flex-end",mt:"md",children:[e.jsx(_,{variant:"outline",onClick:a,children:"Cancel"}),e.jsx(_,{onClick:b,loading:B,disabled:!c.trim()||c===f,children:"Rename"})]})]})})}function kt({selectedCount:s,onClearSelection:t,onDelete:l,onDownload:a,onMove:p,onCopy:c}){return s===0?null:e.jsxs(C,{px:"md",py:"xs",style:{backgroundColor:"var(--supabase-brand-light)",borderBottom:"1px solid var(--supabase-border)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(M,{gap:"sm",children:[e.jsx(V,{variant:"subtle",onClick:t,size:"sm",children:e.jsx(Js,{size:16})}),e.jsxs(g,{size:"sm",fw:500,children:[s," item",s>1?"s":""," selected"]})]}),e.jsxs(M,{gap:"xs",children:[e.jsx(_,{variant:"outline",size:"xs",leftSection:e.jsx(Oe,{size:14}),onClick:a,children:"Download"}),e.jsx(_,{variant:"outline",size:"xs",leftSection:e.jsx(Qs,{size:14}),onClick:p,children:"Move"}),e.jsx(_,{variant:"outline",size:"xs",leftSection:e.jsx(Xs,{size:14}),onClick:c,children:"Copy"}),e.jsx(_,{variant:"outline",size:"xs",color:"red",leftSection:e.jsx(ke,{size:14}),onClick:l,children:"Delete"})]})]})}function Ct({bucketId:s,onFileSelect:t}){const[l,a]=o.useState([]),[p,c]=o.useState(null),[j,B]=o.useState(!1),y=o.useCallback(i=>i.name.endsWith("/")||!i.content_type,[]),b=o.useCallback(async i=>{if(!s)return[];try{return await T.listObjects(s,{prefix:i,limit:100})}catch(d){return console.error("Failed to fetch column items:",d),[]}},[s]);o.useEffect(()=>{(async()=>{if(!s){a([]),c(null);return}B(!0);try{const d=await b("");a([{path:"",items:d,selectedItem:null,loading:!1,error:null}]),c(null)}catch(d){a([{path:"",items:[],selectedItem:null,loading:!1,error:d.message||"Failed to load items"}])}finally{B(!1)}})()},[s,b]),o.useEffect(()=>{t==null||t(p)},[p,t]);const m=o.useCallback(async(i,d)=>{if(s){a(x=>{const r=x.slice(0,d+1);return r[d]&&(r[d]={...r[d],selectedItem:i}),r.push({path:i,items:[],selectedItem:null,loading:!0,error:null}),r}),c(null);try{const x=await b(i);a(r=>{var R;const u=r.length-1;if(((R=r[u])==null?void 0:R.path)===i){const P=[...r];return P[u]={...P[u],items:x,loading:!1},P}return r})}catch(x){a(r=>{var R;const u=r.length-1;if(((R=r[u])==null?void 0:R.path)===i){const P=[...r];return P[u]={...P[u],loading:!1,error:x.message||"Failed to load items"},P}return r})}}},[s,b]),f=o.useCallback((i,d)=>{if(y(i)){const x=i.name.replace(/\/$/,"");m(x,d)}else a(x=>{const r=x.slice(0,d+1);return r[d]&&(r[d]={...r[d],selectedItem:i.name}),r}),c(i)},[y,m]),v=o.useCallback(i=>{i!==0&&(a(d=>{const x=d.slice(0,i);if(x.length>0){const r=x.length-1;x[r]={...x[r],selectedItem:null}}return x}),c(null))},[]),z=o.useCallback(async i=>{if(!s||!l[i])return;const d=l[i];a(x=>{const r=[...x];return r[i]={...r[i],loading:!0,error:null},r});try{const x=await b(d.path);a(r=>{const u=[...r];return u[i]&&(u[i]={...u[i],items:x,loading:!1}),u})}catch(x){a(r=>{const u=[...r];return u[i]&&(u[i]={...u[i],loading:!1,error:x.message||"Failed to refresh"}),u})}},[s,l,b]),F=o.useCallback(()=>{l.forEach((i,d)=>{z(d)})},[l,z]),h=o.useCallback(()=>{c(null),a(i=>i.map(d=>({...d,selectedItem:null})))},[]),O=l.length>1?l[l.length-1].path:"";return{columns:l,selectedFile:p,loading:j,navigateToFolder:m,selectItem:f,navigateBack:v,refreshColumn:z,refreshAll:F,clearSelection:h,currentPath:O}}function Et(){var Ne,qe,He;const{selectedBucket:s,setSelectedBucket:t}=Os(),[l,a]=o.useState([]),[p,c]=o.useState(!0),[j,B]=o.useState(!1),[y,b]=o.useState("columns"),[m,{open:f,close:v}]=X(!1),[z,{open:F,close:h}]=X(!1),[O,{open:i,close:d}]=X(!1),[x,{open:r,close:u}]=X(!1),[R,{open:P,close:W}]=X(!1),[G,{open:is,close:os}]=X(!1),[cs,{open:ds,close:Re}]=X(!1),[K,Ce]=o.useState({name:"",public:!1}),[de,We]=o.useState(""),[te,$]=o.useState(!1),[us,ve]=o.useState(null),[Z,ne]=o.useState(new Set),J=o.useRef(null),{columns:D,selectedFile:q,navigateToFolder:ps,selectItem:Ue,navigateBack:hs,refreshAll:Q,clearSelection:ue,currentPath:ae}=Ct({bucketId:s}),re=o.useCallback(async()=>{c(!0);try{const n=await T.listBuckets();a(n),n.length>0&&!s&&t(n[0].id)}catch(n){S.show({title:"Error",message:n.message||"Failed to load buckets",color:"red"})}finally{c(!1)}},[s,t]);o.useEffect(()=>{re()},[re]);const xs=async()=>{if(!K.name){S.show({title:"Validation Error",message:"Bucket name is required",color:"red"});return}$(!0);try{await T.createBucket({name:K.name,public:K.public}),S.show({title:"Success",message:"Bucket created successfully",color:"green"}),v(),Ce({name:"",public:!1}),re()}catch(n){S.show({title:"Error",message:n.message||"Failed to create bucket",color:"red"})}finally{$(!1)}},ms=async()=>{if(s){$(!0);try{await T.deleteBucket(s),S.show({title:"Success",message:"Bucket deleted successfully",color:"green"}),h(),t(null),re()}catch(n){S.show({title:"Error",message:n.message||"Failed to delete bucket",color:"red"})}finally{$(!1)}}},fs=async n=>{if(!(!s||n.length===0)){B(!0);try{for(const w of n){const E=ae?`${ae}/${w.name}`:w.name;await T.uploadObject(s,E,w)}S.show({title:"Success",message:`${n.length} file(s) uploaded successfully`,color:"green"}),Q()}catch(w){S.show({title:"Error",message:w.message||"Failed to upload files",color:"red"})}finally{B(!1)}}},gs=async()=>{if(!(!s||!q)){$(!0);try{await T.deleteObject(s,q.name),S.show({title:"Success",message:"File deleted successfully",color:"green"}),d(),ue(),Q()}catch(n){S.show({title:"Error",message:n.message||"Failed to delete file",color:"red"})}finally{$(!1)}}},js=async()=>{if(!s||!de.trim()){S.show({title:"Validation Error",message:"Folder name is required",color:"red"});return}$(!0);try{const n=ae?`${ae}/${de.trim()}/.keep`:`${de.trim()}/.keep`,w=new File([""],".keep",{type:"text/plain"});await T.uploadObject(s,n,w),S.show({title:"Success",message:"Folder created successfully",color:"green"}),u(),We(""),Q()}catch(n){S.show({title:"Error",message:n.message||"Failed to create folder",color:"red"})}finally{$(!1)}},Ae=n=>{if(!s)return;const w=T.downloadObjectUrl(s,n.name);window.open(w,"_blank")},$e=async(n,w)=>{if(!s)return;const E=l.find(U=>U.id===s);let k;if(w==="public"&&(E!=null&&E.public))k=`${window.location.origin}${T.getPublicUrl(s,n.name)}`;else try{k=(await T.createSignedUrl(s,n.name,3600)).signedURL}catch{k=T.downloadObjectUrl(s,n.name)}navigator.clipboard.writeText(k),S.show({title:"Copied",message:"URL copied to clipboard",color:"green"})},ys=async n=>{if(s)try{const w=await T.listObjects(s,{prefix:"",search:n,limit:100});S.show({title:"Search Results",message:`Found ${w.length} matching files`,color:"blue"})}catch(w){S.show({title:"Search Error",message:w.message||"Failed to search files",color:"red"})}},bs=n=>{if(n==="")Q();else{const w=n.split("/");if(D.findIndex(k=>k.path===n)>=0)ue();else{const k=w.slice(0,-1).join("/"),U=D.findIndex(Is=>Is.path===k);U>=0&&ps(n,U)}}},ws=(n,w)=>{ne(E=>{const k=new Set(E),U=n.id||n.name;return w?k.add(U):k.delete(U),k})},ks=n=>{if(!D.length)return;const w=D[D.length-1].items;ne(n?new Set(w.map(E=>E.id||E.name)):new Set)},Cs=()=>{ne(new Set)},vs=n=>{ve(n),is()},zs=async()=>{var n;if(!(!s||Z.size===0)){$(!0);try{const E=(((n=D[D.length-1])==null?void 0:n.items)||[]).filter(k=>Z.has(k.id||k.name));for(const k of E)k.name.endsWith("/")||!k.content_type?await T.deleteFolder(s,k.name):await T.deleteObject(s,k.name);S.show({title:"Success",message:`Deleted ${E.length} item(s)`,color:"green"}),Re(),ne(new Set),Q()}catch(w){S.show({title:"Error",message:w.message||"Failed to delete items",color:"red"})}finally{$(!1)}}},Ss=()=>{var E;if(!s)return;const w=(((E=D[D.length-1])==null?void 0:E.items)||[]).filter(k=>Z.has(k.id||k.name)&&k.content_type);for(const k of w){const U=T.downloadObjectUrl(s,k.name);window.open(U,"_blank")}},H=l.find(n=>n.id===s);return e.jsxs(Ps,{title:"Storage",description:"Manage files and buckets",fullWidth:!0,noPadding:!0,children:[e.jsxs(C,{style:{display:"flex",height:"calc(100vh - 140px)"},children:[e.jsxs(C,{style:{width:240,borderRight:"1px solid var(--lb-border-default)",display:"flex",flexDirection:"column",backgroundColor:"var(--lb-bg-primary)",flexShrink:0},children:[e.jsx(C,{px:"md",pt:"md",children:e.jsx(g,{size:"xs",fw:600,tt:"uppercase",style:{letterSpacing:"0.05em",fontSize:"0.6875rem",color:"var(--lb-text-secondary)"},children:"Manage"})}),e.jsx(C,{p:"xs",children:e.jsx(N,{gap:2,children:e.jsx(Ke,{p:"xs",style:{cursor:"pointer",backgroundColor:"var(--lb-brand-light)",borderRadius:"var(--lb-radius-md)"},children:e.jsxs(M,{gap:"xs",children:[e.jsx(ee,{size:16,color:"var(--lb-brand)"}),e.jsx(g,{size:"sm",fw:500,children:"Files"})]})})})}),e.jsx(Y,{mx:"md",my:"xs"}),e.jsx(C,{px:"md",pt:"xs",children:e.jsxs(M,{justify:"space-between",mb:"xs",children:[e.jsx(g,{size:"xs",style:{color:"var(--lb-text-secondary)"},children:"Buckets"}),e.jsx(V,{variant:"subtle",onClick:f,size:"sm",children:e.jsx(Ys,{size:14})})]})}),e.jsx(C,{style:{flex:1,overflow:"auto"},px:"xs",pb:"sm",children:p?e.jsx(A,{py:"xl",children:e.jsx(be,{size:"sm"})}):l.length===0?e.jsx(g,{size:"sm",ta:"center",py:"xl",style:{color:"var(--lb-text-secondary)"},children:"No buckets yet"}):e.jsx(N,{gap:2,children:l.map(n=>e.jsx(Ke,{p:"xs",style:{cursor:"pointer",backgroundColor:s===n.id?"var(--lb-bg-tertiary)":"transparent",borderRadius:"var(--lb-radius-md)",transition:"var(--lb-transition-fast)"},onClick:()=>{t(n.id),ue()},children:e.jsxs(M,{justify:"space-between",wrap:"nowrap",children:[e.jsxs(M,{gap:"xs",wrap:"nowrap",children:[e.jsx(ee,{size:16,color:"var(--lb-text-muted)"}),e.jsx(g,{size:"sm",truncate:!0,style:{maxWidth:120},children:n.name})]}),e.jsx(et,{isPublic:n.public})]})},n.id))})})]}),e.jsx(C,{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:s&&H?e.jsxs(e.Fragment,{children:[Z.size>0&&e.jsx(kt,{selectedCount:Z.size,onClearSelection:Cs,onDelete:ds,onDownload:Ss,onMove:()=>{S.show({title:"Coming soon",message:"Move functionality will be available soon",color:"blue"})},onCopy:()=>{S.show({title:"Coming soon",message:"Copy functionality will be available soon",color:"blue"})}}),e.jsx(pt,{bucketName:H.name,currentPath:ae,viewMode:y,onRefresh:Q,onUpload:()=>{var n;return(n=J.current)==null?void 0:n.call(J)},onCreateFolder:r,onDeleteBucket:F,onEditBucket:P,onViewModeChange:b,onSearch:ys,onNavigateToPath:bs,uploadLoading:j}),e.jsxs(C,{style:{flex:1,display:"flex",overflow:"hidden"},children:[e.jsx(Ls,{onDrop:fs,openRef:J,activateOnClick:!1,styles:{root:{border:"none",backgroundColor:"transparent",flex:1,display:"flex",minWidth:0,padding:0,pointerEvents:"auto"},inner:{pointerEvents:"none",display:"flex",flex:1,padding:0,minWidth:0}},children:D.length===0||D.length===1&&D[0].items.length===0&&!D[0].loading?e.jsx(A,{style:{flex:1,pointerEvents:"auto"},children:e.jsx(Ze,{icon:e.jsx(ee,{size:32}),title:"No files",description:"Upload files or create a folder to get started",action:{label:"Upload files",onClick:()=>{var n;return(n=J.current)==null?void 0:n.call(J)}}})}):y==="list"?e.jsx(bt,{items:((Ne=D[D.length-1])==null?void 0:Ne.items)||[],loading:((qe=D[D.length-1])==null?void 0:qe.loading)||!1,error:((He=D[D.length-1])==null?void 0:He.error)||null,selectedItems:Z,onItemSelect:n=>Ue(n,D.length-1),onItemCheck:ws,onSelectAll:ks,onDownload:Ae,onCopyUrl:n=>$e(n,"signed"),onRename:vs,onDelete:n=>{ve(n),i()}}):e.jsx(rt,{columns:D,onItemSelect:Ue,onBack:hs})}),q&&H&&e.jsx(ut,{file:q,bucket:H,onClose:ue,onDownload:()=>Ae(q),onDelete:i,onCopyUrl:n=>$e(q,n)})]})]}):e.jsx(A,{style:{flex:1},children:e.jsx(Ze,{icon:e.jsx(ee,{size:32}),title:"Select a bucket",description:"Choose a bucket from the sidebar or create a new one",action:{label:"Create bucket",onClick:f}})})})]}),e.jsx(ie,{opened:m,onClose:v,title:"Create bucket",size:"md",children:e.jsxs(N,{gap:"md",children:[e.jsx(oe,{label:"Name",placeholder:"my-bucket",value:K.name,onChange:n=>Ce({...K,name:n.target.value}),required:!0}),e.jsx(Be,{label:"Public bucket",description:"Allow public access to files without authentication",checked:K.public,onChange:n=>Ce({...K,public:n.target.checked})}),e.jsxs(M,{justify:"flex-end",mt:"md",children:[e.jsx(_,{variant:"outline",onClick:v,children:"Cancel"}),e.jsx(_,{onClick:xs,loading:te,children:"Create bucket"})]})]})}),e.jsx(ie,{opened:x,onClose:u,title:"Create folder",size:"md",children:e.jsxs(N,{gap:"md",children:[e.jsx(oe,{label:"Folder name",placeholder:"my-folder",value:de,onChange:n=>We(n.target.value),required:!0}),e.jsxs(M,{justify:"flex-end",mt:"md",children:[e.jsx(_,{variant:"outline",onClick:u,children:"Cancel"}),e.jsx(_,{onClick:js,loading:te,children:"Create folder"})]})]})}),e.jsx(Se,{opened:z,onClose:h,onConfirm:ms,title:"Delete bucket",message:`Are you sure you want to delete "${H==null?void 0:H.name}"? All files in this bucket will be permanently deleted.`,confirmLabel:"Delete",danger:!0,loading:te}),e.jsx(Se,{opened:O,onClose:d,onConfirm:gs,title:"Delete file",message:`Are you sure you want to delete "${q==null?void 0:q.name.split("/").pop()}"?`,confirmLabel:"Delete",danger:!0,loading:te}),e.jsx(mt,{bucket:H||null,opened:R,onClose:W,onSave:re}),e.jsx(wt,{opened:G,item:us,bucketId:s,onClose:()=>{os(),ve(null)},onRename:Q}),e.jsx(Se,{opened:cs,onClose:Re,onConfirm:zs,title:"Delete selected items",message:`Are you sure you want to delete ${Z.size} item(s)? This action cannot be undone.`,confirmLabel:"Delete",danger:!0,loading:te})]})}export{Et as StoragePage};
