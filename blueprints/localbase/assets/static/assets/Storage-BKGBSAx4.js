import{h as M,y as d,j as e,B as a,T as i,S,q as X,G as p,D as J,A as k,O as _,Q as K,R as Oe,w as ie,d as q,e as b,M as m,V as Ee,f as ce,b as de,F as _e,W as Re,X as Te,Y as $e,Z as We}from"./vendor-mantine-C8lHRUHi.js";import{r as o}from"./vendor-react-CFPnf9wS.js";import{P as Ae}from"./PageContainer-Czy__zFQ.js";import{E as ue}from"./EmptyState-BPjdg75G.js";import{C as pe}from"./ConfirmModal-BSlXvWzg.js";import{P as Me}from"./StatusBadge-BrK_xGSF.js";import{s as x}from"./storage-DhEGvAq2.js";import{u as qe}from"./index-DZJ0JtLk.js";import{m as E,V as Ve,_ as He,$ as Ne,f as Ge,a0 as Ze,a1 as Xe,X as xe,Z as Q,a2 as ge,a3 as Y,a4 as Je,a5 as Ke,a6 as be,a7 as me,a8 as he,a9 as Qe,q as Ye,aa as es,ab as ss,ac as ts,ad as rs,ae as as,af as ns,ag as ls,w as os,B as is}from"./vendor-icons-rGG861t1.js";import"./client-CvoVCtJO.js";import"./vendor-state-Ud2phgVo.js";function ye(t){var c;const r=t.content_type||"",n=(c=t.name.split(".").pop())==null?void 0:c.toLowerCase();if(r.startsWith("image/"))return Je;if(r.startsWith("video/"))return Ke;if(r.startsWith("audio/"))return be;if(r==="application/pdf")return me;if(r==="application/json")return he;switch(n){case"js":case"jsx":case"ts":case"tsx":return ls;case"py":return ns;case"go":case"rs":case"java":case"c":case"cpp":case"h":return as;case"md":case"mdx":return rs;case"json":return he;case"html":case"htm":return ts;case"css":case"scss":case"less":return ss;case"zip":case"tar":case"gz":case"rar":case"7z":return es;case"txt":case"log":return Ye;case"pdf":return me;default:return Qe}}function cs(t){return t?t.startsWith("image/"):!1}function ds(t){return t?t.startsWith("video/"):!1}function us(t){return t?t.startsWith("audio/"):!1}function fe(t,r){var I;if(!t&&!r)return!1;if(t&&["text/plain","text/html","text/css","text/javascript","application/json","application/javascript","application/xml"].some(h=>t.includes(h)))return!0;const c=(I=r.split(".").pop())==null?void 0:I.toLowerCase();return c?["txt","md","mdx","json","js","jsx","ts","tsx","py","go","rs","java","c","cpp","h","hpp","css","scss","less","html","htm","xml","yaml","yml","toml","ini","cfg","conf","sh","bash","zsh","sql","graphql","vue","svelte","astro","rb","php","swift","kt","gradle","env","gitignore","dockerfile","makefile","log"].includes(c):!1}function we(t){if(t===0)return"0 B";const r=1024,n=["B","KB","MB","GB","TB"],c=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,c)).toFixed(2))+" "+n[c]}function je(t){return new Date(t).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function ps({file:t,bucket:r,onClose:n,onDownload:c,onDelete:C,onCopyUrl:I}){const[h,R]=o.useState(null),[T,P]=o.useState(null),[V,U]=o.useState(!1),H=ye(t),L=t.name.split("/").pop()||t.name,u=t.content_type||"Unknown";o.useEffect(()=>{if(r){const F=x.downloadObjectUrl(r.id,t.name);R(F),fe(t.content_type,t.name)&&(U(!0),fetch(F).then(B=>B.text()).then(B=>{P(B.slice(0,1e4))}).catch(()=>P(null)).finally(()=>U(!1)))}},[t,r]);const f=()=>{if(cs(t.content_type)&&h)return e.jsx(a,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:16,display:"flex",alignItems:"center",justifyContent:"center",minHeight:200},children:e.jsx(Te,{src:h,alt:L,fit:"contain",style:{maxHeight:300},radius:"md"})});if(ds(t.content_type)&&h)return e.jsx(a,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",overflow:"hidden"},children:e.jsx("video",{src:h,controls:!0,style:{width:"100%",maxHeight:300}})});if(us(t.content_type)&&h)return e.jsxs(a,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:24},children:[e.jsx(_,{mb:"md",children:e.jsx(be,{size:48,color:"var(--supabase-text-muted)"})}),e.jsx("audio",{src:h,controls:!0,style:{width:"100%"}})]});if(fe(t.content_type,t.name)){if(V)return e.jsx(_,{py:"xl",children:e.jsx(K,{size:"sm"})});if(T)return e.jsx($e,{h:300,children:e.jsx(We,{block:!0,style:{backgroundColor:"var(--supabase-bg-surface)",fontSize:"0.75rem",lineHeight:1.5},children:T})})}return e.jsxs(a,{style:{backgroundColor:"var(--supabase-bg-surface)",borderRadius:"var(--supabase-radius-lg)",padding:48,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(H,{size:64,color:"var(--supabase-text-muted)",stroke:1}),e.jsx(i,{size:"sm",c:"dimmed",mt:"md",children:"Preview not available"})]})};return e.jsxs(a,{style:{width:320,borderLeft:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)"},children:[e.jsx(a,{p:"md",style:{borderBottom:"1px solid var(--supabase-border)"},children:e.jsx(p,{justify:"flex-end",children:e.jsx(Re,{onClick:n})})}),e.jsxs(a,{p:"md",style:{flex:1,overflow:"auto"},children:[f(),e.jsxs(a,{mt:"lg",children:[e.jsx(i,{fw:600,size:"sm",style:{wordBreak:"break-word"},children:L}),e.jsxs(i,{size:"xs",c:"dimmed",mt:4,children:[u," - ",we(t.size)]})]}),e.jsxs(S,{gap:"sm",mt:"lg",children:[e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Added on"}),e.jsx(i,{size:"sm",children:t.created_at?je(t.created_at):"Unknown"})]}),e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Last modified"}),e.jsx(i,{size:"sm",children:t.updated_at?je(t.updated_at):"Unknown"})]}),t.owner&&e.jsxs(a,{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Owner"}),e.jsx(i,{size:"sm",truncate:!0,children:t.owner})]})]}),e.jsx(J,{my:"lg"}),e.jsxs(S,{gap:"xs",children:[e.jsx(b,{variant:"outline",leftSection:e.jsx(ge,{size:16}),onClick:c,fullWidth:!0,children:"Download"}),e.jsxs(m,{position:"bottom-end",width:200,children:[e.jsx(m.Target,{children:e.jsx(b,{variant:"outline",leftSection:e.jsx(Y,{size:16}),rightSection:e.jsx(os,{size:14}),fullWidth:!0,children:"Get URL"})}),e.jsxs(m.Dropdown,{children:[e.jsx(m.Item,{leftSection:e.jsx(Y,{size:14}),onClick:I,children:"Copy URL"}),r.public&&e.jsx(m.Item,{leftSection:e.jsx(is,{size:14}),onClick:()=>{const F=`${window.location.origin}${x.getPublicUrl(r.id,t.name)}`;window.open(F,"_blank")},children:"Open in new tab"})]})]}),e.jsx(J,{my:"xs"}),e.jsx(b,{variant:"subtle",color:"red",leftSection:e.jsx(Q,{size:16}),onClick:C,fullWidth:!0,children:"Delete file"})]})]})]})}function vs(){const{selectedBucket:t,setSelectedBucket:r,currentPath:n,setCurrentPath:c}=qe(),[C,I]=o.useState([]),[h,R]=o.useState([]),[T,P]=o.useState(!0),[V,U]=o.useState(!1),[H,L]=o.useState(!1),[u,f]=o.useState(null),[F,{open:B,close:N}]=M(!1),[ke,{open:Ce,close:ee}]=M(!1),[ve,{open:se,close:te}]=M(!1),[ze,{open:Se,close:G}]=M(!1),[v,Z]=o.useState({name:"",public:!1}),[$,re]=o.useState(""),[W,y]=o.useState(!1),z=o.useRef(null),A=o.useCallback(async()=>{P(!0);try{const s=await x.listBuckets();I(s),s.length>0&&!t&&r(s[0].id)}catch(s){d.show({title:"Error",message:s.message||"Failed to load buckets",color:"red"})}finally{P(!1)}},[t,r]),D=o.useCallback(async()=>{if(t){U(!0);try{const s=await x.listObjects(t,{prefix:n,limit:100});R(s)}catch(s){d.show({title:"Error",message:s.message||"Failed to load objects",color:"red"}),R([])}finally{U(!1)}}},[t,n]);o.useEffect(()=>{A()},[A]),o.useEffect(()=>{t&&(D(),f(null))},[t,n,D]);const Ie=async()=>{if(!v.name){d.show({title:"Validation Error",message:"Bucket name is required",color:"red"});return}y(!0);try{await x.createBucket({name:v.name,public:v.public}),d.show({title:"Success",message:"Bucket created successfully",color:"green"}),N(),Z({name:"",public:!1}),A()}catch(s){d.show({title:"Error",message:s.message||"Failed to create bucket",color:"red"})}finally{y(!1)}},Fe=async()=>{if(t){y(!0);try{await x.deleteBucket(t),d.show({title:"Success",message:"Bucket deleted successfully",color:"green"}),ee(),r(null),A()}catch(s){d.show({title:"Error",message:s.message||"Failed to delete bucket",color:"red"})}finally{y(!1)}}},Be=async s=>{if(!(!t||s.length===0)){L(!0);try{for(const l of s){const g=n?`${n}/${l.name}`:l.name;await x.uploadObject(t,g,l)}d.show({title:"Success",message:`${s.length} file(s) uploaded successfully`,color:"green"}),D()}catch(l){d.show({title:"Error",message:l.message||"Failed to upload files",color:"red"})}finally{L(!1)}}},De=async()=>{if(!(!t||!u)){y(!0);try{await x.deleteObject(t,u.name),d.show({title:"Success",message:"File deleted successfully",color:"green"}),te(),f(null),D()}catch(s){d.show({title:"Error",message:s.message||"Failed to delete file",color:"red"})}finally{y(!1)}}},Pe=async()=>{if(!t||!$.trim()){d.show({title:"Validation Error",message:"Folder name is required",color:"red"});return}y(!0);try{const s=n?`${n}/${$.trim()}/.keep`:`${$.trim()}/.keep`,l=new File([""],".keep",{type:"text/plain"});await x.uploadObject(t,s,l),d.show({title:"Success",message:"Folder created successfully",color:"green"}),G(),re(""),D()}catch(s){d.show({title:"Error",message:s.message||"Failed to create folder",color:"red"})}finally{y(!1)}},ae=s=>{if(!t)return;const l=x.downloadObjectUrl(t,s.name);window.open(l,"_blank")},ne=async s=>{if(!t)return;const l=C.find(j=>j.id===t);let g;if(l!=null&&l.public)g=`${window.location.origin}${x.getPublicUrl(t,s.name)}`;else try{g=(await x.createSignedUrl(t,s.name,3600)).signedURL}catch{g=x.downloadObjectUrl(t,s.name)}navigator.clipboard.writeText(g),d.show({title:"Copied",message:"URL copied to clipboard",color:"green"})},le=s=>{c(s),f(null)},Ue=()=>{if(!n)return;const s=n.split("/");s.pop(),c(s.join("/")),f(null)},oe=n?n.split("/"):[],w=C.find(s=>s.id===t),O=s=>s.name.endsWith("/")||!s.content_type,Le=s=>{O(s)?le(s.name.replace(/\/$/,"")):f(s)};return e.jsxs(Ae,{title:"Storage",description:"Manage files and buckets",fullWidth:!0,noPadding:!0,children:[e.jsxs(a,{style:{display:"flex",height:"calc(100vh - 140px)"},children:[e.jsxs(a,{style:{width:240,borderRight:"1px solid var(--supabase-border)",display:"flex",flexDirection:"column",backgroundColor:"var(--supabase-bg)"},children:[e.jsx(a,{px:"md",pt:"md",children:e.jsx(i,{size:"xs",fw:600,tt:"uppercase",c:"dimmed",style:{letterSpacing:"0.05em",fontSize:"0.6875rem"},children:"Manage"})}),e.jsx(a,{p:"xs",children:e.jsx(S,{gap:2,children:e.jsx(X,{p:"xs",style:{cursor:"pointer",backgroundColor:"var(--supabase-brand-light)",borderRadius:6},children:e.jsxs(p,{gap:"xs",children:[e.jsx(E,{size:16,color:"var(--supabase-brand)"}),e.jsx(i,{size:"sm",fw:500,children:"Files"})]})})})}),e.jsx(J,{mx:"md",my:"xs"}),e.jsx(a,{px:"md",pt:"xs",children:e.jsxs(p,{justify:"space-between",mb:"xs",children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Buckets"}),e.jsx(k,{variant:"subtle",onClick:B,size:"sm",children:e.jsx(Ve,{size:14})})]})}),e.jsx(a,{style:{flex:1,overflow:"auto"},px:"xs",pb:"sm",children:T?e.jsx(_,{py:"xl",children:e.jsx(K,{size:"sm"})}):C.length===0?e.jsx(i,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No buckets yet"}):e.jsx(S,{gap:2,children:C.map(s=>e.jsx(X,{p:"xs",style:{cursor:"pointer",backgroundColor:t===s.id?"var(--supabase-bg-surface)":"transparent",borderRadius:6},onClick:()=>{r(s.id),c(""),f(null)},children:e.jsxs(p,{justify:"space-between",wrap:"nowrap",children:[e.jsxs(p,{gap:"xs",wrap:"nowrap",children:[e.jsx(E,{size:16,color:"var(--supabase-text-muted)"}),e.jsx(i,{size:"sm",truncate:!0,style:{maxWidth:120},children:s.name})]}),e.jsx(Me,{isPublic:s.public})]})},s.id))})})]}),e.jsx(a,{style:{flex:1,display:"flex",flexDirection:"column"},children:t?e.jsxs(e.Fragment,{children:[e.jsx(a,{p:"md",style:{borderBottom:"1px solid var(--supabase-border)"},children:e.jsxs(p,{justify:"space-between",children:[e.jsxs(p,{gap:"xs",children:[n&&e.jsx(k,{variant:"subtle",onClick:Ue,children:e.jsx(He,{size:18})}),e.jsxs(Oe,{children:[e.jsx(ie,{size:"sm",onClick:()=>{c(""),f(null)},style:{cursor:"pointer"},children:(w==null?void 0:w.name)||t}),oe.map((s,l)=>e.jsx(ie,{size:"sm",onClick:()=>{le(oe.slice(0,l+1).join("/"))},style:{cursor:"pointer"},children:s},l))]})]}),e.jsxs(p,{gap:"sm",children:[e.jsx(q,{label:"Reload",children:e.jsx(k,{variant:"subtle",onClick:D,children:e.jsx(Ne,{size:18})})}),e.jsx(q,{label:"View",children:e.jsx(k,{variant:"subtle",children:e.jsx(Ge,{size:18})})}),e.jsx(b,{variant:"outline",leftSection:e.jsx(Ze,{size:16}),onClick:()=>{var s;return(s=z.current)==null?void 0:s.call(z)},loading:H,size:"sm",children:"Upload files"}),e.jsx(b,{variant:"outline",leftSection:e.jsx(Xe,{size:16}),onClick:Se,size:"sm",children:"Create folder"}),e.jsxs(m,{position:"bottom-end",children:[e.jsx(m.Target,{children:e.jsx(k,{variant:"subtle",children:e.jsx(xe,{size:18})})}),e.jsx(m.Dropdown,{children:e.jsx(m.Item,{color:"red",leftSection:e.jsx(Q,{size:14}),onClick:Ce,children:"Delete bucket"})})]})]})]})}),e.jsxs(a,{style:{flex:1,display:"flex"},children:[e.jsx(a,{style:{flex:1,overflow:"auto"},p:"md",children:e.jsx(Ee,{onDrop:Be,openRef:z,activateOnClick:!1,styles:{root:{border:"none",backgroundColor:"transparent",minHeight:"100%"}},children:V?e.jsx(_,{py:"xl",children:e.jsx(K,{size:"sm"})}):h.length===0?e.jsx(ue,{icon:e.jsx(E,{size:32}),title:"No files",description:"Upload files or create a folder to get started",action:{label:"Upload files",onClick:()=>{var s;return(s=z.current)==null?void 0:s.call(z)}}}):e.jsx(S,{gap:4,children:h.map(s=>{const l=O(s)?E:ye(s),g=(u==null?void 0:u.id)===s.id;return e.jsx(X,{p:"sm",style:{cursor:"pointer",border:g?"1px solid var(--supabase-brand)":"1px solid var(--supabase-border)",backgroundColor:g?"var(--supabase-brand-light)":"transparent",borderRadius:6},onClick:()=>Le(s),children:e.jsxs(p,{justify:"space-between",wrap:"nowrap",children:[e.jsxs(p,{gap:"sm",wrap:"nowrap",children:[e.jsx(l,{size:20,color:O(s)?"var(--supabase-brand)":"var(--supabase-text-muted)",stroke:1.5}),e.jsxs(a,{children:[e.jsx(i,{size:"sm",fw:500,truncate:!0,style:{maxWidth:400},children:s.name.split("/").pop()||s.name}),!O(s)&&e.jsxs(i,{size:"xs",c:"dimmed",children:[we(s.size)," ",s.content_type&&`- ${s.content_type}`]})]})]}),!O(s)&&e.jsxs(p,{gap:"xs",children:[e.jsx(q,{label:"Download",children:e.jsx(k,{variant:"subtle",onClick:j=>{j.stopPropagation(),ae(s)},children:e.jsx(ge,{size:16})})}),e.jsx(q,{label:"Copy URL",children:e.jsx(k,{variant:"subtle",onClick:j=>{j.stopPropagation(),ne(s)},children:e.jsx(Y,{size:16})})}),e.jsxs(m,{position:"bottom-end",children:[e.jsx(m.Target,{children:e.jsx(k,{variant:"subtle",onClick:j=>j.stopPropagation(),children:e.jsx(xe,{size:16})})}),e.jsx(m.Dropdown,{children:e.jsx(m.Item,{color:"red",leftSection:e.jsx(Q,{size:14}),onClick:j=>{j.stopPropagation(),f(s),se()},children:"Delete"})})]})]})]})},s.id)})})})}),u&&w&&e.jsx(ps,{file:u,bucket:w,onClose:()=>f(null),onDownload:()=>ae(u),onDelete:()=>se(),onCopyUrl:()=>ne(u)})]})]}):e.jsx(_,{style:{flex:1},children:e.jsx(ue,{icon:e.jsx(E,{size:32}),title:"Select a bucket",description:"Choose a bucket from the sidebar or create a new one",action:{label:"Create bucket",onClick:B}})})})]}),e.jsx(ce,{opened:F,onClose:N,title:"Create bucket",size:"md",children:e.jsxs(S,{gap:"md",children:[e.jsx(de,{label:"Name",placeholder:"my-bucket",value:v.name,onChange:s=>Z({...v,name:s.target.value}),required:!0}),e.jsx(_e,{label:"Public bucket",description:"Allow public access to files without authentication",checked:v.public,onChange:s=>Z({...v,public:s.target.checked})}),e.jsxs(p,{justify:"flex-end",mt:"md",children:[e.jsx(b,{variant:"outline",onClick:N,children:"Cancel"}),e.jsx(b,{onClick:Ie,loading:W,children:"Create bucket"})]})]})}),e.jsx(ce,{opened:ze,onClose:G,title:"Create folder",size:"md",children:e.jsxs(S,{gap:"md",children:[e.jsx(de,{label:"Folder name",placeholder:"my-folder",value:$,onChange:s=>re(s.target.value),required:!0}),e.jsxs(p,{justify:"flex-end",mt:"md",children:[e.jsx(b,{variant:"outline",onClick:G,children:"Cancel"}),e.jsx(b,{onClick:Pe,loading:W,children:"Create folder"})]})]})}),e.jsx(pe,{opened:ke,onClose:ee,onConfirm:Fe,title:"Delete bucket",message:`Are you sure you want to delete "${w==null?void 0:w.name}"? All files in this bucket will be permanently deleted.`,confirmLabel:"Delete",danger:!0,loading:W}),e.jsx(pe,{opened:ve,onClose:te,onConfirm:De,title:"Delete file",message:`Are you sure you want to delete "${u==null?void 0:u.name.split("/").pop()}"?`,confirmLabel:"Delete",danger:!0,loading:W})]})}export{vs as StoragePage};
