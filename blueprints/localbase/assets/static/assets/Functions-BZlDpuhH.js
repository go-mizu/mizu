import{h as C,y as o,j as t,t as O,f as N,S as A,b as J,F as M,G as f,e as h,T as g,a as v,A as k,M as r}from"./vendor-mantine-BXMqcLry.js";import{r as a}from"./vendor-react-CFPnf9wS.js";import{P as V}from"./PageContainer-QI0M3bfS.js";import{D as B}from"./DataTable-sfGjDcHA.js";import{E as $}from"./EmptyState-T2jupwgE.js";import{C as G}from"./ConfirmModal-Dw1NY3dN.js";import{S as U}from"./StatusBadge-nOs07_tG.js";import{f as l}from"./functions-Bm-D4nxs.js";import{d as S,V as W,aP as H,X as K,aQ as Q,Z as X}from"./vendor-icons-q9-fAAJw.js";import"./client-CvoVCtJO.js";function ce(){const[F,D]=a.useState([]),[b,p]=a.useState(!0),[i,y]=a.useState(null),[z,{open:j,close:u}]=C(!1),[E,{open:I,close:x}]=C(!1),[n,m]=a.useState({name:"",verify_jwt:!0}),[w,d]=a.useState(!1),c=a.useCallback(async()=>{p(!0);try{const e=await l.listFunctions();D(e)}catch(e){o.show({title:"Error",message:e.message||"Failed to load functions",color:"red"})}finally{p(!1)}},[]);a.useEffect(()=>{c()},[c]);const P=async()=>{if(!n.name.trim()){o.show({title:"Validation Error",message:"Function name is required",color:"red"});return}d(!0);try{await l.createFunction({name:n.name,verify_jwt:n.verify_jwt}),o.show({title:"Success",message:"Function created successfully",color:"green"}),u(),m({name:"",verify_jwt:!0}),c()}catch(e){o.show({title:"Error",message:e.message||"Failed to create function",color:"red"})}finally{d(!1)}},_=async()=>{if(i){d(!0);try{await l.deleteFunction(i.id),o.show({title:"Success",message:"Function deleted successfully",color:"green"}),x(),y(null),c()}catch(e){o.show({title:"Error",message:e.message||"Failed to delete function",color:"red"})}finally{d(!1)}}},T=async e=>{try{await l.deployFunction(e.id,{source_code:`// Edge function: ${e.name}
export default async function(req) {
  return new Response(JSON.stringify({ message: "Hello from ${e.name}!" }), {
    headers: { "Content-Type": "application/json" },
  });
}`}),o.show({title:"Success",message:"Function deployed successfully",color:"green"}),c()}catch(s){o.show({title:"Error",message:s.message||"Failed to deploy function",color:"red"})}},R=async e=>{try{const s=await l.invokeFunction(e.slug||e.name);o.show({title:"Function Response",message:JSON.stringify(s),color:"blue"})}catch(s){o.show({title:"Invocation Error",message:s.message||"Failed to invoke function",color:"red"})}},q=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=[{key:"name",header:"Name",render:e=>t.jsxs(f,{gap:"xs",children:[t.jsx(S,{size:16}),t.jsx(g,{size:"sm",fw:500,children:e.name})]})},{key:"slug",header:"Slug",render:e=>t.jsx(g,{size:"sm",c:"dimmed",children:e.slug||e.name})},{key:"status",header:"Status",render:e=>t.jsx(U,{status:e.status})},{key:"version",header:"Version",render:e=>t.jsxs(v,{size:"sm",variant:"light",color:"gray",children:["v",e.version]})},{key:"verify_jwt",header:"JWT",render:e=>t.jsx(v,{size:"sm",variant:"light",color:e.verify_jwt?"green":"yellow",children:e.verify_jwt?"Required":"Optional"})},{key:"updated_at",header:"Last Updated",render:e=>t.jsx(g,{size:"sm",c:"dimmed",children:q(e.updated_at)})},{key:"actions",header:"",width:100,render:e=>t.jsxs(f,{gap:"xs",wrap:"nowrap",children:[t.jsx(k,{variant:"subtle",color:"blue",onClick:s=>{s.stopPropagation(),R(e)},title:"Invoke",children:t.jsx(H,{size:16})}),t.jsxs(r,{position:"bottom-end",withinPortal:!0,children:[t.jsx(r.Target,{children:t.jsx(k,{variant:"subtle",color:"gray",onClick:s=>s.stopPropagation(),children:t.jsx(K,{size:16})})}),t.jsxs(r.Dropdown,{children:[t.jsx(r.Item,{leftSection:t.jsx(Q,{size:14}),onClick:s=>{s.stopPropagation(),T(e)},children:"Deploy"}),t.jsx(r.Divider,{}),t.jsx(r.Item,{color:"red",leftSection:t.jsx(X,{size:14}),onClick:s=>{s.stopPropagation(),y(e),I()},children:"Delete"})]})]})]})}];return t.jsxs(V,{title:"Edge Functions",description:"Deploy and manage serverless functions",actions:t.jsx(h,{leftSection:t.jsx(W,{size:16}),onClick:j,children:"Create function"}),children:[t.jsx(O,{className:"supabase-section",p:0,children:t.jsx(B,{data:F,columns:L,loading:b,getRowKey:e=>e.id,emptyState:t.jsx($,{icon:t.jsx(S,{size:32}),title:"No functions yet",description:"Create your first edge function to get started",action:{label:"Create function",onClick:j}})})}),t.jsx(N,{opened:z,onClose:u,title:"Create function",size:"md",children:t.jsxs(A,{gap:"md",children:[t.jsx(J,{label:"Function name",placeholder:"my-function",value:n.name,onChange:e=>m({...n,name:e.target.value}),required:!0}),t.jsx(M,{label:"Require JWT verification",description:"Only allow authenticated requests to invoke this function",checked:n.verify_jwt,onChange:e=>m({...n,verify_jwt:e.target.checked})}),t.jsxs(f,{justify:"flex-end",mt:"md",children:[t.jsx(h,{variant:"outline",onClick:u,children:"Cancel"}),t.jsx(h,{onClick:P,loading:w,children:"Create function"})]})]})}),t.jsx(G,{opened:E,onClose:x,onConfirm:_,title:"Delete function",message:`Are you sure you want to delete "${i==null?void 0:i.name}"? This action cannot be undone.`,confirmLabel:"Delete",danger:!0,loading:w})]})}export{ce as FunctionsPage};
