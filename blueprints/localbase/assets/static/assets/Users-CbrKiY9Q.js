import{x as ze,j as e,b as p,h as U,y as d,z as m,G as r,T as i,e as u,S as g,E as Z,B as k,p as F,t as ee,s as se,F as z,q as E,a as q,H as Ie,I as ne,f as N,J as O,d as Ue,M as C,A as ke}from"./vendor-mantine-BXMqcLry.js";import{r as l}from"./vendor-react-CFPnf9wS.js";import{P as Ee}from"./PageContainer-QI0M3bfS.js";import{D as De}from"./DataTable-sfGjDcHA.js";import{E as Ae}from"./EmptyState-T2jupwgE.js";import{C as Te}from"./ConfirmModal-Dw1NY3dN.js";import{a as Le,N as $,O as Re,P as Be,Q as Me,R as Ge,S as _e,T as Fe,l as ie,U as ae,t as te,V as qe,W as re,j as Ne,X as Oe,Y as $e,Z as Ve}from"./vendor-icons-q9-fAAJw.js";import{a as D}from"./auth-CFnvc1BQ.js";import"./client-CvoVCtJO.js";function He({value:A,onChange:T,placeholder:y="Search...",debounceMs:L=300}){const S=ze(x=>{T(x)},L);return e.jsx(p,{placeholder:y,leftSection:e.jsx(Le,{size:16}),defaultValue:A,onChange:x=>S(x.target.value),style:{width:280}})}const Qe=[{id:"email",name:"Email",icon:$,enabled:!0,description:"Allow users to sign up and sign in with email and password",category:"email"},{id:"phone",name:"Phone",icon:Re,enabled:!1,description:"Allow users to sign up and sign in with phone number and OTP",category:"phone"},{id:"google",name:"Google",icon:Be,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their Google account",category:"social"},{id:"github",name:"GitHub",icon:Me,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their GitHub account",category:"social"},{id:"apple",name:"Apple",icon:Ge,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their Apple ID",category:"social"},{id:"twitter",name:"Twitter",icon:_e,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their Twitter account",category:"social"},{id:"discord",name:"Discord",icon:Fe,enabled:!1,clientId:"",clientSecret:"",description:"Allow users to sign in with their Discord account",category:"social"}];function is(){const[A,T]=l.useState("users"),[y,L]=l.useState([]),[S,x]=l.useState([]),[le,V]=l.useState(!0),[b,oe]=l.useState(""),[j,I]=l.useState(null),[w,H]=l.useState(Qe),[a,R]=l.useState(null),[ce,{open:de,close:B}]=U(!1),[t,f]=l.useState({siteUrl:"http://localhost:3000",redirectUrls:"http://localhost:3000/**",jwtExpiry:3600,enableSignUp:!0,enableConfirmation:!0,enableDoubleConfirmation:!1,minimumPasswordLength:8}),[he,{open:Q,close:M}]=U(!1),[ue,{open:me,close:G}]=U(!1),[ge,{open:pe,close:W}]=U(!1),[n,h]=l.useState({email:"",password:"",phone:""}),[_,v]=l.useState(!1),P=l.useCallback(async()=>{V(!0);try{const s=await D.listUsers(1,100);L(s.users),x(s.users)}catch{d.show({title:"Error",message:"Failed to load users",color:"red"})}finally{V(!1)}},[]);l.useEffect(()=>{P()},[P]),l.useEffect(()=>{if(b){const s=b.toLowerCase();x(y.filter(o=>{var c,X;return((c=o.email)==null?void 0:c.toLowerCase().includes(s))||((X=o.phone)==null?void 0:X.toLowerCase().includes(s))}))}else x(y)},[b,y]);const xe=async()=>{if(!n.email||!n.password){d.show({title:"Validation Error",message:"Email and password are required",color:"red"});return}v(!0);try{await D.createUser({email:n.email,password:n.password,phone:n.phone||void 0}),d.show({title:"Success",message:"User created successfully",color:"green"}),M(),h({email:"",password:"",phone:""}),P()}catch(s){d.show({title:"Error",message:s.message||"Failed to create user",color:"red"})}finally{v(!1)}},je=async()=>{if(j){v(!0);try{await D.updateUser(j.id,{email:n.email||void 0,phone:n.phone||void 0,password:n.password||void 0}),d.show({title:"Success",message:"User updated successfully",color:"green"}),G(),h({email:"",password:"",phone:""}),I(null),P()}catch(s){d.show({title:"Error",message:s.message||"Failed to update user",color:"red"})}finally{v(!1)}}},fe=async()=>{if(j){v(!0);try{await D.deleteUser(j.id),d.show({title:"Success",message:"User deleted successfully",color:"green"}),W(),I(null),P()}catch(s){d.show({title:"Error",message:s.message||"Failed to delete user",color:"red"})}finally{v(!1)}}},be=s=>{I(s),h({email:s.email||"",password:"",phone:s.phone||""}),me()},we=s=>{I(s),pe()},Y=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",J=s=>{var o;H(w.map(c=>c.id===s?{...c,enabled:!c.enabled}:c)),d.show({title:"Provider Updated",message:`Provider ${s} has been ${(o=w.find(c=>c.id===s))!=null&&o.enabled?"disabled":"enabled"}`,color:"green"})},ve=s=>{R(s),de()},Ce=()=>{a&&(H(w.map(s=>s.id===a.id?a:s)),B(),d.show({title:"Provider Saved",message:`${a.name} settings have been updated`,color:"green"}))},ye=()=>{d.show({title:"Settings Saved",message:"Authentication settings have been updated",color:"green"})},Se=[{key:"email",header:"Email",render:s=>e.jsxs(r,{gap:"xs",children:[e.jsx(i,{size:"sm",fw:500,children:s.email||"-"}),s.email_confirmed_at&&e.jsx(Ue,{label:"Email verified",children:e.jsx(q,{size:"xs",color:"green",variant:"light",children:"Verified"})})]})},{key:"phone",header:"Phone",render:s=>e.jsx(i,{size:"sm",children:s.phone||"-"})},{key:"provider",header:"Provider",render:s=>{var c;const o=((c=s.app_metadata)==null?void 0:c.provider)||"email";return e.jsx(q,{size:"sm",variant:"light",color:"gray",children:o})}},{key:"created_at",header:"Created",render:s=>e.jsx(i,{size:"sm",c:"dimmed",children:Y(s.created_at)})},{key:"last_sign_in_at",header:"Last Sign In",render:s=>e.jsx(i,{size:"sm",c:"dimmed",children:Y(s.last_sign_in_at)})},{key:"actions",header:"",width:50,render:s=>e.jsxs(C,{position:"bottom-end",withinPortal:!0,children:[e.jsx(C.Target,{children:e.jsx(ke,{variant:"subtle",color:"gray",onClick:o=>o.stopPropagation(),children:e.jsx(Oe,{size:16})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Item,{leftSection:e.jsx($e,{size:14}),onClick:o=>{o.stopPropagation(),be(s)},children:"Edit user"}),e.jsx(C.Divider,{}),e.jsx(C.Item,{color:"red",leftSection:e.jsx(Ve,{size:14}),onClick:o=>{o.stopPropagation(),we(s)},children:"Delete user"})]})]})}],K=w.filter(s=>s.enabled),Pe=w.filter(s=>s.category==="social");return e.jsxs(Ee,{title:"Authentication",description:"Manage users, providers, and authentication settings",children:[e.jsxs(m,{value:A,onChange:T,children:[e.jsxs(m.List,{mb:"lg",children:[e.jsx(m.Tab,{value:"users",leftSection:e.jsx(ie,{size:16}),children:"Users"}),e.jsx(m.Tab,{value:"providers",leftSection:e.jsx(ae,{size:16}),children:"Providers"}),e.jsx(m.Tab,{value:"settings",leftSection:e.jsx(te,{size:16}),children:"Settings"})]}),e.jsxs(m.Panel,{value:"users",children:[e.jsxs(r,{justify:"space-between",mb:"lg",children:[e.jsxs(r,{children:[e.jsx(He,{value:b,onChange:oe,placeholder:"Search by email or phone..."}),e.jsxs(i,{size:"sm",c:"dimmed",children:[S.length," user",S.length!==1?"s":""]})]}),e.jsx(u,{leftSection:e.jsx(qe,{size:16}),onClick:Q,children:"Add user"})]}),e.jsx(De,{data:S,columns:Se,loading:le,getRowKey:s=>s.id,emptyState:e.jsx(Ae,{icon:e.jsx(ie,{size:32}),title:"No users found",description:b?"No users match your search criteria":"Get started by creating your first user",action:b?void 0:{label:"Add user",onClick:Q}})})]}),e.jsx(m.Panel,{value:"providers",children:e.jsxs(g,{gap:"lg",children:[e.jsx(Z,{icon:e.jsx(re,{size:16}),color:"blue",children:"Configure authentication providers for your application. Enable the providers you want to allow users to sign in with."}),e.jsxs(k,{children:[e.jsx(i,{fw:600,mb:"md",children:"Email & Phone"}),e.jsx(F,{cols:{base:1,sm:2},spacing:"md",children:w.filter(s=>s.category==="email"||s.category==="phone").map(s=>e.jsx(ee,{padding:"md",withBorder:!0,children:e.jsxs(r,{justify:"space-between",children:[e.jsxs(r,{gap:"sm",children:[e.jsx(se,{size:"lg",radius:"md",variant:"light",color:s.enabled?"green":"gray",children:e.jsx(s.icon,{size:20})}),e.jsxs(k,{children:[e.jsx(i,{fw:500,children:s.name}),e.jsx(i,{size:"xs",c:"dimmed",children:s.description})]})]}),e.jsx(z,{checked:s.enabled,onChange:()=>J(s.id)})]})},s.id))})]}),e.jsxs(k,{children:[e.jsx(i,{fw:600,mb:"md",children:"Social Providers"}),e.jsx(F,{cols:{base:1,sm:2,lg:3},spacing:"md",children:Pe.map(s=>e.jsxs(ee,{padding:"md",withBorder:!0,children:[e.jsxs(r,{justify:"space-between",mb:"sm",children:[e.jsxs(r,{gap:"sm",children:[e.jsx(se,{size:"lg",radius:"md",variant:"light",color:s.enabled?"green":"gray",children:e.jsx(s.icon,{size:20})}),e.jsx(i,{fw:500,children:s.name})]}),e.jsx(z,{checked:s.enabled,onChange:()=>J(s.id)})]}),e.jsx(i,{size:"xs",c:"dimmed",mb:"sm",children:s.description}),s.enabled&&e.jsx(u,{size:"xs",variant:"light",fullWidth:!0,onClick:()=>ve(s),children:"Configure"})]},s.id))})]}),e.jsxs(E,{p:"md",withBorder:!0,children:[e.jsx(i,{fw:600,mb:"sm",children:"Active Providers"}),K.length===0?e.jsx(i,{size:"sm",c:"dimmed",children:"No providers enabled. Enable at least one provider to allow users to sign in."}):e.jsx(r,{gap:"xs",children:K.map(s=>e.jsx(q,{size:"lg",variant:"light",leftSection:e.jsx(s.icon,{size:14}),children:s.name},s.id))})]})]})}),e.jsx(m.Panel,{value:"settings",children:e.jsxs(g,{gap:"lg",children:[e.jsxs(F,{cols:{base:1,lg:2},spacing:"lg",children:[e.jsxs(E,{p:"md",withBorder:!0,children:[e.jsxs(r,{gap:"xs",mb:"md",children:[e.jsx(Ne,{size:18}),e.jsx(i,{fw:600,children:"URL Configuration"})]}),e.jsxs(g,{gap:"md",children:[e.jsx(p,{label:"Site URL",description:"The base URL of your application",value:t.siteUrl,onChange:s=>f({...t,siteUrl:s.target.value})}),e.jsx(Ie,{label:"Redirect URLs",description:"Allowed redirect URLs (one per line, supports wildcards)",value:t.redirectUrls,onChange:s=>f({...t,redirectUrls:s.target.value}),minRows:3})]})]}),e.jsxs(E,{p:"md",withBorder:!0,children:[e.jsxs(r,{gap:"xs",mb:"md",children:[e.jsx(ae,{size:18}),e.jsx(i,{fw:600,children:"Security"})]}),e.jsxs(g,{gap:"md",children:[e.jsx(ne,{label:"JWT Expiry (seconds)",description:"How long access tokens are valid",value:t.jwtExpiry,onChange:s=>f({...t,jwtExpiry:Number(s)||3600}),min:60,max:604800}),e.jsx(ne,{label:"Minimum Password Length",description:"Required minimum characters for passwords",value:t.minimumPasswordLength,onChange:s=>f({...t,minimumPasswordLength:Number(s)||8}),min:6,max:128})]})]})]}),e.jsxs(E,{p:"md",withBorder:!0,children:[e.jsxs(r,{gap:"xs",mb:"md",children:[e.jsx(te,{size:18}),e.jsx(i,{fw:600,children:"Features"})]}),e.jsxs(g,{gap:"md",children:[e.jsx(z,{label:"Enable Sign-ups",description:"Allow new users to create accounts",checked:t.enableSignUp,onChange:s=>f({...t,enableSignUp:s.currentTarget.checked})}),e.jsx(z,{label:"Email Confirmation",description:"Require email verification before allowing sign-in",checked:t.enableConfirmation,onChange:s=>f({...t,enableConfirmation:s.currentTarget.checked})}),e.jsx(z,{label:"Double Confirmation",description:"Require confirmation when changing email addresses",checked:t.enableDoubleConfirmation,onChange:s=>f({...t,enableDoubleConfirmation:s.currentTarget.checked})})]})]}),e.jsx(r,{justify:"flex-end",children:e.jsx(u,{onClick:ye,children:"Save Settings"})})]})})]}),e.jsx(N,{opened:he,onClose:M,title:"Create new user",size:"md",children:e.jsxs(g,{gap:"md",children:[e.jsx(p,{label:"Email",placeholder:"user@example.com",value:n.email,onChange:s=>h({...n,email:s.target.value}),required:!0,leftSection:e.jsx($,{size:16})}),e.jsx(O,{label:"Password",placeholder:"Minimum 8 characters",value:n.password,onChange:s=>h({...n,password:s.target.value}),required:!0}),e.jsx(p,{label:"Phone (optional)",placeholder:"+1234567890",value:n.phone,onChange:s=>h({...n,phone:s.target.value})}),e.jsxs(r,{justify:"flex-end",mt:"md",children:[e.jsx(u,{variant:"outline",onClick:M,children:"Cancel"}),e.jsx(u,{onClick:xe,loading:_,children:"Create user"})]})]})}),e.jsx(N,{opened:ue,onClose:G,title:"Edit user",size:"md",children:e.jsxs(g,{gap:"md",children:[e.jsx(p,{label:"Email",placeholder:"user@example.com",value:n.email,onChange:s=>h({...n,email:s.target.value}),leftSection:e.jsx($,{size:16})}),e.jsx(O,{label:"New Password (leave empty to keep current)",placeholder:"Minimum 8 characters",value:n.password,onChange:s=>h({...n,password:s.target.value})}),e.jsx(p,{label:"Phone",placeholder:"+1234567890",value:n.phone,onChange:s=>h({...n,phone:s.target.value})}),e.jsxs(r,{justify:"flex-end",mt:"md",children:[e.jsx(u,{variant:"outline",onClick:G,children:"Cancel"}),e.jsx(u,{onClick:je,loading:_,children:"Save changes"})]})]})}),e.jsx(Te,{opened:ge,onClose:W,onConfirm:fe,title:"Delete user",message:`Are you sure you want to delete ${(j==null?void 0:j.email)||"this user"}? This action cannot be undone.`,confirmLabel:"Delete",danger:!0,loading:_}),e.jsx(N,{opened:ce,onClose:B,title:`Configure ${a==null?void 0:a.name}`,size:"md",children:a&&e.jsxs(g,{gap:"md",children:[e.jsxs(Z,{icon:e.jsx(re,{size:16}),color:"blue",children:["Get your OAuth credentials from the"," ",e.jsxs(i,{component:"a",href:"#",c:"blue",style:{textDecoration:"underline"},children:[a.name," Developer Console"]})]}),e.jsx(p,{label:"Client ID",placeholder:`Your ${a.name} Client ID`,value:a.clientId||"",onChange:s=>R({...a,clientId:s.target.value})}),e.jsx(O,{label:"Client Secret",placeholder:`Your ${a.name} Client Secret`,value:a.clientSecret||"",onChange:s=>R({...a,clientSecret:s.target.value})}),e.jsxs(k,{children:[e.jsx(i,{size:"sm",fw:500,mb:4,children:"Callback URL"}),e.jsx(p,{value:`${t.siteUrl}/auth/v1/callback`,readOnly:!0,styles:{input:{fontFamily:"monospace",fontSize:12}}}),e.jsxs(i,{size:"xs",c:"dimmed",mt:4,children:["Add this URL to your ",a.name," app's authorized redirect URIs"]})]}),e.jsxs(r,{justify:"flex-end",mt:"md",children:[e.jsx(u,{variant:"outline",onClick:B,children:"Cancel"}),e.jsx(u,{onClick:Ce,children:"Save"})]})]})})]})}export{is as UsersPage};
