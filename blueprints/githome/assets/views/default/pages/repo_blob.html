{{define "content"}}
<div class="repo-header">
    <div class="repo-header-content">
        <div class="repo-header-title">
            <svg class="octicon color-fg-muted mr-2" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                {{if .Repo.Private}}
                <path fill-rule="evenodd" d="M4 4a4 4 0 0 1 8 0v2h.25c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 12.25 15h-8.5A1.75 1.75 0 0 1 2 13.25v-5.5C2 6.784 2.784 6 3.75 6H4Zm8.25 3.5h-8.5a.25.25 0 0 0-.25.25v5.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 0-.25-.25ZM10.5 6V4a2.5 2.5 0 1 0-5 0v2Z"/>
                {{else}}
                <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8ZM5 12.25a.25.25 0 0 1 .25-.25h3.5a.25.25 0 0 1 .25.25v3.25a.25.25 0 0 1-.4.2l-1.45-1.087a.249.249 0 0 0-.3 0L5.4 15.7a.25.25 0 0 1-.4-.2Z"/>
                {{end}}
            </svg>
            <a href="/{{.Repo.Owner.Login}}" class="repo-owner">{{.Repo.Owner.Login}}</a>
            <span class="repo-separator">/</span>
            <a href="/{{.Repo.FullName}}" class="repo-name">{{.Repo.Name}}</a>
            <span class="Label Label--secondary ml-2">{{if .Repo.Private}}Private{{else}}Public{{end}}</span>
        </div>

        {{if .User}}
        <div class="repo-header-actions">
            <div class="BtnGroup">
                <button class="btn btn-sm BtnGroup-item{{if .Repo.IsWatching}} selected{{end}}">
                    <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M1.679 7.932c.412-.621 1.242-1.75 2.366-2.717C5.175 4.242 6.527 3.5 8 3.5c1.473 0 2.825.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.119.119 0 0 1 0 .136c-.412.621-1.242 1.75-2.366 2.717C10.825 11.758 9.473 12.5 8 12.5c-1.473 0-2.825-.742-3.955-1.715C2.921 9.818 2.091 8.69 1.679 8.068a.119.119 0 0 1 0-.136ZM8 2c-1.981 0-3.67.992-4.933 2.078C1.797 5.169.88 6.423.43 7.1a1.619 1.619 0 0 0 0 1.798c.45.678 1.367 1.932 2.637 3.024C4.329 13.008 6.019 14 8 14c1.981 0 3.67-.992 4.933-2.078 1.27-1.091 2.187-2.345 2.637-3.023a1.619 1.619 0 0 0 0-1.798c-.45-.678-1.367-1.932-2.637-3.023C11.671 2.992 9.981 2 8 2Z"/>
                    </svg>
                    Watch
                </button>
                <span class="Counter BtnGroup-item">{{.Repo.WatchersCount}}</span>
            </div>

            <div class="BtnGroup ml-2">
                <button class="btn btn-sm BtnGroup-item{{if .Repo.IsStarred}} selected{{end}}">
                    <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Z"/>
                    </svg>
                    Star
                </button>
                <span class="Counter BtnGroup-item">{{.Repo.StargazersCount}}</span>
            </div>

            <div class="BtnGroup ml-2">
                <button class="btn btn-sm BtnGroup-item">
                    <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0Z"/>
                    </svg>
                    Fork
                </button>
                <span class="Counter BtnGroup-item">{{.Repo.ForksCount}}</span>
            </div>
        </div>
        {{end}}
    </div>
</div>

<nav class="UnderlineNav">
    <div class="UnderlineNav-body">
        {{range .Repo.Tabs}}
        <a href="{{.URL}}" class="UnderlineNav-item{{if .Active}} selected{{end}}">
            <span>{{.Name}}</span>
            {{if gt .Count 0}}
            <span class="Counter">{{.Count}}</span>
            {{end}}
        </a>
        {{end}}
    </div>
</nav>

<div class="container-xl">
    <div class="mt-4">
        <!-- File Navigation -->
        <div class="file-navigation mb-3">
            <div class="d-flex flex-justify-between">
                <div class="d-flex flex-items-center">
                    <button class="btn btn-sm mr-2">
                        <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                            <path d="M9.5 3.25a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.493 2.493 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25Z"/>
                        </svg>
                        <span>{{.CurrentBranch}}</span>
                        <span class="dropdown-caret"></span>
                    </button>
                    {{if .Branches}}
                    <span class="color-fg-muted f6">{{len .Branches}} branches</span>
                    {{end}}
                </div>

                <div class="d-flex flex-items-center">
                    <a href="/{{.Repo.FullName}}/find/{{.CurrentBranch}}" class="btn btn-sm mr-2">Go to file</a>
                    <button class="btn btn-sm btn-primary">
                        <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                            <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
                            <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
                        </svg>
                        Code
                    </button>
                </div>
            </div>
        </div>

        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb-nav mb-3">
            {{range $i, $b := .Breadcrumbs}}
            {{if $i}} / {{end}}
            {{if $b.URL}}
            <a href="{{$b.URL}}" class="Link--primary">{{$b.Label}}</a>
            {{else}}
            <strong>{{$b.Label}}</strong>
            {{end}}
            {{end}}
        </nav>

        <!-- File Content -->
        <div class="Box">
            <div class="Box-header d-flex flex-items-center flex-justify-between" style="padding: 8px 16px;">
                <div class="d-flex flex-items-center">
                    <svg class="octicon mr-2" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688Z"/>
                    </svg>
                    <span class="text-bold">{{.FileName}}</span>
                    <span class="color-fg-muted ml-2 f6">{{.LineCount}} lines{{if .FileSizeHuman}} ({{.FileSizeHuman}}){{end}}</span>
                </div>
                <div class="d-flex flex-items-center">
                    {{if .IsMarkdown}}
                    <div class="BtnGroup mr-2">
                        <button class="btn btn-sm BtnGroup-item" id="previewBtn" onclick="showPreview()">Preview</button>
                        <button class="btn btn-sm BtnGroup-item selected" id="codeBtn" onclick="showCode()">Code</button>
                    </div>
                    {{end}}
                    <a href="/{{.Repo.FullName}}/raw/{{.CurrentBranch}}/{{.FilePath}}" class="btn btn-sm mr-2">Raw</a>
                    <a href="/{{.Repo.FullName}}/blame/{{.CurrentBranch}}/{{.FilePath}}" class="btn btn-sm mr-2">Blame</a>
                    <button class="btn btn-sm" id="copyBtn" onclick="copyContent()">
                        <svg class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                            <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
                            <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
                        </svg>
                    </button>
                </div>
            </div>

            {{if .IsImage}}
            <div class="Box-body text-center p-4" style="background-color: var(--color-canvas-subtle, #f6f8fa);">
                <img src="/{{.Repo.FullName}}/raw/{{.CurrentBranch}}/{{.FilePath}}"
                     alt="{{.FileName}}"
                     style="max-width: 100%; max-height: 80vh; border: 1px solid var(--color-border-default, #d0d7de); border-radius: 6px;">
            </div>
            {{else if .IsBinary}}
            <div class="Box-body blankslate">
                <h3>Binary file not shown</h3>
                <p>This file is binary and cannot be displayed.</p>
                <a href="/{{.Repo.FullName}}/raw/{{.CurrentBranch}}/{{.FilePath}}" class="btn btn-primary">Download</a>
            </div>
            {{else}}
            {{if .IsMarkdown}}
            <!-- Markdown Preview (hidden by default) -->
            <div class="Box-body markdown-body p-4" id="markdownPreview" style="display: none;">
                {{.MarkdownHTML}}
            </div>
            {{end}}
            <!-- Code View -->
            <div class="Box-body p-0" id="codeView">
                <div class="code-view">
                    <table class="code-table">
                        <tbody>
                            {{$content := .FileContent}}
                            {{$lines := split $content "\n"}}
                            {{range $i, $line := $lines}}
                            <tr id="L{{add $i 1}}">
                                <td class="code-line-number" data-line-number="{{add $i 1}}" onclick="selectLine({{add $i 1}})">{{add $i 1}}</td>
                                <td class="code-line-content">
                                    <pre><code class="language-{{$.Language}}">{{$line}}</code></pre>
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
            </div>
            {{end}}
        </div>
    </div>
</div>

<!-- Highlight.js for syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<style>
.code-view {
    overflow-x: auto;
}

.code-table {
    width: 100%;
    border-collapse: collapse;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    font-size: 12px;
    line-height: 20px;
}

.code-line-number {
    width: 1%;
    min-width: 50px;
    padding: 0 16px 0 16px;
    text-align: right;
    color: var(--color-fg-muted, #656d76);
    background-color: var(--color-canvas-subtle, #f6f8fa);
    vertical-align: top;
    user-select: none;
    cursor: pointer;
}

.code-line-number:hover {
    color: var(--color-accent-fg, #0969da);
}

tr.highlighted .code-line-number,
tr.highlighted .code-line-content {
    background-color: var(--color-attention-subtle, #fff8c5);
}

.code-line-content {
    padding: 0 16px;
    white-space: pre;
    vertical-align: top;
}

.code-line-content pre {
    margin: 0;
    padding: 0;
    background: none;
    border: none;
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
}

.code-line-content code {
    padding: 0;
    background: none;
    border: none;
}

/* Override highlight.js background */
.code-line-content code.hljs {
    background: transparent;
    padding: 0;
}

.breadcrumb-nav {
    font-size: 14px;
}

/* Markdown body styles */
.markdown-body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
}

.markdown-body h1 { font-size: 2em; border-bottom: 1px solid var(--color-border-muted, #d0d7de); padding-bottom: 0.3em; margin-top: 24px; margin-bottom: 16px; }
.markdown-body h2 { font-size: 1.5em; border-bottom: 1px solid var(--color-border-muted, #d0d7de); padding-bottom: 0.3em; margin-top: 24px; margin-bottom: 16px; }
.markdown-body h3 { font-size: 1.25em; margin-top: 24px; margin-bottom: 16px; }
.markdown-body h4 { font-size: 1em; margin-top: 24px; margin-bottom: 16px; }
.markdown-body p { margin-top: 0; margin-bottom: 16px; }
.markdown-body code { padding: 0.2em 0.4em; background-color: var(--color-neutral-muted, rgba(175,184,193,0.2)); border-radius: 6px; font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace; font-size: 85%; }
.markdown-body pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; background-color: var(--color-canvas-subtle, #f6f8fa); border-radius: 6px; }
.markdown-body pre code { padding: 0; background: transparent; }
.markdown-body a { color: var(--color-accent-fg, #0969da); text-decoration: none; }
.markdown-body a:hover { text-decoration: underline; }
.markdown-body ul, .markdown-body ol { padding-left: 2em; margin-top: 0; margin-bottom: 16px; }
.markdown-body li { margin-top: 0.25em; }
.markdown-body blockquote { padding: 0 1em; color: var(--color-fg-muted, #656d76); border-left: 0.25em solid var(--color-border-default, #d0d7de); margin: 0 0 16px 0; }
.markdown-body img { max-width: 100%; height: auto; }
.markdown-body table { border-spacing: 0; border-collapse: collapse; margin-bottom: 16px; }
.markdown-body table th, .markdown-body table td { padding: 6px 13px; border: 1px solid var(--color-border-default, #d0d7de); }
.markdown-body table th { font-weight: 600; background-color: var(--color-canvas-subtle, #f6f8fa); }
.markdown-body table tr:nth-child(2n) { background-color: var(--color-canvas-subtle, #f6f8fa); }

/* Button group styles */
.BtnGroup-item.selected {
    background-color: var(--color-btn-selected-bg, #e8e8e8);
    border-color: var(--color-btn-border, rgba(31,35,40,0.15));
}
</style>

<script>
// Syntax highlighting
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('pre code').forEach((el) => {
        hljs.highlightElement(el);
    });

    // Handle line linking from URL hash
    highlightLinesFromHash();
});

// Handle hash change for line linking
window.addEventListener('hashchange', highlightLinesFromHash);

function highlightLinesFromHash() {
    // Clear previous highlights
    document.querySelectorAll('tr.highlighted').forEach(el => el.classList.remove('highlighted'));

    const hash = window.location.hash;
    const match = hash.match(/^#L(\d+)(-L(\d+))?$/);
    if (match) {
        const start = parseInt(match[1]);
        const end = match[3] ? parseInt(match[3]) : start;
        for (let i = start; i <= end; i++) {
            const row = document.getElementById('L' + i);
            if (row) {
                row.classList.add('highlighted');
                if (i === start) {
                    row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }
    }
}

function selectLine(lineNum) {
    window.location.hash = 'L' + lineNum;
}

{{if .IsMarkdown}}
function showPreview() {
    document.getElementById('codeView').style.display = 'none';
    document.getElementById('markdownPreview').style.display = 'block';
    document.getElementById('previewBtn').classList.add('selected');
    document.getElementById('codeBtn').classList.remove('selected');
}

function showCode() {
    document.getElementById('codeView').style.display = 'block';
    document.getElementById('markdownPreview').style.display = 'none';
    document.getElementById('previewBtn').classList.remove('selected');
    document.getElementById('codeBtn').classList.add('selected');
}
{{end}}

function copyContent() {
    const content = document.querySelector('#codeView .code-view').innerText;
    navigator.clipboard.writeText(content).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.innerHTML = '<svg class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>';
        setTimeout(() => {
            btn.innerHTML = '<svg class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg>';
        }, 2000);
    });
}
</script>
{{end}}
