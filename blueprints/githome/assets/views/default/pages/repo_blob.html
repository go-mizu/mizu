{{define "content"}}
<div class="repo-header">
    <div class="repo-header-content">
        <div class="repo-header-title">
            <svg class="octicon color-fg-muted mr-2" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                {{if .Repo.Private}}
                <path fill-rule="evenodd" d="M4 4a4 4 0 0 1 8 0v2h.25c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 12.25 15h-8.5A1.75 1.75 0 0 1 2 13.25v-5.5C2 6.784 2.784 6 3.75 6H4Zm8.25 3.5h-8.5a.25.25 0 0 0-.25.25v5.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 0-.25-.25ZM10.5 6V4a2.5 2.5 0 1 0-5 0v2Z"/>
                {{else}}
                <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8ZM5 12.25a.25.25 0 0 1 .25-.25h3.5a.25.25 0 0 1 .25.25v3.25a.25.25 0 0 1-.4.2l-1.45-1.087a.249.249 0 0 0-.3 0L5.4 15.7a.25.25 0 0 1-.4-.2Z"/>
                {{end}}
            </svg>
            <a href="/{{.Repo.Owner.Login}}" class="repo-owner">{{.Repo.Owner.Login}}</a>
            <span class="repo-separator">/</span>
            <a href="/{{.Repo.FullName}}" class="repo-name">{{.Repo.Name}}</a>
            <span class="Label Label--secondary ml-2">{{if .Repo.Private}}Private{{else}}Public{{end}}</span>
        </div>

        {{if .User}}
        <div class="repo-header-actions">
            <div class="BtnGroup">
                <button class="btn btn-sm BtnGroup-item BtnGroup-item--label{{if .Repo.IsWatching}} selected{{end}}">
                    {{if .Repo.IsWatching}}
                    <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M8 2c1.981 0 3.671.992 4.933 2.078 1.27 1.091 2.187 2.345 2.637 3.023a1.62 1.62 0 0 1 0 1.798c-.45.678-1.367 1.932-2.637 3.023C11.67 13.008 9.981 14 8 14c-1.981 0-3.671-.992-4.933-2.078C1.797 10.83.88 9.576.43 8.898a1.62 1.62 0 0 1 0-1.798c.45-.677 1.367-1.931 2.637-3.022C4.33 2.992 6.019 2 8 2ZM1.679 7.932a.12.12 0 0 0 0 .136c.411.622 1.241 1.75 2.366 2.717C5.176 11.758 6.527 12.5 8 12.5c1.473 0 2.825-.742 3.955-1.715 1.124-.967 1.954-2.096 2.366-2.717a.12.12 0 0 0 0-.136c-.412-.621-1.242-1.75-2.366-2.717C10.824 4.242 9.473 3.5 8 3.5c-1.473 0-2.825.742-3.955 1.715-1.124.967-1.954 2.096-2.366 2.717ZM8 10a2 2 0 1 1-.001-3.999A2 2 0 0 1 8 10Z"/>
                    </svg>
                    Unwatch
                    {{else}}
                    <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M1.679 7.932c.412-.621 1.242-1.75 2.366-2.717C5.175 4.242 6.527 3.5 8 3.5c1.473 0 2.825.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.119.119 0 0 1 0 .136c-.412.621-1.242 1.75-2.366 2.717C10.825 11.758 9.473 12.5 8 12.5c-1.473 0-2.825-.742-3.955-1.715C2.921 9.818 2.091 8.69 1.679 8.068a.119.119 0 0 1 0-.136ZM8 2c-1.981 0-3.67.992-4.933 2.078C1.797 5.169.88 6.423.43 7.1a1.619 1.619 0 0 0 0 1.798c.45.678 1.367 1.932 2.637 3.024C4.329 13.008 6.019 14 8 14c1.981 0 3.67-.992 4.933-2.078 1.27-1.091 2.187-2.345 2.637-3.023a1.619 1.619 0 0 0 0-1.798c-.45-.678-1.367-1.932-2.637-3.023C11.671 2.992 9.981 2 8 2Z"/>
                    </svg>
                    Watch
                    {{end}}
                    <span class="dropdown-caret ml-1"></span>
                </button>
                <a href="/{{.Repo.FullName}}/watchers" class="btn btn-sm BtnGroup-item BtnGroup-item--count">{{.Repo.WatchersCount}}</a>
            </div>

            <div class="BtnGroup ml-2">
                <button class="btn btn-sm BtnGroup-item BtnGroup-item--label{{if .Repo.IsStarred}} btn-starred{{end}}">
                    {{if .Repo.IsStarred}}
                    <svg class="octicon mr-1 color-fg-attention" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Z"/>
                    </svg>
                    Starred
                    {{else}}
                    <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"/>
                    </svg>
                    Star
                    {{end}}
                    <span class="dropdown-caret ml-1"></span>
                </button>
                <a href="/{{.Repo.FullName}}/stargazers" class="btn btn-sm BtnGroup-item BtnGroup-item--count">{{.Repo.StargazersCount}}</a>
            </div>

            <div class="BtnGroup ml-2">
                <button class="btn btn-sm BtnGroup-item BtnGroup-item--label">
                    <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"/>
                    </svg>
                    Fork
                    <span class="dropdown-caret ml-1"></span>
                </button>
                <a href="/{{.Repo.FullName}}/forks" class="btn btn-sm BtnGroup-item BtnGroup-item--count">{{.Repo.ForksCount}}</a>
            </div>
        </div>
        {{end}}
    </div>
</div>

<nav class="UnderlineNav">
    <div class="UnderlineNav-body">
        {{range .Repo.Tabs}}
        <a href="{{.URL}}" class="UnderlineNav-item{{if .Active}} selected{{end}}">
            {{if eq .Icon "code"}}
            <svg class="octicon UnderlineNav-octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                <path d="m11.28 3.22 4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L13.94 8l-3.72-3.72a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215Zm-6.56 0a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L2.06 8l3.72 3.72a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L.47 8.53a.75.75 0 0 1 0-1.06Z"/>
            </svg>
            {{else if eq .Icon "issue-opened"}}
            <svg class="octicon UnderlineNav-octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"/><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"/>
            </svg>
            {{else if eq .Icon "git-pull-request"}}
            <svg class="octicon UnderlineNav-octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                <path d="M1.5 3.25a2.25 2.25 0 1 1 3 2.122v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.25 2.25 0 0 1 1.5 3.25Zm5.677-.177L9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM3.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm0 9.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm8.25.75a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Z"/>
            </svg>
            {{else if eq .Icon "book"}}
            <svg class="octicon UnderlineNav-octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                <path d="M0 1.75A.75.75 0 0 1 .75 1h4.253c1.227 0 2.317.59 3 1.501A3.743 3.743 0 0 1 11.006 1h4.245a.75.75 0 0 1 .75.75v10.5a.75.75 0 0 1-.75.75h-4.507a2.25 2.25 0 0 0-1.591.659l-.622.621a.75.75 0 0 1-1.06 0l-.622-.621A2.25 2.25 0 0 0 5.258 13H.75a.75.75 0 0 1-.75-.75Zm7.251 10.324.004-5.073-.002-2.253A2.25 2.25 0 0 0 5.003 2.5H1.5v9h3.757a3.75 3.75 0 0 1 1.994.574ZM8.755 4.75l-.004 7.322a3.752 3.752 0 0 1 1.992-.572H14.5v-9h-3.495a2.25 2.25 0 0 0-2.25 2.25Z"/>
            </svg>
            {{else if eq .Icon "gear"}}
            <svg class="octicon UnderlineNav-octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                <path d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.04.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.102-.302c-.067-.019-.177-.011-.3.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.211.224l-.29 1.106c-.168.646-.715 1.196-1.458 1.26a8.006 8.006 0 0 1-1.402 0c-.743-.064-1.289-.614-1.458-1.26l-.289-1.106c-.018-.066-.079-.158-.212-.224a5.738 5.738 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.12 8.12 0 0 1-.704-1.218c-.315-.675-.111-1.422.363-1.891l.815-.806c.05-.048.098-.147.088-.294a6.214 6.214 0 0 1 0-.772c.01-.147-.04-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.102.302c.067.019.177.011.3-.071.214-.143.437-.272.668-.386.133-.066.194-.158.211-.224l.29-1.106C6.009.645 6.556.095 7.299.03 7.53.01 7.764 0 8 0Zm-.571 1.525c-.036.003-.108.036-.137.146l-.289 1.105c-.147.561-.549.967-.998 1.189-.173.086-.34.183-.5.29-.417.278-.97.423-1.529.27l-1.103-.303c-.109-.03-.175.016-.195.045-.22.312-.412.644-.573.99-.014.031-.021.11.059.19l.815.806c.411.406.562.957.53 1.456a4.709 4.709 0 0 0 0 .582c.032.499-.119 1.05-.53 1.456l-.815.806c-.081.08-.073.159-.059.19.162.346.353.677.573.989.02.03.085.076.195.046l1.102-.303c.56-.153 1.113-.008 1.53.27.161.107.328.204.501.29.447.222.85.629.997 1.189l.289 1.105c.029.109.101.143.137.146a6.6 6.6 0 0 0 1.142 0c.036-.003.108-.036.137-.146l.289-1.105c.147-.561.549-.967.998-1.189.173-.086.34-.183.5-.29.417-.278.97-.423 1.529-.27l1.103.303c.109.029.175-.016.195-.045.22-.313.411-.644.573-.99.014-.031.021-.11-.059-.19l-.815-.806c-.411-.406-.562-.957-.53-1.456a4.709 4.709 0 0 0 0-.582c-.032-.499.119-1.05.53-1.456l.815-.806c.081-.08.073-.159.059-.19a6.464 6.464 0 0 0-.573-.989c-.02-.03-.085-.076-.195-.046l-1.102.303c-.56.153-1.113.008-1.53-.27a4.44 4.44 0 0 0-.501-.29c-.447-.222-.85-.629-.997-1.189l-.289-1.105c-.029-.11-.101-.143-.137-.146a6.6 6.6 0 0 0-1.142 0ZM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM9.5 8a1.5 1.5 0 1 0-3.001.001A1.5 1.5 0 0 0 9.5 8Z"/>
            </svg>
            {{end}}
            <span>{{.Name}}</span>
            {{if gt .Count 0}}
            <span class="Counter">{{.Count}}</span>
            {{end}}
        </a>
        {{end}}
    </div>
</nav>

<div class="container-xl">
    <div class="mt-4">
        <!-- File Navigation -->
        <div class="file-navigation mb-3">
            <div class="d-flex flex-justify-between">
                <div class="d-flex flex-items-center">
                    <button class="btn btn-sm mr-2">
                        <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                            <path d="M9.5 3.25a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.493 2.493 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25Z"/>
                        </svg>
                        <span>{{.CurrentBranch}}</span>
                        <span class="dropdown-caret"></span>
                    </button>
                    {{if .Branches}}
                    <span class="color-fg-muted f6">{{len .Branches}} branches</span>
                    {{end}}
                </div>

                <div class="d-flex flex-items-center">
                    <a href="/{{.Repo.FullName}}/find/{{.CurrentBranch}}" class="btn btn-sm mr-2">Go to file</a>
                    <button class="btn btn-sm btn-primary">
                        <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                            <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
                            <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
                        </svg>
                        Code
                    </button>
                </div>
            </div>
        </div>

        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb-nav mb-3">
            {{range $i, $b := .Breadcrumbs}}
            {{if $i}} / {{end}}
            {{if $b.URL}}
            <a href="{{$b.URL}}" class="Link--primary">{{$b.Label}}</a>
            {{else}}
            <strong>{{$b.Label}}</strong>
            {{end}}
            {{end}}
        </nav>

        <!-- File Content -->
        <div class="Box">
            <div class="Box-header d-flex flex-items-center flex-justify-between">
                <div class="d-flex flex-items-center">
                    <svg class="octicon mr-2 color-fg-muted" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688Z"/>
                    </svg>
                    <span class="text-bold">{{.FileName}}</span>
                    <span class="color-fg-muted ml-2 f6">{{.LineCount}} lines{{if .FileSizeHuman}} ({{.FileSizeHuman}}){{end}}</span>
                </div>
                <div class="d-flex flex-items-center">
                    {{if .IsMarkdown}}
                    <div class="BtnGroup mr-2">
                        <button class="btn btn-sm BtnGroup-item" id="previewBtn" onclick="showPreview()">Preview</button>
                        <button class="btn btn-sm BtnGroup-item selected" id="codeViewBtn" onclick="showCode()">Code</button>
                    </div>
                    {{end}}
                    <div class="BtnGroup">
                        <a href="/{{.Repo.FullName}}/raw/{{.CurrentBranch}}/{{.FilePath}}" class="btn btn-sm BtnGroup-item" title="View raw">Raw</a>
                        <button class="btn btn-sm BtnGroup-item" id="copyRawBtn" onclick="copyContent()" title="Copy raw file">
                            <svg class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                                <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
                                <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
                            </svg>
                        </button>
                        <a href="/{{.Repo.FullName}}/raw/{{.CurrentBranch}}/{{.FilePath}}" download class="btn btn-sm BtnGroup-item" title="Download raw file">
                            <svg class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                                <path d="M2.75 14A1.75 1.75 0 0 1 1 12.25v-2.5a.75.75 0 0 1 1.5 0v2.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-2.5a.75.75 0 0 1 1.5 0v2.5A1.75 1.75 0 0 1 13.25 14Z"/>
                                <path d="M7.25 7.689V2a.75.75 0 0 1 1.5 0v5.689l1.97-1.969a.749.749 0 1 1 1.06 1.06l-3.25 3.25a.749.749 0 0 1-1.06 0L4.22 6.78a.749.749 0 1 1 1.06-1.06l1.97 1.969Z"/>
                            </svg>
                        </a>
                    </div>
                    <a href="/{{.Repo.FullName}}/blame/{{.CurrentBranch}}/{{.FilePath}}" class="btn btn-sm ml-2" title="Blame">
                        <svg class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                            <path d="M8 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5ZM8 12a4 4 0 1 1 0-8 4 4 0 0 1 0 8ZM8 0a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0Zm0 13a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 8 13ZM2.343 2.343a.75.75 0 0 1 1.061 0l1.06 1.061a.75.75 0 0 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06Zm9.193 9.193a.75.75 0 0 1 1.06 0l1.061 1.06a.75.75 0 0 1-1.06 1.061l-1.061-1.06a.75.75 0 0 1 0-1.061ZM0 8a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5H.75A.75.75 0 0 1 0 8Zm13 0a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5A.75.75 0 0 1 13 8Zm-9.657 2.404a.75.75 0 0 1 0 1.06l-1.06 1.061a.75.75 0 0 1-1.061-1.06l1.06-1.061a.75.75 0 0 1 1.061 0Zm9.193-9.193a.75.75 0 0 1 0 1.06l-1.06 1.061a.75.75 0 0 1-1.061-1.06l1.06-1.061a.75.75 0 0 1 1.061 0Z"/>
                        </svg>
                        Blame
                    </a>
                    {{if .User}}
                    <a href="/{{.Repo.FullName}}/edit/{{.CurrentBranch}}/{{.FilePath}}" class="btn btn-sm ml-2" title="Edit this file">
                        <svg class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                            <path d="M11.013 1.427a1.75 1.75 0 0 1 2.474 0l1.086 1.086a1.75 1.75 0 0 1 0 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 0 1-.927-.928l.929-3.25c.081-.286.235-.547.445-.758l8.61-8.61Zm.176 4.823L9.75 4.81l-6.286 6.287a.253.253 0 0 0-.064.108l-.558 1.953 1.953-.558a.253.253 0 0 0 .108-.064Zm1.238-3.763a.25.25 0 0 0-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 0 0 0-.354Z"/>
                        </svg>
                    </a>
                    {{end}}
                </div>
            </div>

            {{if .IsImage}}
            <div class="Box-body text-center p-4" style="background-color: var(--color-canvas-subtle, #f6f8fa);">
                <img src="/{{.Repo.FullName}}/raw/{{.CurrentBranch}}/{{.FilePath}}"
                     alt="{{.FileName}}"
                     style="max-width: 100%; max-height: 80vh; border: 1px solid var(--color-border-default, #d0d7de); border-radius: 6px;">
            </div>
            {{else if .IsBinary}}
            <div class="Box-body blankslate">
                <h3>Binary file not shown</h3>
                <p>This file is binary and cannot be displayed.</p>
                <a href="/{{.Repo.FullName}}/raw/{{.CurrentBranch}}/{{.FilePath}}" class="btn btn-primary">Download</a>
            </div>
            {{else}}
            {{if .IsMarkdown}}
            <!-- Markdown Preview (hidden by default) -->
            <div class="Box-body markdown-body p-4" id="markdownPreview" style="display: none;">
                {{.MarkdownHTML}}
            </div>
            {{end}}
            <!-- Code View -->
            <div class="Box-body p-0" id="codeView">
                <div class="code-view">
                    <table class="code-table">
                        <tbody>
                            {{$content := .FileContent}}
                            {{$lines := split $content "\n"}}
                            {{range $i, $line := $lines}}
                            <tr id="L{{add $i 1}}">
                                <td class="code-line-number" data-line-number="{{add $i 1}}" onclick="selectLine({{add $i 1}})"></td>
                                <td class="code-line-content"><span class="code-line-text">{{$line}}</span></td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
            </div>
            {{end}}
        </div>
    </div>
</div>

<!-- Highlight.js for syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<style>
.code-view {
    overflow-x: auto;
    overflow-y: visible;
}

.code-table {
    width: 100%;
    border-collapse: collapse;
    border-spacing: 0;
    font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
    font-size: 12px;
    line-height: 20px;
    tab-size: 4;
}

.code-line-number {
    width: 1%;
    min-width: 50px;
    padding: 0 10px;
    text-align: right;
    color: var(--color-fg-muted, #656d76);
    vertical-align: top;
    user-select: none;
    cursor: pointer;
    white-space: nowrap;
}

.code-line-number::before {
    content: attr(data-line-number);
}

.code-line-number:hover {
    color: var(--color-accent-fg, #0969da);
}

tr.highlighted .code-line-number,
tr.highlighted .code-line-content {
    background-color: var(--color-attention-subtle, #fff8c5);
}

.code-line-content {
    padding: 0 10px;
    white-space: pre;
    vertical-align: top;
    overflow-x: visible;
    word-wrap: normal;
}

.code-line-content pre {
    display: inline;
    margin: 0;
    padding: 0;
    background: none;
    border: none;
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
    white-space: pre;
    overflow: visible;
}

.code-line-content code {
    display: inline;
    padding: 0;
    margin: 0;
    background: none;
    border: none;
    border-radius: 0;
    white-space: pre;
    font-size: inherit;
}

/* Override highlight.js background */
.code-line-content code.hljs {
    display: inline;
    background: transparent;
    padding: 0;
    white-space: pre;
}

.code-line-text {
    white-space: pre;
}

.breadcrumb-nav {
    font-size: 14px;
}

/* Markdown body styles */
.markdown-body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
}

.markdown-body h1 { font-size: 2em; border-bottom: 1px solid var(--color-border-muted, #d0d7de); padding-bottom: 0.3em; margin-top: 24px; margin-bottom: 16px; }
.markdown-body h2 { font-size: 1.5em; border-bottom: 1px solid var(--color-border-muted, #d0d7de); padding-bottom: 0.3em; margin-top: 24px; margin-bottom: 16px; }
.markdown-body h3 { font-size: 1.25em; margin-top: 24px; margin-bottom: 16px; }
.markdown-body h4 { font-size: 1em; margin-top: 24px; margin-bottom: 16px; }
.markdown-body p { margin-top: 0; margin-bottom: 16px; }
.markdown-body code { padding: 0.2em 0.4em; background-color: var(--color-neutral-muted, rgba(175,184,193,0.2)); border-radius: 6px; font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace; font-size: 85%; }
.markdown-body pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; background-color: var(--color-canvas-subtle, #f6f8fa); border-radius: 6px; }
.markdown-body pre code { padding: 0; background: transparent; }
.markdown-body a { color: var(--color-accent-fg, #0969da); text-decoration: none; }
.markdown-body a:hover { text-decoration: underline; }
.markdown-body ul, .markdown-body ol { padding-left: 2em; margin-top: 0; margin-bottom: 16px; }
.markdown-body li { margin-top: 0.25em; }
.markdown-body blockquote { padding: 0 1em; color: var(--color-fg-muted, #656d76); border-left: 0.25em solid var(--color-border-default, #d0d7de); margin: 0 0 16px 0; }
.markdown-body img { max-width: 100%; height: auto; }
.markdown-body table { border-spacing: 0; border-collapse: collapse; margin-bottom: 16px; }
.markdown-body table th, .markdown-body table td { padding: 6px 13px; border: 1px solid var(--color-border-default, #d0d7de); }
.markdown-body table th { font-weight: 600; background-color: var(--color-canvas-subtle, #f6f8fa); }
.markdown-body table tr:nth-child(2n) { background-color: var(--color-canvas-subtle, #f6f8fa); }

/* Button group styles */
.BtnGroup-item.selected {
    background-color: var(--color-btn-selected-bg, #e8e8e8);
    border-color: var(--color-btn-border, rgba(31,35,40,0.15));
}
</style>

<script>
// Syntax highlighting
document.addEventListener('DOMContentLoaded', function() {
    // Apply syntax highlighting to each line
    const language = '{{.Language}}';
    if (language && hljs.getLanguage(language)) {
        document.querySelectorAll('.code-line-text').forEach((el) => {
            const result = hljs.highlight(el.textContent, { language: language });
            el.innerHTML = result.value;
        });
    }

    // Handle line linking from URL hash
    highlightLinesFromHash();
});

// Handle hash change for line linking
window.addEventListener('hashchange', highlightLinesFromHash);

function highlightLinesFromHash() {
    // Clear previous highlights
    document.querySelectorAll('tr.highlighted').forEach(el => el.classList.remove('highlighted'));

    const hash = window.location.hash;
    const match = hash.match(/^#L(\d+)(-L(\d+))?$/);
    if (match) {
        const start = parseInt(match[1]);
        const end = match[3] ? parseInt(match[3]) : start;
        for (let i = start; i <= end; i++) {
            const row = document.getElementById('L' + i);
            if (row) {
                row.classList.add('highlighted');
                if (i === start) {
                    row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }
    }
}

function selectLine(lineNum) {
    window.location.hash = 'L' + lineNum;
}

{{if .IsMarkdown}}
function showPreview() {
    document.getElementById('codeView').style.display = 'none';
    document.getElementById('markdownPreview').style.display = 'block';
    document.getElementById('previewBtn').classList.add('selected');
    document.getElementById('codeBtn').classList.remove('selected');
}

function showCode() {
    document.getElementById('codeView').style.display = 'block';
    document.getElementById('markdownPreview').style.display = 'none';
    document.getElementById('previewBtn').classList.remove('selected');
    document.getElementById('codeBtn').classList.add('selected');
}
{{end}}

function copyContent() {
    const content = document.querySelector('#codeView .code-view').innerText;
    navigator.clipboard.writeText(content).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.innerHTML = '<svg class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>';
        setTimeout(() => {
            btn.innerHTML = '<svg class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg>';
        }, 2000);
    });
}
</script>
{{end}}
