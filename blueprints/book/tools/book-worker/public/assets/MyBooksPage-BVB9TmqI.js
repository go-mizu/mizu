import{j as s,H as w,S as C,B as P,b as m}from"./index-_5h7tsLS.js";import{r as i,L as B}from"./react-vendor-bJoUFh3v.js";import{B as D}from"./BookCard-CQlmd34Y.js";import{B as R}from"./BookGrid-C9hlJN2i.js";import{u as $}from"./ShelfButton-BC7JraQB.js";import{u as E}from"./uiStore-JILr7JTv.js";import{g as I,D as F,h as G,L as M,i as T}from"./ui-hgVKSatf.js";import"./middleware-WYGlAF-S.js";function U({shelves:o,activeShelf:x,onSelect:a,children:u}){if(u)return s.jsx("aside",{className:"sidebar",children:u});const l=(o||[]).reduce((n,r)=>n+r.book_count,0);return s.jsxs("aside",{className:"sidebar",children:[s.jsx("h3",{children:"Bookshelves"}),s.jsxs("button",{type:"button",className:`sidebar-link${x===void 0?" active":""}`,onClick:()=>a?.(0),children:[s.jsx("span",{children:"All"}),s.jsx("span",{className:"sidebar-count",children:l})]}),(o||[]).map(n=>s.jsxs("button",{type:"button",className:`sidebar-link${x===n.id?" active":""}`,onClick:()=>a?.(n.id),children:[s.jsx("span",{children:n.name}),s.jsx("span",{className:"sidebar-count",children:n.book_count})]},n.id)),s.jsx("button",{type:"button",className:"sidebar-link sidebar-link-add",onClick:()=>a?.(-1),children:s.jsx("span",{children:"+ Add shelf"})})]})}function Y(){const[o,x]=i.useState([]),[a,u]=i.useState(null),[l,n]=i.useState(null),[r,p]=i.useState(1),[g,k]=i.useState(!0),[d,v]=i.useState(!1),[y,z]=i.useState(null),h=E(e=>e.shelfView),f=E(e=>e.setShelfView),S=$(e=>e.setShelves),j=20,N=l?Math.ceil(l.total_count/j):0;i.useEffect(()=>{(async()=>{k(!0);try{const t=await m.getShelves();x(t),S(t)}catch(t){z(t instanceof Error?t.message:"Failed to load shelves")}finally{k(!1)}})()},[S]),i.useEffect(()=>{g||(async()=>{v(!0);try{if(a===null){const t=await m.search("",r,j);n({...t,shelfBooks:void 0})}else{const t=await m.getShelfBooks(a,r,j);n(t)}}catch{n({books:[],total_count:0,page:1,page_size:j})}finally{v(!1)}})()},[a,r,g]);const _=e=>{u(e),p(1)},L=()=>{const e=document.createElement("input");e.type="file",e.accept=".csv",e.onchange=async t=>{const b=t.target.files?.[0];if(b)try{await m.importCSV(b),window.location.reload()}catch{}},e.click()},V=()=>{m.exportCSV()},A=a===null?"All":o.find(e=>e.id===a)?.name||"Shelf",c=l?.books||[];return g?s.jsxs(s.Fragment,{children:[s.jsx(w,{}),s.jsx("div",{className:"loading-spinner",children:s.jsx("div",{className:"spinner"})})]}):s.jsxs(s.Fragment,{children:[s.jsx(w,{}),s.jsxs("div",{className:"page-with-sidebar fade-in",children:[s.jsxs(U,{children:[s.jsx("h3",{children:"Bookshelves"}),s.jsxs("button",{type:"button",className:`sidebar-link ${a===null?"active":""}`,onClick:()=>_(null),children:[s.jsx("span",{children:"All"}),s.jsx("span",{className:"sidebar-count",children:o.reduce((e,t)=>e+t.book_count,0)})]}),o.map(e=>s.jsxs("button",{type:"button",className:`sidebar-link ${a===e.id?"active":""}`,onClick:()=>_(e.id),children:[s.jsx("span",{children:e.name}),s.jsx("span",{className:"sidebar-count",children:e.book_count})]},e.id))]}),s.jsxs("main",{children:[s.jsxs("div",{className:"mybooks-header",children:[s.jsxs("h1",{className:"page-title mybooks-title",children:[A,l&&s.jsxs("span",{className:"page-count",children:["(",l.total_count,")"]})]}),s.jsxs("div",{className:"mybooks-controls",children:[s.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:L,title:"Import CSV",children:[s.jsx(I,{size:14}),"Import"]}),s.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:V,title:"Export CSV",children:[s.jsx(F,{size:14}),"Export"]}),s.jsxs("div",{className:"view-toggle",role:"group","aria-label":"View mode",children:[s.jsx("button",{type:"button",onClick:()=>f("grid"),className:h==="grid"?"active":"",title:"Grid view",children:s.jsx(G,{size:16})}),s.jsx("button",{type:"button",onClick:()=>f("list"),className:h==="list"?"active":"",title:"List view",children:s.jsx(M,{size:16})}),s.jsx("button",{type:"button",onClick:()=>f("table"),className:h==="table"?"active":"",title:"Table view",children:s.jsx(T,{size:16})})]})]})]}),y&&s.jsx("div",{className:"empty-state",children:s.jsx("p",{children:y})}),d&&s.jsx("div",{className:"loading-spinner",children:s.jsx("div",{className:"spinner"})}),!d&&c.length===0&&s.jsxs("div",{className:"empty-state",children:[s.jsx("h3",{children:"No books on this shelf"}),s.jsx("p",{children:"Search for books and add them to your shelves."}),s.jsx(B,{to:"/browse",className:"btn btn-primary",children:"Browse books"})]}),!d&&c.length>0&&h==="grid"&&s.jsx(R,{books:c}),!d&&c.length>0&&h==="list"&&s.jsx("div",{children:c.map(e=>s.jsxs("div",{className:"mybooks-list-row",children:[s.jsx("div",{className:"mybooks-list-main",children:s.jsx(D,{book:e})}),s.jsxs("div",{className:"mybooks-list-meta",children:[e.user_shelf&&s.jsx("span",{className:"genre-tag mybooks-shelf-tag",children:e.user_shelf}),e.user_rating!=null&&e.user_rating>0&&s.jsx("div",{className:"mybooks-list-rating",children:s.jsx(C,{rating:e.user_rating,size:14})})]})]},e.id))}),!d&&c.length>0&&h==="table"&&s.jsxs("table",{className:"book-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Cover"}),s.jsx("th",{children:"Title"}),s.jsx("th",{children:"Author"}),s.jsx("th",{children:"Rating"}),s.jsx("th",{children:"Shelf"}),s.jsx("th",{children:"Date Read"}),s.jsx("th",{children:"Pages"})]})}),s.jsx("tbody",{children:c.map(e=>{const t=l?.shelfBooks?.find(b=>b.book_id===e.id);return s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx(P,{book:e,size:"sm"})}),s.jsx("td",{children:s.jsx(B,{to:`/book/${e.id}`,className:"table-book-link",children:e.title})}),s.jsx("td",{children:s.jsx("span",{children:e.author_names})}),s.jsx("td",{children:e.user_rating!=null&&e.user_rating>0?s.jsx(C,{rating:e.user_rating,size:12}):s.jsx("span",{className:"table-muted",children:"--"})}),s.jsx("td",{children:e.user_shelf&&s.jsx("span",{className:"genre-tag",children:e.user_shelf})}),s.jsx("td",{className:"table-muted",children:t?.date_read?new Date(t.date_read).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"--"}),s.jsx("td",{className:"table-muted",children:e.page_count||"--"})]},e.id)})})]}),!d&&N>1&&s.jsxs("div",{className:"pagination-row",children:[s.jsx("button",{className:"btn btn-secondary btn-sm",disabled:r<=1,onClick:()=>p(e=>Math.max(1,e-1)),children:"Previous"}),s.jsxs("span",{className:"pagination-text",children:["Page ",r," of ",N]}),s.jsx("button",{className:"btn btn-secondary btn-sm",disabled:r>=N,onClick:()=>p(e=>e+1),children:"Next"})]})]})]})]})}export{Y as default};
