import{j as r,b}from"./index-C-ixEFdY.js";import{r as o}from"./react-vendor-bJoUFh3v.js";import{p as k}from"./middleware-WYGlAF-S.js";import{m as S,n as h,o as y}from"./ui-RIRksdBL.js";const j=S()(k(s=>({query:"",results:null,isLoading:!1,error:null,shelves:[],currentBook:null,recentBooks:[],setQuery:e=>s({query:e}),setResults:e=>s({results:e}),setLoading:e=>s({isLoading:e}),setError:e=>s({error:e}),setShelves:e=>s({shelves:e}),setCurrentBook:e=>s({currentBook:e}),addRecentBook:e=>s(a=>({recentBooks:[e,...a.recentBooks.filter(l=>l.id!==e.id)].slice(0,20)}))}),{name:"book-store",partialize:s=>({recentBooks:s.recentBooks})}));function z({book:s,shelves:e}){const a=j(n=>n.shelves),l=e??a,[u,i]=o.useState(!1),[c,m]=o.useState(s.user_shelf||""),[x,p]=o.useState(!1),d=o.useRef(null);o.useEffect(()=>{const n=t=>{d.current&&!d.current.contains(t.target)&&i(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const g=async n=>{p(!0);try{await b.addToShelf(n.id,s.id),m(n.name)}catch{}finally{p(!1),i(!1)}},v=c||"Want to Read",f=!!c;return r.jsxs("div",{ref:d,style:{position:"relative",display:"inline-block"},children:[r.jsxs("button",{className:`shelf-btn${f?" shelved":""}`,onClick:()=>i(!u),disabled:x,children:[f&&r.jsx(h,{size:14}),r.jsx("span",{children:v}),r.jsx("span",{className:"dropdown-arrow",children:r.jsx(y,{size:14})})]}),u&&r.jsx("div",{style:{position:"absolute",top:"100%",left:0,marginTop:4,background:"#fff",border:"1px solid var(--gr-border)",borderRadius:4,boxShadow:"0 4px 12px rgba(0,0,0,0.12)",minWidth:180,zIndex:20},children:l.map(n=>r.jsxs("button",{onClick:()=>g(n),style:{display:"flex",alignItems:"center",gap:8,width:"100%",padding:"8px 12px",border:"none",background:"none",cursor:"pointer",fontSize:14,fontFamily:"inherit",color:"var(--gr-text)",textAlign:"left"},onMouseEnter:t=>t.currentTarget.style.background="var(--gr-hover)",onMouseLeave:t=>t.currentTarget.style.background="none",children:[c===n.name&&r.jsx(h,{size:14,style:{color:"var(--gr-green)"}}),r.jsx("span",{children:n.name})]},n.id))})]})}export{z as S,j as u};
