import{j as e,H as _,S as B,B as A,b as x}from"./index-smKHW-e9.js";import{r as i,L as v}from"./react-vendor-bJoUFh3v.js";import{B as T}from"./BookCard-B83x_7cL.js";import{B as P}from"./BookGrid-B6fdp-rd.js";import{u as $}from"./ShelfButton-CIJiR5zA.js";import{u as z}from"./uiStore-DyCOGjzk.js";import{U as R,D,d as F,L as G,e as M}from"./ui-CwMuETwS.js";import"./middleware-WYGlAF-S.js";function W({shelves:c,activeShelf:j,onSelect:n,children:g}){if(g)return e.jsx("aside",{className:"sidebar",children:g});const l=(c||[]).reduce((r,a)=>r+a.book_count,0);return e.jsxs("aside",{className:"sidebar",children:[e.jsx("h3",{children:"Bookshelves"}),e.jsxs("button",{className:`sidebar-link${j===void 0?" active":""}`,onClick:()=>n?.(0),children:[e.jsx("span",{children:"All"}),e.jsx("span",{className:"sidebar-count",children:l})]}),(c||[]).map(r=>e.jsxs("button",{className:`sidebar-link${j===r.id?" active":""}`,onClick:()=>n?.(r.id),children:[e.jsx("span",{children:r.name}),e.jsx("span",{className:"sidebar-count",children:r.book_count})]},r.id)),e.jsx("button",{className:"sidebar-link",style:{color:"var(--gr-teal)",marginTop:8,fontWeight:700,fontSize:13},onClick:()=>n?.(-1),children:e.jsx("span",{children:"+ Add shelf"})})]})}function Y(){const[c,j]=i.useState([]),[n,g]=i.useState(null),[l,r]=i.useState(null),[a,u]=i.useState(1),[m,y]=i.useState(!0),[d,S]=i.useState(!1),[k,E]=i.useState(null),h=z(s=>s.shelfView),p=z(s=>s.setShelfView),N=$(s=>s.setShelves),f=20,b=l?Math.ceil(l.total_count/f):0;i.useEffect(()=>{(async()=>{y(!0);try{const t=await x.getShelves();j(t),N(t)}catch(t){E(t instanceof Error?t.message:"Failed to load shelves")}finally{y(!1)}})()},[N]),i.useEffect(()=>{m||(async()=>{S(!0);try{if(n===null){const t=await x.search("",a,f);r(t)}else{const t=await x.getShelfBooks(n,a,f);r(t)}}catch{r({books:[],total_count:0})}finally{S(!1)}})()},[n,a,m]);const w=s=>{g(s),u(1)},L=()=>{const s=document.createElement("input");s.type="file",s.accept=".csv",s.onchange=async t=>{const C=t.target.files?.[0];if(C)try{await x.importCSV(C),window.location.reload()}catch{}},s.click()},I=()=>{x.exportCSV()},V=n===null?"All":c.find(s=>s.id===n)?.name||"Shelf",o=l?.books||[];return m?e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsxs("div",{className:"page-with-sidebar fade-in",children:[e.jsxs(W,{children:[e.jsx("h3",{children:"Bookshelves"}),e.jsxs("a",{className:`sidebar-link ${n===null?"active":""}`,onClick:()=>w(null),style:{cursor:"pointer"},children:[e.jsx("span",{children:"All"}),e.jsx("span",{className:"sidebar-count",children:c.reduce((s,t)=>s+t.book_count,0)})]}),c.map(s=>e.jsxs("a",{className:`sidebar-link ${n===s.id?"active":""}`,onClick:()=>w(s.id),style:{cursor:"pointer"},children:[e.jsx("span",{children:s.name}),e.jsx("span",{className:"sidebar-count",children:s.book_count})]},s.id))]}),e.jsxs("main",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20},children:[e.jsxs("h1",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:20,fontWeight:700,color:"var(--gr-brown)",margin:0},children:[V,l&&e.jsxs("span",{style:{fontWeight:400,fontSize:14,color:"var(--gr-light)",marginLeft:8},children:["(",l.total_count,")"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:L,title:"Import CSV",children:[e.jsx(R,{size:14}),"Import"]}),e.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:I,title:"Export CSV",children:[e.jsx(D,{size:14}),"Export"]}),e.jsxs("div",{style:{display:"flex",border:"1px solid var(--gr-border)",borderRadius:4,overflow:"hidden",marginLeft:8},children:[e.jsx("button",{onClick:()=>p("grid"),style:{padding:"4px 8px",background:h==="grid"?"var(--gr-hover)":"transparent",border:"none",cursor:"pointer",color:"var(--gr-text)"},title:"Grid view",children:e.jsx(F,{size:16})}),e.jsx("button",{onClick:()=>p("list"),style:{padding:"4px 8px",background:h==="list"?"var(--gr-hover)":"transparent",border:"none",cursor:"pointer",color:"var(--gr-text)"},title:"List view",children:e.jsx(G,{size:16})}),e.jsx("button",{onClick:()=>p("table"),style:{padding:"4px 8px",background:h==="table"?"var(--gr-hover)":"transparent",border:"none",cursor:"pointer",color:"var(--gr-text)"},title:"Table view",children:e.jsx(M,{size:16})})]})]})]}),k&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:k})}),d&&e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})}),!d&&o.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No books on this shelf"}),e.jsx("p",{children:"Search for books and add them to your shelves."}),e.jsx(v,{to:"/browse",className:"btn btn-primary",children:"Browse books"})]}),!d&&o.length>0&&h==="grid"&&e.jsx(P,{books:o}),!d&&o.length>0&&h==="list"&&e.jsx("div",{children:o.map(s=>e.jsxs("div",{style:{display:"flex",alignItems:"start"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(T,{book:s})}),e.jsxs("div",{style:{textAlign:"right",flexShrink:0,paddingTop:16},children:[s.user_shelf&&e.jsx("span",{className:"genre-tag",style:{marginBottom:4,display:"inline-block"},children:s.user_shelf}),s.user_rating!=null&&s.user_rating>0&&e.jsx("div",{style:{marginTop:4},children:e.jsx(B,{rating:s.user_rating,size:14})})]})]},s.id))}),!d&&o.length>0&&h==="table"&&e.jsxs("table",{className:"book-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cover"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Author"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Shelf"}),e.jsx("th",{children:"Pages"})]})}),e.jsx("tbody",{children:o.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(A,{book:s,size:"sm"})}),e.jsx("td",{children:e.jsx(v,{to:`/book/${s.id}`,style:{fontWeight:700,color:"var(--gr-brown)",textDecoration:"none"},children:s.title})}),e.jsx("td",{children:e.jsx(v,{to:`/author/${s.author_id}`,style:{color:"var(--gr-text)",textDecoration:"none"},children:s.author_names})}),e.jsx("td",{children:s.user_rating!=null&&s.user_rating>0?e.jsx(B,{rating:s.user_rating,size:12}):e.jsx("span",{style:{color:"var(--gr-light)",fontSize:12},children:"--"})}),e.jsx("td",{children:s.user_shelf&&e.jsx("span",{className:"genre-tag",children:s.user_shelf})}),e.jsx("td",{style:{color:"var(--gr-light)"},children:s.page_count||"--"})]},s.id))})]}),!d&&b>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:16,marginTop:32},children:[e.jsx("button",{className:"btn btn-secondary btn-sm",disabled:a<=1,onClick:()=>u(s=>Math.max(1,s-1)),children:"Previous"}),e.jsxs("span",{style:{fontSize:14,color:"var(--gr-light)"},children:["Page ",a," of ",b]}),e.jsx("button",{className:"btn btn-secondary btn-sm",disabled:a>=b,onClick:()=>u(s=>s+1),children:"Next"})]})]})]})]})}export{Y as default};
