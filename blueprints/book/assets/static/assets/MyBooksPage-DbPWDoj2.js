import{j as s,H as _,S as C,B as P,b as m}from"./index-CR0Xjtpx.js";import{r as i,L as B}from"./react-vendor-bJoUFh3v.js";import{B as $}from"./BookCard-CXzI_kTH.js";import{B as I}from"./BookGrid-DUWYRpzv.js";import{u as R}from"./ShelfButton-RoCdupez.js";import{u as E}from"./uiStore-mTHBo38P.js";import{e as F,D as G,f as M,L as T,g as D}from"./ui-D_Yei50m.js";import"./middleware-WYGlAF-S.js";function H({shelves:o,activeShelf:x,onSelect:a,children:u}){if(u)return s.jsx("aside",{className:"sidebar",children:u});const c=(o||[]).reduce((n,l)=>n+l.book_count,0);return s.jsxs("aside",{className:"sidebar",children:[s.jsx("h3",{children:"Bookshelves"}),s.jsxs("button",{type:"button",className:`sidebar-link${x===void 0?" active":""}`,onClick:()=>a?.(0),children:[s.jsx("span",{children:"All"}),s.jsx("span",{className:"sidebar-count",children:c})]}),(o||[]).map(n=>s.jsxs("button",{type:"button",className:`sidebar-link${x===n.id?" active":""}`,onClick:()=>a?.(n.id),children:[s.jsx("span",{children:n.name}),s.jsx("span",{className:"sidebar-count",children:n.book_count})]},n.id)),s.jsx("button",{type:"button",className:"sidebar-link sidebar-link-add",onClick:()=>a?.(-1),children:s.jsx("span",{children:"+ Add shelf"})})]})}function Y(){const[o,x]=i.useState([]),[a,u]=i.useState(null),[c,n]=i.useState(null),[l,b]=i.useState(1),[p,N]=i.useState(!0),[d,v]=i.useState(!1),[k,z]=i.useState(null),h=E(e=>e.shelfView),g=E(e=>e.setShelfView),y=R(e=>e.setShelves),j=20,f=c?Math.ceil(c.total_count/j):0;i.useEffect(()=>{(async()=>{N(!0);try{const t=await m.getShelves();x(t),y(t)}catch(t){z(t instanceof Error?t.message:"Failed to load shelves")}finally{N(!1)}})()},[y]),i.useEffect(()=>{p||(async()=>{v(!0);try{if(a===null){const t=await m.search("",l,j);n(t)}else{const t=await m.getShelfBooks(a,l,j);n(t)}}catch{n({books:[],total_count:0,page:1,page_size:j})}finally{v(!1)}})()},[a,l,p]);const S=e=>{u(e),b(1)},V=()=>{const e=document.createElement("input");e.type="file",e.accept=".csv",e.onchange=async t=>{const w=t.target.files?.[0];if(w)try{await m.importCSV(w),window.location.reload()}catch{}},e.click()},L=()=>{m.exportCSV()},A=a===null?"All":o.find(e=>e.id===a)?.name||"Shelf",r=c?.books||[];return p?s.jsxs(s.Fragment,{children:[s.jsx(_,{}),s.jsx("div",{className:"loading-spinner",children:s.jsx("div",{className:"spinner"})})]}):s.jsxs(s.Fragment,{children:[s.jsx(_,{}),s.jsxs("div",{className:"page-with-sidebar fade-in",children:[s.jsxs(H,{children:[s.jsx("h3",{children:"Bookshelves"}),s.jsxs("button",{type:"button",className:`sidebar-link ${a===null?"active":""}`,onClick:()=>S(null),children:[s.jsx("span",{children:"All"}),s.jsx("span",{className:"sidebar-count",children:o.reduce((e,t)=>e+t.book_count,0)})]}),o.map(e=>s.jsxs("button",{type:"button",className:`sidebar-link ${a===e.id?"active":""}`,onClick:()=>S(e.id),children:[s.jsx("span",{children:e.name}),s.jsx("span",{className:"sidebar-count",children:e.book_count})]},e.id))]}),s.jsxs("main",{children:[s.jsxs("div",{className:"mybooks-header",children:[s.jsxs("h1",{className:"page-title mybooks-title",children:[A,c&&s.jsxs("span",{className:"page-count",children:["(",c.total_count,")"]})]}),s.jsxs("div",{className:"mybooks-controls",children:[s.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:V,title:"Import CSV",children:[s.jsx(F,{size:14}),"Import"]}),s.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:L,title:"Export CSV",children:[s.jsx(G,{size:14}),"Export"]}),s.jsxs("div",{className:"view-toggle",role:"group","aria-label":"View mode",children:[s.jsx("button",{type:"button",onClick:()=>g("grid"),className:h==="grid"?"active":"",title:"Grid view",children:s.jsx(M,{size:16})}),s.jsx("button",{type:"button",onClick:()=>g("list"),className:h==="list"?"active":"",title:"List view",children:s.jsx(T,{size:16})}),s.jsx("button",{type:"button",onClick:()=>g("table"),className:h==="table"?"active":"",title:"Table view",children:s.jsx(D,{size:16})})]})]})]}),k&&s.jsx("div",{className:"empty-state",children:s.jsx("p",{children:k})}),d&&s.jsx("div",{className:"loading-spinner",children:s.jsx("div",{className:"spinner"})}),!d&&r.length===0&&s.jsxs("div",{className:"empty-state",children:[s.jsx("h3",{children:"No books on this shelf"}),s.jsx("p",{children:"Search for books and add them to your shelves."}),s.jsx(B,{to:"/browse",className:"btn btn-primary",children:"Browse books"})]}),!d&&r.length>0&&h==="grid"&&s.jsx(I,{books:r}),!d&&r.length>0&&h==="list"&&s.jsx("div",{children:r.map(e=>s.jsxs("div",{className:"mybooks-list-row",children:[s.jsx("div",{className:"mybooks-list-main",children:s.jsx($,{book:e})}),s.jsxs("div",{className:"mybooks-list-meta",children:[e.user_shelf&&s.jsx("span",{className:"genre-tag mybooks-shelf-tag",children:e.user_shelf}),e.user_rating!=null&&e.user_rating>0&&s.jsx("div",{className:"mybooks-list-rating",children:s.jsx(C,{rating:e.user_rating,size:14})})]})]},e.id))}),!d&&r.length>0&&h==="table"&&s.jsxs("table",{className:"book-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Cover"}),s.jsx("th",{children:"Title"}),s.jsx("th",{children:"Author"}),s.jsx("th",{children:"Rating"}),s.jsx("th",{children:"Shelf"}),s.jsx("th",{children:"Pages"})]})}),s.jsx("tbody",{children:r.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx(P,{book:e,size:"sm"})}),s.jsx("td",{children:s.jsx(B,{to:`/book/${e.id}`,className:"table-book-link",children:e.title})}),s.jsx("td",{children:s.jsx("span",{children:e.author_names})}),s.jsx("td",{children:e.user_rating!=null&&e.user_rating>0?s.jsx(C,{rating:e.user_rating,size:12}):s.jsx("span",{className:"table-muted",children:"--"})}),s.jsx("td",{children:e.user_shelf&&s.jsx("span",{className:"genre-tag",children:e.user_shelf})}),s.jsx("td",{className:"table-muted",children:e.page_count||"--"})]},e.id))})]}),!d&&f>1&&s.jsxs("div",{className:"pagination-row",children:[s.jsx("button",{className:"btn btn-secondary btn-sm",disabled:l<=1,onClick:()=>b(e=>Math.max(1,e-1)),children:"Previous"}),s.jsxs("span",{className:"pagination-text",children:["Page ",l," of ",f]}),s.jsx("button",{className:"btn btn-secondary btn-sm",disabled:l>=f,onClick:()=>b(e=>e+1),children:"Next"})]})]})]})]})}export{Y as default};
