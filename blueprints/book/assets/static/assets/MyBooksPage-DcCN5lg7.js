import{j as e,H as C,S as _,B as A,b as x}from"./index-D_4FLS-X.js";import{r as i,L as B}from"./react-vendor-bJoUFh3v.js";import{B as T}from"./BookCard-BhnNLfSz.js";import{B as P}from"./BookGrid-CKHRnQ91.js";import{u as R}from"./ShelfButton-YBBNoQqA.js";import{u as z}from"./uiStore-mTHBo38P.js";import{e as $,D as F,f as G,L as M,g as W}from"./ui-D_Yei50m.js";import"./middleware-WYGlAF-S.js";function D({shelves:c,activeShelf:g,onSelect:n,children:j}){if(j)return e.jsx("aside",{className:"sidebar",children:j});const l=(c||[]).reduce((r,a)=>r+a.book_count,0);return e.jsxs("aside",{className:"sidebar",children:[e.jsx("h3",{children:"Bookshelves"}),e.jsxs("button",{className:`sidebar-link${g===void 0?" active":""}`,onClick:()=>n?.(0),children:[e.jsx("span",{children:"All"}),e.jsx("span",{className:"sidebar-count",children:l})]}),(c||[]).map(r=>e.jsxs("button",{className:`sidebar-link${g===r.id?" active":""}`,onClick:()=>n?.(r.id),children:[e.jsx("span",{children:r.name}),e.jsx("span",{className:"sidebar-count",children:r.book_count})]},r.id)),e.jsx("button",{className:"sidebar-link",style:{color:"var(--gr-teal)",marginTop:8,fontWeight:700,fontSize:13},onClick:()=>n?.(-1),children:e.jsx("span",{children:"+ Add shelf"})})]})}function Y(){const[c,g]=i.useState([]),[n,j]=i.useState(null),[l,r]=i.useState(null),[a,m]=i.useState(1),[u,v]=i.useState(!0),[d,y]=i.useState(!1),[S,E]=i.useState(null),h=z(s=>s.shelfView),f=z(s=>s.setShelfView),k=R(s=>s.setShelves),p=20,b=l?Math.ceil(l.total_count/p):0;i.useEffect(()=>{(async()=>{v(!0);try{const t=await x.getShelves();g(t),k(t)}catch(t){E(t instanceof Error?t.message:"Failed to load shelves")}finally{v(!1)}})()},[k]),i.useEffect(()=>{u||(async()=>{y(!0);try{if(n===null){const t=await x.search("",a,p);r(t)}else{const t=await x.getShelfBooks(n,a,p);r(t)}}catch{r({books:[],total_count:0,page:1,page_size:p})}finally{y(!1)}})()},[n,a,u]);const N=s=>{j(s),m(1)},L=()=>{const s=document.createElement("input");s.type="file",s.accept=".csv",s.onchange=async t=>{const w=t.target.files?.[0];if(w)try{await x.importCSV(w),window.location.reload()}catch{}},s.click()},I=()=>{x.exportCSV()},V=n===null?"All":c.find(s=>s.id===n)?.name||"Shelf",o=l?.books||[];return u?e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsxs("div",{className:"page-with-sidebar fade-in",children:[e.jsxs(D,{children:[e.jsx("h3",{children:"Bookshelves"}),e.jsxs("a",{className:`sidebar-link ${n===null?"active":""}`,onClick:()=>N(null),style:{cursor:"pointer"},children:[e.jsx("span",{children:"All"}),e.jsx("span",{className:"sidebar-count",children:c.reduce((s,t)=>s+t.book_count,0)})]}),c.map(s=>e.jsxs("a",{className:`sidebar-link ${n===s.id?"active":""}`,onClick:()=>N(s.id),style:{cursor:"pointer"},children:[e.jsx("span",{children:s.name}),e.jsx("span",{className:"sidebar-count",children:s.book_count})]},s.id))]}),e.jsxs("main",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20},children:[e.jsxs("h1",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:20,fontWeight:700,color:"var(--gr-brown)",margin:0},children:[V,l&&e.jsxs("span",{style:{fontWeight:400,fontSize:14,color:"var(--gr-light)",marginLeft:8},children:["(",l.total_count,")"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:L,title:"Import CSV",children:[e.jsx($,{size:14}),"Import"]}),e.jsxs("button",{className:"btn btn-secondary btn-sm",onClick:I,title:"Export CSV",children:[e.jsx(F,{size:14}),"Export"]}),e.jsxs("div",{style:{display:"flex",border:"1px solid var(--gr-border)",borderRadius:4,overflow:"hidden",marginLeft:8},children:[e.jsx("button",{onClick:()=>f("grid"),style:{padding:"4px 8px",background:h==="grid"?"var(--gr-hover)":"transparent",border:"none",cursor:"pointer",color:"var(--gr-text)"},title:"Grid view",children:e.jsx(G,{size:16})}),e.jsx("button",{onClick:()=>f("list"),style:{padding:"4px 8px",background:h==="list"?"var(--gr-hover)":"transparent",border:"none",cursor:"pointer",color:"var(--gr-text)"},title:"List view",children:e.jsx(M,{size:16})}),e.jsx("button",{onClick:()=>f("table"),style:{padding:"4px 8px",background:h==="table"?"var(--gr-hover)":"transparent",border:"none",cursor:"pointer",color:"var(--gr-text)"},title:"Table view",children:e.jsx(W,{size:16})})]})]})]}),S&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:S})}),d&&e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})}),!d&&o.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No books on this shelf"}),e.jsx("p",{children:"Search for books and add them to your shelves."}),e.jsx(B,{to:"/browse",className:"btn btn-primary",children:"Browse books"})]}),!d&&o.length>0&&h==="grid"&&e.jsx(P,{books:o}),!d&&o.length>0&&h==="list"&&e.jsx("div",{children:o.map(s=>e.jsxs("div",{style:{display:"flex",alignItems:"start"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(T,{book:s})}),e.jsxs("div",{style:{textAlign:"right",flexShrink:0,paddingTop:16},children:[s.user_shelf&&e.jsx("span",{className:"genre-tag",style:{marginBottom:4,display:"inline-block"},children:s.user_shelf}),s.user_rating!=null&&s.user_rating>0&&e.jsx("div",{style:{marginTop:4},children:e.jsx(_,{rating:s.user_rating,size:14})})]})]},s.id))}),!d&&o.length>0&&h==="table"&&e.jsxs("table",{className:"book-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cover"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Author"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Shelf"}),e.jsx("th",{children:"Pages"})]})}),e.jsx("tbody",{children:o.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(A,{book:s,size:"sm"})}),e.jsx("td",{children:e.jsx(B,{to:`/book/${s.id}`,style:{fontWeight:700,color:"var(--gr-brown)",textDecoration:"none"},children:s.title})}),e.jsx("td",{children:e.jsx("span",{style:{color:"var(--gr-text)"},children:s.author_names})}),e.jsx("td",{children:s.user_rating!=null&&s.user_rating>0?e.jsx(_,{rating:s.user_rating,size:12}):e.jsx("span",{style:{color:"var(--gr-light)",fontSize:12},children:"--"})}),e.jsx("td",{children:s.user_shelf&&e.jsx("span",{className:"genre-tag",children:s.user_shelf})}),e.jsx("td",{style:{color:"var(--gr-light)"},children:s.page_count||"--"})]},s.id))})]}),!d&&b>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:16,marginTop:32},children:[e.jsx("button",{className:"btn btn-secondary btn-sm",disabled:a<=1,onClick:()=>m(s=>Math.max(1,s-1)),children:"Previous"}),e.jsxs("span",{style:{fontSize:14,color:"var(--gr-light)"},children:["Page ",a," of ",b]}),e.jsx("button",{className:"btn btn-secondary btn-sm",disabled:a>=b,onClick:()=>m(s=>s+1),children:"Next"})]})]})]})]})}export{Y as default};
