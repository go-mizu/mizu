import{j as e,S as u,H as B,B as te,b as d}from"./index-C-ixEFdY.js";import{h as se,r as i,L as U}from"./react-vendor-bJoUFh3v.js";import{u as $,S as re}from"./ShelfButton-DeyYxMQ2.js";import{B as ie}from"./BookGrid-Bnk7dYhl.js";import{B as Q,c as ae,C as q,H as ne,G as oe,F as O,U as le,Q as de,E as ce,d as ge}from"./ui-RIRksdBL.js";import"./middleware-WYGlAF-S.js";function z(s){return s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}function he({review:s}){const t=s.book?.title?s.book.title.charAt(0).toUpperCase():"R";return e.jsxs("div",{className:"review-card",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("div",{className:"review-avatar",children:t}),e.jsxs("div",{children:[e.jsx(u,{rating:s.rating}),e.jsx("div",{style:{fontSize:12,color:"var(--gr-light)",marginTop:2},children:z(s.created_at)})]})]}),s.text&&e.jsx("div",{className:"review-text",children:s.text}),(s.started_at||s.finished_at)&&e.jsxs("div",{style:{fontSize:12,color:"var(--gr-light)",marginTop:8},children:[s.started_at&&e.jsxs(e.Fragment,{children:["Started ",z(s.started_at)]}),s.started_at&&s.finished_at&&e.jsx(e.Fragment,{children:" · "}),s.finished_at&&e.jsxs(e.Fragment,{children:["Finished ",z(s.finished_at)]})]})]})}function xe({book:s}){const t=s.rating_dist||[0,0,0,0,0],n=t.reduce((c,o)=>c+o,0)||1,a=["5","4","3","2","1"];return e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:14,fontWeight:700,color:"var(--gr-brown)",marginBottom:12},children:"Rating distribution"}),t.map((c,o)=>{const m=n>0?c/n*100:0;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,fontSize:13},children:[e.jsx("span",{style:{width:16,textAlign:"right",color:"var(--gr-light)",fontWeight:700},children:a[o]}),e.jsx("div",{style:{flex:1,height:10,background:"#eee",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${m}%`,background:"var(--gr-star)",borderRadius:2,transition:"width 0.4s ease"}})}),e.jsxs("span",{style:{width:60,textAlign:"right",color:"var(--gr-light)",fontSize:12},children:[c.toLocaleString()," (",Math.round(m),"%)"]})]},o)})]})}function me({book:s}){return!s.currently_reading&&!s.want_to_read?null:e.jsxs("div",{style:{display:"flex",gap:20,padding:"12px 0",borderTop:"1px solid #eee",borderBottom:"1px solid #eee",marginBottom:16,fontSize:13,color:"var(--gr-light)"},children:[s.currently_reading>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(ce,{size:14}),e.jsxs("span",{children:[e.jsx("strong",{style:{color:"var(--gr-text)"},children:s.currently_reading.toLocaleString()})," currently reading"]})]}),s.want_to_read>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(ge,{size:14}),e.jsxs("span",{children:[e.jsx("strong",{style:{color:"var(--gr-text)"},children:s.want_to_read.toLocaleString()})," want to read"]})]})]})}function pe({text:s}){const[t,n]=i.useState(!1),a=400;return s.length<=a?e.jsx("div",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",marginBottom:24},children:s}):e.jsxs("div",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",marginBottom:24},children:[t?s:s.slice(0,a)+"...",e.jsx("button",{onClick:()=>n(!t),style:{background:"none",border:"none",color:"var(--gr-teal)",cursor:"pointer",fontWeight:700,fontSize:14,marginLeft:4,padding:0},children:t?"less":"more"})]})}function Se(){const{id:s}=se(),[t,n]=i.useState(null),[a,c]=i.useState([]),[o,m]=i.useState([]),[j,V]=i.useState([]),[f,N]=i.useState([]),[Y,R]=i.useState(!0),[C,I]=i.useState(null),[g,v]=i.useState("reviews"),[P,y]=i.useState(!1),[F,b]=i.useState(""),[x,S]=i.useState(0),[T,D]=i.useState(!1),[w,L]=i.useState(""),[W,A]=i.useState(""),[E,M]=i.useState(!1),G=$(r=>r.addRecentBook),k=$(r=>r.setCurrentBook),h=Number(s);i.useEffect(()=>s?((async()=>{R(!0),I(null);try{const[l,_,ee]=await Promise.all([d.getBook(h),d.getReviews(h),d.getSimilar(h)]);n(l),c(_),m(ee),G(l),k(l),d.getBookQuotes(h).then(V).catch(()=>{}),d.getProgress(h).then(N).catch(()=>{})}catch(l){I(l instanceof Error?l.message:"Failed to load book")}finally{R(!1)}})(),()=>k(null)):void 0,[s,h,G,k]);const J=async r=>{if(t)try{await d.createReview(t.id,{rating:r}),n({...t,user_rating:r})}catch{}},K=async()=>{if(!(!t||x===0)){D(!0);try{const r=await d.createReview(t.id,{rating:x,text:F});c([r,...a]),y(!1),b(""),S(0),n({...t,user_rating:x})}catch{}finally{D(!1)}}},X=async()=>{if(!t)return;const r=parseInt(w);if(!(!r||r<=0)){M(!0);try{const l=t.page_count>0?r/t.page_count*100:0,_=await d.updateProgress(t.id,{page:r,percent:Math.min(100,l),note:W||void 0});N([_,...f]),L(""),A("")}catch{}finally{M(!1)}}};if(Y)return e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})})]});if(C||!t)return e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"Book not found"}),e.jsx("p",{children:C||"This book does not exist."}),e.jsx(U,{to:"/browse",className:"btn btn-secondary",children:"Browse books"})]})})]});const H=t.subjects||[],p=f.length>0?f[0]:null,Z=t.rating_dist&&t.rating_dist.some(r=>r>0);return e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsxs("div",{className:"page-container fade-in",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"200px 1fr",gap:32,marginBottom:40},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[e.jsx(te,{book:t,size:"lg"}),e.jsx(re,{book:t}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:13,color:"var(--gr-light)",marginBottom:4},children:"Rate this book"}),e.jsx(u,{rating:t.user_rating||0,interactive:!0,onChange:J})]}),t.page_count>0&&e.jsxs("div",{style:{width:"100%",padding:12,background:"var(--gr-cream)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:"var(--gr-brown)",marginBottom:8},children:"Track Progress"}),p&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{className:"progress-bar",style:{height:6},children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.min(100,p.percent)}%`}})}),e.jsxs("div",{style:{fontSize:11,color:"var(--gr-light)",marginTop:4},children:["Page ",p.page," of ",t.page_count," (",Math.round(p.percent),"%)"]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("input",{type:"number",min:"1",max:t.page_count,value:w,onChange:r=>L(r.target.value),placeholder:"Page #",className:"form-input",style:{fontSize:12,padding:"4px 8px",flex:1}}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:X,disabled:E||!w,style:{fontSize:11,padding:"4px 8px"},children:E?"...":"Update"})]}),e.jsx("input",{type:"text",value:W,onChange:r=>A(r.target.value),placeholder:"Add a note (optional)",className:"form-input",style:{fontSize:11,padding:"4px 8px",marginTop:4,width:"100%"}})]})]}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:28,fontWeight:900,color:"var(--gr-brown)",margin:"0 0 4px",lineHeight:1.3},children:t.title}),t.series&&e.jsx("div",{style:{fontSize:14,color:"var(--gr-light)",marginBottom:8,fontStyle:"italic"},children:t.series}),e.jsxs("p",{className:"book-author",style:{fontSize:16,marginBottom:12},children:["by"," ",e.jsx("span",{style:{color:"var(--gr-text)"},children:t.author_names})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx(u,{rating:t.average_rating}),e.jsx("span",{style:{fontWeight:700,fontSize:16},children:t.average_rating?.toFixed(2)})]}),e.jsxs("div",{style:{fontSize:13,color:"var(--gr-light)",marginBottom:16,display:"flex",gap:12},children:[e.jsxs("span",{children:[t.ratings_count?.toLocaleString()," ratings"]}),t.reviews_count>0&&e.jsxs("span",{children:[t.reviews_count.toLocaleString()," reviews"]})]}),e.jsx(me,{book:t}),t.description&&e.jsx(pe,{text:t.description}),H.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:20},children:H.map(r=>e.jsx(U,{to:`/genre/${encodeURIComponent(r)}`,className:"genre-tag",children:r},r))}),Z&&e.jsx(xe,{book:t}),e.jsxs("div",{style:{padding:16,background:"var(--gr-cream)",borderRadius:8,marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:14,fontWeight:700,color:"var(--gr-brown)",marginBottom:12},children:"Book details & editions"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:10,fontSize:14},children:[t.format&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Q,{size:14}),e.jsxs("span",{children:[t.format,t.page_count>0?`, ${t.page_count} pages`:""]})]}),!t.format&&t.page_count>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Q,{size:14}),e.jsxs("span",{children:[t.page_count," pages"]})]}),t.publisher&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(ae,{size:14}),e.jsx("span",{children:t.publisher})]}),t.first_published&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(q,{size:14}),e.jsxs("span",{children:["First published ",t.first_published]})]}),!t.first_published&&t.publish_year>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(q,{size:14}),e.jsxs("span",{children:["Published ",t.publish_year]})]}),t.isbn13&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(ne,{size:14}),e.jsxs("span",{children:["ISBN ",t.isbn13]})]}),t.language&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(oe,{size:14}),e.jsx("span",{children:t.language})]}),t.asin&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(O,{size:14}),e.jsxs("span",{children:["ASIN ",t.asin]})]}),t.goodreads_id&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(le,{size:14}),e.jsx("a",{href:`https://www.goodreads.com/book/show/${t.goodreads_id}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--gr-teal)",textDecoration:"none"},children:"View on Goodreads"})]}),t.ol_key&&!t.goodreads_id&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(O,{size:14}),e.jsx("span",{children:t.ol_key})]})]})]})]})]}),e.jsxs("div",{className:"tabs",children:[e.jsxs("button",{className:`tab ${g==="reviews"?"active":""}`,onClick:()=>v("reviews"),children:["Community Reviews (",t.reviews_count||a.length,")"]}),e.jsxs("button",{className:`tab ${g==="similar"?"active":""}`,onClick:()=>v("similar"),children:["Similar Books (",o.length,")"]}),e.jsxs("button",{className:`tab ${g==="quotes"?"active":""}`,onClick:()=>v("quotes"),children:["Quotes (",j.length,")"]})]}),g==="reviews"&&e.jsxs("div",{children:[!P&&e.jsx("button",{className:"btn btn-primary",style:{marginBottom:20},onClick:()=>y(!0),children:"Write a review"}),P&&e.jsxs("div",{style:{padding:20,background:"var(--gr-cream)",borderRadius:8,marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:16,color:"var(--gr-brown)",marginBottom:12},children:"Write your review"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Your rating"}),e.jsx(u,{rating:x,interactive:!0,onChange:S,size:24})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Review (optional)"}),e.jsx("textarea",{className:"form-input",placeholder:"What did you think?",value:F,onChange:r=>b(r.target.value)})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:K,disabled:T||x===0,children:T?"Posting...":"Post review"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{y(!1),b(""),S(0)},children:"Cancel"})]})]}),a.length>0?a.map(r=>e.jsx(he,{review:r},r.id)):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No reviews yet"}),e.jsx("p",{children:"Be the first to review this book!"})]})]}),g==="similar"&&e.jsx("div",{children:o.length>0?e.jsx(ie,{books:o}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No similar books found"}),e.jsx("p",{children:"Check back later for recommendations."})]})}),g==="quotes"&&e.jsx("div",{children:j.length>0?j.map(r=>e.jsx("div",{style:{padding:20,borderLeft:"3px solid var(--gr-orange)",background:"var(--gr-cream)",borderRadius:"0 8px 8px 0",marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsx(de,{size:16,style:{color:"var(--gr-orange)",flexShrink:0,marginTop:2}}),e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",fontStyle:"italic",margin:"0 0 8px"},children:["“",r.text,"”"]}),e.jsxs("p",{style:{fontSize:13,color:"var(--gr-light)",margin:0},children:["— ",r.author_name]}),r.likes_count>0&&e.jsxs("p",{style:{fontSize:12,color:"var(--gr-light)",margin:"4px 0 0"},children:[r.likes_count," likes"]})]})]})},r.id)):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No quotes yet"}),e.jsx("p",{children:"Add memorable quotes from this book."})]})})]})]})}export{Se as default};
