import{j as e,S as te,b as l,H as me,B as ue}from"./index-Cw4N14fR.js";import{r as i,h as ct,L as b}from"./react-vendor-bJoUFh3v.js";import{u as xe,S as dt}from"./ShelfButton-W543rZE7.js";import{B as Z,c as ht,C as Ge,H as gt,G as Ue,F as Qe,U as mt,d as ut,e as xt,Q as pt,E as vt,f as ft}from"./ui-Fk1kDDOZ.js";import"./middleware-WYGlAF-S.js";function ee(o){return o?new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}function jt({review:o,onEdit:s,onDelete:h}){const[n,g]=i.useState(o),[x,v]=i.useState(!1),[B,se]=i.useState(!1),[f,S]=i.useState([]),[z,I]=i.useState(!1),[r,F]=i.useState(""),[A,T]=i.useState(!1),[j,k]=i.useState(!1);i.useEffect(()=>{g(o),v(!1),k(!1)},[o]);const L=n.source==="imported",N=n.reviewer_name||(n.source==="user"?"You":n.book?.title?n.book.title.charAt(0).toUpperCase():"R"),_=N.charAt(0).toUpperCase(),D=async()=>{if(!(j||A)){T(!0);try{const c=await l.likeReview(n.id);g({...n,likes_count:c.likes_count}),k(!0)}catch{}finally{T(!1)}}},$=async()=>{I(!0);try{const c=await l.getReviewComments(n.id);S(c.comments||[])}catch{}finally{I(!1)}},H=()=>{const c=!B;se(c),c&&f.length===0&&$()},ie=async()=>{const c=r.trim();if(c)try{const C=await l.createReviewComment(n.id,{text:c,author_name:"You"});S([C,...f]),F(""),g({...n,comments_count:(n.comments_count||0)+1})}catch{}},G=async c=>{try{await l.deleteReviewComment(n.id,c),S(f.filter(C=>C.id!==c)),g({...n,comments_count:Math.max(0,(n.comments_count||0)-1)})}catch{}};return e.jsxs("div",{className:"review-card",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("div",{className:"review-avatar",children:_}),e.jsxs("div",{className:"review-main",children:[e.jsxs("div",{className:"review-name-row",children:[e.jsx("span",{className:"review-name",children:N}),L&&e.jsx("span",{className:"review-badge",children:"Imported"})]}),e.jsx(te,{rating:n.rating}),e.jsxs("div",{className:"review-meta",children:[ee(n.created_at),n.likes_count?` · ${n.likes_count} likes`:"",n.comments_count?` · ${n.comments_count} comments`:""]})]}),n.source==="user"&&(s||h)&&e.jsxs("div",{className:"review-owner-actions",children:[s&&e.jsx("button",{className:"link-button",onClick:()=>s(n),children:"Edit"}),h&&e.jsx("button",{className:"link-button",onClick:()=>h(n),children:"Delete"})]})]}),n.text&&n.is_spoiler&&!x?e.jsxs("div",{className:"review-spoiler",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Spoiler"})," · This review contains spoilers."]}),e.jsx("button",{className:"link-button",onClick:()=>v(!0),children:"Reveal"})]}):n.text?e.jsx("div",{className:"review-text",children:n.text}):null,e.jsxs("div",{className:"review-actions",children:[e.jsx("button",{className:"link-button",onClick:D,disabled:A||j,children:j?"Liked":"Like"}),e.jsx("button",{className:"link-button",onClick:H,children:"Comment"})]}),(n.started_at||n.finished_at)&&e.jsxs("div",{className:"review-read-dates",children:[n.started_at&&e.jsxs(e.Fragment,{children:["Started ",ee(n.started_at)]}),n.started_at&&n.finished_at&&e.jsx(e.Fragment,{children:" · "}),n.finished_at&&e.jsxs(e.Fragment,{children:["Finished ",ee(n.finished_at)]})]}),B&&e.jsxs("div",{className:"review-comments",children:[e.jsxs("div",{className:"comment-form",children:[e.jsx("input",{className:"form-input",placeholder:"Add a comment...",value:r,onChange:c=>F(c.target.value)}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:ie,disabled:!r.trim(),children:"Post"})]}),z?e.jsx("div",{className:"comment-loading",children:"Loading comments..."}):f.length>0?f.map(c=>e.jsxs("div",{className:"comment-item",children:[e.jsxs("div",{children:[e.jsx("strong",{children:c.author_name})," ",c.text]}),e.jsxs("div",{className:"comment-meta",children:[e.jsx("span",{children:ee(c.created_at)}),c.author_name==="You"&&e.jsx("button",{className:"link-button",onClick:()=>G(c.id),children:"Delete"})]})]},c.id)):e.jsx("div",{className:"comment-empty",children:"No comments yet."})]})]})}function yt({book:o}){const s=o.rating_dist||[0,0,0,0,0],h=s.reduce((g,x)=>g+x,0)||1,n=["5","4","3","2","1"];return e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:14,fontWeight:700,color:"var(--gr-brown)",marginBottom:12},children:"Rating distribution"}),s.map((g,x)=>{const v=h>0?g/h*100:0;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,fontSize:13},children:[e.jsx("span",{style:{width:16,textAlign:"right",color:"var(--gr-light)",fontWeight:700},children:n[x]}),e.jsx("div",{style:{flex:1,height:10,background:"#eee",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${v}%`,background:"var(--gr-star)",borderRadius:2,transition:"width 0.4s ease"}})}),e.jsxs("span",{style:{width:60,textAlign:"right",color:"var(--gr-light)",fontSize:12},children:[g.toLocaleString()," (",Math.round(v),"%)"]})]},x)})]})}function bt({book:o}){return!o.currently_reading&&!o.want_to_read?null:e.jsxs("div",{style:{display:"flex",gap:20,padding:"12px 0",borderTop:"1px solid #eee",borderBottom:"1px solid #eee",marginBottom:16,fontSize:13,color:"var(--gr-light)"},children:[o.currently_reading>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(vt,{size:14}),e.jsxs("span",{children:[e.jsx("strong",{style:{color:"var(--gr-text)"},children:o.currently_reading.toLocaleString()})," currently reading"]})]}),o.want_to_read>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(ft,{size:14}),e.jsxs("span",{children:[e.jsx("strong",{style:{color:"var(--gr-text)"},children:o.want_to_read.toLocaleString()})," want to read"]})]})]})}function wt({text:o}){const[s,h]=i.useState(!1),n=400;return o.length<=n?e.jsx("div",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",marginBottom:24},children:o}):e.jsxs("div",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",marginBottom:24},children:[s?o:o.slice(0,n)+"...",e.jsx("button",{onClick:()=>h(!s),style:{background:"none",border:"none",color:"var(--gr-teal)",cursor:"pointer",fontWeight:700,fontSize:14,marginLeft:4,padding:0},children:s?"less":"more"})]})}function Rt(){const{id:o}=ct(),[s,h]=i.useState(null),[n,g]=i.useState([]),[x,v]=i.useState(0),[B,se]=i.useState([]),[f,S]=i.useState([]),[z,I]=i.useState([]),[r,F]=i.useState(null),[A,T]=i.useState([]),[j,k]=i.useState(null),[L,N]=i.useState(""),[_,D]=i.useState(!1),[$,H]=i.useState(!1),[ie,G]=i.useState(!0),[c,C]=i.useState(null),[U,pe]=i.useState("reviews"),[ve,Q]=i.useState(!1),[fe,O]=i.useState(""),[P,V]=i.useState(0),[je,Y]=i.useState(!1),[ye,q]=i.useState(""),[ne,J]=i.useState(""),[K,E]=i.useState(null),[W,ae]=i.useState(null),[be,Oe]=i.useState("popular"),[re,Ve]=i.useState(0),[le,Ye]=i.useState("all"),[oe,qe]=i.useState("all"),[we,Je]=i.useState(""),[Se,Ke]=i.useState(!1),[Xe,ke]=i.useState(!1),[Ne,_e]=i.useState(!1),[ce,Ce]=i.useState(""),[Re,Be]=i.useState(""),[ze,Ie]=i.useState(!1),[Fe,Ae]=i.useState(!1),[w,Ze]=i.useState([]),Te=xe(t=>t.addRecentBook),de=xe(t=>t.setCurrentBook),et=xe(t=>t.setShelves),m=Number(o),Le=t=>{if(!t)return"";const a=new Date(t);return Number.isNaN(a.getTime())?"":a.toISOString().slice(0,10)},tt=()=>({sort:be,rating:re>0?re:void 0,source:le==="all"?void 0:le,has_text:oe==="all"?void 0:oe==="with",q:we.trim()||void 0,include_spoilers:Se}),M=async t=>{ke(!0);try{const a=await l.getReviews(t,tt());return g(a.reviews),v(a.total),a.reviews}finally{ke(!1)}};i.useEffect(()=>o?((async()=>{G(!0),C(null);try{const[a,p,R]=await Promise.all([l.getBook(m),l.getSimilar(m),l.getShelves()]),u=await M(m);if(h(a),se(p),Ze(R),et(R),Te(a),de(a),l.getBookQuotes(m).then(S).catch(()=>{}),l.getProgress(m).then(I).catch(()=>{}),l.getNote(m).then(d=>{k(d),N(d?.text||"")}).catch(()=>{}),a.authors&&a.authors.length>0&&a.authors[0].id){const d=a.authors[0];l.getAuthor(d.id).then(F).catch(()=>{}),l.getAuthorBooks(d.id).then(y=>{T(y.books.filter(ge=>ge.id!==m).slice(0,8))}).catch(()=>{})}else a.author_names&&l.searchAuthors(a.author_names.split(",")[0].trim()).then(d=>{d&&d.length>0&&(F(d[0]),l.getAuthorBooks(d[0].id).then(y=>{T(y.books.filter(ge=>ge.id!==m).slice(0,8))}).catch(()=>{}))}).catch(()=>{});u.length===0&&(Ae(!0),l.enrichBook(m).then(d=>{h(d),M(m).catch(()=>{}),l.getBookQuotes(m).then(S).catch(()=>{})}).catch(()=>{}).finally(()=>Ae(!1)))}catch(a){C(a instanceof Error?a.message:"Failed to load book")}finally{G(!1)}})(),()=>de(null)):void 0,[o,m,Te,de]),i.useEffect(()=>{if(!K&&s?.user_shelf&&w.length>0){const t=w.find(a=>a.slug===s.user_shelf);t&&E(t.id)}},[s?.user_shelf,w,K]);const st=async t=>{if(s)try{await l.createReview(s.id,{rating:t}),h({...s,user_rating:t}),M(s.id).catch(()=>{})}catch{}},it=async()=>{if(!(!s||P===0)){_e(!0);try{const t={rating:P,text:fe,is_spoiler:je,started_at:ye||void 0,finished_at:ne||void 0},a=W?await l.updateReview(W,t):await l.createReview(s.id,t);g(u=>{const d=u.findIndex(y=>y.id===a.id);if(d>=0){const y=[...u];return y[d]=a,y}return[a,...u]}),W||v(u=>u+1);const p=w.find(u=>u.slug==="read"),R=K||(ne&&p?p.id:null);if(R){await l.addToShelf(R,s.id);const u=w.find(d=>d.id===R)?.slug;u&&h({...s,user_shelf:u})}M(s.id).catch(()=>{}),Q(!1),O(""),V(0),Y(!1),q(""),J(""),E(null),ae(null),h({...s,user_rating:P})}catch{}finally{_e(!1)}}},nt=async()=>{if(s){H(!0);try{if(L.trim()){const t=await l.saveNote(s.id,L.trim());k(t)}else j?.id&&(await l.deleteNote(s.id),k(null));D(!1)}catch{}finally{H(!1)}}},at=async()=>{if(!s)return;const t=parseInt(ce);if(!(!t||t<=0)){Ie(!0);try{const a=s.page_count>0?t/s.page_count*100:0,p=await l.updateProgress(s.id,{page:t,percent:Math.min(100,a),note:Re||void 0});I([p,...z]),Ce(""),Be("")}catch{}finally{Ie(!1)}}},De=t=>{if(ae(t.id),V(t.rating),O(t.text||""),Y(!!t.is_spoiler),q(Le(t.started_at)),J(Le(t.finished_at)),s?.user_shelf){const a=w.find(p=>p.slug===s.user_shelf);E(a?a.id:null)}Q(!0)},rt=async t=>{if(s)try{await l.deleteReview(t.id),g(a=>a.filter(p=>p.id!==t.id)),v(a=>Math.max(0,a-1)),h({...s,user_rating:0})}catch{}};if(ie)return e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})})]});if(c||!s)return e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"Book not found"}),e.jsx("p",{children:c||"This book does not exist."}),e.jsx(b,{to:"/browse",className:"btn btn-secondary",children:"Browse books"})]})})]});const Pe=s.subjects||[],Ee=s.characters||[],We=s.settings||[],Me=s.literary_awards||[],X=z.length>0?z[0]:null,lt=s.rating_dist&&s.rating_dist.some(t=>t>0),ot=x||s.reviews_count||n.length,he=n.find(t=>t.source==="user"),$e=w.filter(t=>t.is_exclusive),He=s.editions_count??0;return e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsxs("div",{className:"page-container fade-in",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"200px 1fr",gap:32,marginBottom:40},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[e.jsx(ue,{book:s,size:"lg"}),e.jsx(dt,{book:s}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:13,color:"var(--gr-light)",marginBottom:4},children:"Rate this book"}),e.jsx(te,{rating:s.user_rating||0,interactive:!0,onChange:st})]}),s.page_count>0&&e.jsxs("div",{style:{width:"100%",padding:12,background:"var(--gr-cream)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:"var(--gr-brown)",marginBottom:8},children:"Track Progress"}),X&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{className:"progress-bar",style:{height:6},children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.min(100,X.percent)}%`}})}),e.jsxs("div",{style:{fontSize:11,color:"var(--gr-light)",marginTop:4},children:["Page ",X.page," of ",s.page_count," (",Math.round(X.percent),"%)"]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("input",{type:"number",min:"1",max:s.page_count,value:ce,onChange:t=>Ce(t.target.value),placeholder:"Page #",className:"form-input",style:{fontSize:12,padding:"4px 8px",flex:1}}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:at,disabled:ze||!ce,style:{fontSize:11,padding:"4px 8px"},children:ze?"...":"Update"})]}),e.jsx("input",{type:"text",value:Re,onChange:t=>Be(t.target.value),placeholder:"Add a note (optional)",className:"form-input",style:{fontSize:11,padding:"4px 8px",marginTop:4,width:"100%"}})]})]}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:28,fontWeight:900,color:"var(--gr-brown)",margin:"0 0 4px",lineHeight:1.3},children:s.title}),s.series&&e.jsx("div",{style:{fontSize:14,color:"var(--gr-light)",marginBottom:8,fontStyle:"italic"},children:s.series}),e.jsxs("p",{className:"book-author",style:{fontSize:16,marginBottom:12},children:["by"," ",r?e.jsx(b,{to:`/author/${r.id}`,style:{color:"var(--gr-teal)",textDecoration:"none",fontWeight:600},children:s.author_names}):e.jsx("span",{style:{color:"var(--gr-text)"},children:s.author_names})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx(te,{rating:s.average_rating}),e.jsx("span",{style:{fontWeight:700,fontSize:16},children:s.average_rating?.toFixed(2)})]}),e.jsxs("div",{style:{fontSize:13,color:"var(--gr-light)",marginBottom:16,display:"flex",gap:12},children:[e.jsxs("span",{children:[s.ratings_count?.toLocaleString()," ratings"]}),s.reviews_count>0&&e.jsxs("span",{children:[s.reviews_count.toLocaleString()," reviews"]})]}),e.jsx(bt,{book:s}),s.description&&e.jsx(wt,{text:s.description}),Pe.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:20},children:Pe.map(t=>e.jsx(b,{to:`/genre/${encodeURIComponent(t)}`,className:"genre-tag",children:t},t))}),Ee.length>0&&e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,color:"var(--gr-light)",marginBottom:6},children:"Characters"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:Ee.map(t=>e.jsx("span",{className:"genre-tag",children:t},t))})]}),We.length>0&&e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,color:"var(--gr-light)",marginBottom:6},children:"Setting"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:We.map(t=>e.jsx("span",{className:"genre-tag",children:t},t))})]}),Me.length>0&&e.jsxs("div",{style:{marginBottom:14,fontSize:13,color:"var(--gr-light)"},children:[e.jsx("strong",{style:{color:"var(--gr-text)"},children:"Literary awards:"})," ",Me.join(", ")]}),lt&&e.jsx(yt,{book:s}),e.jsxs("div",{style:{padding:16,background:"var(--gr-cream)",borderRadius:8,marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:14,fontWeight:700,color:"var(--gr-brown)",marginBottom:12},children:"Book details & editions"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:10,fontSize:14},children:[s.format&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Z,{size:14}),e.jsxs("span",{children:[s.format,s.page_count>0?`, ${s.page_count} pages`:""]})]}),!s.format&&s.page_count>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Z,{size:14}),e.jsxs("span",{children:[s.page_count," pages"]})]}),s.publisher&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(ht,{size:14}),e.jsx("span",{children:s.publisher})]}),s.original_title&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Z,{size:14}),e.jsxs("span",{children:["Original title: ",s.original_title]})]}),s.first_published&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Ge,{size:14}),e.jsxs("span",{children:["First published ",s.first_published]})]}),!s.first_published&&s.publish_year>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Ge,{size:14}),e.jsxs("span",{children:["Published ",s.publish_year]})]}),s.isbn13&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(gt,{size:14}),e.jsxs("span",{children:["ISBN ",s.isbn13]})]}),s.language&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Ue,{size:14}),e.jsx("span",{children:s.language})]}),s.edition_language&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Ue,{size:14}),e.jsxs("span",{children:["Edition language: ",s.edition_language]})]}),He>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Z,{size:14}),e.jsxs("span",{children:[He.toLocaleString()," editions"]})]}),s.asin&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Qe,{size:14}),e.jsxs("span",{children:["ASIN ",s.asin]})]}),s.source_id&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(mt,{size:14}),e.jsx("a",{href:s.source_url,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--gr-teal)",textDecoration:"none"},children:"View source page"})]}),s.ol_key&&!s.source_id&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Qe,{size:14}),e.jsx("span",{children:s.ol_key})]})]})]})]})]}),e.jsxs("div",{style:{padding:16,background:"var(--gr-cream)",borderRadius:8,marginBottom:24},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:_?12:0},children:[e.jsxs("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:14,fontWeight:700,color:"var(--gr-brown)",display:"flex",alignItems:"center",gap:6,margin:0},children:[e.jsx(ut,{size:14}),"Private Notes"]}),!_&&e.jsx("button",{className:"link-button",onClick:()=>D(!0),style:{fontSize:13},children:j?.text?"Edit":"Add note"})]}),!_&&j?.text&&e.jsx("p",{style:{fontSize:14,color:"var(--gr-text)",lineHeight:1.6,margin:"8px 0 0"},children:j.text}),_&&e.jsxs("div",{children:[e.jsx("textarea",{className:"form-input",value:L,onChange:t=>N(t.target.value),placeholder:"Add your private notes about this book...",rows:3,style:{marginBottom:8,fontSize:14}}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:nt,disabled:$,children:$?"Saving...":"Save"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>{D(!1),N(j?.text||"")},children:"Cancel"})]})]})]}),r&&e.jsxs("div",{style:{padding:20,background:"var(--gr-cream)",borderRadius:8,marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:14,fontWeight:700,color:"var(--gr-brown)",marginBottom:12},children:"About the author"}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx(b,{to:`/author/${r.id}`,style:{flexShrink:0},children:r.photo_url?e.jsx("img",{src:r.photo_url,alt:r.name,style:{width:64,height:64,borderRadius:"50%",objectFit:"cover"}}):e.jsx("div",{style:{width:64,height:64,borderRadius:"50%",background:"var(--gr-teal)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,fontWeight:700},children:r.name.charAt(0)})}),e.jsxs("div",{style:{flex:1},children:[e.jsx(b,{to:`/author/${r.id}`,style:{fontWeight:700,color:"var(--gr-text)",textDecoration:"none",fontSize:15},children:r.name}),e.jsxs("div",{style:{fontSize:13,color:"var(--gr-light)",marginTop:2},children:[r.works_count>0&&e.jsxs("span",{children:[r.works_count," books"]}),r.followers>0&&e.jsxs("span",{children:[" · ",r.followers.toLocaleString()," followers"]})]}),r.bio&&e.jsx("p",{style:{fontSize:13,color:"var(--gr-text)",lineHeight:1.6,margin:"8px 0 0"},children:r.bio.length>200?r.bio.slice(0,200)+"...":r.bio})]})]})]}),A.length>0&&e.jsxs("section",{style:{marginBottom:32},children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("span",{className:"section-title",style:{fontSize:14,fontFamily:"'Merriweather', Georgia, serif"},children:["More by ",r?.name||s.author_names]}),r&&e.jsxs(b,{to:`/author/${r.id}`,className:"section-link",style:{fontSize:13},children:["View all ",e.jsx(xt,{size:14})]})]}),e.jsx("div",{className:"book-scroll",children:A.map(t=>e.jsxs(b,{to:`/book/${t.id}`,className:"book-scroll-item",children:[e.jsx(ue,{book:t}),e.jsx("div",{className:"book-scroll-title",children:t.title})]},t.id))})]}),B.length>0&&e.jsxs("section",{style:{marginBottom:32},children:[e.jsx("div",{className:"section-header",children:e.jsx("span",{className:"section-title",style:{fontSize:14,fontFamily:"'Merriweather', Georgia, serif"},children:"Readers also enjoyed"})}),e.jsx("div",{className:"book-scroll",children:B.map(t=>e.jsxs(b,{to:`/book/${t.id}`,className:"book-scroll-item",children:[e.jsx(ue,{book:t}),e.jsx("div",{className:"book-scroll-title",children:t.title}),e.jsx("div",{className:"book-scroll-author",children:t.author_names})]},t.id))})]}),e.jsxs("div",{className:"tabs",children:[e.jsxs("button",{className:`tab ${U==="reviews"?"active":""}`,onClick:()=>pe("reviews"),children:["Community Reviews (",ot,")"]}),e.jsxs("button",{className:`tab ${U==="quotes"?"active":""}`,onClick:()=>pe("quotes"),children:["Quotes (",f.length,")"]})]}),U==="reviews"&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:8,marginBottom:14,padding:12,background:"var(--gr-cream)",borderRadius:8},children:[e.jsxs("select",{className:"form-input",value:be,onChange:t=>Oe(t.target.value),children:[e.jsx("option",{value:"popular",children:"Popular"}),e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"oldest",children:"Oldest"}),e.jsx("option",{value:"rating_desc",children:"Highest rating"}),e.jsx("option",{value:"rating_asc",children:"Lowest rating"})]}),e.jsxs("select",{className:"form-input",value:re,onChange:t=>Ve(Number(t.target.value)),children:[e.jsx("option",{value:0,children:"All ratings"}),e.jsx("option",{value:5,children:"5 stars"}),e.jsx("option",{value:4,children:"4 stars"}),e.jsx("option",{value:3,children:"3 stars"}),e.jsx("option",{value:2,children:"2 stars"}),e.jsx("option",{value:1,children:"1 star"})]}),e.jsxs("select",{className:"form-input",value:le,onChange:t=>Ye(t.target.value),children:[e.jsx("option",{value:"all",children:"All sources"}),e.jsx("option",{value:"imported",children:"Imported"}),e.jsx("option",{value:"user",children:"My reviews"})]}),e.jsxs("select",{className:"form-input",value:oe,onChange:t=>qe(t.target.value),children:[e.jsx("option",{value:"all",children:"Any text"}),e.jsx("option",{value:"with",children:"With text"}),e.jsx("option",{value:"without",children:"Ratings only"})]}),e.jsx("input",{type:"search",className:"form-input",placeholder:"Search review text",value:we,onChange:t=>Je(t.target.value)}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>M(s.id),children:"Apply filters"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:Se,onChange:t=>Ke(t.target.checked)}),"Show spoilers"]})]}),x>0&&e.jsxs("div",{style:{fontSize:12,color:"var(--gr-light)",marginBottom:12},children:["Showing ",n.length," of ",x," reviews"]}),!ve&&e.jsx("button",{className:"btn btn-primary",style:{marginBottom:20},onClick:()=>{he?De(he):Q(!0)},children:he?"Edit your review":"Write a review"}),ve&&e.jsxs("div",{style:{padding:20,background:"var(--gr-cream)",borderRadius:8,marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:16,color:"var(--gr-brown)",marginBottom:12},children:W?"Edit your review":"Write your review"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Your rating"}),e.jsx(te,{rating:P,interactive:!0,onChange:V,size:24})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Review (optional)"}),e.jsx("textarea",{className:"form-input",placeholder:"What did you think?",value:fe,onChange:t=>O(t.target.value)})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[e.jsx("input",{type:"checkbox",checked:je,onChange:t=>Y(t.target.checked)}),"Contains spoilers"]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Started reading"}),e.jsx("input",{type:"date",className:"form-input",value:ye,onChange:t=>q(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Finished reading"}),e.jsx("input",{type:"date",className:"form-input",value:ne,onChange:t=>J(t.target.value)})]})]}),$e.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Reading status"}),e.jsxs("select",{className:"form-input",value:K??"",onChange:t=>E(t.target.value?Number(t.target.value):null),children:[e.jsx("option",{value:"",children:"No status"}),$e.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:it,disabled:Ne||P===0,children:Ne?"Saving...":W?"Save review":"Post review"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{Q(!1),O(""),V(0),Y(!1),q(""),J(""),E(null),ae(null)},children:"Cancel"})]})]}),Fe&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16,fontSize:14,color:"var(--gr-light)"},children:[e.jsx("div",{className:"spinner",style:{width:16,height:16,borderWidth:2}}),"Fetching imported community reviews..."]}),Xe&&e.jsx("div",{style:{marginBottom:12,fontSize:13,color:"var(--gr-light)"},children:"Loading reviews..."}),n.length>0?n.map(t=>e.jsx(jt,{review:t,onEdit:t.source==="user"?De:void 0,onDelete:t.source==="user"?rt:void 0},t.id)):Fe?null:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No reviews yet"}),e.jsx("p",{children:"Be the first to review this book!"})]})]}),U==="quotes"&&e.jsx("div",{children:f.length>0?f.map(t=>e.jsx("div",{style:{padding:20,borderLeft:"3px solid var(--gr-orange)",background:"var(--gr-cream)",borderRadius:"0 8px 8px 0",marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsx(pt,{size:16,style:{color:"var(--gr-orange)",flexShrink:0,marginTop:2}}),e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",fontStyle:"italic",margin:"0 0 8px"},children:["“",t.text,"”"]}),e.jsxs("p",{style:{fontSize:13,color:"var(--gr-light)",margin:0},children:["— ",t.author_name]}),t.likes_count>0&&e.jsxs("p",{style:{fontSize:12,color:"var(--gr-light)",margin:"4px 0 0"},children:[t.likes_count," likes"]})]})]})},t.id)):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No quotes yet"}),e.jsx("p",{children:"Add memorable quotes from this book."})]})})]})]})}export{Rt as default};
