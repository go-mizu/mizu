import{j as n,b as S}from"./index-CR0Xjtpx.js";import{r as o}from"./react-vendor-bJoUFh3v.js";import{p as j}from"./middleware-WYGlAF-S.js";import{n as B,o as h,p as b}from"./ui-D_Yei50m.js";const w=B()(j(s=>({query:"",results:null,isLoading:!1,error:null,shelves:[],currentBook:null,recentBooks:[],setQuery:e=>s({query:e}),setResults:e=>s({results:e}),setLoading:e=>s({isLoading:e}),setError:e=>s({error:e}),setShelves:e=>s({shelves:e}),setCurrentBook:e=>s({currentBook:e}),addRecentBook:e=>s(r=>({recentBooks:[e,...r.recentBooks.filter(a=>a.id!==e.id)].slice(0,20)}))}),{name:"book-store",partialize:s=>({recentBooks:s.recentBooks})}));function g({book:s,shelves:e}){const r=w(t=>t.shelves),a=e??r,[d,l]=o.useState(!1),[c,f]=o.useState(s.user_shelf||""),[p,u]=o.useState(!1),i=o.useRef(null);o.useEffect(()=>{const t=x=>{i.current&&!i.current.contains(x.target)&&l(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const k=async t=>{u(!0);try{await S.addToShelf(t.id,s.id),f(t.name)}catch{}finally{u(!1),l(!1)}},v=c||"Want to Read",m=!!c;return n.jsxs("div",{ref:i,className:"shelf-dropdown",children:[n.jsxs("button",{type:"button",className:`shelf-btn${m?" shelved":""}`,onClick:()=>l(!d),disabled:p,children:[m&&n.jsx(h,{size:14}),n.jsx("span",{children:v}),n.jsx("span",{className:"dropdown-arrow",children:n.jsx(b,{size:14})})]}),d&&n.jsx("div",{className:"shelf-menu",children:a.map(t=>n.jsxs("button",{type:"button",onClick:()=>k(t),className:"shelf-menu-item",children:[c===t.name&&n.jsx(h,{size:14,className:"shelf-menu-check"}),n.jsx("span",{children:t.name})]},t.id))})]})}export{g as S,w as u};
