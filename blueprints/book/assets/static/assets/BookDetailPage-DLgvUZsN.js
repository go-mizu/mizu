import{j as e,S as v,H as P,B as Ne,b as d}from"./index-D_4FLS-X.js";import{r,h as Be,L as ne}from"./react-vendor-bJoUFh3v.js";import{u as le,S as Re}from"./ShelfButton-YBBNoQqA.js";import{B as ze}from"./BookGrid-CKHRnQ91.js";import{B as oe,c as Ce,C as de,H as Fe,G as Ie,F as ce,U as Pe,Q as Te,E as Ae,d as Le}from"./ui-D_Yei50m.js";import"./middleware-WYGlAF-S.js";function T(i){return i?new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}function We({review:i}){const[t,n]=r.useState(!1),l=i.source==="goodreads",o=(i.reviewer_name||(i.book?.title?i.book.title.charAt(0).toUpperCase():"R")).charAt(0).toUpperCase();return e.jsxs("div",{className:"review-card",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("div",{className:"review-avatar",children:o}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[i.reviewer_name&&e.jsx("span",{style:{fontSize:14,fontWeight:700,color:"var(--gr-brown)"},children:i.reviewer_name}),l&&e.jsx("span",{style:{fontSize:10,padding:"2px 6px",background:"var(--gr-tan)",borderRadius:3,color:"var(--gr-light)",fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:"Goodreads"})]}),e.jsx(v,{rating:i.rating}),e.jsxs("div",{style:{fontSize:12,color:"var(--gr-light)",marginTop:2},children:[T(i.created_at),i.likes_count?` · ${i.likes_count} likes`:""]})]})]}),i.text&&e.jsx("div",{className:"review-text",children:i.is_spoiler&&!t?e.jsxs("div",{children:[e.jsx("strong",{children:"Spoiler warning."})," ",e.jsx("button",{className:"btn btn-secondary btn-sm",style:{marginLeft:6},onClick:()=>n(!0),children:"Show review"})]}):i.text}),(i.started_at||i.finished_at)&&e.jsxs("div",{style:{fontSize:12,color:"var(--gr-light)",marginTop:8},children:[i.started_at&&e.jsxs(e.Fragment,{children:["Started ",T(i.started_at)]}),i.started_at&&i.finished_at&&e.jsx(e.Fragment,{children:" · "}),i.finished_at&&e.jsxs(e.Fragment,{children:["Finished ",T(i.finished_at)]})]})]})}function De({book:i}){const t=i.rating_dist||[0,0,0,0,0],n=t.reduce((g,o)=>g+o,0)||1,l=["5","4","3","2","1"];return e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:14,fontWeight:700,color:"var(--gr-brown)",marginBottom:12},children:"Rating distribution"}),t.map((g,o)=>{const u=n>0?g/n*100:0;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,fontSize:13},children:[e.jsx("span",{style:{width:16,textAlign:"right",color:"var(--gr-light)",fontWeight:700},children:l[o]}),e.jsx("div",{style:{flex:1,height:10,background:"#eee",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${u}%`,background:"var(--gr-star)",borderRadius:2,transition:"width 0.4s ease"}})}),e.jsxs("span",{style:{width:60,textAlign:"right",color:"var(--gr-light)",fontSize:12},children:[g.toLocaleString()," (",Math.round(u),"%)"]})]},o)})]})}function Ge({book:i}){return!i.currently_reading&&!i.want_to_read?null:e.jsxs("div",{style:{display:"flex",gap:20,padding:"12px 0",borderTop:"1px solid #eee",borderBottom:"1px solid #eee",marginBottom:16,fontSize:13,color:"var(--gr-light)"},children:[i.currently_reading>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ae,{size:14}),e.jsxs("span",{children:[e.jsx("strong",{style:{color:"var(--gr-text)"},children:i.currently_reading.toLocaleString()})," currently reading"]})]}),i.want_to_read>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Le,{size:14}),e.jsxs("span",{children:[e.jsx("strong",{style:{color:"var(--gr-text)"},children:i.want_to_read.toLocaleString()})," want to read"]})]})]})}function Ee({text:i}){const[t,n]=r.useState(!1),l=400;return i.length<=l?e.jsx("div",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",marginBottom:24},children:i}):e.jsxs("div",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",marginBottom:24},children:[t?i:i.slice(0,l)+"...",e.jsx("button",{onClick:()=>n(!t),style:{background:"none",border:"none",color:"var(--gr-teal)",cursor:"pointer",fontWeight:700,fontSize:14,marginLeft:4,padding:0},children:t?"less":"more"})]})}function Oe(){const{id:i}=Be(),[t,n]=r.useState(null),[l,g]=r.useState([]),[o,u]=r.useState([]),[j,A]=r.useState([]),[f,L]=r.useState([]),[ge,W]=r.useState(!0),[D,G]=r.useState(null),[h,y]=r.useState("reviews"),[E,b]=r.useState(!1),[M,S]=r.useState(""),[x,w]=r.useState(0),[H,k]=r.useState(!1),[U,_]=r.useState(""),[$,N]=r.useState(""),[Q,he]=r.useState("popular"),[B,xe]=r.useState(0),[R,pe]=r.useState("all"),[z,ue]=r.useState("all"),[q,me]=r.useState(""),[O,ve]=r.useState(!1),[je,V]=r.useState(!1),[Y,J]=r.useState(!1),[C,K]=r.useState(""),[X,Z]=r.useState(""),[ee,te]=r.useState(!1),[se,ie]=r.useState(!1),re=le(s=>s.addRecentBook),F=le(s=>s.setCurrentBook),c=Number(i),fe=()=>({sort:Q,rating:B>0?B:void 0,source:R==="all"?void 0:R,has_text:z==="all"?void 0:z==="with",q:q.trim()||void 0,include_spoilers:O}),p=async s=>{V(!0);try{const a=await d.getReviews(s,fe());return g(a),a}finally{V(!1)}};r.useEffect(()=>i?((async()=>{W(!0),G(null);try{const[a,I]=await Promise.all([d.getBook(c),d.getSimilar(c)]),ke=await p(c);n(a),u(I),re(a),F(a),d.getBookQuotes(c).then(A).catch(()=>{}),d.getProgress(c).then(L).catch(()=>{}),ke.length===0&&(ie(!0),d.enrichBook(c).then(_e=>{n(_e),p(c).catch(()=>{}),d.getBookQuotes(c).then(A).catch(()=>{})}).catch(()=>{}).finally(()=>ie(!1)))}catch(a){G(a instanceof Error?a.message:"Failed to load book")}finally{W(!1)}})(),()=>F(null)):void 0,[i,c,re,F]);const ye=async s=>{if(t)try{await d.createReview(t.id,{rating:s}),n({...t,user_rating:s}),p(t.id).catch(()=>{})}catch{}},be=async()=>{if(!(!t||x===0)){J(!0);try{const s=await d.createReview(t.id,{rating:x,text:M,is_spoiler:H,started_at:U||void 0,finished_at:$||void 0});g(a=>[s,...a]),p(t.id).catch(()=>{}),b(!1),S(""),w(0),k(!1),_(""),N(""),n({...t,user_rating:x})}catch{}finally{J(!1)}}},Se=async()=>{if(!t)return;const s=parseInt(C);if(!(!s||s<=0)){te(!0);try{const a=t.page_count>0?s/t.page_count*100:0,I=await d.updateProgress(t.id,{page:s,percent:Math.min(100,a),note:X||void 0});L([I,...f]),K(""),Z("")}catch{}finally{te(!1)}}};if(ge)return e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})})]});if(D||!t)return e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"Book not found"}),e.jsx("p",{children:D||"This book does not exist."}),e.jsx(ne,{to:"/browse",className:"btn btn-secondary",children:"Browse books"})]})})]});const ae=t.subjects||[],m=f.length>0?f[0]:null,we=t.rating_dist&&t.rating_dist.some(s=>s>0);return e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsxs("div",{className:"page-container fade-in",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"200px 1fr",gap:32,marginBottom:40},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[e.jsx(Ne,{book:t,size:"lg"}),e.jsx(Re,{book:t}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:13,color:"var(--gr-light)",marginBottom:4},children:"Rate this book"}),e.jsx(v,{rating:t.user_rating||0,interactive:!0,onChange:ye})]}),t.page_count>0&&e.jsxs("div",{style:{width:"100%",padding:12,background:"var(--gr-cream)",borderRadius:8},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:"var(--gr-brown)",marginBottom:8},children:"Track Progress"}),m&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{className:"progress-bar",style:{height:6},children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.min(100,m.percent)}%`}})}),e.jsxs("div",{style:{fontSize:11,color:"var(--gr-light)",marginTop:4},children:["Page ",m.page," of ",t.page_count," (",Math.round(m.percent),"%)"]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("input",{type:"number",min:"1",max:t.page_count,value:C,onChange:s=>K(s.target.value),placeholder:"Page #",className:"form-input",style:{fontSize:12,padding:"4px 8px",flex:1}}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:Se,disabled:ee||!C,style:{fontSize:11,padding:"4px 8px"},children:ee?"...":"Update"})]}),e.jsx("input",{type:"text",value:X,onChange:s=>Z(s.target.value),placeholder:"Add a note (optional)",className:"form-input",style:{fontSize:11,padding:"4px 8px",marginTop:4,width:"100%"}})]})]}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:28,fontWeight:900,color:"var(--gr-brown)",margin:"0 0 4px",lineHeight:1.3},children:t.title}),t.series&&e.jsx("div",{style:{fontSize:14,color:"var(--gr-light)",marginBottom:8,fontStyle:"italic"},children:t.series}),e.jsxs("p",{className:"book-author",style:{fontSize:16,marginBottom:12},children:["by"," ",e.jsx("span",{style:{color:"var(--gr-text)"},children:t.author_names})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx(v,{rating:t.average_rating}),e.jsx("span",{style:{fontWeight:700,fontSize:16},children:t.average_rating?.toFixed(2)})]}),e.jsxs("div",{style:{fontSize:13,color:"var(--gr-light)",marginBottom:16,display:"flex",gap:12},children:[e.jsxs("span",{children:[t.ratings_count?.toLocaleString()," ratings"]}),t.reviews_count>0&&e.jsxs("span",{children:[t.reviews_count.toLocaleString()," reviews"]})]}),e.jsx(Ge,{book:t}),t.description&&e.jsx(Ee,{text:t.description}),ae.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:20},children:ae.map(s=>e.jsx(ne,{to:`/genre/${encodeURIComponent(s)}`,className:"genre-tag",children:s},s))}),we&&e.jsx(De,{book:t}),e.jsxs("div",{style:{padding:16,background:"var(--gr-cream)",borderRadius:8,marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:14,fontWeight:700,color:"var(--gr-brown)",marginBottom:12},children:"Book details & editions"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:10,fontSize:14},children:[t.format&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(oe,{size:14}),e.jsxs("span",{children:[t.format,t.page_count>0?`, ${t.page_count} pages`:""]})]}),!t.format&&t.page_count>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(oe,{size:14}),e.jsxs("span",{children:[t.page_count," pages"]})]}),t.publisher&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Ce,{size:14}),e.jsx("span",{children:t.publisher})]}),t.first_published&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(de,{size:14}),e.jsxs("span",{children:["First published ",t.first_published]})]}),!t.first_published&&t.publish_year>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(de,{size:14}),e.jsxs("span",{children:["Published ",t.publish_year]})]}),t.isbn13&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Fe,{size:14}),e.jsxs("span",{children:["ISBN ",t.isbn13]})]}),t.language&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Ie,{size:14}),e.jsx("span",{children:t.language})]}),t.asin&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(ce,{size:14}),e.jsxs("span",{children:["ASIN ",t.asin]})]}),t.goodreads_id&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Pe,{size:14}),e.jsx("a",{href:`https://www.goodreads.com/book/show/${t.goodreads_id}`,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--gr-teal)",textDecoration:"none"},children:"View on Goodreads"})]}),t.ol_key&&!t.goodreads_id&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(ce,{size:14}),e.jsx("span",{children:t.ol_key})]})]})]})]})]}),e.jsxs("div",{className:"tabs",children:[e.jsxs("button",{className:`tab ${h==="reviews"?"active":""}`,onClick:()=>y("reviews"),children:["Community Reviews (",t.reviews_count||l.length,")"]}),e.jsxs("button",{className:`tab ${h==="similar"?"active":""}`,onClick:()=>y("similar"),children:["Similar Books (",o.length,")"]}),e.jsxs("button",{className:`tab ${h==="quotes"?"active":""}`,onClick:()=>y("quotes"),children:["Quotes (",j.length,")"]})]}),h==="reviews"&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:8,marginBottom:14,padding:12,background:"var(--gr-cream)",borderRadius:8},children:[e.jsxs("select",{className:"form-input",value:Q,onChange:s=>he(s.target.value),children:[e.jsx("option",{value:"popular",children:"Popular"}),e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"oldest",children:"Oldest"}),e.jsx("option",{value:"rating_desc",children:"Highest rating"}),e.jsx("option",{value:"rating_asc",children:"Lowest rating"})]}),e.jsxs("select",{className:"form-input",value:B,onChange:s=>xe(Number(s.target.value)),children:[e.jsx("option",{value:0,children:"All ratings"}),e.jsx("option",{value:5,children:"5 stars"}),e.jsx("option",{value:4,children:"4 stars"}),e.jsx("option",{value:3,children:"3 stars"}),e.jsx("option",{value:2,children:"2 stars"}),e.jsx("option",{value:1,children:"1 star"})]}),e.jsxs("select",{className:"form-input",value:R,onChange:s=>pe(s.target.value),children:[e.jsx("option",{value:"all",children:"All sources"}),e.jsx("option",{value:"goodreads",children:"Goodreads"}),e.jsx("option",{value:"user",children:"My reviews"})]}),e.jsxs("select",{className:"form-input",value:z,onChange:s=>ue(s.target.value),children:[e.jsx("option",{value:"all",children:"Any text"}),e.jsx("option",{value:"with",children:"With text"}),e.jsx("option",{value:"without",children:"Ratings only"})]}),e.jsx("input",{type:"search",className:"form-input",placeholder:"Search review text",value:q,onChange:s=>me(s.target.value)}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>p(t.id),children:"Apply filters"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:O,onChange:s=>ve(s.target.checked)}),"Show spoilers"]})]}),!E&&e.jsx("button",{className:"btn btn-primary",style:{marginBottom:20},onClick:()=>b(!0),children:"Write a review"}),E&&e.jsxs("div",{style:{padding:20,background:"var(--gr-cream)",borderRadius:8,marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:16,color:"var(--gr-brown)",marginBottom:12},children:"Write your review"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Your rating"}),e.jsx(v,{rating:x,interactive:!0,onChange:w,size:24})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Review (optional)"}),e.jsx("textarea",{className:"form-input",placeholder:"What did you think?",value:M,onChange:s=>S(s.target.value)})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[e.jsx("input",{type:"checkbox",checked:H,onChange:s=>k(s.target.checked)}),"Contains spoilers"]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Started reading"}),e.jsx("input",{type:"date",className:"form-input",value:U,onChange:s=>_(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Finished reading"}),e.jsx("input",{type:"date",className:"form-input",value:$,onChange:s=>N(s.target.value)})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:be,disabled:Y||x===0,children:Y?"Posting...":"Post review"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{b(!1),S(""),w(0),k(!1),_(""),N("")},children:"Cancel"})]})]}),se&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16,fontSize:14,color:"var(--gr-light)"},children:[e.jsx("div",{className:"spinner",style:{width:16,height:16,borderWidth:2}}),"Fetching community reviews from Goodreads..."]}),je&&e.jsx("div",{style:{marginBottom:12,fontSize:13,color:"var(--gr-light)"},children:"Loading reviews..."}),l.length>0?l.map(s=>e.jsx(We,{review:s},s.id)):se?null:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No reviews yet"}),e.jsx("p",{children:"Be the first to review this book!"})]})]}),h==="similar"&&e.jsx("div",{children:o.length>0?e.jsx(ze,{books:o}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No similar books found"}),e.jsx("p",{children:"Check back later for recommendations."})]})}),h==="quotes"&&e.jsx("div",{children:j.length>0?j.map(s=>e.jsx("div",{style:{padding:20,borderLeft:"3px solid var(--gr-orange)",background:"var(--gr-cream)",borderRadius:"0 8px 8px 0",marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsx(Te,{size:16,style:{color:"var(--gr-orange)",flexShrink:0,marginTop:2}}),e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",fontStyle:"italic",margin:"0 0 8px"},children:["“",s.text,"”"]}),e.jsxs("p",{style:{fontSize:13,color:"var(--gr-light)",margin:0},children:["— ",s.author_name]}),s.likes_count>0&&e.jsxs("p",{style:{fontSize:12,color:"var(--gr-light)",margin:"4px 0 0"},children:[s.likes_count," likes"]})]})]})},s.id)):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No quotes yet"}),e.jsx("p",{children:"Add memorable quotes from this book."})]})})]})]})}export{Oe as default};
