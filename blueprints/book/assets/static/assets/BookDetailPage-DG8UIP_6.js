import{j as e,S as g,H as v,B as G,b as l}from"./index-smKHW-e9.js";import{h as L,r as a,L as f}from"./react-vendor-bJoUFh3v.js";import{u as I,S as A}from"./ShelfButton-CIJiR5zA.js";import{B as $}from"./BookGrid-B6fdp-rd.js";import{B as U,c as M,C as O,H as Y,G as q,F as J}from"./ui-CwMuETwS.js";import"./middleware-WYGlAF-S.js";function y(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}function K({review:t}){const s=t.book_title?t.book_title.charAt(0).toUpperCase():"R";return e.jsxs("div",{className:"review-card",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("div",{className:"review-avatar",children:s}),e.jsxs("div",{children:[e.jsx(g,{rating:t.rating}),e.jsx("div",{style:{fontSize:12,color:"var(--gr-light)",marginTop:2},children:y(t.created_at)})]})]}),t.text&&e.jsx("div",{className:"review-text",children:t.text}),(t.started_at||t.finished_at)&&e.jsxs("div",{style:{fontSize:12,color:"var(--gr-light)",marginTop:8},children:[t.started_at&&e.jsxs(e.Fragment,{children:["Started ",y(t.started_at)]}),t.started_at&&t.finished_at&&e.jsx(e.Fragment,{children:" Â· "}),t.finished_at&&e.jsxs(e.Fragment,{children:["Finished ",y(t.finished_at)]})]})]})}function te(){const{id:t}=L(),[s,h]=a.useState(null),[o,b]=a.useState([]),[m,D]=a.useState([]),[T,k]=a.useState(!0),[S,B]=a.useState(null),[c,w]=a.useState("reviews"),[N,x]=a.useState(!1),[_,j]=a.useState(""),[n,p]=a.useState(0),[R,C]=a.useState(!1),z=I(i=>i.addRecentBook),u=I(i=>i.setCurrentBook),d=Number(t);a.useEffect(()=>t?((async()=>{k(!0),B(null);try{const[r,W,E]=await Promise.all([l.getBook(d),l.getReviews(d),l.getSimilar(d)]);h(r),b(W),D(E),z(r),u(r)}catch(r){B(r instanceof Error?r.message:"Failed to load book")}finally{k(!1)}})(),()=>u(null)):void 0,[t,d,z,u]);const H=async i=>{if(s)try{await l.createReview({book_id:s.id,rating:i}),h({...s,user_rating:i})}catch{}},P=async()=>{if(!(!s||n===0)){C(!0);try{const i=await l.createReview({book_id:s.id,rating:n,text:_});b([i,...o]),x(!1),j(""),p(0),h({...s,user_rating:n})}catch{}finally{C(!1)}}};if(T)return e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})})]});if(S||!s)return e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"Book not found"}),e.jsx("p",{children:S||"This book does not exist."}),e.jsx(f,{to:"/browse",className:"btn btn-secondary",children:"Browse books"})]})})]});const F=s.genres?s.genres.split(",").map(i=>i.trim()).filter(Boolean):[];return e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsxs("div",{className:"page-container fade-in",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"200px 1fr",gap:32,marginBottom:40},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[e.jsx(G,{book:s,size:"lg"}),e.jsx(A,{book:s}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:13,color:"var(--gr-light)",marginBottom:4},children:"Rate this book"}),e.jsx(g,{rating:s.user_rating||0,interactive:!0,onChange:H})]})]}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:28,fontWeight:900,color:"var(--gr-brown)",margin:"0 0 8px",lineHeight:1.3},children:s.title}),e.jsxs("p",{className:"book-author",style:{fontSize:16,marginBottom:12},children:["by"," ",e.jsx(f,{to:`/author/${s.author_id}`,style:{color:"var(--gr-text)"},children:s.author_names})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[e.jsx(g,{rating:s.average_rating}),e.jsx("span",{style:{fontWeight:700,fontSize:16},children:s.average_rating?.toFixed(2)}),e.jsxs("span",{style:{color:"var(--gr-light)",fontSize:14},children:["(",s.ratings_count?.toLocaleString()," ratings)"]})]}),s.description&&e.jsx("div",{style:{fontSize:15,lineHeight:1.7,color:"var(--gr-text)",marginBottom:24},children:s.description}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12,marginBottom:24,fontSize:14},children:[s.page_count>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(U,{size:14}),e.jsxs("span",{children:[s.page_count," pages"]})]}),s.publisher&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(M,{size:14}),e.jsx("span",{children:s.publisher})]}),s.publish_year>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(O,{size:14}),e.jsxs("span",{children:["Published ",s.publish_year]})]}),s.isbn13&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(Y,{size:14}),e.jsxs("span",{children:["ISBN ",s.isbn13]})]}),s.language&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(q,{size:14}),e.jsx("span",{children:s.language})]}),s.ol_key&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,color:"var(--gr-light)"},children:[e.jsx(J,{size:14}),e.jsx("span",{children:s.ol_key})]})]}),F.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:16},children:F.map(i=>e.jsx(f,{to:`/genre/${encodeURIComponent(i)}`,className:"genre-tag",children:i},i))})]})]}),e.jsxs("div",{className:"tabs",children:[e.jsxs("button",{className:`tab ${c==="reviews"?"active":""}`,onClick:()=>w("reviews"),children:["Reviews (",o.length,")"]}),e.jsxs("button",{className:`tab ${c==="similar"?"active":""}`,onClick:()=>w("similar"),children:["Similar Books (",m.length,")"]})]}),c==="reviews"&&e.jsxs("div",{children:[!N&&e.jsx("button",{className:"btn btn-primary",style:{marginBottom:20},onClick:()=>x(!0),children:"Write a review"}),N&&e.jsxs("div",{style:{padding:20,background:"var(--gr-cream)",borderRadius:8,marginBottom:24},children:[e.jsx("h3",{style:{fontFamily:"'Merriweather', Georgia, serif",fontSize:16,color:"var(--gr-brown)",marginBottom:12},children:"Write your review"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Your rating"}),e.jsx(g,{rating:n,interactive:!0,onChange:p,size:24})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Review (optional)"}),e.jsx("textarea",{className:"form-input",placeholder:"What did you think?",value:_,onChange:i=>j(i.target.value)})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:P,disabled:R||n===0,children:R?"Posting...":"Post review"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{x(!1),j(""),p(0)},children:"Cancel"})]})]}),o.length>0?o.map(i=>e.jsx(K,{review:i},i.id)):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No reviews yet"}),e.jsx("p",{children:"Be the first to review this book!"})]})]}),c==="similar"&&e.jsx("div",{children:m.length>0?e.jsx($,{books:m}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No similar books found"}),e.jsx("p",{children:"Check back later for recommendations."})]})})]})]})}export{te as default};
