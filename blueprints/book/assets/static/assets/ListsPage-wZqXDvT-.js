import{b as l,j as s,H as M,A as R}from"./index-CR0Xjtpx.js";import{r as t,L as T}from"./react-vendor-bJoUFh3v.js";import{D as O,P as $,B as z,U as _}from"./ui-D_Yei50m.js";function K(){const[x,c]=t.useState([]),[B,P]=t.useState(!0),[I,r]=t.useState(!1),[n,j]=t.useState(""),[N,f]=t.useState(""),[d,b]=t.useState([]),[v,g]=t.useState(!1),[m,S]=t.useState(!1),[u,L]=t.useState(null),[C,h]=t.useState(""),[k,p]=t.useState(""),[y,A]=t.useState(""),[i,w]=t.useState("");t.useEffect(()=>{l.getLists().then(c).catch(()=>{}).finally(()=>P(!1))},[]);const D=()=>{n.trim()&&l.createList({title:n,description:N}).then(e=>{c(a=>[...a,e]),r(!1),j(""),f("")}).catch(()=>{})},U=()=>{if(h(""),d.length>0){S(!m);return}g(!0),S(!0),l.browseSourceLists(y).then(b).catch(e=>{e instanceof R?h(e.message):h("Failed to browse source lists")}).finally(()=>g(!1))},F=()=>{b([]),U()},E=async e=>{const a=e.trim();if(a){p(""),L(a);try{const o=await l.importSourceList(a);c(H=>[...H,o]),i.trim()===a&&w("")}catch(o){o instanceof R?p(o.message):p("Failed to import source list")}finally{L(null)}}};return s.jsxs(s.Fragment,{children:[s.jsx(M,{}),s.jsxs("div",{className:"page-container",children:[s.jsxs("div",{className:"section-header",children:[s.jsx("h1",{className:"section-title",children:"Listopia"}),s.jsxs("div",{className:"header-actions",children:[s.jsxs("button",{className:"btn btn-secondary",onClick:U,children:[s.jsx(O,{size:16})," ",m?"Hide":"Browse"," Source Lists"]}),s.jsxs("button",{className:"btn btn-primary",onClick:()=>r(!0),children:[s.jsx($,{size:16})," Create List"]})]})]}),m&&s.jsxs("section",{className:"source-lists-panel",children:[s.jsxs("div",{className:"source-input-row",children:[s.jsx("input",{className:"form-input source-tag-input",value:y,onChange:e=>A(e.target.value),placeholder:"Optional tag (e.g. fantasy)"}),s.jsx("button",{className:"btn btn-secondary btn-sm",onClick:F,disabled:v,children:"Refresh"})]}),s.jsxs("div",{className:"source-input-row",children:[s.jsx("input",{className:"form-input source-url-input",value:i,onChange:e=>w(e.target.value),placeholder:"Paste source list URL"}),s.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>E(i),disabled:!i.trim()||!!u,children:"Import URL"})]}),s.jsx("h2",{className:"source-section-title",children:"Popular Source Lists"}),C&&s.jsx("p",{className:"form-error",children:C}),k&&s.jsx("p",{className:"form-error",children:k}),v?s.jsx("div",{className:"loading-spinner",children:s.jsx("div",{className:"spinner"})}):d.length===0?s.jsx("p",{className:"page-subtitle",children:"No lists found."}):s.jsx("div",{className:"list-grid",children:d.map((e,a)=>s.jsxs("div",{className:"source-list-card",children:[s.jsxs("div",{className:"source-list-info",children:[s.jsx("div",{className:"source-list-title",children:e.title}),s.jsxs("div",{className:"source-list-meta",children:[e.tag&&s.jsxs("span",{children:["#",e.tag]}),e.book_count>0&&s.jsxs("span",{className:"source-meta-item",children:[s.jsx(z,{size:11})," ",e.book_count.toLocaleString()," books"]}),e.voter_count>0&&s.jsxs("span",{className:"source-meta-item",children:[s.jsx(_,{size:11})," ",e.voter_count.toLocaleString()," voters"]})]})]}),s.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>E(e.url),disabled:u===e.url,children:u===e.url?"...":"Import"})]},a))})]}),B?s.jsx("div",{className:"loading-spinner",children:s.jsx("div",{className:"spinner"})}):x.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx("h3",{children:"No lists yet"}),s.jsx("p",{children:"Create your first book list or import from a source list URL."}),s.jsx("button",{className:"btn btn-primary",onClick:()=>r(!0),children:"Create List"})]}):s.jsx("div",{className:"list-grid",children:x.map(e=>s.jsxs(T,{to:`/list/${e.id}`,className:"local-list-card",children:[s.jsx("h3",{className:"local-list-title",children:e.title}),e.description&&s.jsx("p",{className:"local-list-description",children:e.description}),s.jsxs("div",{className:"local-list-meta",children:[s.jsxs("span",{className:"source-meta-item",children:[s.jsx(z,{size:12})," ",e.item_count," books"]}),e.voter_count>0&&s.jsxs("span",{className:"source-meta-item",children:[s.jsx(_,{size:12})," ",e.voter_count.toLocaleString()," voters"]})]})]},e.id))}),I&&s.jsx("div",{className:"modal-overlay",onClick:()=>r(!1),children:s.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),children:[s.jsx("h2",{children:"Create New List"}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{className:"form-label",children:"Title"}),s.jsx("input",{className:"form-input",value:n,onChange:e=>j(e.target.value),placeholder:"Best Books of 2024"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{className:"form-label",children:"Description"}),s.jsx("textarea",{className:"form-input",value:N,onChange:e=>f(e.target.value),placeholder:"A curated list of..."})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>r(!1),children:"Cancel"}),s.jsx("button",{className:"btn btn-primary",onClick:D,children:"Create"})]})]})})]})]})}export{K as default};
