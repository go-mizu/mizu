{{template "layouts/default.html" .}}

{{define "title"}}{{.Account.DisplayName}} (@{{.Account.Username}}) - Mizu Forum{{end}}
{{define "description"}}View {{.Account.DisplayName}}'s profile, threads, and comments on Mizu Forum.{{end}}

{{define "content"}}
<div class="page-layout page-layout--with-sidebar">
    <div class="main-content">
        <!-- Profile Header -->
        <div class="card mb-6">
            <div class="card__body">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-4">
                        <div class="user-badge__avatar" style="width: 80px; height: 80px; font-size: var(--text-3xl);">
                            {{slice .Account.Username 0 1 | toUpper}}
                        </div>
                        <div>
                            <h1 style="margin-bottom: var(--space-2);">{{.Account.DisplayName}}</h1>
                            <p class="text-muted">@{{.Account.Username}}</p>
                        </div>
                    </div>
                    <div>
                        {{if .IsOwnProfile}}
                        <a href="/settings" class="btn btn--secondary">Edit Profile</a>
                        {{else if .User}}
                        <button class="btn btn--primary">Follow</button>
                        {{end}}
                    </div>
                </div>

                {{if .Account.Bio}}
                <p class="mb-4">{{.Account.Bio}}</p>
                {{end}}

                <div class="flex gap-6 text-sm">
                    <div>
                        <strong class="text-lg">{{.Account.PostKarma}}</strong>
                        <span class="text-muted">post karma</span>
                    </div>
                    <div>
                        <strong class="text-lg">{{.Account.CommentKarma}}</strong>
                        <span class="text-muted">comment karma</span>
                    </div>
                    <div>
                        <strong class="text-lg">{{.Account.TotalKarma}}</strong>
                        <span class="text-muted">total karma</span>
                    </div>
                    <div>
                        <span class="text-muted">Joined {{.Account.CreatedAt.Format "Jan 2006"}}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="mb-4">
            <div class="flex gap-2">
                <a href="/u/{{.Account.Username}}" class="btn btn--sm {{if eq .Tab "overview"}}btn--primary{{else}}btn--secondary{{end}}">Overview</a>
                <a href="/u/{{.Account.Username}}?tab=threads" class="btn btn--sm {{if eq .Tab "threads"}}btn--primary{{else}}btn--secondary{{end}}">Threads</a>
                <a href="/u/{{.Account.Username}}?tab=comments" class="btn btn--sm {{if eq .Tab "comments"}}btn--primary{{else}}btn--secondary{{end}}">Comments</a>
                {{if .IsOwnProfile}}
                <a href="/u/{{.Account.Username}}?tab=saved" class="btn btn--sm {{if eq .Tab "saved"}}btn--primary{{else}}btn--secondary{{end}}">Saved</a>
                {{end}}
            </div>
        </div>

        <!-- Content -->
        <div class="card">
            <div class="card__body">
                {{if eq .Tab "threads"}}
                    <!-- Threads List -->
                    {{if .Threads}}
                    <div class="thread-list">
                        {{range .Threads}}
                            {{template "thread_card" (dict "ID" .ID "Title" .Title "Content" .Content "Score" .Score "UserVote" .UserVote "PostCount" .PostCount "ViewCount" .ViewCount "Sticky" .Sticky "Locked" .Locked "NSFW" .NSFW "Tags" .Tags "CreatedAt" .CreatedAt "Account" .Account "Forum" .Forum "User" $.User)}}
                        {{end}}
                    </div>
                    {{else}}
                    <div class="text-center" style="padding: var(--space-12) 0;">
                        <p class="text-muted">No threads yet</p>
                    </div>
                    {{end}}

                {{else if eq .Tab "comments"}}
                    <!-- Comments List -->
                    {{if .Posts}}
                    <div class="post-list">
                        {{range .Posts}}
                            <div class="post-card" style="margin-bottom: var(--space-4);">
                                <div class="post-card__vote">
                                    {{template "vote_controls" (dict "Type" "post" "ID" .ID "Score" .Score "UserVote" .UserVote "User" $.User)}}
                                </div>
                                <div class="post-card__content">
                                    <div class="text-sm text-muted mb-2">
                                        commented on <a href="/f/{{.ThreadForum}}/t/{{.ThreadID}}">{{.ThreadTitle}}</a>
                                    </div>
                                    <div class="post-card__body">{{.Content}}</div>
                                    <div class="text-sm text-muted mt-2">
                                        {{.CreatedAt.Format "2 Jan 2006 15:04"}}
                                    </div>
                                </div>
                            </div>
                        {{end}}
                    </div>
                    {{else}}
                    <div class="text-center" style="padding: var(--space-12) 0;">
                        <p class="text-muted">No comments yet</p>
                    </div>
                    {{end}}

                {{else}}
                    <!-- Overview - Mixed Activity -->
                    {{if .Activity}}
                    <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                        {{range .Activity}}
                            {{if eq .Type "thread"}}
                                {{template "thread_card" (dict "ID" .ID "Title" .Title "Content" .Content "Score" .Score "UserVote" .UserVote "PostCount" .PostCount "ViewCount" .ViewCount "Sticky" .Sticky "Locked" .Locked "NSFW" .NSFW "Tags" .Tags "CreatedAt" .CreatedAt "Account" .Account "Forum" .Forum "User" $.User)}}
                            {{else}}
                                <div class="post-card">
                                    <div class="post-card__vote">
                                        {{template "vote_controls" (dict "Type" "post" "ID" .ID "Score" .Score "UserVote" .UserVote "User" $.User)}}
                                    </div>
                                    <div class="post-card__content">
                                        <div class="text-sm text-muted mb-2">
                                            commented on <a href="/f/{{.ThreadForum}}/t/{{.ThreadID}}">{{.ThreadTitle}}</a>
                                        </div>
                                        <div class="post-card__body">{{.Content}}</div>
                                        <div class="text-sm text-muted mt-2">
                                            {{.CreatedAt.Format "2 Jan 2006 15:04"}}
                                        </div>
                                    </div>
                                </div>
                            {{end}}
                        {{end}}
                    </div>
                    {{else}}
                    <div class="text-center" style="padding: var(--space-12) 0;">
                        <p class="text-muted">No activity yet</p>
                    </div>
                    {{end}}
                {{end}}
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar-content">
        <div class="sidebar">
            <div class="sidebar__section">
                <h3 class="sidebar__title">About</h3>
                <div class="text-sm">
                    <div class="mb-2">
                        <strong>Username:</strong> {{.Account.Username}}
                    </div>
                    <div class="mb-2">
                        <strong>Joined:</strong> {{.Account.CreatedAt.Format "January 2006"}}
                    </div>
                    {{if .Account.Location}}
                    <div class="mb-2">
                        <strong>Location:</strong> {{.Account.Location}}
                    </div>
                    {{end}}
                    {{if .Account.Website}}
                    <div class="mb-2">
                        <strong>Website:</strong> <a href="{{.Account.Website}}" target="_blank" rel="noopener">{{.Account.Website}}</a>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </div>
</div>
{{end}}
