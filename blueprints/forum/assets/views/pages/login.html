{{template "layouts/default.html" .}}

{{define "title"}}Login - Mizu Forum{{end}}

{{define "content"}}
<div class="content" style="padding: var(--space-12) 0;">
    <div class="card" style="max-width: 500px; margin: 0 auto;">
        <div class="card__header">
            <h2 class="card__title">Welcome Back</h2>
        </div>
        <div class="card__body">
            {{if .Error}}
            <div class="flash-message flash-message--error mb-4">
                {{.Error}}
            </div>
            {{end}}

            <form method="POST" action="/api/v1/auth/login" id="login-form">
                <div class="form-group">
                    <label class="form-label" for="username_or_email">Username or Email</label>
                    <input
                        type="text"
                        id="username_or_email"
                        name="username_or_email"
                        class="form-input"
                        placeholder="Enter your username or email"
                        required
                        autofocus
                    >
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        class="form-input"
                        placeholder="Enter your password"
                        required
                    >
                    <a href="/forgot-password" class="form-help" style="display: block; margin-top: var(--space-2);">Forgot your password?</a>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: var(--space-2); cursor: pointer;">
                        <input type="checkbox" name="remember" class="form-checkbox">
                        <span class="text-sm">Remember me</span>
                    </label>
                </div>

                <button type="submit" class="btn btn--primary btn--lg" style="width: 100%;">
                    Login
                </button>
            </form>
        </div>
        <div class="card__footer text-center">
            Don't have an account? <a href="/register" class="font-semibold">Sign up</a>
        </div>
    </div>
</div>

{{end}}

{{define "scripts"}}
<script>
document.getElementById('login-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    const data = {
        username_or_email: formData.get('username_or_email'),
        password: formData.get('password')
    };

    try {
        const response = await fetch('/api/v1/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (response.ok) {
            // Store token if provided
            if (result.data && result.data.session && result.data.session.token) {
                localStorage.setItem('auth_token', result.data.session.token);
            }
            // Redirect to home or intended page
            window.location.href = '/';
        } else {
            alert(result.error || 'Login failed. Please try again.');
        }
    } catch (error) {
        alert('An error occurred. Please try again.');
    }
});
</script>
{{end}}
