<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{block "title" .}}Workspace{{end}}</title>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/dist/css/main.css">
    <script>
        // Set initial theme before render to prevent flash
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
</head>
<body class="min-h-screen">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="fixed left-0 top-0 bottom-0 w-62 bg-secondary flex flex-col overflow-y-auto overflow-x-hidden z-100 transition-slow scrollbar-thin" id="sidebar">
            <div class="p-3 px-2 flex items-center gap-2">
                <button class="flex items-center justify-center w-7 h-7 rounded-sm text-secondary opacity-0 hover:bg-hover hover:opacity-100 transition btn-icon shrink-0" id="sidebar-toggle" title="Toggle sidebar">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M2 4h12M2 8h12M2 12h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                </button>
                <div class="flex items-center gap-2 px-2 py-1 rounded cursor-pointer flex-1 min-w-0 hover:bg-hover transition" id="workspace-switcher">
                    {{if .Workspace}}
                    <span class="ws-icon-md">{{slice .Workspace.Name 0 1}}</span>
                    <span class="flex-1 text-base font-medium truncate text-primary">{{.Workspace.Name}}</span>
                    {{end}}
                    <svg class="text-tertiary shrink-0 transition" width="12" height="12" viewBox="0 0 12 12">
                        <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    </svg>
                </div>
                <div class="dropdown hidden top-full left-2 right-2 mt-1 animate-slideDown" id="workspace-dropdown">
                    {{range .Workspaces}}
                    <a href="/w/{{.Slug}}" class="flex items-center gap-2 py-2 px-3 rounded text-base text-primary hover:bg-hover transition">
                        <span class="ws-icon-sm">{{slice .Name 0 1}}</span>
                        <span>{{.Name}}</span>
                    </a>
                    {{end}}
                    <div class="divider my-1"></div>
                    <button class="flex items-center gap-2 py-2 px-3 rounded text-base text-primary hover:bg-hover transition w-full text-left" id="create-workspace-btn">
                        <span class="w-5 h-5 flex items-center justify-center text-secondary text-md">+</span>
                        <span>Create workspace</span>
                    </button>
                </div>
            </div>

            <nav class="px-2">
                <a href="/w/{{.Workspace.Slug}}/search" class="flex items-center gap-2 py-1 px-2 rounded text-secondary text-base min-h-7 relative hover:bg-hover hover:text-primary transition">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="shrink-0 opacity-80">
                        <circle cx="7" cy="7" r="5" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M11 11L14 14" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>Search</span>
                    <kbd class="ml-auto text-xs text-tertiary bg-tertiary px-1-5 py-0-5 rounded-sm font-mono">Cmd+K</kbd>
                </a>
                <a href="/w/{{.Workspace.Slug}}/settings" class="flex items-center gap-2 py-1 px-2 rounded text-secondary text-base min-h-7 relative hover:bg-hover hover:text-primary transition">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="shrink-0 opacity-80">
                        <circle cx="8" cy="8" r="2" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M8 2v2M8 12v2M2 8h2M12 8h2M3.5 3.5l1.4 1.4M11.1 11.1l1.4 1.4M3.5 12.5l1.4-1.4M11.1 4.9l1.4-1.4" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>Settings</span>
                </a>
            </nav>

            {{if .Favorites}}
            <div class="mt-4 px-2">
                <div class="flex items-center justify-between py-1 px-2 mb-0-5">
                    <span class="text-xs font-medium text-tertiary tracking-wide">Favorites</span>
                </div>
                <div class="flex flex-col gap-px">
                {{range .Favorites}}
                <a href="/w/{{$.Workspace.Slug}}/p/{{.TargetID}}" class="flex items-center gap-2 py-1 px-2 rounded text-secondary text-base min-h-7 hover:bg-hover hover:text-primary transition">
                    <span class="text-base leading-none shrink-0 w-4 text-center">{{if .Icon}}{{.Icon}}{{else}}‚≠ê{{end}}</span>
                    <span class="flex-1 truncate text-base font-normal text-secondary">{{.Title}}</span>
                </a>
                {{end}}
                </div>
            </div>
            {{end}}

            <div class="mt-4 px-2">
                <div class="flex items-center justify-between py-1 px-2 mb-0-5 group">
                    <span class="text-xs font-medium text-tertiary tracking-wide">Pages</span>
                    <button class="flex items-center justify-center w-4-5 h-4-5 p-0 rounded-sm text-tertiary opacity-0 group-hover:opacity-100 hover:bg-hover hover:text-primary transition" id="add-page-btn" data-workspace="{{.Workspace.ID}}" title="Add page">
                        <svg width="12" height="12" viewBox="0 0 12 12">
                            <path d="M6 2v8M2 6h8" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </button>
                </div>
                <div class="flex flex-col gap-px" id="page-tree">
                    {{range .Pages}}
                    {{if eq .ParentType "workspace"}}
                    <div class="relative" data-id="{{.ID}}">
                        <a href="/w/{{$.Workspace.Slug}}/p/{{.ID}}" class="flex items-center gap-2 py-1 px-2 rounded text-secondary text-base min-h-7 hover:bg-hover hover:text-primary transition">
                            <span class="text-base leading-none shrink-0 w-4 text-center">{{if .Icon}}{{.Icon}}{{else}}üìÑ{{end}}</span>
                            <span class="flex-1 truncate text-base font-normal text-secondary">{{.Title}}</span>
                        </a>
                    </div>
                    {{end}}
                    {{end}}
                </div>
            </div>

            <!-- Theme toggle -->
            <div class="mt-auto p-2 border-t">
                <button class="flex items-center gap-2 py-1 px-2 rounded text-secondary text-base min-h-7 w-full justify-start hover:bg-hover hover:text-primary transition" id="theme-toggle" title="Toggle theme">
                    <svg class="shrink-0 opacity-80" width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <circle cx="8" cy="8" r="3" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M8 2v2M8 12v2M2 8h2M12 8h2M3.5 3.5l1.4 1.4M11.1 11.1l1.4 1.4M3.5 12.5l1.4-1.4M11.1 4.9l1.4-1.4" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>Theme</span>
                </button>
            </div>
        </aside>

        <!-- Main content -->
        <main class="flex-1 ml-62 flex flex-col min-h-screen bg-primary">
            <header class="h-11 flex items-center justify-between px-3 sticky top-0 bg-primary z-50 min-w-0">
                <div class="flex items-center gap-1 text-base text-tertiary min-w-0">
                    <a href="/w/{{.Workspace.Slug}}" class="flex items-center justify-center w-6 h-6 rounded text-tertiary hover:bg-hover hover:text-primary transition">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M2 8l6-6 6 6M4 7v6a1 1 0 001 1h2v-3a1 1 0 011-1h0a1 1 0 011 1v3h2a1 1 0 001-1V7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </a>
                    <span class="text-tertiary select-none">/</span>
                    {{block "breadcrumb" .}}{{end}}
                </div>
                <div class="flex items-center gap-1 shrink-0">
                    {{if .User}}
                    <div class="relative" id="user-menu">
                        <button class="avatar-md cursor-pointer hover:opacity-85 transition">{{slice .User.Name 0 1}}</button>
                        <div class="dropdown hidden right-0 top-full mt-1 min-w-55 animate-slideDown" id="user-dropdown">
                            <div class="py-2 px-3">
                                <strong class="block text-base font-medium text-primary">{{.User.Name}}</strong>
                                <span class="text-sm text-secondary">{{.User.Email}}</span>
                            </div>
                            <div class="divider my-1"></div>
                            <button id="logout-btn" class="flex items-center gap-2 w-full py-2 px-3 rounded text-base text-primary text-left hover:bg-hover transition">Log out</button>
                        </div>
                    </div>
                    {{end}}
                </div>
            </header>
            <div class="flex-1 py-6 px-24 max-w-content mx-auto w-full">
                {{block "content" .}}{{end}}
            </div>
        </main>
    </div>
    <script src="/static/js/app.js"></script>
    {{block "scripts" .}}{{end}}
</body>
</html>
