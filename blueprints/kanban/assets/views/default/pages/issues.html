{{define "content"}}
<div class="flex items-center justify-between mb-6">
  <div class="flex items-center gap-4">
    <h1 class="text-2xl font-semibold text-zinc-900">Issues</h1>
    <div class="flex items-center bg-zinc-100 rounded-lg p-1" role="group" aria-label="View options">
      <a href="/w/{{.Workspace.Slug}}/issues?view=list" class="flex items-center justify-center w-8 h-8 rounded-md bg-white shadow-sm text-zinc-900" aria-label="List view" aria-current="page">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="8" x2="21" y1="6" y2="6"/>
          <line x1="8" x2="21" y1="12" y2="12"/>
          <line x1="8" x2="21" y1="18" y2="18"/>
          <line x1="3" x2="3.01" y1="6" y2="6"/>
          <line x1="3" x2="3.01" y1="12" y2="12"/>
          <line x1="3" x2="3.01" y1="18" y2="18"/>
        </svg>
      </a>
      {{if .DefaultProjectID}}
      <a href="/w/{{.Workspace.Slug}}/board/{{.DefaultProjectID}}" class="flex items-center justify-center w-8 h-8 rounded-md text-zinc-500 hover:text-zinc-900 hover:bg-white transition-colors" aria-label="Board view">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect width="6" height="14" x="4" y="5"/>
          <rect width="6" height="10" x="14" y="7"/>
        </svg>
      </a>
      {{end}}
      <a href="/w/{{.Workspace.Slug}}/issues?view=calendar" class="flex items-center justify-center w-8 h-8 rounded-md text-zinc-500 hover:text-zinc-900 hover:bg-white transition-colors" aria-label="Calendar view">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M8 2v4"/>
          <path d="M16 2v4"/>
          <rect width="18" height="18" x="3" y="4"/>
          <path d="M3 10h18"/>
        </svg>
      </a>
      <a href="/w/{{.Workspace.Slug}}/issues?view=gantt" class="flex items-center justify-center w-8 h-8 rounded-md text-zinc-500 hover:text-zinc-900 hover:bg-white transition-colors" aria-label="Gantt chart view">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M3 3v18h18"/>
          <rect x="7" y="6" width="10" height="3"/>
          <rect x="5" y="12" width="8" height="3"/>
          <rect x="9" y="18" width="6" height="3"/>
        </svg>
      </a>
    </div>
  </div>
  <div class="flex items-center gap-3">
    <div class="relative">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.3-4.3"/>
      </svg>
      <input type="text" id="issue-search" class="w-64 pl-9 pr-4 py-2 text-sm border border-zinc-200 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Search issues...">
    </div>
    <div class="relative" id="filter-dropdown">
      <button class="inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-zinc-700 bg-white border border-zinc-200 rounded-lg hover:bg-zinc-50 transition-colors dropdown-trigger" id="filter-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
        </svg>
        Filter
        <span id="filter-count" class="hidden min-w-5 h-5 px-1.5 text-xs font-medium text-white bg-indigo-600 rounded-full flex items-center justify-center">0</span>
      </button>
      <div class="absolute right-0 top-full mt-1 w-64 bg-white rounded-lg shadow-lg border border-zinc-200 py-2 z-50 hidden dropdown-menu">
        <div class="px-3 py-2">
          <div class="text-xs font-semibold uppercase tracking-wide text-zinc-400 mb-2">Quick Filters</div>
          <button class="flex items-center gap-2 w-full px-2 py-1.5 text-sm text-left text-zinc-700 hover:bg-zinc-50 rounded transition-colors" data-filter="my-issues">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            My Issues
          </button>
          <button class="flex items-center gap-2 w-full px-2 py-1.5 text-sm text-left text-zinc-700 hover:bg-zinc-50 rounded transition-colors" data-filter="unassigned">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <path d="m4.93 4.93 14.14 14.14"/>
            </svg>
            Unassigned
          </button>
        </div>
        <div class="border-t border-zinc-100 my-2"></div>
        <div class="px-3 py-2">
          <div class="text-xs font-semibold uppercase tracking-wide text-zinc-400 mb-2">Status</div>
          {{range .Columns}}
          <label class="flex items-center gap-2 px-2 py-1.5 cursor-pointer hover:bg-zinc-50 rounded transition-colors">
            <input type="checkbox" data-filter-type="status" value="{{.Name}}" checked class="w-4 h-4 text-indigo-600 border-zinc-300 rounded focus:ring-indigo-500">
            <span class="inline-flex items-center gap-1.5 text-sm {{if eq (lower .Name) "done"}}text-green-600{{else if eq (lower .Name) "in-progress"}}text-blue-600{{else if eq (lower .Name) "todo"}}text-zinc-600{{else}}text-zinc-500{{end}}">
              {{if eq (lower .Name) "backlog"}}
              <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6" stroke-dasharray="2 2"/></svg>
              {{else if eq (lower .Name) "todo"}}
              <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><circle cx="8" cy="8" r="1.5" fill="currentColor"/></svg>
              {{else if or (eq (lower .Name) "in-progress") (eq (lower .Name) "doing")}}
              <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 2a6 6 0 0 1 6 6" stroke-width="2"/></svg>
              {{else if or (eq (lower .Name) "done") (eq (lower .Name) "completed")}}
              <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="7"/><path d="M5.5 8l2 2 3.5-3.5" stroke="white" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
              {{else if or (eq (lower .Name) "canceled") (eq (lower .Name) "cancelled")}}
              <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M5.5 5.5l5 5M10.5 5.5l-5 5"/></svg>
              {{else}}
              <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/></svg>
              {{end}}
              {{.Name}}
            </span>
          </label>
          {{end}}
        </div>
        <div class="border-t border-zinc-100 my-2"></div>
        <div class="px-3 py-2">
          <button class="text-sm text-zinc-500 hover:text-zinc-700 transition-colors" id="clear-filters">Clear all</button>
        </div>
      </div>
    </div>
  </div>
</div>

<span id="visible-count" class="hidden">{{.TotalCount}}</span>

<!-- Issues List (Linear-inspired, grouped by Status) -->
{{if .IssuesByStatus}}
<div id="issues-container">
  {{range .IssuesByStatus}}
  {{if .Issues}}
  <div class="mb-4 issue-group" data-group="{{.Status}}">
    <!-- Group Header (collapsible) -->
    <button type="button" class="flex items-center gap-2 w-full py-2 text-left group-toggle" data-expanded="true">
      <svg class="w-4 h-4 text-zinc-400 transition-transform group-chevron" style="transform: rotate(90deg);" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 4l4 4-4 4"/></svg>
      <!-- Status Icon -->
      <span class="{{if eq (lower .Status) "done"}}text-green-600{{else if eq (lower .Status) "in-progress"}}text-blue-600{{else if eq (lower .Status) "todo"}}text-zinc-600{{else}}text-zinc-400{{end}}">
        {{if eq (lower .Status) "backlog"}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6" stroke-dasharray="2 2"/></svg>
        {{else if eq (lower .Status) "todo"}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><circle cx="8" cy="8" r="1.5" fill="currentColor"/></svg>
        {{else if or (eq (lower .Status) "in-progress") (eq (lower .Status) "doing")}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 2a6 6 0 0 1 6 6" stroke-width="2"/></svg>
        {{else if or (eq (lower .Status) "done") (eq (lower .Status) "completed")}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="7"/><path d="M5.5 8l2 2 3.5-3.5" stroke="white" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
        {{else if or (eq (lower .Status) "canceled") (eq (lower .Status) "cancelled")}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M5.5 5.5l5 5M10.5 5.5l-5 5"/></svg>
        {{else}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/></svg>
        {{end}}
      </span>
      <span class="text-sm font-medium text-zinc-700">{{.Status}}</span>
      <span class="text-xs text-zinc-400">{{len .Issues}}</span>
    </button>
    <!-- Group Items -->
    <div class="group-content">
      {{range .Issues}}
      <div data-issue-key="{{.Key}}" data-status="{{if .Column}}{{.Column.Name}}{{end}}" data-priority="{{.Issue.Priority}}" data-title="{{.Title}}" class="flex items-center gap-3 px-2 py-2.5 hover:bg-zinc-100 cursor-pointer transition-colors issue-row">
        <!-- Priority indicator -->
        <div class="w-4 flex-shrink-0">
          {{if eq .Issue.Priority 1}}
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500" title="Urgent">
            <path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            <line x1="12" y1="9" x2="12" y2="13"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
          </svg>
          {{else if eq .Issue.Priority 2}}
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="text-orange-500" title="High"><rect x="2" y="2" width="3" height="12" fill="currentColor"/><rect x="6.5" y="5" width="3" height="9" fill="currentColor"/><rect x="11" y="8" width="3" height="6" fill="currentColor"/></svg>
          {{else if eq .Issue.Priority 3}}
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="text-yellow-500" title="Medium"><rect x="2" y="5" width="3" height="9" fill="currentColor"/><rect x="6.5" y="8" width="3" height="6" fill="currentColor"/></svg>
          {{else if eq .Issue.Priority 4}}
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="text-blue-500" title="Low"><rect x="2" y="8" width="3" height="6" fill="currentColor"/></svg>
          {{else}}
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-300"><line x1="5" y1="12" x2="19" y2="12"/></svg>
          {{end}}
        </div>
        <!-- Key -->
        <span class="text-xs font-medium text-zinc-400 font-mono w-16 flex-shrink-0">{{.Key}}</span>
        <!-- Title -->
        <span class="flex-1 text-sm text-zinc-900 truncate">{{.Title}}</span>
        <!-- Assignee -->
        <div class="flex items-center -space-x-1 flex-shrink-0 w-8">
          {{if .Assignees}}
          {{range .Assignees}}
          <span class="w-5 h-5 rounded-full bg-zinc-700 text-white text-xs flex items-center justify-center font-medium ring-2 ring-white" title="{{.DisplayName}}">{{slice .DisplayName 0 1}}</span>
          {{end}}
          {{end}}
        </div>
        <!-- Updated -->
        <span class="text-xs text-zinc-400 w-20 text-right flex-shrink-0">{{.UpdatedAt.Format "Jan 2, 2006"}}</span>
      </div>
      {{end}}
    </div>
  </div>
  {{end}}
  {{end}}
</div>

<!-- Fallback flat list for search/filter -->
<div id="issues-flat" class="hidden">
  {{range .Issues}}
  <div data-issue-key="{{.Key}}" data-status="{{if .Column}}{{.Column.Name}}{{end}}" data-priority="{{.Issue.Priority}}" data-title="{{.Title}}" class="flex items-center gap-3 px-2 py-2.5 hover:bg-zinc-100 cursor-pointer transition-colors issue-row">
    <div class="w-4 flex-shrink-0">
      {{if eq .Issue.Priority 1}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      {{else if eq .Issue.Priority 2}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="text-orange-500"><rect x="2" y="2" width="3" height="12" fill="currentColor"/><rect x="6.5" y="5" width="3" height="9" fill="currentColor"/><rect x="11" y="8" width="3" height="6" fill="currentColor"/></svg>
      {{else if eq .Issue.Priority 3}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="text-yellow-500"><rect x="2" y="5" width="3" height="9" fill="currentColor"/><rect x="6.5" y="8" width="3" height="6" fill="currentColor"/></svg>
      {{else if eq .Issue.Priority 4}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="text-blue-500"><rect x="2" y="8" width="3" height="6" fill="currentColor"/></svg>
      {{else}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-300"><line x1="5" y1="12" x2="19" y2="12"/></svg>
      {{end}}
    </div>
    <div class="w-4 flex-shrink-0">
      {{if .Column}}
      <span class="{{if eq (lower .Column.Name) "done"}}text-green-600{{else if eq (lower .Column.Name) "in-progress"}}text-blue-600{{else if eq (lower .Column.Name) "todo"}}text-zinc-600{{else}}text-zinc-400{{end}}">
        {{if eq (lower .Column.Name) "backlog"}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6" stroke-dasharray="2 2"/></svg>
        {{else if eq (lower .Column.Name) "todo"}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><circle cx="8" cy="8" r="1.5" fill="currentColor"/></svg>
        {{else if or (eq (lower .Column.Name) "in-progress") (eq (lower .Column.Name) "doing")}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 2a6 6 0 0 1 6 6" stroke-width="2"/></svg>
        {{else if or (eq (lower .Column.Name) "done") (eq (lower .Column.Name) "completed")}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="7"/><path d="M5.5 8l2 2 3.5-3.5" stroke="white" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
        {{else if or (eq (lower .Column.Name) "canceled") (eq (lower .Column.Name) "cancelled")}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M5.5 5.5l5 5M10.5 5.5l-5 5"/></svg>
        {{else}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/></svg>
        {{end}}
      </span>
      {{end}}
    </div>
    <span class="text-xs font-medium text-zinc-400 font-mono w-16 flex-shrink-0">{{.Key}}</span>
    <span class="flex-1 text-sm text-zinc-900 truncate">{{.Title}}</span>
    <div class="flex items-center -space-x-1 flex-shrink-0 w-8">
      {{if .Assignees}}
      {{range .Assignees}}
      <span class="w-5 h-5 rounded-full bg-zinc-700 text-white text-xs flex items-center justify-center font-medium ring-2 ring-white" title="{{.DisplayName}}">{{slice .DisplayName 0 1}}</span>
      {{end}}
      {{end}}
    </div>
    <span class="text-xs text-zinc-400 w-20 text-right flex-shrink-0">{{.UpdatedAt.Format "Jan 2, 2006"}}</span>
  </div>
  {{end}}
</div>
{{else if .Issues}}
<!-- Fallback if IssuesByStatus not available -->
<div id="issues-container">
  {{range .Issues}}
  <div data-issue-key="{{.Key}}" data-status="{{if .Column}}{{.Column.Name}}{{end}}" data-priority="{{.Issue.Priority}}" data-title="{{.Title}}" class="flex items-center gap-3 px-2 py-2.5 hover:bg-zinc-100 cursor-pointer transition-colors issue-row">
    <div class="w-4 flex-shrink-0">
      {{if eq .Issue.Priority 1}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      {{else if eq .Issue.Priority 2}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="text-orange-500"><rect x="2" y="2" width="3" height="12" fill="currentColor"/><rect x="6.5" y="5" width="3" height="9" fill="currentColor"/><rect x="11" y="8" width="3" height="6" fill="currentColor"/></svg>
      {{else if eq .Issue.Priority 3}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="text-yellow-500"><rect x="2" y="5" width="3" height="9" fill="currentColor"/><rect x="6.5" y="8" width="3" height="6" fill="currentColor"/></svg>
      {{else if eq .Issue.Priority 4}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16" class="text-blue-500"><rect x="2" y="8" width="3" height="6" fill="currentColor"/></svg>
      {{else}}
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-300"><line x1="5" y1="12" x2="19" y2="12"/></svg>
      {{end}}
    </div>
    <div class="w-4 flex-shrink-0">
      {{if .Column}}
      <span class="{{if eq (lower .Column.Name) "done"}}text-green-600{{else if eq (lower .Column.Name) "in-progress"}}text-blue-600{{else if eq (lower .Column.Name) "todo"}}text-zinc-600{{else}}text-zinc-400{{end}}">
        {{if eq (lower .Column.Name) "backlog"}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6" stroke-dasharray="2 2"/></svg>
        {{else if eq (lower .Column.Name) "todo"}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><circle cx="8" cy="8" r="1.5" fill="currentColor"/></svg>
        {{else if or (eq (lower .Column.Name) "in-progress") (eq (lower .Column.Name) "doing")}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 2a6 6 0 0 1 6 6" stroke-width="2"/></svg>
        {{else if or (eq (lower .Column.Name) "done") (eq (lower .Column.Name) "completed")}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="7"/><path d="M5.5 8l2 2 3.5-3.5" stroke="white" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
        {{else if or (eq (lower .Column.Name) "canceled") (eq (lower .Column.Name) "cancelled")}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M5.5 5.5l5 5M10.5 5.5l-5 5"/></svg>
        {{else}}
        <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/></svg>
        {{end}}
      </span>
      {{end}}
    </div>
    <span class="text-xs font-medium text-zinc-400 font-mono w-16 flex-shrink-0">{{.Key}}</span>
    <span class="flex-1 text-sm text-zinc-900 truncate">{{.Title}}</span>
    <div class="flex items-center -space-x-1 flex-shrink-0 w-8">
      {{if .Assignees}}
      {{range .Assignees}}
      <span class="w-5 h-5 rounded-full bg-zinc-700 text-white text-xs flex items-center justify-center font-medium ring-2 ring-white" title="{{.DisplayName}}">{{slice .DisplayName 0 1}}</span>
      {{end}}
      {{end}}
    </div>
    <span class="text-xs text-zinc-400 w-20 text-right flex-shrink-0">{{.UpdatedAt.Format "Jan 2, 2006"}}</span>
  </div>
  {{end}}
</div>
{{else}}
<div class="flex flex-col items-center justify-center py-16 px-8 text-center">
  <svg class="w-12 h-12 mb-5 text-zinc-300" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/>
    <line x1="12" x2="12" y1="8" y2="12"/>
    <line x1="12" x2="12.01" y1="16" y2="16"/>
  </svg>
  <div class="text-base font-semibold mb-2 text-zinc-900">No issues yet</div>
  <div class="text-sm text-zinc-500 max-w-xs mb-5">Create your first issue to start tracking work</div>
  <button class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-zinc-900 hover:bg-zinc-800 transition-colors" data-modal="create-issue-modal">
    Create Issue
  </button>
</div>
{{end}}

<!-- Create Issue Modal -->
<div id="create-issue-modal" class="fixed inset-0 z-50 hidden">
  <div class="fixed inset-0 bg-black/50" data-close="create-issue-modal"></div>
  <div class="fixed inset-0 flex items-center justify-center p-4">
    <div class="relative w-full max-w-lg bg-white rounded-xl shadow-xl">
      <div class="flex items-center justify-between px-6 py-4 border-b border-zinc-200">
        <div class="flex items-center gap-2">
          <span class="font-medium text-zinc-900">New issue</span>
        </div>
        <button class="text-zinc-400 hover:text-zinc-600 transition-colors" data-close="create-issue-modal">&times;</button>
      </div>
      <form id="create-issue-form">
        <div class="px-6 py-4">
          <input type="text" id="issue-title" name="title" class="w-full py-2 text-lg font-medium border-none bg-transparent outline-none text-zinc-900 placeholder-zinc-400" placeholder="Issue title" required autofocus>
          <textarea id="issue-description" name="description" class="w-full py-2 text-sm border-none bg-transparent outline-none resize-none text-zinc-900 placeholder-zinc-400" placeholder="Add description..." rows="3"></textarea>

          <div class="flex flex-wrap gap-2 pt-2">
            <button type="button" class="inline-flex items-center gap-1.5 px-2.5 py-1.5 text-sm rounded-md border border-zinc-200 bg-white hover:bg-zinc-50 transition-colors cursor-pointer" data-property="status" id="issues-status-chip">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-500">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="1"/>
              </svg>
              <span>Backlog</span>
            </button>
            <button type="button" class="inline-flex items-center gap-1.5 px-2.5 py-1.5 text-sm rounded-md border border-zinc-200 bg-white hover:bg-zinc-50 transition-colors cursor-pointer" data-property="priority" id="issues-priority-chip">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-500">
                <path d="M2 20h.01"/>
                <path d="M7 20v-4"/>
                <path d="M12 20v-8"/>
                <path d="M17 20V8"/>
              </svg>
              <span>Priority</span>
            </button>
            {{if .Projects}}
            <button type="button" class="inline-flex items-center gap-1.5 px-2.5 py-1.5 text-sm rounded-md border border-zinc-200 bg-white hover:bg-zinc-50 transition-colors cursor-pointer" data-property="project" id="issues-project-chip">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-500">
                <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/>
              </svg>
              <span>Project</span>
            </button>
            {{end}}
          </div>

          <!-- Hidden fields -->
          <input type="hidden" name="project_id" id="issues-project-id" value="{{.DefaultProjectID}}">
          <input type="hidden" name="column_id" id="issues-column-id" value="">
          <input type="hidden" name="priority" id="issues-priority" value="0">
        </div>
        <div class="flex items-center justify-between px-6 py-4 bg-zinc-50 rounded-b-xl border-t border-zinc-100">
          <label class="flex items-center gap-2 text-sm text-zinc-600 cursor-pointer">
            <input type="checkbox" id="issues-create-more" class="w-4 h-4 text-indigo-600 border-zinc-300 rounded focus:ring-indigo-500">
            Create more
          </label>
          <div class="flex gap-2">
            <button type="button" class="px-4 py-2 text-sm font-medium text-zinc-700 bg-white border border-zinc-200 rounded-md hover:bg-zinc-50 transition-colors" data-close="create-issue-modal">Cancel</button>
            <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors" id="create-issue-submit">Create issue</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Issues Status Dropdown -->
{{if .Columns}}
<div id="issues-status-selector" class="fixed bg-white rounded-lg shadow-lg border border-zinc-200 py-1 z-[60] hidden" style="min-width: 200px;">
  {{range .Columns}}
  <button type="button" class="flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-zinc-700 hover:bg-zinc-50 transition-colors issues-status-option" data-column-id="{{.ID}}" data-column-name="{{.Name}}">
    <span class="inline-flex items-center gap-1.5 {{if eq (lower .Name) "done"}}text-green-600{{else if eq (lower .Name) "in-progress"}}text-blue-600{{else if eq (lower .Name) "todo"}}text-zinc-600{{else}}text-zinc-500{{end}}">
      {{if eq (lower .Name) "backlog"}}
      <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6" stroke-dasharray="2 2"/></svg>
      {{else if eq (lower .Name) "todo"}}
      <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><circle cx="8" cy="8" r="1.5" fill="currentColor"/></svg>
      {{else if or (eq (lower .Name) "in-progress") (eq (lower .Name) "doing")}}
      <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 2a6 6 0 0 1 6 6" stroke-width="2"/></svg>
      {{else if or (eq (lower .Name) "done") (eq (lower .Name) "completed")}}
      <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="7"/><path d="M5.5 8l2 2 3.5-3.5" stroke="white" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
      {{else if or (eq (lower .Name) "canceled") (eq (lower .Name) "cancelled")}}
      <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M5.5 5.5l5 5M10.5 5.5l-5 5"/></svg>
      {{else}}
      <svg class="w-4 h-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/></svg>
      {{end}}
      {{.Name}}
    </span>
  </button>
  {{end}}
</div>
{{end}}

<!-- Issues Priority Dropdown -->
<div id="issues-priority-selector" class="fixed bg-white rounded-lg shadow-lg border border-zinc-200 py-1 z-[60] hidden" style="min-width: 200px;">
  <button type="button" class="flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-zinc-700 hover:bg-zinc-50 transition-colors issues-priority-option" data-priority="0" data-priority-name="No priority">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-400">
      <line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
    <span>No priority</span>
  </button>
  <button type="button" class="flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-zinc-700 hover:bg-zinc-50 transition-colors issues-priority-option" data-priority="1" data-priority-name="Urgent">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500">
      <path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
      <line x1="12" y1="9" x2="12" y2="13"/>
      <line x1="12" y1="17" x2="12.01" y2="17"/>
    </svg>
    <span>Urgent</span>
  </button>
  <button type="button" class="flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-zinc-700 hover:bg-zinc-50 transition-colors issues-priority-option" data-priority="2" data-priority-name="High">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500">
      <rect x="3" y="3" width="6" height="18" rx="1"/>
      <rect x="9" y="8" width="6" height="13" rx="1"/>
      <rect x="15" y="13" width="6" height="8" rx="1"/>
    </svg>
    <span>High</span>
  </button>
  <button type="button" class="flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-zinc-700 hover:bg-zinc-50 transition-colors issues-priority-option" data-priority="3" data-priority-name="Medium">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500">
      <rect x="3" y="8" width="6" height="13" rx="1"/>
      <rect x="9" y="13" width="6" height="8" rx="1"/>
    </svg>
    <span>Medium</span>
  </button>
  <button type="button" class="flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-zinc-700 hover:bg-zinc-50 transition-colors issues-priority-option" data-priority="4" data-priority-name="Low">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500">
      <rect x="3" y="13" width="6" height="8" rx="1"/>
    </svg>
    <span>Low</span>
  </button>
</div>

<!-- Issues Project Dropdown -->
{{if .Projects}}
<div id="issues-project-selector" class="fixed bg-white rounded-lg shadow-lg border border-zinc-200 py-1 z-[60] hidden" style="min-width: 200px;">
  {{range .Projects}}
  <button type="button" class="flex items-center gap-2 w-full px-3 py-2 text-sm text-left text-zinc-700 hover:bg-zinc-50 transition-colors issues-project-option" data-project-id="{{.ID}}" data-project-name="{{.Name}}" data-project-key="{{.Key}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-500">
      <rect width="6" height="14" x="4" y="5" rx="2"/>
      <rect width="6" height="10" x="14" y="7" rx="2"/>
    </svg>
    {{.Name}}
    <span class="text-zinc-400 text-xs ml-auto">{{.Key}}</span>
  </button>
  {{end}}
</div>
{{end}}

<script>
const currentUserId = '{{.User.ID}}';
const workspaceSlug = '{{.Workspace.Slug}}';

// Row click navigation
document.querySelectorAll('.issue-row[data-issue-key]').forEach(row => {
  row.addEventListener('click', () => {
    const key = row.dataset.issueKey;
    location.href = `/w/${workspaceSlug}/issue/${key}`;
  });
});

// Group toggle functionality
document.querySelectorAll('.group-toggle').forEach(btn => {
  btn.addEventListener('click', () => {
    const group = btn.closest('.issue-group');
    const content = group.querySelector('.group-content');
    const chevron = btn.querySelector('.group-chevron');
    const isExpanded = btn.dataset.expanded === 'true';

    if (isExpanded) {
      content.style.display = 'none';
      chevron.style.transform = 'rotate(0deg)';
      btn.dataset.expanded = 'false';
    } else {
      content.style.display = 'block';
      chevron.style.transform = 'rotate(90deg)';
      btn.dataset.expanded = 'true';
    }
  });
});

// Issues modal form state
const issuesModalForm = {
  selectedProjectId: '{{.DefaultProjectID}}',
  selectedColumnId: '',
  selectedPriority: 0,

  init() {
    this.setupChips();
    this.setupDropdowns();
    this.setupForm();
  },

  setupChips() {
    document.getElementById('issues-status-chip')?.addEventListener('click', (e) => {
      e.preventDefault();
      this.showDropdown('issues-status-selector', e.currentTarget);
    });
    document.getElementById('issues-priority-chip')?.addEventListener('click', (e) => {
      e.preventDefault();
      this.showDropdown('issues-priority-selector', e.currentTarget);
    });
    document.getElementById('issues-project-chip')?.addEventListener('click', (e) => {
      e.preventDefault();
      this.showDropdown('issues-project-selector', e.currentTarget);
    });
  },

  setupDropdowns() {
    // Project options
    document.querySelectorAll('.issues-project-option').forEach(opt => {
      opt.addEventListener('click', () => {
        this.selectedProjectId = opt.dataset.projectId;
        document.getElementById('issues-project-id').value = this.selectedProjectId;
        document.querySelector('#issues-project-chip span').textContent = opt.dataset.projectKey;
        this.hideAllDropdowns();
      });
    });

    // Status options
    document.querySelectorAll('.issues-status-option').forEach(opt => {
      opt.addEventListener('click', () => {
        this.selectedColumnId = opt.dataset.columnId;
        document.getElementById('issues-column-id').value = this.selectedColumnId;
        document.querySelector('#issues-status-chip span').textContent = opt.dataset.columnName;
        this.hideAllDropdowns();
      });
    });

    // Priority options
    document.querySelectorAll('.issues-priority-option').forEach(opt => {
      opt.addEventListener('click', () => {
        this.selectedPriority = parseInt(opt.dataset.priority);
        document.getElementById('issues-priority').value = this.selectedPriority;
        const chipSpan = document.querySelector('#issues-priority-chip span');
        if (chipSpan) {
          chipSpan.textContent = this.selectedPriority === 0 ? 'Priority' : opt.dataset.priorityName;
        }
        this.hideAllDropdowns();
      });
    });

    // Close dropdowns on outside click
    document.addEventListener('click', (e) => {
      if (!e.target.closest('[data-property]') && !e.target.closest('[id$="-selector"]')) {
        this.hideAllDropdowns();
      }
    });
  },

  setupForm() {
    const form = document.getElementById('create-issue-form');
    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const submitBtn = document.getElementById('create-issue-submit');
      const title = form.title.value.trim();

      if (!this.selectedProjectId) {
        alert('Please select a project');
        return;
      }

      if (!title) {
        alert('Please enter a title');
        form.title.focus();
        return;
      }

      const data = {
        title,
        description: form.description?.value?.trim() || '',
      };

      if (this.selectedColumnId) {
        data.column_id = this.selectedColumnId;
      }
      if (this.selectedPriority > 0) {
        data.priority = this.selectedPriority;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = 'Creating...';

      try {
        const issue = await app.api.post(`/projects/${this.selectedProjectId}/issues`, data);

        const createMore = document.getElementById('issues-create-more')?.checked;
        if (createMore) {
          form.reset();
          this.selectedColumnId = '';
          this.selectedPriority = 0;
          document.querySelector('#issues-status-chip span').textContent = 'Backlog';
          document.querySelector('#issues-priority-chip span').textContent = 'Priority';
          location.reload();
        } else {
          location.href = `/w/{{.Workspace.Slug}}/issue/${issue.key}`;
        }
      } catch (error) {
        alert(error.message || 'Failed to create issue');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create issue';
      }
    });
  },

  showDropdown(id, anchor) {
    this.hideAllDropdowns();
    const dropdown = document.getElementById(id);
    if (!dropdown) return;

    const rect = anchor.getBoundingClientRect();
    dropdown.style.top = `${rect.bottom + 4}px`;
    dropdown.style.left = `${rect.left}px`;
    dropdown.classList.remove('hidden');
  },

  hideAllDropdowns() {
    document.querySelectorAll('[id$="-selector"]').forEach(d => d.classList.add('hidden'));
  }
};

issuesModalForm.init();

// Filter & Search Functionality
const issueFilter = {
  searchQuery: '',
  myIssuesOnly: false,
  unassignedOnly: false,
  statusFilters: new Set(),
  sortColumn: null,
  sortDirection: 'asc',

  init() {
    document.querySelectorAll('[data-filter-type="status"]').forEach(cb => {
      if (cb.checked) this.statusFilters.add(cb.value);
    });

    const searchInput = document.getElementById('issue-search');
    searchInput?.addEventListener('input', (e) => {
      this.searchQuery = e.target.value.toLowerCase();
      this.applyFilters();
    });

    document.querySelectorAll('[data-filter-type="status"]').forEach(cb => {
      cb.addEventListener('change', (e) => {
        if (e.target.checked) {
          this.statusFilters.add(e.target.value);
        } else {
          this.statusFilters.delete(e.target.value);
        }
        this.applyFilters();
      });
    });

    document.querySelector('[data-filter="my-issues"]')?.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      this.myIssuesOnly = !this.myIssuesOnly;
      this.unassignedOnly = false;
      e.target.closest('button').classList.toggle('bg-indigo-50', this.myIssuesOnly);
      e.target.closest('button').classList.toggle('text-indigo-600', this.myIssuesOnly);
      document.querySelector('[data-filter="unassigned"]')?.classList.remove('bg-indigo-50', 'text-indigo-600');
      this.applyFilters();
    });

    document.querySelector('[data-filter="unassigned"]')?.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      this.unassignedOnly = !this.unassignedOnly;
      this.myIssuesOnly = false;
      e.target.closest('button').classList.toggle('bg-indigo-50', this.unassignedOnly);
      e.target.closest('button').classList.toggle('text-indigo-600', this.unassignedOnly);
      document.querySelector('[data-filter="my-issues"]')?.classList.remove('bg-indigo-50', 'text-indigo-600');
      this.applyFilters();
    });

    document.getElementById('clear-filters')?.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      this.clearAllFilters();
    });

    document.querySelectorAll('th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        const column = th.dataset.sort;
        if (this.sortColumn === column) {
          this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
        } else {
          this.sortColumn = column;
          this.sortDirection = 'asc';
        }
        this.sortTable();
      });
    });
  },

  clearAllFilters() {
    this.searchQuery = '';
    this.myIssuesOnly = false;
    this.unassignedOnly = false;

    const searchInput = document.getElementById('issue-search');
    if (searchInput) searchInput.value = '';

    document.querySelectorAll('[data-filter-type="status"]').forEach(cb => {
      cb.checked = true;
      this.statusFilters.add(cb.value);
    });

    document.querySelectorAll('[data-filter]').forEach(btn => {
      btn.classList.remove('bg-indigo-50', 'text-indigo-600');
    });

    this.applyFilters();
  },

  applyFilters() {
    const rows = document.querySelectorAll('#issues-table tbody tr');
    let visibleCount = 0;

    rows.forEach(row => {
      let visible = true;

      if (this.searchQuery) {
        const title = (row.dataset.title || '').toLowerCase();
        const key = (row.dataset.issueKey || '').toLowerCase();
        if (!title.includes(this.searchQuery) && !key.includes(this.searchQuery)) {
          visible = false;
        }
      }

      if (visible && this.statusFilters.size > 0) {
        const status = row.dataset.status || '';
        if (!this.statusFilters.has(status)) {
          visible = false;
        }
      }

      if (visible && this.myIssuesOnly) {
        const assignee = row.dataset.assignee || '';
        if (assignee !== currentUserId) {
          visible = false;
        }
      }

      if (visible && this.unassignedOnly) {
        const assignee = row.dataset.assignee || '';
        if (assignee !== '') {
          visible = false;
        }
      }

      row.style.display = visible ? '' : 'none';
      if (visible) visibleCount++;
    });

    document.getElementById('visible-count').textContent = visibleCount;
    this.updateFilterBadge();
  },

  updateFilterBadge() {
    const filterCount = document.getElementById('filter-count');
    let activeFilters = 0;

    if (this.searchQuery) activeFilters++;
    if (this.myIssuesOnly) activeFilters++;
    if (this.unassignedOnly) activeFilters++;

    const totalStatus = document.querySelectorAll('[data-filter-type="status"]').length;
    if (this.statusFilters.size < totalStatus) activeFilters++;

    if (activeFilters > 0) {
      filterCount.textContent = activeFilters;
      filterCount.classList.remove('hidden');
      filterCount.classList.add('flex');
    } else {
      filterCount.classList.add('hidden');
      filterCount.classList.remove('flex');
    }
  },

  sortTable() {
    const tbody = document.querySelector('#issues-table tbody');
    if (!tbody) return;

    const rows = Array.from(tbody.querySelectorAll('tr'));

    rows.sort((a, b) => {
      let aVal, bVal;

      switch (this.sortColumn) {
        case 'key':
          aVal = a.dataset.issueKey || '';
          bVal = b.dataset.issueKey || '';
          break;
        case 'title':
          aVal = a.dataset.title || '';
          bVal = b.dataset.title || '';
          break;
        case 'status':
          aVal = a.dataset.status || '';
          bVal = b.dataset.status || '';
          break;
        case 'assignee':
          aVal = a.dataset.assigneeName || '';
          bVal = b.dataset.assigneeName || '';
          break;
        case 'updated':
          aVal = a.dataset.updated || '';
          bVal = b.dataset.updated || '';
          break;
        default:
          return 0;
      }

      let comparison = aVal.localeCompare(bVal);
      return this.sortDirection === 'desc' ? -comparison : comparison;
    });

    rows.forEach(row => tbody.appendChild(row));
  }
};

issueFilter.init();
</script>
{{end}}
