{{define "pages/sprints.html"}}
{{template "layouts/default.html" .}}
{{define "title"}}{{.Project.Name}} - Sprints{{end}}
{{define "content"}}
<div class="page-header">
    <h1>Sprints</h1>
    <div class="page-actions">
        <button class="btn btn-primary btn-sm" onclick="createSprint()">New Sprint</button>
    </div>
</div>

<div class="sprints-view">
    {{if .Sprints}}
    <div class="sprint-list">
        {{range .Sprints}}
        <div class="sprint-card">
            <div class="sprint-header">
                <h3 class="sprint-name">{{.Name}}</h3>
                <span class="sprint-status status-{{.Status}}">{{.Status}}</span>
            </div>
            {{if .Goal}}
            <p class="sprint-goal">{{.Goal}}</p>
            {{end}}
            <div class="sprint-dates">
                {{if .StartDate}}
                <span>Start: {{formatDate .StartDate}}</span>
                {{end}}
                {{if .EndDate}}
                <span>End: {{formatDate .EndDate}}</span>
                {{end}}
            </div>
            <div class="sprint-actions">
                {{if eq .Status "planning"}}
                <button class="btn btn-sm btn-primary" onclick="startSprint('{{.ID}}')">Start Sprint</button>
                {{else if eq .Status "active"}}
                <button class="btn btn-sm btn-secondary" onclick="completeSprint('{{.ID}}')">Complete</button>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
    {{else}}
    <div class="empty-state">
        <h3 class="empty-state-title">No sprints yet</h3>
        <p class="empty-state-description">Create your first sprint to start planning work.</p>
        <button class="btn btn-primary" onclick="createSprint()">Create Sprint</button>
    </div>
    {{end}}
</div>

<script>
function createSprint() {
    const name = prompt('Sprint name:');
    if (!name) return;

    fetch('/api/v1/projects/{{.Project.ID}}/sprints', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
    }).then(res => {
        if (res.ok) window.location.reload();
    });
}

function startSprint(id) {
    fetch('/api/v1/sprints/' + id + '/start', { method: 'POST' })
        .then(res => { if (res.ok) window.location.reload(); });
}

function completeSprint(id) {
    fetch('/api/v1/sprints/' + id + '/complete', { method: 'POST' })
        .then(res => { if (res.ok) window.location.reload(); });
}
</script>
{{end}}
{{end}}
