{{define "pages/notifications.html"}}
{{template "layouts/default.html" .}}
{{define "title"}}Notifications{{end}}
{{define "content"}}
<div class="page-header">
    <h1>Notifications</h1>
    <div class="page-actions">
        <button class="btn btn-ghost btn-sm" onclick="markAllRead()">Mark all as read</button>
    </div>
</div>

<div class="notifications-view">
    {{if .Notifications}}
    <div class="notification-list">
        {{range .Notifications}}
        <div class="notification-item {{if not .ReadAt}}unread{{end}}" onclick="markRead('{{.ID}}')">
            <div class="notification-icon type-{{.Type}}">
                {{if eq .Type "mention"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"></circle><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"></path></svg>
                {{else if eq .Type "assignment"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                {{else if eq .Type "comment"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                {{else}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                {{end}}
            </div>
            <div class="notification-content">
                <p class="notification-text">{{.Content}}</p>
                <span class="notification-time">{{formatTime .CreatedAt}}</span>
            </div>
        </div>
        {{end}}
    </div>
    {{else}}
    <div class="empty-state">
        <h3 class="empty-state-title">No notifications</h3>
        <p class="empty-state-description">You're all caught up!</p>
    </div>
    {{end}}
</div>

<script>
function markRead(id) {
    fetch('/api/v1/notifications/' + id + '/read', { method: 'POST' });
}

function markAllRead() {
    fetch('/api/v1/notifications/read-all', { method: 'POST' })
        .then(() => window.location.reload());
}
</script>
{{end}}
{{end}}
