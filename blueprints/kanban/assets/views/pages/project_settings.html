{{define "pages/project_settings.html"}}
{{template "layouts/default.html" .}}
{{define "title"}}{{.Project.Name}} - Settings{{end}}
{{define "content"}}
<div class="page-header">
    <h1>Project Settings</h1>
</div>

<div class="settings-view">
    <div class="settings-section">
        <h2>General</h2>
        <form class="settings-form" id="project-form">
            <div class="form-group">
                <label class="form-label">Project Name</label>
                <input type="text" class="form-input" name="name" value="{{.Project.Name}}">
            </div>
            <div class="form-group">
                <label class="form-label">Project Key</label>
                <input type="text" class="form-input" name="key" value="{{.Project.Key}}" disabled>
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" name="description">{{.Project.Description}}</textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Color</label>
                <input type="color" class="form-input" name="color" value="{{.Project.Color}}">
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
    </div>

    <div class="settings-section">
        <h2>Labels</h2>
        <div class="label-list">
            {{range .Labels}}
            <div class="label-item">
                <span class="label" style="background: {{.Color}}">{{.Name}}</span>
                <button class="btn btn-ghost btn-sm" onclick="deleteLabel('{{.ID}}')">Delete</button>
            </div>
            {{end}}
        </div>
        <button class="btn btn-secondary btn-sm" onclick="createLabel()">Add Label</button>
    </div>

    <div class="settings-section danger-zone">
        <h2>Danger Zone</h2>
        <button class="btn btn-danger" onclick="deleteProject()">Delete Project</button>
    </div>
</div>

<script>
document.getElementById('project-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    await fetch('/api/v1/workspaces/{{.Workspace.Slug}}/projects/{{.Project.Key}}', {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            name: form.name.value,
            description: form.description.value,
            color: form.color.value
        })
    });
});

function createLabel() {
    const name = prompt('Label name:');
    if (!name) return;
    const color = prompt('Label color (hex):', '#3b82f6');
    if (!color) return;

    fetch('/api/v1/projects/{{.Project.ID}}/labels', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, color })
    }).then(() => window.location.reload());
}

function deleteLabel(id) {
    if (!confirm('Delete this label?')) return;
    fetch('/api/v1/labels/' + id, { method: 'DELETE' })
        .then(() => window.location.reload());
}

function deleteProject() {
    if (!confirm('Are you sure? This cannot be undone.')) return;
    fetch('/api/v1/workspaces/{{.Workspace.Slug}}/projects/{{.Project.Key}}', { method: 'DELETE' })
        .then(() => window.location.href = '/{{.Workspace.Slug}}');
}
</script>
{{end}}
{{end}}
