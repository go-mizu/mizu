{{define "pages/backlog.html"}}
{{template "layouts/default.html" .}}
{{define "title"}}{{.Project.Name}} - Backlog{{end}}
{{define "content"}}
<div class="page-header">
    <h1>Backlog</h1>
    <div class="page-actions">
        <button class="btn btn-primary btn-sm" onclick="createIssue()">New Issue</button>
    </div>
</div>

<div class="backlog-view">
    {{if .Issues}}
    <div class="issue-list">
        {{range .Issues}}
        <div class="issue-list-item" onclick="window.location.href='/{{$.Workspace.Slug}}/issue/{{.Key}}'">
            <div class="issue-list-left">
                <span class="issue-key">{{.Key}}</span>
                <span class="issue-title">{{.Title}}</span>
            </div>
            <div class="issue-list-right">
                <span class="priority-indicator priority-{{.Priority}}"></span>
                <span class="type-badge type-{{.Type}}">{{typeLabel .Type}}</span>
            </div>
        </div>
        {{end}}
    </div>
    {{else}}
    <div class="empty-state">
        <h3 class="empty-state-title">Backlog is empty</h3>
        <p class="empty-state-description">Create issues to add them to the backlog.</p>
        <button class="btn btn-primary" onclick="createIssue()">Create Issue</button>
    </div>
    {{end}}
</div>

<script>
function createIssue() {
    const title = prompt('Issue title:');
    if (!title) return;

    fetch('/api/v1/projects/{{.Project.ID}}/issues', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, status: 'backlog' })
    }).then(res => {
        if (res.ok) window.location.reload();
    });
}
</script>
{{end}}
{{end}}
