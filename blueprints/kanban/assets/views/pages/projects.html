{{define "pages/projects.html"}}
{{template "layouts/default.html" .}}
{{define "title"}}Projects - {{.Workspace.Name}}{{end}}
{{define "content"}}
<div class="page-header">
    <h1>Projects</h1>
    <div class="page-actions">
        <button class="btn btn-primary" onclick="createProject()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            New Project
        </button>
    </div>
</div>

<div class="page-content">
    {{if .Projects}}
    <div class="project-list">
        {{range .Projects}}
        <a href="/{{$.Workspace.Slug}}/projects/{{.Key}}" class="project-list-item">
            <div class="project-list-color" style="background: {{.Color}}"></div>
            <div class="project-list-info">
                <div class="project-list-header">
                    <span class="project-key">{{.Key}}</span>
                    <h3 class="project-name">{{.Name}}</h3>
                </div>
                <p class="project-description">{{.Description | default "No description"}}</p>
            </div>
            <div class="project-list-meta">
                <span class="project-status status-{{.Status}}">{{.Status}}</span>
            </div>
        </a>
        {{end}}
    </div>
    {{else}}
    <div class="empty-state">
        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
        <h3 class="empty-state-title">No projects yet</h3>
        <p class="empty-state-description">Create your first project to start tracking issues.</p>
        <button class="btn btn-primary" onclick="createProject()">Create Project</button>
    </div>
    {{end}}
</div>

<script>
function createProject() {
    const name = prompt('Project name:');
    if (!name) return;

    const key = prompt('Project key (e.g., PROJ):', name.substring(0, 4).toUpperCase());
    if (!key) return;

    fetch('/api/v1/workspaces/{{.Workspace.Slug}}/projects', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, key })
    }).then(res => {
        if (res.ok) {
            res.json().then(project => {
                window.location.href = '/{{.Workspace.Slug}}/projects/' + project.key;
            });
        }
    });
}
</script>
{{end}}
{{end}}
