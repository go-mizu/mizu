{{define "settings.html"}}
{{template "base.html" .}}
{{end}}

{{define "content"}}
<div style="display: flex; height: 100vh;">
  <aside style="width: 200px; background: var(--bg-secondary); padding: 2rem 1rem;">
    <h3 style="font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 1rem;">User Settings</h3>
    <nav style="display: flex; flex-direction: column; gap: 0.25rem;">
      <a href="/settings/account" style="padding: 0.5rem; border-radius: 4px; color: var(--text-primary); background: var(--bg-accent);">My Account</a>
      <a href="/settings/profile" style="padding: 0.5rem; border-radius: 4px; color: var(--text-secondary);">Profile</a>
      <a href="/settings/appearance" style="padding: 0.5rem; border-radius: 4px; color: var(--text-secondary);">Appearance</a>
    </nav>

    <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--bg-accent);">
      <button onclick="logout()" class="btn btn-secondary" style="width: 100%;">Log Out</button>
    </div>
  </aside>

  <main style="flex: 1; padding: 2rem 3rem; overflow-y: auto;">
    <h1 style="font-size: 1.25rem; margin-bottom: 2rem;">My Account</h1>

    <div style="background: var(--bg-primary); border-radius: 8px; padding: 1.5rem; max-width: 600px;">
      <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
        <div class="user-avatar" style="width: 80px; height: 80px; font-size: 2rem;">
          {{if .User.AvatarURL}}
            <img src="{{.User.AvatarURL}}" alt="{{.User.Username}}">
          {{else}}
            {{slice .User.Username 0 1}}
          {{end}}
        </div>
        <div>
          <h2 style="font-size: 1.25rem;">{{.User.DisplayName}}</h2>
          <p style="color: var(--text-muted);">{{.User.Username}}#{{.User.Discriminator}}</p>
        </div>
      </div>

      <form id="profile-form">
        <div class="form-group">
          <label class="form-label">Display Name</label>
          <input class="form-input" type="text" name="display_name" value="{{.User.DisplayName}}">
        </div>

        <div class="form-group">
          <label class="form-label">Bio</label>
          <textarea class="form-input" name="bio" rows="3" style="resize: vertical;">{{.User.Bio}}</textarea>
        </div>

        <button type="submit" class="btn btn-primary">Save Changes</button>
      </form>
    </div>
  </main>
</div>

<script>
document.getElementById('profile-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const data = {
    display_name: form.display_name.value,
    bio: form.bio.value
  };

  try {
    const res = await fetch('/api/v1/auth/me', {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    if (res.ok) {
      alert('Settings saved!');
    } else {
      alert('Failed to save settings');
    }
  } catch (err) {
    alert('Failed to save settings');
  }
});

async function logout() {
  await fetch('/api/v1/auth/logout', { method: 'POST' });
  window.location.href = '/';
}
</script>
{{end}}
