import{j as e}from"./markdown-DRpjVqyA.js";import{r as n,u as H,a as J,L as M}from"./react-vendor-DqWpB-k-.js";import{a as O,b as X,S as Y}from"./index-CAplHHN5.js";import{A as Z,a as ee}from"./AIResponse-BCJIzhT6.js";import{V as se,M as te}from"./VoiceInput-UQPjxTqg.js";import{i as B,S as _,G as ne,p as ae,q as ie,A as oe,h as re,I as ce,V as le,N as ue,R as de,r as me}from"./ui-DxqIiTN1.js";function pe({onSubmit:q,disabled:i,placeholder:t="Ask a follow-up"}){const[d,p]=n.useState(""),[g,c]=n.useState("search"),[o,j]=n.useState(""),h=n.useRef(null),x=a=>{a?.preventDefault(),!(!d.trim()||i)&&(q(d.trim()),p(""))},y=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),x())},T=n.useCallback(a=>{p(l=>l+(l?" ":"")+a),j("")},[]),C=n.useCallback(a=>{j(a)},[]),N=d+(o?` ${o}`:"");return e.jsx("div",{className:"followup-input-container",children:e.jsxs("form",{onSubmit:x,className:"followup-input-box",children:[e.jsxs("div",{className:"followup-modes",children:[e.jsx("button",{type:"button",className:g==="search"?"active":"",onClick:()=>c("search"),title:"Search mode",children:e.jsx(B,{size:16})}),e.jsx("button",{type:"button",className:g==="ai"?"active":"",onClick:()=>c("ai"),title:"AI mode",children:e.jsx(_,{size:16})}),e.jsx("button",{type:"button",className:g==="collection"?"active":"",onClick:()=>c("collection"),title:"Collection mode",children:e.jsx(ne,{size:16})})]}),e.jsx("input",{ref:h,type:"text",value:N,onChange:a=>p(a.target.value),onKeyDown:y,placeholder:t,disabled:i,className:"followup-input"}),e.jsxs("div",{className:"followup-actions",children:[e.jsx("button",{type:"button",className:"action-btn",title:"Focus",disabled:i,children:e.jsx(ae,{size:18})}),e.jsx("button",{type:"button",className:"action-btn",title:"Attach file",disabled:i,children:e.jsx(ie,{size:18})}),e.jsx(se,{onTranscript:T,onInterimTranscript:C,disabled:i,size:"sm"}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:!d.trim()||i,title:"Send",children:e.jsx(oe,{size:18})})]})]})})}function ye(){const[q]=H(),i=J(),t=q.get("q")||"",{mode:d,selectedModelId:p,setSelectedModelId:g,isLoading:c,isStreaming:o,streamingContent:j,streamingThinking:h,setLoading:x,setStreaming:y,appendStreamContent:T,addThinkingStep:C,resetStream:N,error:a,setError:l}=O(),[m,S]=n.useState(null),[G,w]=n.useState([]),[P,I]=n.useState([]),[D,A]=n.useState([]),R=n.useRef(null),f=n.useRef(null),V=n.useRef(0),k=n.useCallback(()=>{f.current&&(f.current.abort(),f.current=null)},[]);n.useEffect(()=>()=>{k()},[k]),n.useEffect(()=>{if(!t||t===R.current)return;R.current=t;const u=setTimeout(()=>{U(t)},50);return()=>clearTimeout(u)},[t]);const U=async u=>{if(!u.trim())return;k(),V.current+=1;const K=V.current,F=new AbortController;f.current=F,N(),x(!0),l(null),S(null),w([]),I([]),A([]);const r=()=>V.current!==K;try{y(!0);const b=X.queryStreamFetch({text:u,mode:d,model_id:p||void 0},F.signal);for await(const s of b){if(r())break;switch(s.type){case"start":break;case"search":s.query&&!r()&&C(`Searching for: ${s.query}`);break;case"token":s.content&&!r()&&T(s.content);break;case"thinking":s.thinking&&!r()&&C(s.thinking);break;case"citation":s.citation&&!r()&&w(W=>[...W,s.citation]);break;case"done":s.response&&!r()&&(S({text:s.response.text,mode:s.response.mode,citations:s.response.citations||[],follow_ups:s.response.follow_ups||[],related_questions:s.response.related_questions||[],images:s.response.images||[],session_id:s.response.session_id,sources_used:s.response.sources_used,thinking_steps:h,usage:s.response.usage,provider:s.response.provider,model:s.response.model,from_cache:s.response.from_cache}),I(s.response.related_questions||[]),A(s.response.images||[]));break;case"error":r()||l(s.error||"An error occurred");break}}}catch(b){if(b instanceof Error&&b.name==="AbortError")return;r()||l(b instanceof Error?b.message:"Failed to get AI response")}finally{r()||(x(!1),y(!1)),f.current===F&&(f.current=null)}},v=u=>{k(),R.current=null,S(null),l(null),w([]),I([]),A([]),N(),x(!1),y(!1),i(`/ai?q=${encodeURIComponent(u)}`)},L=u=>{v(u)},E=()=>{t&&(k(),R.current=null,S(null),l(null),w([]),I([]),A([]),N(),U(t))},z=j||m?.text||"",Q=h.length>0?h:m?.thinking_steps||[],$=m?.citations||G;return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("header",{className:"sticky top-0 bg-white z-50 border-b border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(M,{to:"/",children:e.jsx("span",{className:"text-3xl font-bold",style:{background:"linear-gradient(90deg, #4285F4, #EA4335, #FBBC05, #34A853)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Search"})}),e.jsx("div",{className:"flex-1 max-w-xl",children:e.jsx(Y,{initialValue:t,size:"sm",onSearch:v})}),e.jsx(M,{to:"/ai/sessions",className:"p-2 text-[#5f6368] hover:bg-[#f1f3f4] rounded-full transition-colors",title:"AI Research Sessions",children:e.jsx(_,{size:20})}),e.jsx(M,{to:"/settings",className:"p-2 text-[#5f6368] hover:bg-[#f1f3f4] rounded-full transition-colors",children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"search-tabs mt-2",style:{paddingLeft:0},children:[e.jsxs("button",{type:"button",className:"search-tab",onClick:()=>i(`/search?q=${encodeURIComponent(t)}`),children:[e.jsx(B,{size:16}),"All"]}),e.jsxs("button",{type:"button",className:"search-tab active",children:[e.jsx(_,{size:16}),"AI"]}),e.jsxs("button",{type:"button",className:"search-tab",onClick:()=>i(`/images?q=${encodeURIComponent(t)}`),children:[e.jsx(ce,{size:16}),"Images"]}),e.jsxs("button",{type:"button",className:"search-tab",onClick:()=>i(`/videos?q=${encodeURIComponent(t)}`),children:[e.jsx(le,{size:16}),"Videos"]}),e.jsxs("button",{type:"button",className:"search-tab",onClick:()=>i(`/news?q=${encodeURIComponent(t)}`),children:[e.jsx(ue,{size:16}),"News"]})]})]})}),e.jsxs("main",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(Z,{}),e.jsx(te,{selectedModel:p||void 0,onSelectModel:g}),(m||o)&&e.jsxs("button",{type:"button",onClick:E,className:"ai-action-button ml-auto",disabled:c||o,children:[e.jsx(de,{size:14,className:c?"animate-spin":""}),"Regenerate"]})]}),t&&e.jsx("div",{className:"ai-query-display mb-6",children:e.jsx("h1",{className:"text-2xl font-medium text-gray-900",children:t})}),a&&e.jsxs("div",{className:"ai-error-banner mb-6",children:[e.jsx("span",{className:"text-red-600",children:a}),e.jsx("button",{type:"button",onClick:E,className:"text-blue-600 hover:underline ml-2",children:"Try again"})]}),c&&!z&&e.jsxs("div",{className:"ai-loading-state",children:[e.jsx(me,{size:32,className:"animate-spin text-blue-500 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Analyzing with AI..."})]}),(z||m)&&e.jsx("div",{className:"ai-main-response",children:e.jsx(ee,{response:m??{text:z,mode:d,citations:$,follow_ups:[],related_questions:P,images:D,session_id:"",sources_used:$.length,thinking_steps:Q},streamingContent:o?j:void 0,streamingThinking:o?h:void 0,isStreaming:o,onFollowUp:L,onRefresh:E})}),(m||z)&&!o&&e.jsx(pe,{onSubmit:L,disabled:c||o}),!t&&e.jsxs("div",{className:"ai-empty-state",children:[e.jsx(_,{size:48,className:"text-blue-500 mb-4"}),e.jsx("h2",{className:"text-xl font-medium text-gray-900 mb-2",children:"AI-Powered Search"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Get comprehensive, AI-generated answers with citations from multiple sources."}),e.jsxs("div",{className:"ai-suggestion-chips",children:[e.jsx("button",{type:"button",onClick:()=>v("What are the latest developments in AI?"),className:"ai-suggestion-chip",children:"Latest AI developments"}),e.jsx("button",{type:"button",onClick:()=>v("Compare React vs Vue for web development"),className:"ai-suggestion-chip",children:"React vs Vue comparison"}),e.jsx("button",{type:"button",onClick:()=>v("Best practices for Go backend development"),className:"ai-suggestion-chip",children:"Go backend best practices"})]})]})]})]})}export{ye as default};
