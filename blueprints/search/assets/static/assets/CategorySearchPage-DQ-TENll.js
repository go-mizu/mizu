import{j as e}from"./markdown-DRpjVqyA.js";import{u as P,r as n}from"./react-vendor-DqWpB-k-.js";import{S as C}from"./SearchHeader-B2KRDaM8.js";import{P as E}from"./Pagination-D2Fxudqr.js";import{S as q,R as I}from"./ReaderView-C4OToC1c.js";import{u as L}from"./index-CmWeGl3w.js";import{R as T}from"./ui-CyDAUWlq.js";function V({category:o,tab:S,searchFn:b}){const[i,d]=P(),a=i.get("q")||"",c=parseInt(i.get("page")||"1",10),[t,v]=n.useState(null),[N,h]=n.useState(!1),[m,x]=n.useState(null),[u,p]=n.useState(null),[f,g]=n.useState(!1),{settings:r,addRecentSearch:R}=L(),j=async(s=!1)=>{if(a){h(!s),s&&g(!0),x(null);try{const l=await b(a,{page:c,per_page:r.results_per_page,safe:r.safe_search,region:r.region,lang:r.language,refetch:s});v(l),R(a)}catch(l){x(l instanceof Error?l.message:"Search failed")}finally{h(!1),g(!1)}}};n.useEffect(()=>{a&&j()},[a,c,r]);const y=s=>{d({q:s})},_=s=>{d({q:a,page:String(s)}),window.scrollTo({top:0,behavior:"smooth"})},w=t?Math.ceil(t.total_results/r.results_per_page):0;return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx(C,{query:a,activeTab:S,onSearch:y}),e.jsx("main",{children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsx("div",{className:"flex-1 max-w-2xl",children:N?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-[#1a73e8] border-t-transparent rounded-full animate-spin"})}):m?e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-red-600",children:m})}):t?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#70757a] mb-4",children:[e.jsxs("span",{children:["About ",(t.total_results??0).toLocaleString()," ",o," results (",(t.search_time_ms??0).toFixed(2)," ms)",t.cached&&e.jsx("span",{className:"ml-1 text-[#188038]",title:"Served from cache",children:"- cached"})]}),e.jsx("button",{type:"button",onClick:()=>j(!0),disabled:f,className:"p-1 text-[#5f6368] hover:text-[#1a73e8] hover:bg-[#f1f3f4] rounded transition-colors disabled:opacity-50",title:"Refresh results (bypass cache)",children:e.jsx(T,{size:14,className:f?"animate-spin":""})})]}),(t.results||[]).map(s=>e.jsx(q,{result:s,onRead:p},s.id)),e.jsx(E,{page:c,totalPages:w,onPageChange:_})]}):e.jsx("div",{className:"py-12 text-center",children:e.jsxs("p",{className:"text-[#70757a]",children:["Search for ",o," results"]})})})})}),u&&e.jsx(I,{url:u,onClose:()=>p(null)})]})}export{V as C};
