import{j as e}from"./markdown-DRpjVqyA.js";import{r as o,u as B,a as G,L as A}from"./react-vendor-DqWpB-k-.js";import{b as P,a as D,S as K}from"./index-B9sQUvT8.js";import{A as Q,a as W}from"./AIResponse-HCCGBydo.js";import{V as H,M as J}from"./VoiceInput-CEKYF9vR.js";import{e as V,g as S,G as O,F as X,i as Y,A as Z,S as ee,I as se,V as te,N as ne,R as ae,j as ie}from"./ui-DSv63oDG.js";function oe({onSubmit:C,disabled:a,placeholder:t="Ask a follow-up"}){const[l,d]=o.useState(""),[h,r]=o.useState("search"),[i,x]=o.useState(""),m=o.useRef(null),b=n=>{n?.preventDefault(),!(!l.trim()||a)&&(C(l.trim()),d(""))},f=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),b())},w=o.useCallback(n=>{d(u=>u+(u?" ":"")+n),x("")},[]),N=o.useCallback(n=>{x(n)},[]),g=l+(i?` ${i}`:"");return e.jsx("div",{className:"followup-input-container",children:e.jsxs("form",{onSubmit:b,className:"followup-input-box",children:[e.jsxs("div",{className:"followup-modes",children:[e.jsx("button",{type:"button",className:h==="search"?"active":"",onClick:()=>r("search"),title:"Search mode",children:e.jsx(V,{size:16})}),e.jsx("button",{type:"button",className:h==="ai"?"active":"",onClick:()=>r("ai"),title:"AI mode",children:e.jsx(S,{size:16})}),e.jsx("button",{type:"button",className:h==="collection"?"active":"",onClick:()=>r("collection"),title:"Collection mode",children:e.jsx(O,{size:16})})]}),e.jsx("input",{ref:m,type:"text",value:g,onChange:n=>d(n.target.value),onKeyDown:f,placeholder:t,disabled:a,className:"followup-input"}),e.jsxs("div",{className:"followup-actions",children:[e.jsx("button",{type:"button",className:"action-btn",title:"Focus",disabled:a,children:e.jsx(X,{size:18})}),e.jsx("button",{type:"button",className:"action-btn",title:"Attach file",disabled:a,children:e.jsx(Y,{size:18})}),e.jsx(H,{onTranscript:w,onInterimTranscript:N,disabled:a,size:"sm"}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:!l.trim()||a,title:"Send",children:e.jsx(Z,{size:18})})]})]})})}function pe(){const[C]=B(),a=G(),t=C.get("q")||"",{mode:l,selectedModelId:d,setSelectedModelId:h,isLoading:r,isStreaming:i,streamingContent:x,streamingThinking:m,setLoading:b,setStreaming:f,appendStreamContent:w,addThinkingStep:N,resetStream:g,error:n,setError:u}=P(),[c,y]=o.useState(null),[M,z]=o.useState([]),[U,R]=o.useState([]),[E,_]=o.useState([]);o.useEffect(()=>{t&&!r&&!i&&!c&&q(t)},[t]);const q=async p=>{if(!(!p.trim()||r||i)){g(),b(!0),u(null),y(null),z([]),R([]),_([]);try{f(!0);const v=D.queryStreamFetch({text:p,mode:l,model_id:d||void 0});for await(const s of v)switch(s.type){case"start":break;case"search":s.query&&N(`Searching for: ${s.query}`);break;case"token":s.content&&w(s.content);break;case"thinking":s.thinking&&N(s.thinking);break;case"citation":s.citation&&z($=>[...$,s.citation]);break;case"done":s.response&&(y({text:s.response.text,mode:s.response.mode,citations:s.response.citations||[],follow_ups:s.response.follow_ups||[],related_questions:s.response.related_questions||[],images:s.response.images||[],session_id:s.response.session_id,sources_used:s.response.sources_used,thinking_steps:m}),R(s.response.related_questions||[]),_(s.response.images||[]));break;case"error":u(s.error||"An error occurred");break}}catch(v){u(v instanceof Error?v.message:"Failed to get AI response")}finally{b(!1),f(!1)}}},j=p=>{a(`/ai?q=${encodeURIComponent(p)}`),y(null),g()},T=p=>{j(p)},I=()=>{t&&(y(null),g(),q(t))},k=x||c?.text||"",L=m.length>0?m:c?.thinking_steps||[],F=c?.citations||M;return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("header",{className:"sticky top-0 bg-white z-50 border-b border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(A,{to:"/",children:e.jsx("span",{className:"text-3xl font-bold",style:{background:"linear-gradient(90deg, #4285F4, #EA4335, #FBBC05, #34A853)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Search"})}),e.jsx("div",{className:"flex-1 max-w-xl",children:e.jsx(K,{initialValue:t,size:"sm",onSearch:j})}),e.jsx(A,{to:"/ai/sessions",className:"p-2 text-[#5f6368] hover:bg-[#f1f3f4] rounded-full transition-colors",title:"AI Research Sessions",children:e.jsx(S,{size:20})}),e.jsx(A,{to:"/settings",className:"p-2 text-[#5f6368] hover:bg-[#f1f3f4] rounded-full transition-colors",children:e.jsx(ee,{size:20})})]}),e.jsxs("div",{className:"search-tabs mt-2",style:{paddingLeft:0},children:[e.jsxs("button",{type:"button",className:"search-tab",onClick:()=>a(`/search?q=${encodeURIComponent(t)}`),children:[e.jsx(V,{size:16}),"All"]}),e.jsxs("button",{type:"button",className:"search-tab active",children:[e.jsx(S,{size:16}),"AI"]}),e.jsxs("button",{type:"button",className:"search-tab",onClick:()=>a(`/images?q=${encodeURIComponent(t)}`),children:[e.jsx(se,{size:16}),"Images"]}),e.jsxs("button",{type:"button",className:"search-tab",onClick:()=>a(`/videos?q=${encodeURIComponent(t)}`),children:[e.jsx(te,{size:16}),"Videos"]}),e.jsxs("button",{type:"button",className:"search-tab",onClick:()=>a(`/news?q=${encodeURIComponent(t)}`),children:[e.jsx(ne,{size:16}),"News"]})]})]})}),e.jsxs("main",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(Q,{}),e.jsx(J,{selectedModel:d||void 0,onSelectModel:h}),(c||i)&&e.jsxs("button",{type:"button",onClick:I,className:"ai-action-button ml-auto",disabled:r||i,children:[e.jsx(ae,{size:14,className:r?"animate-spin":""}),"Regenerate"]})]}),t&&e.jsx("div",{className:"ai-query-display mb-6",children:e.jsx("h1",{className:"text-2xl font-medium text-gray-900",children:t})}),n&&e.jsxs("div",{className:"ai-error-banner mb-6",children:[e.jsx("span",{className:"text-red-600",children:n}),e.jsx("button",{type:"button",onClick:I,className:"text-blue-600 hover:underline ml-2",children:"Try again"})]}),r&&!k&&e.jsxs("div",{className:"ai-loading-state",children:[e.jsx(ie,{size:32,className:"animate-spin text-blue-500 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Analyzing with AI..."})]}),(k||c)&&e.jsx("div",{className:"ai-main-response",children:e.jsx(W,{response:c??{text:k,mode:l,citations:F,follow_ups:[],related_questions:U,images:E,session_id:"",sources_used:F.length,thinking_steps:L},streamingContent:i?x:void 0,streamingThinking:i?m:void 0,isStreaming:i,onFollowUp:T,onRefresh:I})}),(c||k)&&!i&&e.jsx(oe,{onSubmit:T,disabled:r||i}),!t&&e.jsxs("div",{className:"ai-empty-state",children:[e.jsx(S,{size:48,className:"text-blue-500 mb-4"}),e.jsx("h2",{className:"text-xl font-medium text-gray-900 mb-2",children:"AI-Powered Search"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Get comprehensive, AI-generated answers with citations from multiple sources."}),e.jsxs("div",{className:"ai-suggestion-chips",children:[e.jsx("button",{type:"button",onClick:()=>j("What are the latest developments in AI?"),className:"ai-suggestion-chip",children:"Latest AI developments"}),e.jsx("button",{type:"button",onClick:()=>j("Compare React vs Vue for web development"),className:"ai-suggestion-chip",children:"React vs Vue comparison"}),e.jsx("button",{type:"button",onClick:()=>j("Best practices for Go backend development"),className:"ai-suggestion-chip",children:"Go backend best practices"})]})]})]})]})}export{pe as default};
