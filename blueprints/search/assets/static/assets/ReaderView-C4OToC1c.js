import{j as e,M as h}from"./markdown-DRpjVqyA.js";import{r as n}from"./react-vendor-DqWpB-k-.js";import{u,s as f}from"./index-CmWeGl3w.js";import{B as b,l as j,s as g,t as y,u as v,E as x,X as w,r as N}from"./ui-CyDAUWlq.js";function z({result:s,onRead:o}){const{settings:r}=u(),[m,p]=n.useState(!1),l=n.useRef(null);n.useEffect(()=>{const t=a=>{l.current&&!l.current.contains(a.target)&&p(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const i=async t=>{try{await f.setPreference(s.domain,t),p(!1)}catch(a){console.error("Failed to set preference:",a)}},c=(()=>{try{const t=new URL(s.url),a=t.pathname.split("/").filter(Boolean);return{domain:t.hostname,path:a.slice(0,2).join(" › ")}}catch{return{domain:s.url,path:""}}})();return e.jsxs("div",{className:"search-result group",children:[e.jsxs("div",{className:"search-result-url",children:[s.favicon&&e.jsx("img",{src:s.favicon,alt:"",onError:t=>{t.target.style.display="none"}}),e.jsx("span",{children:c.domain}),c.path&&e.jsxs("span",{className:"search-result-breadcrumb",children:["› ",c.path]}),o&&e.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),o(s.url)},className:"opacity-0 group-hover:opacity-100 ml-2 p-1 text-[#70757a] hover:text-[#1a73e8] hover:bg-[#e8f0fe] rounded-full transition-all",title:"Read page",children:e.jsx(b,{size:14})}),e.jsxs("div",{className:"relative ml-auto",ref:l,children:[e.jsx("button",{type:"button",onClick:()=>p(!m),className:"opacity-0 group-hover:opacity-100 p-1 text-[#70757a] hover:bg-[#f1f3f4] rounded-full transition-opacity",children:e.jsx(j,{size:16})}),m&&e.jsxs("div",{className:"dropdown-menu",children:[e.jsxs("button",{type:"button",className:"dropdown-item",onClick:()=>i("upvote"),children:[e.jsx(g,{size:16}),"Boost ",s.domain]}),e.jsxs("button",{type:"button",className:"dropdown-item",onClick:()=>i("downvote"),children:[e.jsx(y,{size:16}),"Lower ",s.domain]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{type:"button",className:"dropdown-item danger",onClick:()=>i("block"),children:[e.jsx(v,{size:16}),"Block ",s.domain]})]})]})]}),e.jsx("a",{href:s.url,target:r.open_in_new_tab?"_blank":"_self",rel:"noopener noreferrer",className:"search-result-title",children:s.title}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("p",{className:"search-result-snippet flex-1",dangerouslySetInnerHTML:{__html:s.snippet}}),s.thumbnail?.url&&r.show_thumbnails&&e.jsx("a",{href:s.url,target:r.open_in_new_tab?"_blank":"_self",rel:"noopener noreferrer",className:"flex-shrink-0",children:e.jsx("img",{src:s.thumbnail.url,alt:"",className:"w-24 h-16 object-cover rounded border border-[#dadce0]",onError:t=>{t.target.style.display="none"}})})]}),s.published&&e.jsx("p",{className:"text-xs text-[#70757a] mt-1",children:new Date(s.published).toLocaleDateString()}),(s.sitelinks?.length??0)>0&&e.jsx("div",{className:"flex flex-wrap gap-x-4 gap-y-1 mt-2",children:(s.sitelinks||[]).map(t=>e.jsx("a",{href:t.url,target:r.open_in_new_tab?"_blank":"_self",rel:"noopener noreferrer",className:"text-sm text-[#1a0dab] hover:underline",children:t.title},t.url))})]})}function S({url:s,onClose:o}){const[r,m]=n.useState(null),[p,l]=n.useState(!0),[i,c]=n.useState(null);n.useEffect(()=>{(async()=>{l(!0),c(null);try{const d=await f.readPage(s);m(d)}catch(d){c(d instanceof Error?d.message:"Failed to load page")}finally{l(!1)}})()},[s]),n.useEffect(()=>{const a=d=>{d.key==="Escape"&&o()};return document.addEventListener("keydown",a),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",a),document.body.style.overflow=""}},[o]);const t=(()=>{try{return new URL(s).hostname}catch{return s}})();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:o}),e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full max-w-2xl bg-white shadow-2xl z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-[#e8eaed] flex-shrink-0",children:[e.jsx("div",{className:"min-w-0 flex-1 mr-4",children:r?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-base font-medium text-[#202124] truncate",children:r.title}),e.jsx("p",{className:"text-xs text-[#70757a] truncate mt-0.5",children:t})]}):e.jsx("div",{className:"h-5 w-48 bg-[#f1f3f4] rounded animate-pulse"})}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-[#5f6368] hover:bg-[#f1f3f4] rounded-full transition-colors",title:"Open original",children:e.jsx(x,{size:18})}),e.jsx("button",{type:"button",onClick:o,className:"p-2 text-[#5f6368] hover:bg-[#f1f3f4] rounded-full transition-colors",children:e.jsx(w,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:p?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(N,{size:32,className:"text-[#1a73e8] animate-spin mb-4"}),e.jsx("p",{className:"text-sm text-[#5f6368]",children:"Reading page..."})]}):i?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-sm text-[#d93025] mb-4",children:i}),e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 px-4 py-2 text-sm font-medium bg-[#1a73e8] text-white rounded-lg hover:bg-[#1557b0] transition-colors",children:[e.jsx(x,{size:14}),"Open original page"]})]}):r?e.jsx("article",{className:"prose prose-sm max-w-none prose-headings:text-[#202124] prose-p:text-[#3c4043] prose-a:text-[#1a73e8] prose-strong:text-[#202124] prose-code:text-[#202124] prose-code:bg-[#f1f3f4] prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-pre:bg-[#f8f9fa] prose-pre:border prose-pre:border-[#e8eaed]",children:e.jsx(h,{children:r.content})}):null})]})]})}export{S as R,z as S};
