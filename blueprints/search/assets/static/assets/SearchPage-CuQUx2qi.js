import{j as e,M as Q}from"./markdown-DRpjVqyA.js";import{r,u as $,a as K}from"./react-vendor-DqWpB-k-.js";import{S as G}from"./SearchHeader-DwJgPlaY.js";import{P as Y}from"./Pagination-Cu2MGMWm.js";import{a as O,s as F,u as B,b as J}from"./index-BbJAyEfF.js";import{J as W,i as X,K as Z,O as ee,Q as se,W as te,f as ae,Y as ne,_ as re,$ as V,E as P,S as le,a0 as H,C as U,R as ie,v as ce,h as q,X as oe,m as de}from"./ui-BUNJN1AT.js";import{A as me,a as xe}from"./AIResponse-DQeVP6mD.js";function ue({result:s,onRead:t}){const{settings:o}=O(),[i,m]=r.useState(!1),l=r.useRef(null);r.useEffect(()=>{const c=x=>{l.current&&!l.current.contains(x.target)&&m(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]);const n=async c=>{try{await F.setPreference(s.domain,c),m(!1)}catch(x){console.error("Failed to set preference:",x)}},u=(()=>{try{const c=new URL(s.url),x=c.pathname.split("/").filter(Boolean);return{domain:c.hostname,path:x.slice(0,2).join(" › ")}}catch{return{domain:s.url,path:""}}})();return e.jsxs("div",{className:"search-result group",children:[e.jsxs("div",{className:"search-result-url",children:[s.favicon&&e.jsx("img",{src:s.favicon,alt:"",onError:c=>{c.target.style.display="none"}}),e.jsx("span",{children:u.domain}),u.path&&e.jsxs("span",{className:"search-result-breadcrumb",children:["› ",u.path]}),t&&e.jsx("button",{type:"button",onClick:c=>{c.preventDefault(),t(s.url)},className:"opacity-0 group-hover:opacity-100 ml-2 p-1 text-[#70757a] hover:text-[#1a73e8] hover:bg-[#e8f0fe] rounded-full transition-all",title:"Read page",children:e.jsx(W,{size:14})}),e.jsxs("div",{className:"relative ml-auto",ref:l,children:[e.jsx("button",{type:"button",onClick:()=>m(!i),className:"opacity-0 group-hover:opacity-100 p-1 text-[#70757a] hover:bg-[#f1f3f4] rounded-full transition-opacity",children:e.jsx(X,{size:16})}),i&&e.jsxs("div",{className:"dropdown-menu",children:[e.jsxs("button",{type:"button",className:"dropdown-item",onClick:()=>n("upvote"),children:[e.jsx(Z,{size:16}),"Boost ",s.domain]}),e.jsxs("button",{type:"button",className:"dropdown-item",onClick:()=>n("downvote"),children:[e.jsx(ee,{size:16}),"Lower ",s.domain]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{type:"button",className:"dropdown-item danger",onClick:()=>n("block"),children:[e.jsx(se,{size:16}),"Block ",s.domain]})]})]})]}),e.jsx("a",{href:s.url,target:o.open_in_new_tab?"_blank":"_self",rel:"noopener noreferrer",className:"search-result-title",children:s.title}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("p",{className:"search-result-snippet flex-1",dangerouslySetInnerHTML:{__html:s.snippet}}),s.thumbnail?.url&&o.show_thumbnails&&e.jsx("a",{href:s.url,target:o.open_in_new_tab?"_blank":"_self",rel:"noopener noreferrer",className:"flex-shrink-0",children:e.jsx("img",{src:s.thumbnail.url,alt:"",className:"w-24 h-16 object-cover rounded border border-[#dadce0]",onError:c=>{c.target.style.display="none"}})})]}),s.published&&e.jsx("p",{className:"text-xs text-[#70757a] mt-1",children:new Date(s.published).toLocaleDateString()}),(s.sitelinks?.length??0)>0&&e.jsx("div",{className:"flex flex-wrap gap-x-4 gap-y-1 mt-2",children:(s.sitelinks||[]).map(c=>e.jsx("a",{href:c.url,target:o.open_in_new_tab?"_blank":"_self",rel:"noopener noreferrer",className:"text-sm text-[#1a0dab] hover:underline",children:c.title},c.url))})]})}const he={calculator:V,currency:re,weather:ne,definition:W,time:ae,unit:te};function pe({answer:s}){const t=he[s.type]||V;return e.jsxs("div",{className:"bg-white border border-[#dadce0] rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(t,{size:20,className:"text-[#1a73e8]"}),e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-[#1a73e8] bg-[#e8f0fe] rounded",children:s.type?s.type.charAt(0).toUpperCase()+s.type.slice(1):"Answer"})]}),e.jsx("div",{className:"text-3xl font-semibold text-[#202124]",children:s.result}),s.type==="calculator"&&e.jsxs("p",{className:"text-sm text-[#70757a] mt-1",children:[s.query," ="]}),s.type==="weather"&&s.data?e.jsx(fe,{data:s.data}):null,s.type==="definition"&&s.data?e.jsx(je,{data:s.data}):null,s.type==="time"&&s.data?e.jsx(ge,{data:s.data}):null,s.type==="currency"&&s.data?e.jsx(be,{data:s.data}):null,s.type==="unit"&&s.data?e.jsx(Ne,{data:s.data}):null]})}function fe({data:s}){return e.jsxs("div",{className:"flex gap-8 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-[#70757a]",children:"Humidity"}),e.jsxs("p",{className:"text-sm text-[#202124]",children:[s.humidity,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-[#70757a]",children:"Wind"}),e.jsxs("p",{className:"text-sm text-[#202124]",children:[s.wind_speed," ",s.wind_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-[#70757a]",children:"Condition"}),e.jsx("p",{className:"text-sm text-[#202124]",children:s.condition})]})]})}function je({data:s}){return e.jsxs("div",{className:"mt-3",children:[s.phonetic&&e.jsx("p",{className:"text-sm text-[#70757a] italic",children:s.phonetic}),e.jsx("p",{className:"text-sm text-[#70757a] mt-1",children:s.part_of_speech}),(s.definitions?.length??0)>1&&e.jsxs("p",{className:"text-sm text-[#70757a] mt-1",children:["2. ",s.definitions?.[1]]}),(s.synonyms?.length??0)>0&&e.jsxs("p",{className:"text-xs text-[#70757a] mt-2",children:["Synonyms: ",(s.synonyms||[]).join(", ")]})]})}function ge({data:s}){return e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-[#70757a]",children:s.date}),e.jsxs("p",{className:"text-xs text-[#70757a]",children:[s.timezone," (",s.offset,")"]})]})}function be({data:s}){const t=typeof s.rate=="number"?s.rate.toFixed(4):s.rate??"—";return e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-[#70757a]",children:["1 ",s.from_currency," = ",t," ",s.to_currency]}),e.jsxs("p",{className:"text-xs text-[#70757a]",children:["Rate as of ",new Date(s.updated_at).toLocaleDateString()]})]})}function Ne({data:s}){const t=typeof s.to_value=="number"?s.to_value.toFixed(4):s.to_value??"—";return e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-[#70757a]",children:[s.from_value," ",s.from_unit," = ",t," ",s.to_unit]}),e.jsx("p",{className:"text-xs text-[#70757a] capitalize",children:s.category})]})}function ve({panel:s}){return e.jsxs("div",{className:"knowledge-panel",children:[s.image&&e.jsx("img",{src:s.image,alt:s.title,className:"knowledge-panel-image",onError:t=>{t.target.style.display="none"}}),e.jsxs("div",{className:"knowledge-panel-content",children:[e.jsx("h2",{className:"knowledge-panel-title",children:s.title}),s.subtitle&&e.jsx("p",{className:"knowledge-panel-subtitle",children:s.subtitle.charAt(0).toUpperCase()+s.subtitle.slice(1).replace(/_/g," ")}),e.jsx("p",{className:"knowledge-panel-description",children:s.description}),(s.facts?.length??0)>0&&e.jsx("div",{className:"knowledge-panel-facts",children:(s.facts||[]).map(t=>e.jsxs("div",{className:"knowledge-panel-fact",children:[e.jsx("span",{className:"knowledge-panel-fact-label",children:t.label}),e.jsx("span",{className:"knowledge-panel-fact-value",children:t.value})]},t.label))}),(s.links?.length??0)>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-[#dadce0]",children:(s.links||[]).map(t=>e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 py-2 text-sm text-[#1a73e8] hover:underline",children:[e.jsx(P,{size:14}),t.title]},t.url))}),s.source&&e.jsxs("p",{className:"mt-4 text-xs text-[#70757a]",children:["Source: ",s.source]})]})]})}function ye({query:s,onFollowUp:t}){const{mode:o,aiAvailable:i,isLoading:m,isStreaming:l,streamingContent:n,streamingThinking:u,currentResponse:c,error:x,setLoading:h,setStreaming:C,appendStreamContent:A,addThinkingStep:E,resetStream:f,setCurrentResponse:y,setError:w}=B(),[k,R]=r.useState(!0),[p,L]=r.useState(!1),j=r.useRef(null),g=r.useRef(0),b=r.useCallback(()=>{j.current&&(j.current.abort(),j.current=null)},[]);r.useEffect(()=>()=>{b()},[b]);const S=r.useCallback(async()=>{if(!s||!i)return;b(),g.current+=1;const d=g.current,z=new AbortController;j.current=z;const N=()=>g.current!==d;f(),h(!0),w(null),y(null);try{C(!0);const _=J.queryStreamFetch({text:s,mode:o},z.signal);let T=null;for await(const v of _){if(N())break;switch(v.type){case"token":v.content&&!N()&&A(v.content);break;case"thinking":v.thinking&&!N()&&E(v.thinking);break;case"done":v.response&&!N()&&(T=v.response);break;case"error":N()||w(v.error||"An error occurred");break}}T&&!N()&&y(T)}catch(_){if(_ instanceof Error&&_.name==="AbortError")return;N()||w(_ instanceof Error?_.message:"Failed to get AI response")}finally{N()||(h(!1),C(!1),L(!0)),j.current===z&&(j.current=null)}},[s,o,i,b]);if(r.useEffect(()=>{s&&i&&!p&&S()},[s,i,p,S]),r.useEffect(()=>{b(),L(!1),f(),y(null)},[s,b]),!i)return null;const D=()=>{S()},I=()=>{S()},a=c||{text:n,mode:o,citations:[],follow_ups:[],session_id:"",sources_used:0,thinking_steps:u};return e.jsxs("div",{className:"ai-summary",children:[e.jsxs("div",{className:"ai-summary-header",children:[e.jsxs("button",{type:"button",onClick:()=>R(!k),className:"ai-summary-toggle",children:[e.jsx(le,{size:18,className:"ai-summary-icon"}),e.jsx("span",{className:"ai-summary-title",children:"AI Overview"}),k?e.jsx(H,{size:16}):e.jsx(U,{size:16})]}),e.jsxs("div",{className:"ai-summary-controls",children:[e.jsx(me,{size:"sm",onChange:I}),e.jsx("button",{type:"button",onClick:D,disabled:m||l,className:"ai-refresh-button",title:"Regenerate",children:e.jsx(ie,{size:14,className:m?"animate-spin":""})})]})]}),k&&e.jsx("div",{className:"ai-summary-content",children:x?e.jsxs("div",{className:"ai-error",children:[e.jsx("p",{children:x}),e.jsx("button",{type:"button",onClick:D,children:"Try again"})]}):m&&!n?e.jsxs("div",{className:"ai-loading",children:[e.jsxs("div",{className:"ai-loading-dots",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}),e.jsx("p",{children:"Generating AI overview..."})]}):a.text||n?e.jsx(xe,{response:a,streamingContent:l?n:void 0,streamingThinking:l?u:void 0,isStreaming:l,onFollowUp:t}):null})]})}function we({sheet:s}){const[t,o]=r.useState(new Set([0])),i=m=>{const l=new Set(t);l.has(m)?l.delete(m):l.add(m),o(l)};return e.jsxs("div",{className:"bg-[#f8f9fa] border border-[#dadce0] rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ce,{size:18,className:"text-[#1a73e8]"}),e.jsx("h3",{className:"font-medium text-[#202124]",children:s.title})]}),s.description&&e.jsx("p",{className:"text-sm text-[#70757a] mb-3",children:s.description}),e.jsx("div",{className:"space-y-2",children:s.sections.map((m,l)=>e.jsxs("div",{className:"border border-[#e8eaed] rounded bg-white",children:[e.jsxs("button",{type:"button",onClick:()=>i(l),className:"w-full flex items-center justify-between px-3 py-2 text-sm font-medium text-[#202124] hover:bg-[#f1f3f4]",children:[e.jsx("span",{children:m.title}),t.has(l)?e.jsx(H,{size:16,className:"text-[#70757a]"}):e.jsx(U,{size:16,className:"text-[#70757a]"})]}),t.has(l)&&e.jsx("div",{className:"px-3 pb-3 space-y-2",children:m.items.map((n,u)=>e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsx("code",{className:"px-2 py-0.5 bg-[#f1f3f4] rounded text-[#1a73e8] font-mono text-xs flex-shrink-0",children:n.code}),e.jsx("span",{className:"text-[#5f6368]",children:n.description})]},u))})]},l))})]})}function ke({searches:s,onSearch:t}){return!s||s.length===0?null:e.jsxs("div",{className:"bg-[#f8f9fa] border border-[#dadce0] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(q,{size:18,className:"text-[#1a73e8]"}),e.jsx("h3",{className:"font-medium text-[#202124]",children:"Related Searches"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.map((o,i)=>e.jsxs("button",{type:"button",onClick:()=>t(o),className:"flex items-center gap-2 px-3 py-2 text-sm text-left text-[#1a0dab] hover:bg-[#e8f0fe] rounded transition-colors",children:[e.jsx(q,{size:14,className:"text-[#70757a] flex-shrink-0"}),e.jsx("span",{className:"truncate",children:o})]},i))})]})}function Se({url:s,onClose:t}){const[o,i]=r.useState(null),[m,l]=r.useState(!0),[n,u]=r.useState(null);r.useEffect(()=>{(async()=>{l(!0),u(null);try{const h=await F.readPage(s);i(h)}catch(h){u(h instanceof Error?h.message:"Failed to load page")}finally{l(!1)}})()},[s]),r.useEffect(()=>{const x=h=>{h.key==="Escape"&&t()};return document.addEventListener("keydown",x),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",x),document.body.style.overflow=""}},[t]);const c=(()=>{try{return new URL(s).hostname}catch{return s}})();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:t}),e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full max-w-2xl bg-white shadow-2xl z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-[#e8eaed] flex-shrink-0",children:[e.jsx("div",{className:"min-w-0 flex-1 mr-4",children:o?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-base font-medium text-[#202124] truncate",children:o.title}),e.jsx("p",{className:"text-xs text-[#70757a] truncate mt-0.5",children:c})]}):e.jsx("div",{className:"h-5 w-48 bg-[#f1f3f4] rounded animate-pulse"})}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-[#5f6368] hover:bg-[#f1f3f4] rounded-full transition-colors",title:"Open original",children:e.jsx(P,{size:18})}),e.jsx("button",{type:"button",onClick:t,className:"p-2 text-[#5f6368] hover:bg-[#f1f3f4] rounded-full transition-colors",children:e.jsx(oe,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:m?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(de,{size:32,className:"text-[#1a73e8] animate-spin mb-4"}),e.jsx("p",{className:"text-sm text-[#5f6368]",children:"Reading page..."})]}):n?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-sm text-[#d93025] mb-4",children:n}),e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 px-4 py-2 text-sm font-medium bg-[#1a73e8] text-white rounded-lg hover:bg-[#1557b0] transition-colors",children:[e.jsx(P,{size:14}),"Open original page"]})]}):o?e.jsx("article",{className:"prose prose-sm max-w-none prose-headings:text-[#202124] prose-p:text-[#3c4043] prose-a:text-[#1a73e8] prose-strong:text-[#202124] prose-code:text-[#202124] prose-code:bg-[#f1f3f4] prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-pre:bg-[#f8f9fa] prose-pre:border prose-pre:border-[#e8eaed]",children:e.jsx(Q,{children:o.content})}):null})]})]})}const M=[{value:"",label:"Any time"},{value:"day",label:"Past 24 hours"},{value:"week",label:"Past week"},{value:"month",label:"Past month"},{value:"year",label:"Past year"}];function De(){const[s,t]=$(),o=K(),i=s.get("q")||"",m=parseInt(s.get("page")||"1",10),l=s.get("time")||"",[n,u]=r.useState(null),[c,x]=r.useState(!1),[h,C]=r.useState(null),[A,E]=r.useState(!1),[f,y]=r.useState(null),[w,k]=r.useState(null),R=r.useRef(null),{settings:p,addRecentSearch:L}=O(),{aiAvailable:j}=B();r.useEffect(()=>{const a=d=>{R.current&&!R.current.contains(d.target)&&E(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),r.useEffect(()=>{if(!i)return;(async()=>{x(!0),C(null),y(null);try{const d=await F.search(i,{page:m,per_page:p.results_per_page,time:l,safe:p.safe_search,region:p.region,lang:p.language});if(d.redirect)if(d.redirect.startsWith("http"))y({url:d.redirect,name:d.bang?.name||"External site"}),u(null);else{o(d.redirect);return}else if(d.category){o(`/${d.category}?q=${encodeURIComponent(d.query)}`);return}else u(d);L(i)}catch(d){C(d instanceof Error?d.message:"Search failed")}finally{x(!1)}})()},[i,m,l,p]);const g=a=>{t({q:a})},b=a=>{t({q:i,page:String(a)}),window.scrollTo({top:0,behavior:"smooth"})},S=a=>{t(a?{q:i,time:a}:{q:i}),E(!1)},D=n?Math.ceil(n.total_results/p.results_per_page):0,I=M.find(a=>a.value===l)?.label||"Any time";return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx(G,{query:i,activeTab:"all",onSearch:g,tabsRight:e.jsxs("div",{className:"time-filter",ref:R,children:[e.jsxs("button",{type:"button",className:"time-filter-button",onClick:()=>E(!A),children:[I,e.jsx(U,{size:16})]}),A&&e.jsx("div",{className:"time-filter-dropdown",children:M.map(a=>e.jsx("button",{type:"button",className:`time-filter-option ${l===a.value?"active":""}`,onClick:()=>S(a.value),children:a.label},a.value))})]})}),e.jsx("main",{children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-8",children:[e.jsx("div",{className:"flex-1 max-w-2xl",children:c?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-[#1a73e8] border-t-transparent rounded-full animate-spin"})}):f?e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"bg-[#f8f9fa] border border-[#dadce0] rounded-lg p-6 text-center",children:[e.jsx(P,{size:32,className:"mx-auto mb-4 text-[#1a73e8]"}),e.jsxs("h2",{className:"text-lg font-medium text-[#202124] mb-2",children:["Redirecting to ",f.name]}),e.jsx("p",{className:"text-sm text-[#5f6368] mb-4",children:"You're about to leave Mizu Search"}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsxs("a",{href:f.url,className:"px-4 py-2 bg-[#1a73e8] text-white rounded-lg hover:bg-[#1557b0] transition-colors",rel:"noopener noreferrer",children:["Continue to ",f.name]}),e.jsx("button",{type:"button",onClick:()=>{y(null),o("/")},className:"px-4 py-2 border border-[#dadce0] rounded-lg hover:bg-[#f1f3f4] transition-colors text-[#5f6368]",children:"Go Back"})]}),e.jsx("p",{className:"text-xs text-[#9aa0a6] mt-4 break-all",children:f.url})]})}):h?e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-red-600",children:h})}):n?e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-[#70757a] mb-4",children:["About ",(n.total_results??0).toLocaleString()," results (",(n.search_time_ms??0).toFixed(2)," ms)"]}),n.corrected_query&&e.jsxs("p",{className:"text-sm mb-4",children:["Showing results for"," ",e.jsx("button",{type:"button",onClick:()=>g(n.corrected_query),className:"font-medium text-[#1a73e8] hover:underline",children:n.corrected_query})]}),j&&i&&e.jsx("div",{className:"mb-6",children:e.jsx(ye,{query:i,onFollowUp:a=>g(a)})}),n.widgets?.filter(a=>a.type==="cheat_sheet").map((a,d)=>e.jsx(we,{sheet:a.content},d)),n.instant_answer&&e.jsx("div",{className:"mb-4",children:e.jsx(pe,{answer:n.instant_answer})}),(n.results||[]).map(a=>e.jsx(ue,{result:a,onRead:k},a.id)),(()=>{const a=n.widgets?.find(z=>z.type==="related_searches"),d=a?a.content:n.related_searches||[];return d.length>0?e.jsx(ke,{searches:d,onSearch:g}):null})(),e.jsx(Y,{page:m,totalPages:D,onPageChange:b})]}):e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-[#70757a]",children:"Enter a search query"})})}),n?.knowledge_panel&&e.jsx("div",{className:"hidden lg:block w-80",children:e.jsx(ve,{panel:n.knowledge_panel})})]})})}),w&&e.jsx(Se,{url:w,onClose:()=>k(null)})]})}export{De as default};
