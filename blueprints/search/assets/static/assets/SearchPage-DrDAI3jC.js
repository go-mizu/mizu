import{j as e}from"./markdown-DRpjVqyA.js";import{r as i,u as V,a as H}from"./react-vendor-DqWpB-k-.js";import{S as Q}from"./SearchHeader-B_HpoXUx.js";import{P as $}from"./Pagination-BRhfUMXj.js";import{S as G,R as K}from"./ReaderView-C-6qPGC5.js";import{a0 as Y,f as J,B as X,a1 as Z,a2 as ee,a3 as U,E as W,S as se,a4 as M,C as q,R as O,j as te,i as L}from"./ui-DWjFbB9d.js";import{a as B,b as ae,u as ne,s as re}from"./index-Di8JkMG2.js";import{A as le,a as ie}from"./AIResponse-Pp38m_RQ.js";const ce={calculator:U,currency:ee,weather:Z,definition:X,time:J,unit:Y};function oe({answer:s}){const a=ce[s.type]||U;return e.jsxs("div",{className:"bg-white border border-[#dadce0] rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(a,{size:20,className:"text-[#1a73e8]"}),e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-[#1a73e8] bg-[#e8f0fe] rounded",children:s.type?s.type.charAt(0).toUpperCase()+s.type.slice(1):"Answer"})]}),e.jsx("div",{className:"text-3xl font-semibold text-[#202124]",children:s.result}),s.type==="calculator"&&e.jsxs("p",{className:"text-sm text-[#70757a] mt-1",children:[s.query," ="]}),s.type==="weather"&&s.data?e.jsx(de,{data:s.data}):null,s.type==="definition"&&s.data?e.jsx(me,{data:s.data}):null,s.type==="time"&&s.data?e.jsx(xe,{data:s.data}):null,s.type==="currency"&&s.data?e.jsx(ue,{data:s.data}):null,s.type==="unit"&&s.data?e.jsx(he,{data:s.data}):null]})}function de({data:s}){return e.jsxs("div",{className:"flex gap-8 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-[#70757a]",children:"Humidity"}),e.jsxs("p",{className:"text-sm text-[#202124]",children:[s.humidity,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-[#70757a]",children:"Wind"}),e.jsxs("p",{className:"text-sm text-[#202124]",children:[s.wind_speed," ",s.wind_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-[#70757a]",children:"Condition"}),e.jsx("p",{className:"text-sm text-[#202124]",children:s.condition})]})]})}function me({data:s}){return e.jsxs("div",{className:"mt-3",children:[s.phonetic&&e.jsx("p",{className:"text-sm text-[#70757a] italic",children:s.phonetic}),e.jsx("p",{className:"text-sm text-[#70757a] mt-1",children:s.part_of_speech}),(s.definitions?.length??0)>1&&e.jsxs("p",{className:"text-sm text-[#70757a] mt-1",children:["2. ",s.definitions?.[1]]}),(s.synonyms?.length??0)>0&&e.jsxs("p",{className:"text-xs text-[#70757a] mt-2",children:["Synonyms: ",(s.synonyms||[]).join(", ")]})]})}function xe({data:s}){return e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-[#70757a]",children:s.date}),e.jsxs("p",{className:"text-xs text-[#70757a]",children:[s.timezone," (",s.offset,")"]})]})}function ue({data:s}){const a=typeof s.rate=="number"?s.rate.toFixed(4):s.rate??"—";return e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-[#70757a]",children:["1 ",s.from_currency," = ",a," ",s.to_currency]}),e.jsxs("p",{className:"text-xs text-[#70757a]",children:["Rate as of ",new Date(s.updated_at).toLocaleDateString()]})]})}function he({data:s}){const a=typeof s.to_value=="number"?s.to_value.toFixed(4):s.to_value??"—";return e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-[#70757a]",children:[s.from_value," ",s.from_unit," = ",a," ",s.to_unit]}),e.jsx("p",{className:"text-xs text-[#70757a] capitalize",children:s.category})]})}function pe({panel:s}){return e.jsxs("div",{className:"knowledge-panel",children:[s.image&&e.jsx("img",{src:s.image,alt:s.title,className:"knowledge-panel-image",onError:a=>{a.target.style.display="none"}}),e.jsxs("div",{className:"knowledge-panel-content",children:[e.jsx("h2",{className:"knowledge-panel-title",children:s.title}),s.subtitle&&e.jsx("p",{className:"knowledge-panel-subtitle",children:s.subtitle.charAt(0).toUpperCase()+s.subtitle.slice(1).replace(/_/g," ")}),e.jsx("p",{className:"knowledge-panel-description",children:s.description}),(s.facts?.length??0)>0&&e.jsx("div",{className:"knowledge-panel-facts",children:(s.facts||[]).map(a=>e.jsxs("div",{className:"knowledge-panel-fact",children:[e.jsx("span",{className:"knowledge-panel-fact-label",children:a.label}),e.jsx("span",{className:"knowledge-panel-fact-value",children:a.value})]},a.label))}),(s.links?.length??0)>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-[#dadce0]",children:(s.links||[]).map(a=>e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 py-2 text-sm text-[#1a73e8] hover:underline",children:[e.jsx(W,{size:14}),a.title]},a.url))}),s.source&&e.jsxs("p",{className:"mt-4 text-xs text-[#70757a]",children:["Source: ",s.source]})]})]})}function fe({query:s,onFollowUp:a}){const{mode:m,aiAvailable:l,isLoading:o,isStreaming:c,streamingContent:r,streamingThinking:p,currentResponse:P,error:y,setLoading:S,setStreaming:k,appendStreamContent:A,addThinkingStep:w,resetStream:x,setCurrentResponse:f,setError:b}=B(),[N,z]=i.useState(!0),[C,v]=i.useState(!1),d=i.useRef(null),_=i.useRef(0),u=i.useCallback(()=>{d.current&&(d.current.abort(),d.current=null)},[]);i.useEffect(()=>()=>{u()},[u]);const j=i.useCallback(async()=>{if(!s||!l)return;u(),_.current+=1;const D=_.current,R=new AbortController;d.current=R;const t=()=>_.current!==D;x(),S(!0),b(null),f(null);try{k(!0);const n=ae.queryStreamFetch({text:s,mode:m},R.signal);let E=null;for await(const h of n){if(t())break;switch(h.type){case"token":h.content&&!t()&&A(h.content);break;case"thinking":h.thinking&&!t()&&w(h.thinking);break;case"done":h.response&&!t()&&(E=h.response);break;case"error":t()||b(h.error||"An error occurred");break}}E&&!t()&&f(E)}catch(n){if(n instanceof Error&&n.name==="AbortError")return;t()||b(n instanceof Error?n.message:"Failed to get AI response")}finally{t()||(S(!1),k(!1),v(!0)),d.current===R&&(d.current=null)}},[s,m,l,u]);if(i.useEffect(()=>{s&&l&&!C&&j()},[s,l,C,j]),i.useEffect(()=>{u(),v(!1),x(),f(null)},[s,u]),!l)return null;const g=()=>{j()},T=()=>{j()},I=P||{text:r,mode:m,citations:[],follow_ups:[],session_id:"",sources_used:0,thinking_steps:p};return e.jsxs("div",{className:"ai-summary",children:[e.jsxs("div",{className:"ai-summary-header",children:[e.jsxs("button",{type:"button",onClick:()=>z(!N),className:"ai-summary-toggle",children:[e.jsx(se,{size:18,className:"ai-summary-icon"}),e.jsx("span",{className:"ai-summary-title",children:"AI Overview"}),N?e.jsx(M,{size:16}):e.jsx(q,{size:16})]}),e.jsxs("div",{className:"ai-summary-controls",children:[e.jsx(le,{size:"sm",onChange:T}),e.jsx("button",{type:"button",onClick:g,disabled:o||c,className:"ai-refresh-button",title:"Regenerate",children:e.jsx(O,{size:14,className:o?"animate-spin":""})})]})]}),N&&e.jsx("div",{className:"ai-summary-content",children:y?e.jsxs("div",{className:"ai-error",children:[e.jsx("p",{children:y}),e.jsx("button",{type:"button",onClick:g,children:"Try again"})]}):o&&!r?e.jsxs("div",{className:"ai-loading",children:[e.jsxs("div",{className:"ai-loading-dots",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}),e.jsx("p",{children:"Generating AI overview..."})]}):I.text||r?e.jsx(ie,{response:I,streamingContent:c?r:void 0,streamingThinking:c?p:void 0,isStreaming:c,onFollowUp:a}):null})]})}function je({sheet:s}){const[a,m]=i.useState(new Set([0])),l=o=>{const c=new Set(a);c.has(o)?c.delete(o):c.add(o),m(c)};return e.jsxs("div",{className:"bg-[#f8f9fa] border border-[#dadce0] rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(te,{size:18,className:"text-[#1a73e8]"}),e.jsx("h3",{className:"font-medium text-[#202124]",children:s.title})]}),s.description&&e.jsx("p",{className:"text-sm text-[#70757a] mb-3",children:s.description}),e.jsx("div",{className:"space-y-2",children:s.sections.map((o,c)=>e.jsxs("div",{className:"border border-[#e8eaed] rounded bg-white",children:[e.jsxs("button",{type:"button",onClick:()=>l(c),className:"w-full flex items-center justify-between px-3 py-2 text-sm font-medium text-[#202124] hover:bg-[#f1f3f4]",children:[e.jsx("span",{children:o.title}),a.has(c)?e.jsx(M,{size:16,className:"text-[#70757a]"}):e.jsx(q,{size:16,className:"text-[#70757a]"})]}),a.has(c)&&e.jsx("div",{className:"px-3 pb-3 space-y-2",children:o.items.map((r,p)=>e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsx("code",{className:"px-2 py-0.5 bg-[#f1f3f4] rounded text-[#1a73e8] font-mono text-xs flex-shrink-0",children:r.code}),e.jsx("span",{className:"text-[#5f6368]",children:r.description})]},p))})]},c))})]})}function ge({searches:s,onSearch:a}){return!s||s.length===0?null:e.jsxs("div",{className:"bg-[#f8f9fa] border border-[#dadce0] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(L,{size:18,className:"text-[#1a73e8]"}),e.jsx("h3",{className:"font-medium text-[#202124]",children:"Related Searches"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.map((m,l)=>e.jsxs("button",{type:"button",onClick:()=>a(m),className:"flex items-center gap-2 px-3 py-2 text-sm text-left text-[#1a0dab] hover:bg-[#e8f0fe] rounded transition-colors",children:[e.jsx(L,{size:14,className:"text-[#70757a] flex-shrink-0"}),e.jsx("span",{className:"truncate",children:m})]},l))})]})}const F=[{value:"",label:"Any time"},{value:"day",label:"Past 24 hours"},{value:"week",label:"Past week"},{value:"month",label:"Past month"},{value:"year",label:"Past year"}];function _e(){const[s,a]=V(),m=H(),l=s.get("q")||"",o=parseInt(s.get("page")||"1",10),c=s.get("time")||"",[r,p]=i.useState(null),[P,y]=i.useState(!1),[S,k]=i.useState(null),[A,w]=i.useState(!1),[x,f]=i.useState(null),[b,N]=i.useState(null),[z,C]=i.useState(!1),v=i.useRef(null),{settings:d,addRecentSearch:_}=ne(),{aiAvailable:u}=B();i.useEffect(()=>{const t=n=>{v.current&&!v.current.contains(n.target)&&w(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const j=async(t=!1)=>{y(!t),t&&C(!0),k(null),f(null);try{const n=await re.search(l,{page:o,per_page:d.results_per_page,time:c,safe:d.safe_search,region:d.region,lang:d.language,refetch:t});if(n.redirect)if(n.redirect.startsWith("http"))f({url:n.redirect,name:n.bang?.name||"External site"}),p(null);else{m(n.redirect);return}else if(n.category){m(`/${n.category}?q=${encodeURIComponent(n.query)}`);return}else p(n);_(l)}catch(n){k(n instanceof Error?n.message:"Search failed")}finally{y(!1),C(!1)}};i.useEffect(()=>{l&&j()},[l,o,c,d]);const g=t=>{a({q:t})},T=t=>{a({q:l,page:String(t)}),window.scrollTo({top:0,behavior:"smooth"})},I=t=>{a(t?{q:l,time:t}:{q:l}),w(!1)},D=r?Math.ceil(r.total_results/d.results_per_page):0,R=F.find(t=>t.value===c)?.label||"Any time";return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx(Q,{query:l,activeTab:"all",onSearch:g,tabsRight:e.jsxs("div",{className:"time-filter",ref:v,children:[e.jsxs("button",{type:"button",className:"time-filter-button",onClick:()=>w(!A),children:[R,e.jsx(q,{size:16})]}),A&&e.jsx("div",{className:"time-filter-dropdown",children:F.map(t=>e.jsx("button",{type:"button",className:`time-filter-option ${c===t.value?"active":""}`,onClick:()=>I(t.value),children:t.label},t.value))})]})}),e.jsx("main",{children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-8",children:[e.jsx("div",{className:"flex-1 max-w-2xl",children:P?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-[#1a73e8] border-t-transparent rounded-full animate-spin"})}):x?e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"bg-[#f8f9fa] border border-[#dadce0] rounded-lg p-6 text-center",children:[e.jsx(W,{size:32,className:"mx-auto mb-4 text-[#1a73e8]"}),e.jsxs("h2",{className:"text-lg font-medium text-[#202124] mb-2",children:["Redirecting to ",x.name]}),e.jsx("p",{className:"text-sm text-[#5f6368] mb-4",children:"You're about to leave Mizu Search"}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsxs("a",{href:x.url,className:"px-4 py-2 bg-[#1a73e8] text-white rounded-lg hover:bg-[#1557b0] transition-colors",rel:"noopener noreferrer",children:["Continue to ",x.name]}),e.jsx("button",{type:"button",onClick:()=>{f(null),m("/")},className:"px-4 py-2 border border-[#dadce0] rounded-lg hover:bg-[#f1f3f4] transition-colors text-[#5f6368]",children:"Go Back"})]}),e.jsx("p",{className:"text-xs text-[#9aa0a6] mt-4 break-all",children:x.url})]})}):S?e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-red-600",children:S})}):r?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#70757a] mb-4",children:[e.jsxs("span",{children:["About ",(r.total_results??0).toLocaleString()," results (",(r.search_time_ms??0).toFixed(2)," ms)",r.cached&&e.jsx("span",{className:"ml-1 text-[#188038]",title:"Served from cache",children:"- cached"})]}),e.jsx("button",{type:"button",onClick:()=>j(!0),disabled:z,className:"p-1 text-[#5f6368] hover:text-[#1a73e8] hover:bg-[#f1f3f4] rounded transition-colors disabled:opacity-50",title:"Refresh results (bypass cache)",children:e.jsx(O,{size:14,className:z?"animate-spin":""})})]}),r.corrected_query&&e.jsxs("p",{className:"text-sm mb-4",children:["Showing results for"," ",e.jsx("button",{type:"button",onClick:()=>g(r.corrected_query),className:"font-medium text-[#1a73e8] hover:underline",children:r.corrected_query})]}),u&&l&&e.jsx("div",{className:"mb-6",children:e.jsx(fe,{query:l,onFollowUp:t=>g(t)})}),r.widgets?.filter(t=>t.type==="cheat_sheet").map((t,n)=>e.jsx(je,{sheet:t.content},n)),r.instant_answer&&e.jsx("div",{className:"mb-4",children:e.jsx(oe,{answer:r.instant_answer})}),(r.results||[]).map(t=>e.jsx(G,{result:t,onRead:N},t.id)),(()=>{const t=r.widgets?.find(E=>E.type==="related_searches"),n=t?t.content:r.related_searches||[];return n.length>0?e.jsx(ge,{searches:n,onSearch:g}):null})(),e.jsx($,{page:o,totalPages:D,onPageChange:T})]}):e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-[#70757a]",children:"Enter a search query"})})}),r?.knowledge_panel&&e.jsx("div",{className:"hidden lg:block w-80",children:e.jsx(pe,{panel:r.knowledge_panel})})]})})}),b&&e.jsx(K,{url:b,onClose:()=>N(null)})]})}export{_e as default};
