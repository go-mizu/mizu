{{define "content"}}
<div class="im-auth-container">
    <div class="im-auth-card">
        <!-- iMessage Logo -->
        <div class="im-auth-logo">
            <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="imessage-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="#5EE173"/>
                        <stop offset="100%" stop-color="#34C759"/>
                    </linearGradient>
                </defs>
                <rect width="72" height="72" rx="16" fill="url(#imessage-gradient)"/>
                <path d="M36 16C24.954 16 16 23.835 16 33.5C16 38.186 18.298 42.426 22 45.41V56L31.677 50.307C33.059 50.538 34.5 50.667 36 50.667C47.046 50.667 56 42.832 56 33.333C56 23.835 47.046 16 36 16Z" fill="white"/>
            </svg>
        </div>

        <h1 class="im-auth-title">Sign In</h1>
        <p class="im-auth-subtitle">Welcome back. Enter your credentials to continue.</p>

        <!-- Login Form -->
        <form id="login-form" class="im-auth-form">
            <!-- Error Message -->
            <div id="error-message" class="im-auth-error hidden"></div>

            <!-- Username -->
            <div class="im-form-group">
                <label class="im-label" for="username">Username</label>
                <input
                    type="text"
                    id="username"
                    name="username"
                    class="im-input-field"
                    placeholder="Enter your username"
                    required
                    autofocus
                >
            </div>

            <!-- Password -->
            <div class="im-form-group">
                <label class="im-label" for="password">Password</label>
                <input
                    type="password"
                    id="password"
                    name="password"
                    class="im-input-field"
                    placeholder="Enter your password"
                    required
                >
            </div>

            <!-- Remember Me -->
            <div class="im-form-group">
                <label class="im-checkbox">
                    <input type="checkbox" id="remember">
                    <span>Remember me</span>
                </label>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="im-btn im-btn-primary im-btn-block im-btn-lg" id="submit-btn">
                <span id="btn-text">Sign In</span>
                <span id="btn-loading" class="hidden">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                    </svg>
                </span>
            </button>
        </form>

        <!-- Divider -->
        <div class="im-auth-divider">
            <span>or</span>
        </div>

        <!-- Back to Home -->
        <a href="/" style="text-decoration: none;">
            <button class="im-btn im-btn-secondary im-btn-block">
                Back to Home
            </button>
        </a>

        <!-- Footer -->
        <div class="im-auth-footer">
            Don't have an account? <a href="/register">Create one</a>
        </div>
    </div>
</div>

<style>
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
</style>

<script>
document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const errorDiv = document.getElementById('error-message');
    const submitBtn = document.getElementById('submit-btn');
    const btnText = document.getElementById('btn-text');
    const btnLoading = document.getElementById('btn-loading');

    // Show loading state
    submitBtn.disabled = true;
    btnText.classList.add('hidden');
    btnLoading.classList.remove('hidden');
    errorDiv.classList.add('hidden');

    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    try {
        const res = await fetch('/api/v1/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (data.success) {
            window.location.href = '/app';
        } else {
            submitBtn.disabled = false;
            btnText.classList.remove('hidden');
            btnLoading.classList.add('hidden');
            errorDiv.textContent = data.error || 'Invalid username or password';
            errorDiv.classList.remove('hidden');
        }
    } catch (err) {
        submitBtn.disabled = false;
        btnText.classList.remove('hidden');
        btnLoading.classList.add('hidden');
        errorDiv.textContent = 'Connection error. Please try again.';
        errorDiv.classList.remove('hidden');
    }
});
</script>
{{end}}
