import{a,j as e}from"./markdown-Bs6XdLEX.js";import{f as O}from"./utils-BuvrnUzC.js";import{u as A,I as o}from"./index-h92Apb6x.js";import"./react-vendor-ZmPOmYi1.js";function P({gw:c}){const[p,w]=a.useState([]),[g,f]=a.useState(!0),[T,b]=a.useState(null),[j,u]=a.useState({}),[E,h]=a.useState(!1),[v,N]=a.useState(!1),[m,C]=a.useState(""),[x,k]=a.useState(""),[y,S]=a.useState("{}"),{toast:t}=A(),d=a.useCallback(()=>{f(!0),c.rpc("channels.status").then(s=>{const n=s.channels||[];w(n),u(l=>{const i={...l};for(const r of n)r.id in i||(i[r.id]=r.status==="connected");return i})}).catch(s=>{t("Failed to load channels: "+s.message,"error")}).finally(()=>f(!1))},[c,t]),z=a.useCallback(async s=>{const n=p.find(r=>r.id===s),l=j[s]??(n==null?void 0:n.status)==="connected",i=l?"disconnected":"connected";u(r=>({...r,[s]:!l}));try{await c.rpc("channels.update",{id:s,status:i}),t(((n==null?void 0:n.name)||s)+(i==="connected"?" enabled":" disabled"),"success"),d()}catch(r){u(D=>({...D,[s]:l})),t("Failed to toggle: "+(r instanceof Error?r.message:"unknown"),"error")}},[p,j,c,t,d]),I=a.useCallback(async(s,n)=>{if(confirm(`Delete channel "${n||s}"? This cannot be undone.`))try{await c.rpc("channels.delete",{id:s}),t("Channel deleted","success"),b(null),d()}catch(l){t("Failed to delete: "+(l instanceof Error?l.message:"unknown"),"error")}},[c,t,d]),W=a.useCallback(async()=>{if(!m.trim()||!x.trim()){t("Name and type are required","error");return}let s={};try{s=JSON.parse(y)}catch{t("Config must be valid JSON","error");return}N(!0);try{await c.rpc("channels.create",{name:m.trim(),type:x.trim(),config:s,status:"disconnected"}),t("Channel created","success"),h(!1),C(""),k(""),S("{}"),d()}catch(n){t("Failed to create channel: "+(n instanceof Error?n.message:"unknown"),"error")}finally{N(!1)}},[c,m,x,y,t,d]);return a.useEffect(()=>{d()},[d]),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"card-title",children:"Channels"}),e.jsx("div",{className:"card-sub",children:"Connected messaging platform integrations."})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{className:"btn btn--sm",onClick:d,disabled:g,children:[e.jsx(o,{name:"refresh"}),e.jsx("span",{children:"Refresh"})]}),e.jsxs("button",{className:"btn btn--sm primary",onClick:()=>h(!0),children:[e.jsx(o,{name:"plus"}),e.jsx("span",{children:"Create"})]})]})]}),E&&e.jsxs("div",{style:{marginTop:16,border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:16,background:"var(--bg-elevated)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("span",{style:{fontWeight:600,fontSize:14,color:"var(--text-strong)"},children:"New Channel"}),e.jsx("button",{className:"btn btn--sm",onClick:()=>h(!1),style:{padding:"4px 8px"},children:e.jsx(o,{name:"x",size:14})})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"field",children:[e.jsx("span",{children:"Name"}),e.jsx("input",{type:"text",value:m,onChange:s=>C(s.target.value),placeholder:"e.g. my-slack-channel"})]}),e.jsxs("div",{className:"field",children:[e.jsx("span",{children:"Type"}),e.jsxs("select",{value:x,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"",children:"Select type..."}),e.jsx("option",{value:"telegram",children:"Telegram"}),e.jsx("option",{value:"discord",children:"Discord"}),e.jsx("option",{value:"mattermost",children:"Mattermost"}),e.jsx("option",{value:"webhook",children:"Webhook"})]})]})]}),e.jsxs("div",{className:"field",style:{marginTop:12},children:[e.jsx("span",{children:"Config (JSON)"}),e.jsx("textarea",{value:y,onChange:s=>S(s.target.value),placeholder:'{"token": "...", "channel_id": "..."}',style:{minHeight:80}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[e.jsx("button",{className:"btn btn--sm",onClick:()=>h(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn--sm primary",onClick:W,disabled:v||!m.trim()||!x.trim(),children:v?"Creating...":"Create Channel"})]})]}),g&&p.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("div",{className:"spinner"})}):p.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:e.jsx(o,{name:"link",size:36})}),e.jsx("div",{children:"No channels connected."})]}):e.jsx("div",{className:"list",style:{marginTop:16},children:p.map(s=>{const n=T===s.id,l=j[s.id]??s.status==="connected";return e.jsxs("div",{children:[e.jsxs("div",{className:"list-item",style:{cursor:"pointer"},onClick:()=>b(n?null:s.id),children:[e.jsxs("div",{className:"list-main",children:[e.jsxs("div",{className:"list-title",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{display:"inline-flex",transition:"transform 0.15s ease",transform:n?"rotate(0deg)":"rotate(-90deg)"},children:e.jsx(o,{name:"chevronDown",size:14})}),s.name]}),e.jsx("div",{className:"list-sub mono",children:s.id})]}),e.jsxs("div",{className:"list-meta",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:12},children:[e.jsxs("div",{className:"chip-row",children:[e.jsx("span",{className:"chip",children:s.type}),e.jsx("span",{className:"chip "+(s.status==="connected"?"chip-ok":"chip-warn"),children:s.status})]}),e.jsxs("label",{className:"toggle",onClick:i=>i.stopPropagation(),children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>z(s.id)}),e.jsx("span",{className:"toggle-track",children:e.jsx("span",{className:"toggle-thumb"})})]})]}),e.jsx("div",{children:O(s.createdAt)})]})]}),n&&e.jsxs("div",{style:{border:"1px solid var(--border)",borderTop:"none",borderRadius:"0 0 var(--radius-md) var(--radius-md)",padding:16,background:"var(--bg-elevated)",animation:"rise 0.2s var(--ease-out)"},children:[e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"ID"}),e.jsx("span",{className:"mono",style:{fontSize:13},children:s.id})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Name"}),e.jsx("span",{style:{fontSize:13},children:s.name})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Type"}),e.jsx("span",{style:{fontSize:13},children:s.type})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Status"}),e.jsx("span",{style:{fontSize:13},children:s.status})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Created"}),e.jsx("span",{style:{fontSize:13},children:s.createdAt?new Date(s.createdAt).toLocaleString():"n/a"})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Enabled"}),e.jsx("span",{style:{fontSize:13},children:l?"Yes":"No"})]})]}),s.config&&Object.keys(s.config).length>0&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"label",style:{marginBottom:6},children:"Config"}),e.jsx("pre",{className:"code-block",children:JSON.stringify(s.config,null,2)})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16,paddingTop:12,borderTop:"1px solid var(--border)"},children:e.jsxs("button",{className:"btn btn--sm danger",onClick:i=>{i.stopPropagation(),I(s.id,s.name)},children:[e.jsx(o,{name:"trash",size:14}),e.jsx("span",{children:"Delete Channel"})]})})]})]},s.id)})})]})}export{P as ChannelsPage};
