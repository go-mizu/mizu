import{a as t,j as e}from"./markdown-Bs6XdLEX.js";import{u as D,I as b}from"./index-b4ey1F3N.js";import"./react-vendor-ZmPOmYi1.js";const E={meta:"Bot identity, name, version, and metadata.",wizard:"Setup wizard configuration and first-run settings.",auth:"Authentication providers, tokens, and access control.",agents:"Agent definitions, models, and behavior tuning.",messages:"Message formatting, templates, and limits.",commands:"Slash commands, aliases, and permission overrides.",channels:"Channel bindings, routing rules, and filters.",gateway:"WebSocket gateway, protocol, and connection settings.",plugins:"Plugin registry, load order, and per-plugin options."};function k({path:c,label:a,value:n,onChange:g,depth:l=0}){if(n==null)return e.jsxs("div",{className:"field",style:{paddingLeft:l>0?16:0},children:[e.jsx("span",{children:a}),e.jsx("span",{style:{color:"var(--muted)",fontStyle:"italic",fontSize:12},children:"null"})]});if(typeof n=="boolean")return e.jsx("div",{className:"field",style:{paddingLeft:l>0?16:0},children:e.jsxs("label",{className:"toggle",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:d=>g(c,d.target.checked)}),e.jsx("div",{className:"toggle-track",children:e.jsx("div",{className:"toggle-thumb"})}),e.jsx("span",{style:{fontSize:13,fontWeight:500,color:"var(--text)"},children:a})]})});if(typeof n=="number")return e.jsxs("div",{className:"field",style:{paddingLeft:l>0?16:0},children:[e.jsx("span",{children:a}),e.jsx("input",{type:"number",value:n,onChange:d=>{const r=d.target.value;g(c,r===""?0:Number(r))}})]});if(typeof n=="string")return e.jsxs("div",{className:"field",style:{paddingLeft:l>0?16:0},children:[e.jsx("span",{children:a}),e.jsx("input",{type:"text",value:n,onChange:d=>g(c,d.target.value)})]});if(Array.isArray(n))return e.jsxs("div",{style:{paddingLeft:l>0?16:0,display:"grid",gap:8},children:[e.jsx("span",{style:{color:"var(--muted)",fontSize:13,fontWeight:500},children:a}),e.jsxs("div",{style:{border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:12,background:"var(--secondary)",display:"grid",gap:8},children:[n.length===0&&e.jsx("span",{style:{color:"var(--muted)",fontStyle:"italic",fontSize:12},children:"Empty list"}),n.map((d,r)=>e.jsx(k,{path:[...c,String(r)],label:`[${r}]`,value:d,onChange:g,depth:l+1},r))]})]});if(typeof n=="object"){const d=Object.entries(n);return e.jsxs("div",{style:{paddingLeft:l>0?16:0,display:"grid",gap:10},children:[l>0&&e.jsx("span",{style:{color:"var(--text-strong)",fontSize:13,fontWeight:600},children:a}),e.jsx("div",{className:"form-grid",children:d.map(([r,p])=>e.jsx(k,{path:[...c,r],label:r,value:p,onChange:g,depth:l+1},r))})]})}return e.jsxs("div",{className:"field",style:{paddingLeft:l>0?16:0},children:[e.jsx("span",{children:a}),e.jsx("input",{type:"text",value:String(n),readOnly:!0})]})}function q({gw:c}){const{toast:a}=D(),[n,g]=t.useState(""),[l,d]=t.useState(""),[r,p]=t.useState(!0),[z,O]=t.useState(!1),[F,L]=t.useState(!1),[x,A]=t.useState("form"),[i,S]=t.useState(""),[j,J]=t.useState(""),[M,y]=t.useState(""),N=t.useCallback(async()=>{O(!0),y("");try{const s=await c.rpc("config.read"),f=s.raw??"{}",v=s.valid??!0;g(f),d(f),p(v)}catch(s){a("Failed to load config: "+(s instanceof Error?s.message:"unknown error"),"error")}finally{O(!1)}},[c,a]);t.useEffect(()=>{N()},[N]);const o=t.useMemo(()=>{try{return JSON.parse(n)}catch{return null}},[n]),C=t.useMemo(()=>o?Object.keys(o):[],[o]),u=t.useMemo(()=>{if(!j)return C;const s=j.toLowerCase();return C.filter(f=>f.toLowerCase().includes(s))},[C,j]);t.useEffect(()=>{u.length>0&&!u.includes(i)?S(u[0]):u.length===0&&S("")},[u,i]);const R=n!==l,_=t.useCallback(s=>{g(s);try{JSON.parse(s),p(!0)}catch{p(!1)}},[]),V=t.useCallback(async()=>{if(!r){a("Cannot save invalid JSON","error");return}L(!0),y("");try{await c.rpc("config.write",{raw:n}),d(n),y("Saved"),a("Configuration saved successfully","success")}catch(s){const f=s instanceof Error?s.message:"unknown error";y("Save failed"),a("Failed to save config: "+f,"error")}finally{L(!1)}},[c,n,r,a]),W=t.useCallback(async()=>{try{await c.rpc("config.apply"),a("Configuration applied (runtime reload)","success")}catch(s){const f=s instanceof Error?s.message:"unknown error";a("Failed to apply config: "+f,"error")}},[c,a]),$=t.useCallback((s,f)=>{if(!o)return;const v=JSON.parse(JSON.stringify(o));let m=v;for(let w=0;w<s.length-1;w++)m&&typeof m=="object"&&(m=m[s[w]]);m&&typeof m=="object"&&(m[s[s.length-1]]=f);const T=JSON.stringify(v,null,2);g(T),p(!0)},[o]),I=t.useMemo(()=>!o||!i||!(i in o)?"":JSON.stringify(o[i],null,2),[o,i]),h=t.useMemo(()=>{if(!(!o||!i||!(i in o)))return o[i]},[o,i]);return e.jsxs("div",{className:"config-layout",children:[e.jsxs("aside",{className:"config-sidebar",children:[e.jsxs("div",{className:"config-sidebar__header",children:[e.jsx("h2",{children:"Configuration"}),e.jsxs("div",{className:"config-sidebar__modes",children:[e.jsx("button",{className:`btn btn-sm${x==="form"?" active":""}`,onClick:()=>A("form"),children:"Form"}),e.jsx("button",{className:`btn btn-sm${x==="raw"?" active":""}`,onClick:()=>A("raw"),children:"Raw"})]})]}),x==="form"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"config-search",type:"text",placeholder:"Search sections...",value:j,onChange:s=>J(s.target.value)}),e.jsxs("nav",{className:"config-nav",children:[u.map(s=>e.jsx("button",{className:`config-nav__item${i===s?" active":""}`,onClick:()=>S(s),children:s},s)),u.length===0&&e.jsx("div",{className:"config-nav__empty",children:"No sections found"})]})]})]}),e.jsxs("main",{className:"config-main",children:[e.jsxs("div",{className:"config-actions",children:[e.jsxs("button",{className:"btn btn-sm",onClick:N,disabled:z,children:[e.jsx(b,{name:"refresh",size:14}),"Reload"]}),e.jsxs("button",{className:"btn btn-sm primary",onClick:V,disabled:F||!r||!R,children:[e.jsx(b,{name:"save",size:14}),"Save"]}),e.jsxs("button",{className:"btn btn-sm",onClick:W,children:[e.jsx(b,{name:"zap",size:14}),"Apply"]}),R&&e.jsx("span",{className:"config-changes-badge",children:"Unsaved changes"}),M&&e.jsx("span",{className:"config-status",children:M}),!r&&e.jsx("span",{className:"config-status error",children:"Invalid JSON"})]}),z?e.jsxs("div",{className:"config-loading",children:[e.jsx(b,{name:"loader",size:24}),"Loading configuration..."]}):x==="raw"?e.jsx("textarea",{className:"config-raw-editor",value:n,onChange:s=>_(s.target.value),spellCheck:!1}):e.jsx("div",{className:"config-form-view",children:i?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"config-section-title",children:i}),E[i]&&e.jsx("p",{style:{color:"var(--muted)",fontSize:13,margin:"0 0 16px"},children:E[i]}),h!==void 0&&typeof h=="object"&&h!==null&&!Array.isArray(h)?e.jsx("div",{className:"form-grid",children:Object.entries(h).map(([s,f])=>e.jsx(k,{path:[i,s],label:s,value:f,onChange:$,depth:0},s))}):e.jsx("pre",{className:"code-block",children:I})]}):e.jsx("div",{className:"config-empty",children:"Select a section from the sidebar to view its configuration."})})]})]})}export{q as ConfigPage};
