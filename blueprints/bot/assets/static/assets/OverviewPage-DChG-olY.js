import{a as c,j as s}from"./markdown-Bs6XdLEX.js";import{I as n}from"./index-DVYE_7Vo.js";import"./react-vendor-ZmPOmYi1.js";const K={system:{ok:!1,uptime:"--",database:"--",goVersion:"--",sessions:0,messages:0},health:{allocMB:0,sysMB:0,goroutines:0},cron:{enabled:!1,jobs:0,enabledJobs:0},channels:{total:0,connected:0},agents:{count:0},skills:{total:0,enabled:0,eligible:0},memory:{files:0,chunks:0}};function h(l){window.location.hash=l}function W({gw:l}){const[V,L]=c.useState(K),[S,E]=c.useState(!1),[A,M]=c.useState(""),[x,T]=c.useState(null),[C,z]=c.useState([]),v=c.useCallback(async()=>{E(!0),M("");try{const[e,R,y,N,k,B,J,I]=await Promise.all([l.rpc("system.status"),l.rpc("health.check"),l.rpc("cron.status"),l.rpc("channels.status"),l.rpc("agents.list"),l.rpc("cron.list").catch(()=>({jobs:[]})),l.rpc("skills.status").catch(()=>({skills:[]})),l.rpc("memory.stats").catch(()=>({files:0,chunks:0}))]);l.rpc("agent.identity.get").then(t=>{T({name:t.name||"OpenBot",emoji:t.emoji||"ðŸ¤–"})}).catch(()=>{});const a=e.status&&typeof e.status=="object"?e.status:null,F={ok:e.ok??(a==null?void 0:a.ok)??!1,uptime:e.uptime??(a==null?void 0:a.uptime)??"--",database:e.database??(a==null?void 0:a.database)??"--",goVersion:e.goVersion??(a==null?void 0:a.goVersion)??"--",sessions:e.sessions??(a==null?void 0:a.sessions)??0,messages:e.messages??(a==null?void 0:a.messages)??0},u=R.memory??R,G={allocMB:u.allocMB??0,sysMB:u.sysMB??0,goroutines:u.goroutines??0},j={enabled:y.enabled??!1,jobs:y.jobs??0,enabledJobs:y.enabledJobs??0},g=Array.isArray(B.jobs)?B.jobs:[];if(g.length>0){const t=g.filter($=>$.enabled);j.jobs===0&&(j.jobs=g.length),j.enabledJobs===0&&(j.enabledJobs=t.length)}const p=Array.isArray(N.channels)?N.channels:[];z(p);const P={total:N.total??p.length??0,connected:N.connected??p.filter(t=>t.connected===!0||t.status==="connected").length??0},D=Array.isArray(k.agents)?k.agents:[],H={count:k.total??D.length??0},f=Array.isArray(J.skills)?J.skills:[],U={total:f.length,enabled:f.filter(t=>t.enabled===!0).length,eligible:f.filter(t=>t.eligible===!0||t.eligible===void 0).length},Y={files:I.files??0,chunks:I.chunks??0};L({system:F,health:G,cron:j,channels:P,agents:H,skills:U,memory:Y})}catch(e){M(e instanceof Error?e.message:"Failed to load status")}finally{E(!1)}},[l]);c.useEffect(()=>{v()},[v]);const{system:i,health:b,cron:d,channels:m,agents:w,skills:r,memory:o}=V;return s.jsxs("div",{className:"overview-page",children:[s.jsxs("div",{className:"overview-header",children:[s.jsx("h2",{children:"System Overview"}),s.jsxs("button",{className:"btn btn-outline",onClick:v,disabled:S,title:"Refresh",children:[s.jsx(n,{name:"refresh",size:16}),s.jsx("span",{children:S?"Loading...":"Refresh"})]})]}),A&&s.jsx("div",{className:"overview-error",children:A}),s.jsxs("div",{className:"stat-grid",children:[s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"STATUS"}),s.jsx("div",{className:`stat-value ${i.ok?"ok":""}`,children:i.ok?"Healthy":"Unhealthy"})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"UPTIME"}),s.jsx("div",{className:"stat-value",children:i.uptime})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"DATABASE"}),s.jsx("div",{className:"stat-value",children:i.database})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"GO VERSION"}),s.jsx("div",{className:"stat-value",children:i.goVersion})]}),s.jsxs("div",{className:"stat-card stat-card--link",onClick:()=>h("sessions"),title:"View Sessions",children:[s.jsx("div",{className:"stat-label",children:"SESSIONS"}),s.jsx("div",{className:"stat-value",children:i.sessions})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"MESSAGES"}),s.jsx("div",{className:"stat-value",children:i.messages})]}),s.jsxs("div",{className:"stat-card stat-card--link",onClick:()=>h("channels"),title:"View Channels",children:[s.jsx("div",{className:"stat-label",children:"CHANNELS"}),s.jsxs("div",{className:`stat-value ${m.connected===m.total&&m.total>0?"ok":""}`,children:[m.connected,"/",m.total]}),s.jsx("div",{className:"stat-sub",children:"connected"})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"AGENTS"}),s.jsx("div",{className:"stat-value",children:w.count})]}),s.jsxs("div",{className:"stat-card stat-card--link",onClick:()=>h("skills"),title:"View Skills",children:[s.jsx("div",{className:"stat-label",children:"SKILLS"}),s.jsxs("div",{className:"stat-value",children:[r.enabled,"/",r.total]}),s.jsx("div",{className:"stat-sub",children:"enabled"})]}),s.jsxs("div",{className:"stat-card stat-card--link",onClick:()=>h("memory"),title:"View Memory",children:[s.jsx("div",{className:"stat-label",children:"MEMORY"}),s.jsx("div",{className:"stat-value",children:o.files}),s.jsxs("div",{className:"stat-sub",children:[o.chunks," chunks"]})]}),s.jsxs("div",{className:"stat-card stat-card--link",onClick:()=>h("cron"),title:"View Cron Jobs",children:[s.jsx("div",{className:"stat-label",children:"CRON JOBS"}),s.jsxs("div",{className:"stat-value",children:[d.enabledJobs,"/",d.jobs]}),s.jsx("div",{className:"stat-sub",children:"active"})]}),s.jsxs("div",{className:"stat-card stat-card--link",onClick:()=>h("instances"),title:"View Instances",children:[s.jsx("div",{className:"stat-label",children:"INSTANCES"}),s.jsx("div",{className:"stat-value",children:s.jsx(n,{name:"radio",size:14})}),s.jsx("div",{className:"stat-sub",children:"live"})]})]}),s.jsxs("div",{className:"detail-grid",children:[x&&s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx("span",{style:{fontSize:20},children:x.emoji}),s.jsx("span",{children:"Agent Identity"})]}),s.jsx("table",{className:"detail-table",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Name"}),s.jsx("td",{className:"detail-val",children:x.name})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Emoji"}),s.jsx("td",{className:"detail-val",children:x.emoji})]})]})})]}),s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx(n,{name:"monitor",size:16}),s.jsx("span",{children:"Health"})]}),s.jsx("table",{className:"detail-table",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Alloc Memory"}),s.jsxs("td",{className:"detail-val",children:[b.allocMB.toFixed(1)," MB"]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"System Memory"}),s.jsxs("td",{className:"detail-val",children:[b.sysMB.toFixed(1)," MB"]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Goroutines"}),s.jsx("td",{className:"detail-val",children:b.goroutines})]})]})})]}),s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx(n,{name:"loader",size:16}),s.jsx("span",{children:"Scheduler"})]}),s.jsx("table",{className:"detail-table",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Enabled"}),s.jsx("td",{className:"detail-val",children:d.enabled?"Yes":"No"})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Total Jobs"}),s.jsx("td",{className:"detail-val",children:d.jobs})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Enabled Jobs"}),s.jsxs("td",{className:"detail-val",children:[d.enabledJobs,"/",d.jobs]})]})]})})]}),r.total>0&&s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx(n,{name:"activity",size:16}),s.jsx("span",{children:"Skills"})]}),s.jsx("table",{className:"detail-table",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Total"}),s.jsx("td",{className:"detail-val",children:r.total})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Enabled"}),s.jsx("td",{className:"detail-val",children:r.enabled})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Eligible"}),s.jsx("td",{className:"detail-val",children:r.eligible})]})]})})]}),(o.files>0||o.chunks>0)&&s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx(n,{name:"database",size:16}),s.jsx("span",{children:"Memory Index"})]}),s.jsx("table",{className:"detail-table",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Indexed Files"}),s.jsx("td",{className:"detail-val",children:o.files})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Chunks"}),s.jsx("td",{className:"detail-val",children:o.chunks})]})]})})]}),C.length>0&&s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx(n,{name:"radio",size:16}),s.jsx("span",{children:"Channels"})]}),s.jsx("table",{className:"detail-table",children:s.jsx("tbody",{children:C.map(e=>s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:e.name||e.id}),s.jsx("td",{className:"detail-val",children:s.jsx("span",{className:"chip "+(e.status==="connected"||e.connected?"chip-ok":"chip-warn"),children:e.status||(e.connected?"connected":"disconnected")})})]},e.id||e.name))})})]})]})]})}export{W as OverviewPage};
