import{a,j as e}from"./markdown-Bs6XdLEX.js";import{d as k,a as E}from"./utils-BuvrnUzC.js";import{u as C,I as c}from"./index-CaXNju9V.js";import"./react-vendor-ZmPOmYi1.js";const f=["trace","debug","info","warn","error","fatal"];function _({gw:u}){const{toast:r}=C(),[l,j]=a.useState([]),[x,p]=a.useState(!1),[i,b]=a.useState(""),[m,v]=a.useState(!0),[d,N]=a.useState(()=>new Set(f)),h=a.useRef(null),g=a.useCallback(async()=>{p(!0);try{const t=(await u.rpc("logs.tail",{limit:200})).entries??[];j(t)}catch(s){const t=s instanceof Error?s.message:"unknown error";r("Failed to load logs: "+t,"error")}finally{p(!1)}},[u,r]);a.useEffect(()=>{g()},[g]),a.useEffect(()=>{m&&h.current&&h.current.scrollIntoView({behavior:"smooth"})},[l,m]);const w=a.useCallback(s=>{N(t=>{const n=new Set(t);return n.has(s)?n.delete(s):n.add(s),n})},[]),o=a.useMemo(()=>{const s=i.toLowerCase();return l.filter(t=>!(!d.has(t.level)||s&&!(t.message+" "+t.subsystem+" "+t.level).toLowerCase().includes(s)))},[l,d,i]),L=a.useCallback(()=>{if(o.length===0){r("No entries to export","info");return}const s=o.map(t=>`${t.timestamp} [${t.level}] ${t.subsystem}: ${t.message}`);k(s.join(`
`),"logs-export.txt"),r("Logs exported","success")},[o,r]);return e.jsxs("div",{className:"logs-page",children:[e.jsxs("div",{className:"logs-toolbar",children:[e.jsxs("div",{className:"logs-toolbar__left",children:[e.jsxs("div",{className:"logs-search-wrapper",children:[e.jsx(c,{name:"search",size:14}),e.jsx("input",{type:"text",className:"logs-search",placeholder:"Filter logs...",value:i,onChange:s=>b(s.target.value)})]}),e.jsx("div",{className:"logs-level-chips",children:f.map(s=>e.jsx("button",{className:`chip chip--level chip--${s}${d.has(s)?" active":""}`,onClick:()=>w(s),children:s},s))})]}),e.jsxs("div",{className:"logs-toolbar__right",children:[e.jsxs("label",{className:"logs-auto-follow",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:s=>v(s.target.checked)}),"Auto-follow"]}),e.jsxs("span",{className:"logs-count",children:[o.length," / ",l.length," entries"]}),e.jsxs("button",{className:"btn btn-sm",onClick:L,children:[e.jsx(c,{name:"download",size:14}),"Export"]}),e.jsxs("button",{className:"btn btn-sm",onClick:g,disabled:x,children:[e.jsx(c,{name:"refresh",size:14}),"Refresh"]})]})]}),e.jsxs("div",{className:"log-stream",children:[x&&l.length===0?e.jsxs("div",{className:"logs-loading",children:[e.jsx(c,{name:"loader",size:20}),"Loading logs..."]}):o.length===0?e.jsx("div",{className:"logs-empty",children:l.length===0?"No log entries available.":"No entries match the current filters."}):o.map((s,t)=>e.jsxs("div",{className:"log-row",children:[e.jsx("span",{className:"log-time",children:E(s.timestamp)}),e.jsx("span",{className:`log-level ${s.level}`,children:s.level}),e.jsx("span",{className:"log-subsystem",children:s.subsystem}),e.jsx("span",{className:"log-message",children:s.message})]},t)),e.jsx("div",{ref:h})]})]})}export{_ as LogsPage};
