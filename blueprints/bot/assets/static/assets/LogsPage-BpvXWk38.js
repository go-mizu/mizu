import{a,j as e}from"./markdown-Bs6XdLEX.js";import{d as E,a as C}from"./utils-BuvrnUzC.js";import{u as S,I as i}from"./index-DVYE_7Vo.js";import"./react-vendor-ZmPOmYi1.js";const j=["trace","debug","info","warn","error","fatal"];function z({gw:c}){const{toast:r}=S(),[o,x]=a.useState([]),[p,f]=a.useState(!1),[m,b]=a.useState(""),[h,v]=a.useState(!0),[d,N]=a.useState(()=>new Set(j)),u=a.useRef(null),g=a.useCallback(async()=>{f(!0);try{const t=(await c.rpc("logs.tail",{limit:200})).entries??[];x(t)}catch(s){const t=s instanceof Error?s.message:"unknown error";r("Failed to load logs: "+t,"error")}finally{f(!1)}},[c,r]);a.useEffect(()=>{g()},[g]),a.useEffect(()=>c.on("event:log.entry",t=>{const l=t;l&&l.message&&x(L=>[...L,l])}),[c]),a.useEffect(()=>{h&&u.current&&u.current.scrollIntoView({behavior:"smooth"})},[o,h]);const w=a.useCallback(s=>{N(t=>{const l=new Set(t);return l.has(s)?l.delete(s):l.add(s),l})},[]),n=a.useMemo(()=>{const s=m.toLowerCase();return o.filter(t=>!(!d.has(t.level)||s&&!(t.message+" "+t.subsystem+" "+t.level).toLowerCase().includes(s)))},[o,d,m]),k=a.useCallback(()=>{if(n.length===0){r("No entries to export","info");return}const s=n.map(t=>`${t.timestamp} [${t.level}] ${t.subsystem}: ${t.message}`);E(s.join(`
`),"logs-export.txt"),r("Logs exported","success")},[n,r]);return e.jsxs("div",{className:"logs-page",children:[e.jsxs("div",{className:"logs-toolbar",children:[e.jsxs("div",{className:"logs-toolbar__left",children:[e.jsxs("div",{className:"logs-search-wrapper",children:[e.jsx(i,{name:"search",size:14}),e.jsx("input",{type:"text",className:"logs-search",placeholder:"Filter logs...",value:m,onChange:s=>b(s.target.value)})]}),e.jsx("div",{className:"logs-level-chips",children:j.map(s=>e.jsx("button",{className:`chip chip--level chip--${s}${d.has(s)?" active":""}`,onClick:()=>w(s),children:s},s))})]}),e.jsxs("div",{className:"logs-toolbar__right",children:[e.jsxs("label",{className:"logs-auto-follow",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:s=>v(s.target.checked)}),"Auto-follow"]}),e.jsxs("span",{className:"logs-count",children:[n.length," / ",o.length," entries"]}),e.jsx("span",{className:"chip chip-ok",children:o.length}),e.jsxs("button",{className:"btn btn-sm",onClick:k,children:[e.jsx(i,{name:"download",size:14}),"Export"]}),e.jsxs("button",{className:"btn btn-sm",onClick:g,disabled:p,children:[e.jsx(i,{name:"refresh",size:14}),"Refresh"]})]})]}),e.jsxs("div",{className:"log-stream",children:[p&&o.length===0?e.jsxs("div",{className:"logs-loading",children:[e.jsx(i,{name:"loader",size:20}),"Loading logs..."]}):n.length===0?e.jsx("div",{className:"logs-empty",children:o.length===0?"No log entries available.":"No entries match the current filters."}):n.map((s,t)=>e.jsxs("div",{className:"log-row",children:[e.jsx("span",{className:"log-time",children:C(s.timestamp)}),e.jsx("span",{className:`log-level ${s.level}`,children:s.level}),e.jsx("span",{className:"log-subsystem",children:s.subsystem}),e.jsx("span",{className:"log-message",children:s.message})]},t)),e.jsx("div",{ref:u})]})]})}export{z as LogsPage};
