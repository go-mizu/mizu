import{a,j as s}from"./markdown-Bs6XdLEX.js";import{a as N}from"./utils-BuvrnUzC.js";import{u as Z,I as c}from"./index-DVYE_7Vo.js";import"./react-vendor-ZmPOmYi1.js";function ls({gw:n}){var J,P;const{toast:g}=Z(),[F,A]=a.useState(""),[H,q]=a.useState(""),[f,y]=a.useState(!1),[r,S]=a.useState(""),[i,B]=a.useState("{}"),[C,m]=a.useState(""),[k,u]=a.useState(""),[G,_]=a.useState(!1),[o,h]=a.useState(null),[R,D]=a.useState([]),[E,M]=a.useState(!1),[z,p]=a.useState(null),[L,w]=a.useState([]),[O,K]=a.useState(null),[Q]=a.useState(new Date().toISOString()),U=a.useRef(0),x=a.useCallback(async()=>{y(!0);try{const[e,t]=await Promise.all([n.rpc("system.status"),n.rpc("health.check")]);A(JSON.stringify(e,null,2)),q(JSON.stringify(t,null,2))}catch(e){const t=e instanceof Error?e.message:"unknown error";g("Failed to load snapshots: "+t,"error")}finally{y(!1)}},[n,g]),j=a.useCallback(async()=>{M(!0),p(null);const e=Date.now();try{const t=await n.rpc("models.list");p(Date.now()-e);const l=Array.isArray(t.models)?t.models:[];D(l)}catch{p(Date.now()-e),D([])}finally{M(!1)}},[n]);a.useEffect(()=>{x(),j()},[x,j]),a.useEffect(()=>n.on("event",t=>{const l=t,d=(l==null?void 0:l.event)??"unknown",v=(l==null?void 0:l.payload)!==void 0?JSON.stringify(l.payload):"",T=new Date().toISOString();K(T),w(Y=>{const b=[{id:++U.current,timestamp:T,event:d,payload:v.length>200?v.slice(0,200)+"...":v},...Y];return b.length>50?b.slice(0,50):b})}),[n]);const V=a.useCallback(async()=>{if(!r.trim())return;_(!0),m(""),u(""),h(null);const e=Date.now();try{let t={};i.trim()&&(t=JSON.parse(i));const l=await n.rpc(r.trim(),t),d=Date.now()-e;h(d),m(JSON.stringify(l,null,2))}catch(t){const l=Date.now()-e;h(l);const d=t instanceof Error?t.message:"unknown error";u(d)}finally{_(!1)}},[n,r,i]),W=a.useCallback(e=>{S(e),m(""),u(""),h(null)},[]),X=a.useCallback(()=>{w([])},[]),I=((P=(J=n.hello)==null?void 0:J.features)==null?void 0:P.methods)??[];return s.jsxs("div",{className:"debug-page",children:[s.jsxs("div",{className:"debug-grid",children:[s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"card__header",children:[s.jsx("h3",{children:"Snapshots"}),s.jsxs("button",{className:"btn btn-sm",onClick:x,disabled:f,children:[s.jsx(c,{name:"refresh",size:14}),"Refresh"]})]}),s.jsx("div",{className:"card__body",children:f?s.jsxs("div",{className:"debug-loading",children:[s.jsx(c,{name:"loader",size:20}),"Loading..."]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"debug-snapshot",children:[s.jsx("h4",{children:"system.status"}),s.jsx("pre",{className:"code-block",children:F||"No data"})]}),s.jsxs("div",{className:"debug-snapshot",children:[s.jsx("h4",{children:"health.check"}),s.jsx("pre",{className:"code-block",children:H||"No data"})]})]})})]}),s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"card__header",children:[s.jsx("h3",{children:"Models"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[z!=null&&s.jsxs("span",{style:{color:"var(--muted)",fontSize:12},children:[z,"ms"]}),s.jsxs("button",{className:"btn btn-sm",onClick:j,disabled:E,children:[s.jsx(c,{name:"refresh",size:14}),"Refresh"]})]})]}),s.jsx("div",{className:"card__body",children:E?s.jsxs("div",{className:"debug-loading",children:[s.jsx(c,{name:"loader",size:20}),"Loading..."]}):R.length===0?s.jsx("div",{className:"debug-events-empty",children:"No models available."}):s.jsx("div",{className:"debug-methods__chips",children:R.map(e=>s.jsx("span",{className:"chip",title:e.provider||"",children:e.name||e.id},e.id))})})]}),s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card__header",children:s.jsx("h3",{children:"Manual RPC"})}),s.jsxs("div",{className:"card__body",children:[s.jsxs("div",{className:"debug-rpc-form",children:[s.jsx("label",{htmlFor:"rpc-method",children:"Method"}),s.jsx("input",{id:"rpc-method",type:"text",className:"input",placeholder:"e.g. system.status",value:r,onChange:e=>S(e.target.value)}),s.jsx("label",{htmlFor:"rpc-params",children:"Params (JSON)"}),s.jsx("textarea",{id:"rpc-params",className:"input",rows:3,value:i,onChange:e=>B(e.target.value),spellCheck:!1}),s.jsxs("button",{className:"btn primary",onClick:V,disabled:G||!r.trim(),children:[s.jsx(c,{name:"play",size:14}),"Call"]})]}),C&&s.jsxs("div",{className:"debug-rpc-result",children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[s.jsx("h4",{children:"Result"}),o!=null&&s.jsxs("span",{style:{color:"var(--muted)",fontSize:12},children:[o,"ms"]})]}),s.jsx("pre",{className:"code-block",children:C})]}),k&&s.jsxs("div",{className:"callout callout--error",children:[s.jsx(c,{name:"x",size:14}),s.jsx("span",{children:k}),o!=null&&s.jsxs("span",{style:{color:"var(--muted)",fontSize:12,marginLeft:8},children:[o,"ms"]})]}),I.length>0&&s.jsxs("div",{className:"debug-methods",children:[s.jsx("h4",{children:"Available Methods"}),s.jsx("div",{className:"debug-methods__chips",children:I.map(e=>s.jsx("button",{className:"chip",onClick:()=>W(e),children:e},e))})]})]})]})]}),s.jsxs("div",{className:"card debug-events-card",children:[s.jsxs("div",{className:"card__header",children:[s.jsx("h3",{children:"Event Log"}),s.jsxs("div",{className:"debug-events-meta",children:[O&&s.jsxs("span",{className:"debug-heartbeat",children:["Last event: ",N(O)]}),s.jsxs("span",{className:"debug-heartbeat",children:["Connected since: ",N(Q)]})]}),s.jsxs("button",{className:"btn btn-sm",onClick:X,children:[s.jsx(c,{name:"trash",size:14}),"Clear"]})]}),s.jsx("div",{className:"card__body",children:L.length===0?s.jsx("div",{className:"debug-events-empty",children:"No events received yet."}):s.jsx("div",{className:"log-stream",children:L.map(e=>s.jsxs("div",{className:"log-row debug-event-row",children:[s.jsx("span",{className:"log-time",children:N(e.timestamp)}),s.jsx("span",{className:"log-event-name",children:e.event}),s.jsx("span",{className:"log-payload",children:e.payload})]},e.id))})})]})]})}export{ls as DebugPage};
