import{a as r,j as s}from"./markdown-Bs6XdLEX.js";import{t as T}from"./utils-BuvrnUzC.js";import{u as A,I as j}from"./index-CaXNju9V.js";import"./react-vendor-ZmPOmYi1.js";function M(n){return n.disabled?{label:"disabled",cls:"chip-err"}:n.blockedByAllowlist?{label:"blocked",cls:"chip-err"}:n.eligible?n.always?{label:"always",cls:"chip-ok"}:{label:"ready",cls:"chip-ok"}:{label:"missing deps",cls:"chip-warn"}}function L(n){return n.bins.length>0||n.anyBins.length>0||n.env.length>0||n.config.length>0||n.os.length>0}function z({gw:n}){const{toast:a}=A(),[o,C]=r.useState([]),[v,b]=r.useState(!0),[g,E]=r.useState(""),[I,S]=r.useState(null),[y,f]=r.useState({}),[u,x]=r.useState({}),[N,K]=r.useState(null),c=r.useCallback(async()=>{b(!0);try{const e=await n.rpc("skills.status");C(e.skills??[])}catch(e){a("Failed to load skills: "+(e instanceof Error?e.message:"unknown"),"error")}finally{b(!1)}},[n,a]);r.useEffect(()=>{c()},[c]);const p=r.useMemo(()=>{if(!g.trim())return o;const e=g.toLowerCase();return o.filter(l=>l.name.toLowerCase().includes(e)||l.key.toLowerCase().includes(e)||l.description.toLowerCase().includes(e))},[o,g]),q=r.useCallback(async e=>{try{const l=e.disabled?!0:!e.enabled;await n.rpc("skills.update",{skillKey:e.skillKey,enabled:l}),a(l?`${e.name} enabled`:`${e.name} disabled`,"success"),await c()}catch(l){a("Toggle failed: "+(l instanceof Error?l.message:"unknown"),"error")}},[n,a,c]),B=r.useCallback(async e=>{const l=y[e.skillKey]??"";try{await n.rpc("skills.update",{skillKey:e.skillKey,apiKey:l}),a(`API key ${l?"saved":"cleared"} for ${e.name}`,"success"),f(i=>{const m={...i};return delete m[e.skillKey],m}),await c()}catch(i){a("Save failed: "+(i instanceof Error?i.message:"unknown"),"error")}},[n,a,c,y]),$=r.useCallback(async e=>{const l=u[e.skillKey];if(!(!l||!l.key.trim()))try{await n.rpc("skills.update",{skillKey:e.skillKey,env:{[l.key.trim()]:l.value}}),a(`Env ${l.key} ${l.value?"set":"removed"} for ${e.name}`,"success"),x(i=>{const m={...i};return delete m[e.skillKey],m}),await c()}catch(i){a("Save failed: "+(i instanceof Error?i.message:"unknown"),"error")}},[n,a,c,u]),W=r.useCallback(async(e,l)=>{K(l.id);try{const i=await n.rpc("skills.install",{name:e.name,installId:l.id,timeoutMs:12e4});i.ok?a(`Installed ${l.label} for ${e.name}`,"success"):a(`Install failed: ${i.message||"unknown error"}`,"error"),await c()}catch(i){a("Install error: "+(i instanceof Error?i.message:"unknown"),"error")}finally{K(null)}},[n,a,c]);return s.jsxs("div",{className:"card",children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[s.jsxs("div",{children:[s.jsx("div",{className:"card-title",children:"Skills"}),s.jsxs("div",{className:"card-sub",children:[o.length," skill",o.length!==1?"s":""," registered"," · ",o.filter(e=>e.eligible).length," eligible"]})]}),s.jsxs("button",{className:"btn btn--sm",onClick:c,disabled:v,children:[s.jsx(j,{name:"refresh"}),s.jsx("span",{children:"Refresh"})]})]}),s.jsxs("div",{className:"filters",style:{marginTop:14},children:[s.jsx("div",{className:"field",style:{flex:1,maxWidth:320},children:s.jsx("input",{type:"text",value:g,onChange:e=>E(e.target.value),placeholder:"Search skills..."})}),s.jsxs("span",{className:"label",children:[p.length," shown"]})]}),v&&o.length===0?s.jsx("div",{className:"empty-state",children:s.jsx("div",{className:"spinner"})}):p.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-state-icon",children:s.jsx(j,{name:"zap",size:36})}),s.jsx("div",{children:o.length===0?"No skills registered.":"No skills match your filter."})]}):s.jsx("div",{className:"list",style:{marginTop:16},children:p.map(e=>{var m,w;const l=M(e),i=I===e.key;return s.jsxs("div",{className:"list-item",style:{flexDirection:"column",alignItems:"stretch"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[s.jsxs("div",{className:"list-main",style:{cursor:"pointer",flex:1},onClick:()=>S(i?null:e.key),children:[s.jsxs("div",{className:"list-title",children:[e.emoji?e.emoji+" ":"",e.name,e.homepage&&s.jsx("a",{href:e.homepage,target:"_blank",rel:"noopener noreferrer",style:{marginLeft:8,fontSize:"0.8em",opacity:.6},onClick:t=>t.stopPropagation(),children:"homepage"})]}),s.jsx("div",{className:"list-sub",children:T(e.description,140)}),s.jsxs("div",{className:"chip-row",style:{marginTop:6},children:[s.jsx("span",{className:"chip",children:e.source}),s.jsx("span",{className:"chip "+l.cls,children:l.label}),e.userInvocable&&s.jsx("span",{className:"chip chip-ok",children:"user-invocable"}),e.always&&s.jsx("span",{className:"chip",children:"always"})]}),L(e.missing)&&s.jsxs("div",{className:"label",style:{marginTop:6,color:"var(--c-warn, #e8a735)"},children:[e.missing.bins.length>0&&s.jsxs("span",{children:["Missing bins: ",e.missing.bins.join(", "),". "]}),e.missing.anyBins.length>0&&s.jsxs("span",{children:["Need one of: ",e.missing.anyBins.join(", "),". "]}),e.missing.env.length>0&&s.jsxs("span",{children:["Missing env: ",e.missing.env.join(", "),". "]}),e.missing.config.length>0&&s.jsxs("span",{children:["Missing config: ",e.missing.config.join(", "),". "]}),e.missing.os.length>0&&s.jsxs("span",{children:["Wrong OS (needs: ",e.missing.os.join(", "),"). "]})]})]}),s.jsx("div",{className:"list-meta",children:s.jsxs("label",{className:"toggle",children:[s.jsx("input",{type:"checkbox",checked:e.enabled&&!e.disabled,onChange:()=>q(e)}),s.jsx("span",{className:"toggle-track",children:s.jsx("span",{className:"toggle-thumb"})})]})})]}),i&&s.jsxs("div",{style:{padding:"12px 0 4px",borderTop:"1px solid var(--c-border, #333)"},children:[(e.requirements.bins.length>0||e.requirements.anyBins.length>0||e.requirements.env.length>0||e.requirements.config.length>0||e.requirements.os.length>0)&&s.jsxs("div",{style:{marginBottom:12},children:[s.jsx("div",{className:"label",style:{marginBottom:4,fontWeight:600},children:"Requirements"}),e.requirements.bins.length>0&&s.jsxs("div",{className:"label",children:["Binaries (all): ",e.requirements.bins.join(", ")]}),e.requirements.anyBins.length>0&&s.jsxs("div",{className:"label",children:["Binaries (any): ",e.requirements.anyBins.join(", ")]}),e.requirements.env.length>0&&s.jsxs("div",{className:"label",children:["Env vars: ",e.requirements.env.join(", ")]}),e.requirements.config.length>0&&s.jsxs("div",{className:"label",children:["Config paths: ",e.requirements.config.join(", ")]}),e.requirements.os.length>0&&s.jsxs("div",{className:"label",children:["OS: ",e.requirements.os.join(", ")]})]}),e.install&&e.install.length>0&&s.jsxs("div",{style:{marginBottom:12},children:[s.jsx("div",{className:"label",style:{marginBottom:4,fontWeight:600},children:"Install"}),s.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.install.map(t=>s.jsxs("button",{className:"btn btn--sm",disabled:N===t.id,onClick:()=>W(e,t),children:[N===t.id?s.jsx("span",{className:"spinner",style:{width:14,height:14}}):s.jsx(j,{name:"download"}),s.jsx("span",{children:t.label||`${t.kind}: ${t.bins.join(", ")}`})]},t.id))})]}),e.primaryEnv&&s.jsxs("div",{style:{marginBottom:12},children:[s.jsxs("div",{className:"label",style:{marginBottom:4,fontWeight:600},children:["API Key (",e.primaryEnv,")"]}),s.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[s.jsx("div",{className:"field",style:{flex:1,maxWidth:400},children:s.jsx("input",{type:"password",placeholder:`Enter ${e.primaryEnv}...`,value:y[e.skillKey]??"",onChange:t=>f(d=>({...d,[e.skillKey]:t.target.value}))})}),s.jsx("button",{className:"btn btn--sm",onClick:()=>B(e),children:"Save"})]})]}),e.requirements.env.length>0&&s.jsxs("div",{style:{marginBottom:12},children:[s.jsx("div",{className:"label",style:{marginBottom:4,fontWeight:600},children:"Environment Variables"}),s.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[s.jsx("div",{className:"field",style:{maxWidth:160},children:s.jsx("input",{type:"text",placeholder:"VAR_NAME",value:((m=u[e.skillKey])==null?void 0:m.key)??"",onChange:t=>x(d=>{var h;return{...d,[e.skillKey]:{...d[e.skillKey],key:t.target.value,value:((h=d[e.skillKey])==null?void 0:h.value)??""}}})})}),s.jsx("div",{className:"field",style:{flex:1,maxWidth:300},children:s.jsx("input",{type:"text",placeholder:"value",value:((w=u[e.skillKey])==null?void 0:w.value)??"",onChange:t=>x(d=>{var h;return{...d,[e.skillKey]:{...d[e.skillKey],key:((h=d[e.skillKey])==null?void 0:h.key)??"",value:t.target.value}}})})}),s.jsx("button",{className:"btn btn--sm",onClick:()=>$(e),children:"Set"})]})]}),s.jsxs("div",{className:"label",style:{opacity:.5},children:["Key: ",e.skillKey,e.filePath&&s.jsxs(s.Fragment,{children:[" · ",e.filePath]}),e.baseDir&&s.jsxs(s.Fragment,{children:[" · Dir: ",e.baseDir]})]})]})]},e.key)})})]})}export{z as SkillsPage};
