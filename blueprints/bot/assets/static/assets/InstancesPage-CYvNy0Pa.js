import{a as n,j as e}from"./markdown-Bs6XdLEX.js";import{f as I,t as w}from"./utils-BuvrnUzC.js";import{u as S,I as N}from"./index-DVYE_7Vo.js";import"./react-vendor-ZmPOmYi1.js";function E({gw:o}){const[c,g]=n.useState([]),[x,j]=n.useState(!0),[m,y]=n.useState(""),[a,C]=n.useState("connectedAt"),[h,f]=n.useState("desc"),{toast:v}=S(),i=n.useCallback(()=>{j(!0),o.rpc("system.presence").then(s=>{g(s.instances||[])}).catch(s=>{v("Failed to load instances: "+s.message,"error")}).finally(()=>j(!1))},[o,v]);n.useEffect(()=>{i()},[i]),n.useEffect(()=>o.on("event:presence",()=>{i()}),[o,i]);const p=n.useCallback(s=>{C(r=>r===s?(f(t=>t==="asc"?"desc":"asc"),r):(f("desc"),s))},[]),A=n.useMemo(()=>{const s=m.toLowerCase().trim();let r=c;return s&&(r=c.filter(t=>t.id.toLowerCase().includes(s)||t.remoteAddr.toLowerCase().includes(s)||t.userAgent.toLowerCase().includes(s)||t.role.toLowerCase().includes(s))),[...r].sort((t,l)=>{let d=0;if(a==="connectedAt"){const b=typeof t.connectedAt=="number"?t.connectedAt:new Date(t.connectedAt).getTime(),k=typeof l.connectedAt=="number"?l.connectedAt:new Date(l.connectedAt).getTime();d=b-k}else a==="id"?d=t.id.localeCompare(l.id):a==="remoteAddr"&&(d=t.remoteAddr.localeCompare(l.remoteAddr));return h==="asc"?d:-d})},[c,m,a,h]),u=s=>a===s?h==="asc"?" ↑":" ↓":"";return e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"card-title",children:"Connected Instances"}),e.jsxs("div",{className:"card-sub",children:["Dashboard clients and nodes connected to this gateway.",c.length>0&&e.jsxs("span",{className:"chip chip-ok",style:{marginLeft:8},children:[c.length," online"]})]})]}),e.jsxs("button",{className:"btn btn--sm",onClick:i,disabled:x,children:[e.jsx(N,{name:"refresh"}),e.jsx("span",{children:"Refresh"})]})]}),c.length>0&&e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("input",{type:"text",placeholder:"Filter by ID, address, or user agent...",value:m,onChange:s=>y(s.target.value),style:{flex:1,minWidth:200}}),e.jsxs("div",{className:"chip-row",children:[e.jsxs("button",{className:"chip "+(a==="connectedAt"?"chip-ok":""),onClick:()=>p("connectedAt"),children:["Time",u("connectedAt")]}),e.jsxs("button",{className:"chip "+(a==="id"?"chip-ok":""),onClick:()=>p("id"),children:["ID",u("id")]}),e.jsxs("button",{className:"chip "+(a==="remoteAddr"?"chip-ok":""),onClick:()=>p("remoteAddr"),children:["Address",u("remoteAddr")]})]})]}),x&&c.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("div",{className:"spinner"})}):c.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:e.jsx(N,{name:"radio",size:36})}),e.jsx("div",{children:"No instances connected."})]}):A.length===0?e.jsx("div",{className:"empty-state",children:e.jsxs("div",{children:['No instances match "',m,'"']})}):e.jsx("div",{className:"list",style:{marginTop:16},children:A.map(s=>e.jsxs("div",{className:"list-item",children:[e.jsxs("div",{className:"list-main",children:[e.jsx("div",{className:"list-title",children:s.id}),e.jsx("div",{className:"list-sub",children:s.remoteAddr})]}),e.jsxs("div",{className:"list-meta",children:[e.jsx("div",{className:"chip-row",children:e.jsx("span",{className:"chip chip-ok",children:s.role})}),e.jsx("div",{children:I(s.connectedAt)}),e.jsx("div",{className:"mono",style:{fontSize:11},children:w(s.userAgent,48)})]})]},s.id))})]})}export{E as InstancesPage};
