import{a,j as e}from"./markdown-Bs6XdLEX.js";import{f as D}from"./utils-BuvrnUzC.js";import{u as O,I as c}from"./index-BMNYCodQ.js";import"./react-vendor-ZmPOmYi1.js";function M({gw:d}){const[o,S]=a.useState([]),[u,g]=a.useState(!0),[T,y]=a.useState(null),[w,f]=a.useState({}),[z,h]=a.useState(!1),[b,v]=a.useState(!1),[m,N]=a.useState(""),[p,C]=a.useState(""),[j,k]=a.useState("{}"),{toast:t}=O(),r=a.useCallback(()=>{g(!0),d.rpc("channels.status").then(s=>{const n=s.channels||[];S(n),f(i=>{const l={...i};for(const x of n)x.id in l||(l[x.id]=x.status==="connected");return l})}).catch(s=>{t("Failed to load channels: "+s.message,"error")}).finally(()=>g(!1))},[d,t]),E=a.useCallback(s=>{f(n=>{const i={...n,[s]:!n[s]},l=o.find(x=>x.id===s);return t(((l==null?void 0:l.name)||s)+(i[s]?" enabled":" disabled"),"success"),i})},[o,t]),I=a.useCallback(async(s,n)=>{if(confirm(`Delete channel "${n||s}"? This cannot be undone.`))try{await d.rpc("channels.delete",{id:s}),t("Channel deleted","success"),y(null),r()}catch(i){t("Failed to delete: "+(i instanceof Error?i.message:"unknown"),"error")}},[d,t,r]),W=a.useCallback(async()=>{if(!m.trim()||!p.trim()){t("Name and type are required","error");return}let s={};try{s=JSON.parse(j)}catch{t("Config must be valid JSON","error");return}v(!0);try{await d.rpc("channels.create",{name:m.trim(),type:p.trim(),config:s,status:"disconnected"}),t("Channel created","success"),h(!1),N(""),C(""),k("{}"),r()}catch(n){t("Failed to create channel: "+(n instanceof Error?n.message:"unknown"),"error")}finally{v(!1)}},[d,m,p,j,t,r]);return a.useEffect(()=>{r()},[r]),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"card-title",children:"Channels"}),e.jsx("div",{className:"card-sub",children:"Connected messaging platform integrations."})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{className:"btn btn--sm",onClick:r,disabled:u,children:[e.jsx(c,{name:"refresh"}),e.jsx("span",{children:"Refresh"})]}),e.jsxs("button",{className:"btn btn--sm primary",onClick:()=>h(!0),children:[e.jsx(c,{name:"plus"}),e.jsx("span",{children:"Create"})]})]})]}),z&&e.jsxs("div",{style:{marginTop:16,border:"1px solid var(--border)",borderRadius:"var(--radius-md)",padding:16,background:"var(--bg-elevated)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("span",{style:{fontWeight:600,fontSize:14,color:"var(--text-strong)"},children:"New Channel"}),e.jsx("button",{className:"btn btn--sm",onClick:()=>h(!1),style:{padding:"4px 8px"},children:e.jsx(c,{name:"x",size:14})})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"field",children:[e.jsx("span",{children:"Name"}),e.jsx("input",{type:"text",value:m,onChange:s=>N(s.target.value),placeholder:"e.g. my-slack-channel"})]}),e.jsxs("div",{className:"field",children:[e.jsx("span",{children:"Type"}),e.jsxs("select",{value:p,onChange:s=>C(s.target.value),children:[e.jsx("option",{value:"",children:"Select type..."}),e.jsx("option",{value:"telegram",children:"Telegram"}),e.jsx("option",{value:"discord",children:"Discord"}),e.jsx("option",{value:"mattermost",children:"Mattermost"}),e.jsx("option",{value:"webhook",children:"Webhook"})]})]})]}),e.jsxs("div",{className:"field",style:{marginTop:12},children:[e.jsx("span",{children:"Config (JSON)"}),e.jsx("textarea",{value:j,onChange:s=>k(s.target.value),placeholder:'{"token": "...", "channel_id": "..."}',style:{minHeight:80}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[e.jsx("button",{className:"btn btn--sm",onClick:()=>h(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn--sm primary",onClick:W,disabled:b||!m.trim()||!p.trim(),children:b?"Creating...":"Create Channel"})]})]}),u&&o.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("div",{className:"spinner"})}):o.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:e.jsx(c,{name:"link",size:36})}),e.jsx("div",{children:"No channels connected."})]}):e.jsx("div",{className:"list",style:{marginTop:16},children:o.map(s=>{const n=T===s.id,i=w[s.id]??s.status==="connected";return e.jsxs("div",{children:[e.jsxs("div",{className:"list-item",style:{cursor:"pointer"},onClick:()=>y(n?null:s.id),children:[e.jsxs("div",{className:"list-main",children:[e.jsxs("div",{className:"list-title",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{display:"inline-flex",transition:"transform 0.15s ease",transform:n?"rotate(0deg)":"rotate(-90deg)"},children:e.jsx(c,{name:"chevronDown",size:14})}),s.name]}),e.jsx("div",{className:"list-sub mono",children:s.id})]}),e.jsxs("div",{className:"list-meta",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:12},children:[e.jsxs("div",{className:"chip-row",children:[e.jsx("span",{className:"chip",children:s.type}),e.jsx("span",{className:"chip "+(s.status==="connected"?"chip-ok":"chip-warn"),children:s.status})]}),e.jsxs("label",{className:"toggle",onClick:l=>l.stopPropagation(),children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>E(s.id)}),e.jsx("span",{className:"toggle-track",children:e.jsx("span",{className:"toggle-thumb"})})]})]}),e.jsx("div",{children:D(s.createdAt)})]})]}),n&&e.jsxs("div",{style:{border:"1px solid var(--border)",borderTop:"none",borderRadius:"0 0 var(--radius-md) var(--radius-md)",padding:16,background:"var(--bg-elevated)",animation:"rise 0.2s var(--ease-out)"},children:[e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"ID"}),e.jsx("span",{className:"mono",style:{fontSize:13},children:s.id})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Name"}),e.jsx("span",{style:{fontSize:13},children:s.name})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Type"}),e.jsx("span",{style:{fontSize:13},children:s.type})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Status"}),e.jsx("span",{style:{fontSize:13},children:s.status})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Created"}),e.jsx("span",{style:{fontSize:13},children:s.createdAt?new Date(s.createdAt).toLocaleString():"n/a"})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("span",{className:"label",style:{minWidth:80},children:"Enabled"}),e.jsx("span",{style:{fontSize:13},children:i?"Yes":"No"})]})]}),s.config&&Object.keys(s.config).length>0&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"label",style:{marginBottom:6},children:"Config"}),e.jsx("pre",{className:"code-block",children:JSON.stringify(s.config,null,2)})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16,paddingTop:12,borderTop:"1px solid var(--border)"},children:e.jsxs("button",{className:"btn btn--sm danger",onClick:l=>{l.stopPropagation(),I(s.id,s.name)},children:[e.jsx(c,{name:"trash",size:14}),e.jsx("span",{children:"Delete Channel"})]})})]})]},s.id)})})]})}export{M as ChannelsPage};
