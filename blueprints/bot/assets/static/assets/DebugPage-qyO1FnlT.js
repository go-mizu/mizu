import{a,j as e}from"./markdown-Bs6XdLEX.js";import{a as v}from"./utils-BuvrnUzC.js";import{u as K,I as i}from"./index-CaXNju9V.js";import"./react-vendor-ZmPOmYi1.js";function Y({gw:l}){var D,O;const{toast:b}=K(),[z,L]=a.useState(""),[M,I]=a.useState(""),[N,g]=a.useState(!1),[c,f]=a.useState(""),[d,J]=a.useState("{}"),[y,m]=a.useState(""),[S,u]=a.useState(""),[P,C]=a.useState(!1),[o,h]=a.useState(null),[k,R]=a.useState([]),[_,T]=a.useState(null),[F]=a.useState(new Date().toISOString()),A=a.useRef(0),p=a.useCallback(async()=>{g(!0);try{const[s,t]=await Promise.all([l.rpc("system.status"),l.rpc("health.check")]);L(JSON.stringify(s,null,2)),I(JSON.stringify(t,null,2))}catch(s){const t=s instanceof Error?s.message:"unknown error";b("Failed to load snapshots: "+t,"error")}finally{g(!1)}},[l,b]);a.useEffect(()=>{p()},[p]),a.useEffect(()=>l.on("event",t=>{const n=t,r=(n==null?void 0:n.event)??"unknown",x=(n==null?void 0:n.payload)!==void 0?JSON.stringify(n.payload):"",w=new Date().toISOString();T(w),R(G=>{const j=[{id:++A.current,timestamp:w,event:r,payload:x.length>200?x.slice(0,200)+"...":x},...G];return j.length>50?j.slice(0,50):j})}),[l]);const H=a.useCallback(async()=>{if(!c.trim())return;C(!0),m(""),u(""),h(null);const s=Date.now();try{let t={};d.trim()&&(t=JSON.parse(d));const n=await l.rpc(c.trim(),t),r=Date.now()-s;h(r),m(JSON.stringify(n,null,2))}catch(t){const n=Date.now()-s;h(n);const r=t instanceof Error?t.message:"unknown error";u(r)}finally{C(!1)}},[l,c,d]),q=a.useCallback(s=>{f(s),m(""),u(""),h(null)},[]),B=a.useCallback(()=>{R([])},[]),E=((O=(D=l.hello)==null?void 0:D.features)==null?void 0:O.methods)??[];return e.jsxs("div",{className:"debug-page",children:[e.jsxs("div",{className:"debug-grid",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card__header",children:[e.jsx("h3",{children:"Snapshots"}),e.jsxs("button",{className:"btn btn-sm",onClick:p,disabled:N,children:[e.jsx(i,{name:"refresh",size:14}),"Refresh"]})]}),e.jsx("div",{className:"card__body",children:N?e.jsxs("div",{className:"debug-loading",children:[e.jsx(i,{name:"loader",size:20}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"debug-snapshot",children:[e.jsx("h4",{children:"system.status"}),e.jsx("pre",{className:"code-block",children:z||"No data"})]}),e.jsxs("div",{className:"debug-snapshot",children:[e.jsx("h4",{children:"health.check"}),e.jsx("pre",{className:"code-block",children:M||"No data"})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:e.jsx("h3",{children:"Manual RPC"})}),e.jsxs("div",{className:"card__body",children:[e.jsxs("div",{className:"debug-rpc-form",children:[e.jsx("label",{htmlFor:"rpc-method",children:"Method"}),e.jsx("input",{id:"rpc-method",type:"text",className:"input",placeholder:"e.g. system.status",value:c,onChange:s=>f(s.target.value)}),e.jsx("label",{htmlFor:"rpc-params",children:"Params (JSON)"}),e.jsx("textarea",{id:"rpc-params",className:"input",rows:3,value:d,onChange:s=>J(s.target.value),spellCheck:!1}),e.jsxs("button",{className:"btn primary",onClick:H,disabled:P||!c.trim(),children:[e.jsx(i,{name:"play",size:14}),"Call"]})]}),y&&e.jsxs("div",{className:"debug-rpc-result",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("h4",{children:"Result"}),o!=null&&e.jsxs("span",{style:{color:"var(--muted)",fontSize:12},children:[o,"ms"]})]}),e.jsx("pre",{className:"code-block",children:y})]}),S&&e.jsxs("div",{className:"callout callout--error",children:[e.jsx(i,{name:"x",size:14}),e.jsx("span",{children:S}),o!=null&&e.jsxs("span",{style:{color:"var(--muted)",fontSize:12,marginLeft:8},children:[o,"ms"]})]}),E.length>0&&e.jsxs("div",{className:"debug-methods",children:[e.jsx("h4",{children:"Available Methods"}),e.jsx("div",{className:"debug-methods__chips",children:E.map(s=>e.jsx("button",{className:"chip",onClick:()=>q(s),children:s},s))})]})]})]})]}),e.jsxs("div",{className:"card debug-events-card",children:[e.jsxs("div",{className:"card__header",children:[e.jsx("h3",{children:"Event Log"}),e.jsxs("div",{className:"debug-events-meta",children:[_&&e.jsxs("span",{className:"debug-heartbeat",children:["Last event: ",v(_)]}),e.jsxs("span",{className:"debug-heartbeat",children:["Connected since: ",v(F)]})]}),e.jsxs("button",{className:"btn btn-sm",onClick:B,children:[e.jsx(i,{name:"trash",size:14}),"Clear"]})]}),e.jsx("div",{className:"card__body",children:k.length===0?e.jsx("div",{className:"debug-events-empty",children:"No events received yet."}):e.jsx("div",{className:"log-stream",children:k.map(s=>e.jsxs("div",{className:"log-row debug-event-row",children:[e.jsx("span",{className:"log-time",children:v(s.timestamp)}),e.jsx("span",{className:"log-event-name",children:s.event}),e.jsx("span",{className:"log-payload",children:s.payload})]},s.id))})})]})]})}export{Y as DebugPage};
