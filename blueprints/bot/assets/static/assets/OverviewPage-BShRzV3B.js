import{a as c,j as s}from"./markdown-Bs6XdLEX.js";import{I as m}from"./index-CaXNju9V.js";import"./react-vendor-ZmPOmYi1.js";const P={system:{ok:!1,uptime:"--",database:"--",goVersion:"--",sessions:0,messages:0},health:{allocMB:0,sysMB:0,goroutines:0},cron:{enabled:!1,jobs:0,enabledJobs:0},channels:{total:0,connected:0},agents:{count:0}};function U({gw:l}){const[M,B]=c.useState(P),[g,p]=c.useState(!1),[f,S]=c.useState(""),[r,J]=c.useState(null),[k,R]=c.useState([]),j=c.useCallback(async()=>{p(!0),S("");try{const[e,A,N,h,v,E]=await Promise.all([l.rpc("system.status"),l.rpc("health.check"),l.rpc("cron.status"),l.rpc("channels.status"),l.rpc("agents.list"),l.rpc("cron.list").catch(()=>({jobs:[]}))]);l.rpc("agent.identity.get").then(n=>{J({name:n.name||"OpenBot",emoji:n.emoji||"ðŸ¤–"})}).catch(()=>{});const a=e.status&&typeof e.status=="object"?e.status:null,T={ok:e.ok??(a==null?void 0:a.ok)??!1,uptime:e.uptime??(a==null?void 0:a.uptime)??"--",database:e.database??(a==null?void 0:a.database)??"--",goVersion:e.goVersion??(a==null?void 0:a.goVersion)??"--",sessions:e.sessions??(a==null?void 0:a.sessions)??0,messages:e.messages??(a==null?void 0:a.messages)??0},b=A.memory??A,I={allocMB:b.allocMB??0,sysMB:b.sysMB??0,goroutines:b.goroutines??0},i={enabled:N.enabled??!1,jobs:N.jobs??0,enabledJobs:N.enabledJobs??0},y=Array.isArray(E.jobs)?E.jobs:[];if(y.length>0){const n=y.filter(G=>G.enabled);i.jobs===0&&(i.jobs=y.length),i.enabledJobs===0&&(i.enabledJobs=n.length)}const u=Array.isArray(h.channels)?h.channels:[];R(u);const V={total:h.total??u.length??0,connected:h.connected??u.filter(n=>n.connected===!0||n.status==="connected").length??0},z=Array.isArray(v.agents)?v.agents:[],C={count:v.total??z.length??0};B({system:T,health:I,cron:i,channels:V,agents:C})}catch(e){S(e instanceof Error?e.message:"Failed to load status")}finally{p(!1)}},[l]);c.useEffect(()=>{j()},[j]);const{system:t,health:x,cron:o,channels:d,agents:L}=M;return s.jsxs("div",{className:"overview-page",children:[s.jsxs("div",{className:"overview-header",children:[s.jsx("h2",{children:"System Overview"}),s.jsxs("button",{className:"btn btn-outline",onClick:j,disabled:g,title:"Refresh",children:[s.jsx(m,{name:"refresh",size:16}),s.jsx("span",{children:g?"Loading...":"Refresh"})]})]}),f&&s.jsx("div",{className:"overview-error",children:f}),s.jsxs("div",{className:"stat-grid",children:[s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"STATUS"}),s.jsx("div",{className:`stat-value ${t.ok?"ok":""}`,children:t.ok?"Healthy":"Unhealthy"})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"UPTIME"}),s.jsx("div",{className:"stat-value",children:t.uptime})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"DATABASE"}),s.jsx("div",{className:"stat-value",children:t.database})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"GO VERSION"}),s.jsx("div",{className:"stat-value",children:t.goVersion})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"SESSIONS"}),s.jsx("div",{className:"stat-value",children:t.sessions})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"MESSAGES"}),s.jsx("div",{className:"stat-value",children:t.messages})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"CHANNELS"}),s.jsxs("div",{className:`stat-value ${d.connected===d.total&&d.total>0?"ok":""}`,children:[d.connected,"/",d.total]}),s.jsx("div",{className:"stat-sub",children:"connected"})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:"AGENTS"}),s.jsx("div",{className:"stat-value",children:L.count})]})]}),s.jsxs("div",{className:"detail-grid",children:[r&&s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx("span",{style:{fontSize:20},children:r.emoji}),s.jsx("span",{children:"Agent Identity"})]}),s.jsx("table",{className:"detail-table",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Name"}),s.jsx("td",{className:"detail-val",children:r.name})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Emoji"}),s.jsx("td",{className:"detail-val",children:r.emoji})]})]})})]}),s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx(m,{name:"monitor",size:16}),s.jsx("span",{children:"Health"})]}),s.jsx("table",{className:"detail-table",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Alloc Memory"}),s.jsxs("td",{className:"detail-val",children:[x.allocMB.toFixed(1)," MB"]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"System Memory"}),s.jsxs("td",{className:"detail-val",children:[x.sysMB.toFixed(1)," MB"]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Goroutines"}),s.jsx("td",{className:"detail-val",children:x.goroutines})]})]})})]}),s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx(m,{name:"loader",size:16}),s.jsx("span",{children:"Scheduler"})]}),s.jsx("table",{className:"detail-table",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Enabled"}),s.jsx("td",{className:"detail-val",children:o.enabled?"Yes":"No"})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Total Jobs"}),s.jsx("td",{className:"detail-val",children:o.jobs})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:"Enabled Jobs"}),s.jsxs("td",{className:"detail-val",children:[o.enabledJobs,"/",o.jobs]})]})]})})]}),k.length>0&&s.jsxs("div",{className:"detail-card",children:[s.jsxs("h3",{children:[s.jsx(m,{name:"radio",size:16}),s.jsx("span",{children:"Channels"})]}),s.jsx("table",{className:"detail-table",children:s.jsx("tbody",{children:k.map(e=>s.jsxs("tr",{children:[s.jsx("td",{className:"detail-key",children:e.name||e.id}),s.jsx("td",{className:"detail-val",children:s.jsx("span",{className:"chip "+(e.status==="connected"||e.connected?"chip-ok":"chip-warn"),children:e.status||(e.connected?"connected":"disconnected")})})]},e.id||e.name))})})]})]})]})}export{U as OverviewPage};
