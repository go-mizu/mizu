---
title: "OpenAPI"
description: "Generate API documentation automatically from your Contract services"
---

# OpenAPI

OpenAPI (formerly known as Swagger) is a standard way to describe REST APIs. Contract automatically generates an OpenAPI specification from your service - no manual YAML writing needed!

## What Is OpenAPI?

OpenAPI is a specification format that describes your API:
- What endpoints exist
- What parameters they accept
- What responses they return
- What your data types look like

This specification can be used to:
- **Generate documentation**: Beautiful, interactive API docs with Swagger UI or Redoc
- **Generate client code**: Create typed clients in TypeScript, Python, Go, and more
- **Test your API**: Import into Postman, Insomnia, or other API tools
- **Validate requests**: Ensure requests match the expected format

## Quick Start

Add OpenAPI documentation in one line:

```go
import "github.com/go-mizu/mizu/contract"

svc, _ := contract.Register("todo", &TodoService{})

mux := http.NewServeMux()
contract.MountREST(mux, svc)
contract.ServeOpenAPI(mux, "/openapi.json", svc)  // Add this line!

http.ListenAndServe(":8080", mux)
```

Now visit `http://localhost:8080/openapi.json` to see your API specification.

## What Gets Generated

Contract analyzes your service and generates a complete OpenAPI 3.1 specification.

### From Your Service

```go
type TodoService struct{}

type CreateInput struct {
    Title       string `json:"title"`
    Description string `json:"description"`
}

type Todo struct {
    ID          string    `json:"id"`
    Title       string    `json:"title"`
    Description string    `json:"description"`
    Completed   bool      `json:"completed"`
    CreatedAt   time.Time `json:"createdAt"`
}

func (s *TodoService) Create(ctx context.Context, in *CreateInput) (*Todo, error)
func (s *TodoService) List(ctx context.Context) (*ListOutput, error)
func (s *TodoService) Get(ctx context.Context, in *GetInput) (*Todo, error)
```

### To OpenAPI Specification

```json
{
  "openapi": "3.1.0",
  "info": {
    "title": "todo",
    "version": "0.1.0"
  },
  "paths": {
    "/todos": {
      "post": {
        "operationId": "todo.Create",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/todo.CreateInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/todo.Todo" }
              }
            }
          }
        }
      },
      "get": {
        "operationId": "todo.List",
        "responses": { "..." }
      }
    },
    "/todos/{id}": {
      "get": {
        "operationId": "todo.Get",
        "responses": { "..." }
      }
    }
  },
  "components": {
    "schemas": {
      "todo.CreateInput": {
        "type": "object",
        "properties": {
          "title": { "type": "string" },
          "description": { "type": "string" }
        },
        "required": ["title", "description"]
      },
      "todo.Todo": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "title": { "type": "string" },
          "description": { "type": "string" },
          "completed": { "type": "boolean" },
          "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "title", "description", "completed", "createdAt"]
      }
    }
  }
}
```

## Adding Interactive Documentation

The JSON spec is machine-readable. For human-readable docs, add Swagger UI or Redoc.

### Option 1: Swagger UI

Swagger UI provides an interactive interface where users can try your API:

```go
mux := http.NewServeMux()
contract.MountREST(mux, svc)
contract.ServeOpenAPI(mux, "/openapi.json", svc)

// Serve Swagger UI at /docs
mux.HandleFunc("/docs", func(w http.ResponseWriter, r *http.Request) {
    w.Header().Set("Content-Type", "text/html")
    w.Write([]byte(`<!DOCTYPE html>
<html>
<head>
    <title>API Documentation</title>
    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5/swagger-ui.css">
</head>
<body>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <script>
        SwaggerUIBundle({
            url: "/openapi.json",
            dom_id: "#swagger-ui"
        });
    </script>
</body>
</html>`))
})
```

Now visit `http://localhost:8080/docs` to see interactive documentation!

### Option 2: Redoc

Redoc provides clean, three-panel documentation:

```go
mux.HandleFunc("/docs", func(w http.ResponseWriter, r *http.Request) {
    w.Header().Set("Content-Type", "text/html")
    w.Write([]byte(`<!DOCTYPE html>
<html>
<head>
    <title>API Documentation</title>
</head>
<body>
    <redoc spec-url="/openapi.json"></redoc>
    <script src="https://cdn.redoc.ly/redoc/latest/bundles/redoc.standalone.js"></script>
</body>
</html>`))
})
```

## Complete Example

```go
package main

import (
    "context"
    "fmt"
    "net/http"
    "sync"
    "time"

    "github.com/go-mizu/mizu/contract"
)

// Service
type TodoService struct {
    mu     sync.RWMutex
    todos  map[string]*Todo
    nextID int
}

// Types
type Todo struct {
    ID          string    `json:"id"`
    Title       string    `json:"title"`
    Description string    `json:"description"`
    Completed   bool      `json:"completed"`
    CreatedAt   time.Time `json:"createdAt"`
}

type CreateInput struct {
    Title       string `json:"title"`
    Description string `json:"description"`
}

type GetInput struct {
    ID string `json:"id"`
}

type ListOutput struct {
    Items []*Todo `json:"items"`
    Total int     `json:"total"`
}

// Methods
func (s *TodoService) Create(ctx context.Context, in *CreateInput) (*Todo, error) {
    s.mu.Lock()
    defer s.mu.Unlock()
    s.nextID++
    todo := &Todo{
        ID:          fmt.Sprintf("%d", s.nextID),
        Title:       in.Title,
        Description: in.Description,
        CreatedAt:   time.Now(),
    }
    s.todos[todo.ID] = todo
    return todo, nil
}

func (s *TodoService) Get(ctx context.Context, in *GetInput) (*Todo, error) {
    s.mu.RLock()
    defer s.mu.RUnlock()
    todo, ok := s.todos[in.ID]
    if !ok {
        return nil, contract.ErrNotFound("todo not found")
    }
    return todo, nil
}

func (s *TodoService) List(ctx context.Context) (*ListOutput, error) {
    s.mu.RLock()
    defer s.mu.RUnlock()
    items := make([]*Todo, 0, len(s.todos))
    for _, t := range s.todos {
        items = append(items, t)
    }
    return &ListOutput{Items: items, Total: len(items)}, nil
}

func main() {
    todoService := &TodoService{todos: make(map[string]*Todo)}
    svc, _ := contract.Register("todo", todoService)

    mux := http.NewServeMux()

    // Mount REST API
    contract.MountREST(mux, svc)

    // Serve OpenAPI specification
    contract.ServeOpenAPI(mux, "/openapi.json", svc)

    // Serve Swagger UI
    mux.HandleFunc("/docs", swaggerUIHandler)

    fmt.Println("Server: http://localhost:8080")
    fmt.Println("API:    http://localhost:8080/todos")
    fmt.Println("Spec:   http://localhost:8080/openapi.json")
    fmt.Println("Docs:   http://localhost:8080/docs")
    http.ListenAndServe(":8080", mux)
}

func swaggerUIHandler(w http.ResponseWriter, r *http.Request) {
    w.Header().Set("Content-Type", "text/html")
    w.Write([]byte(`<!DOCTYPE html>
<html><head>
    <title>Todo API Docs</title>
    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5/swagger-ui.css">
</head><body>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <script>SwaggerUIBundle({url: "/openapi.json", dom_id: "#swagger-ui"});</script>
</body></html>`))
}
```

## Using the OpenAPI Spec

### Generate Client Code

Use tools like `openapi-generator` to create typed clients:

```bash
# Install openapi-generator
npm install -g @openapitools/openapi-generator-cli

# Generate TypeScript client
openapi-generator-cli generate -i http://localhost:8080/openapi.json -g typescript-fetch -o ./client

# Generate Python client
openapi-generator-cli generate -i http://localhost:8080/openapi.json -g python -o ./python-client

# Generate Go client
openapi-generator-cli generate -i http://localhost:8080/openapi.json -g go -o ./go-client
```

### Import into Postman

1. Open Postman
2. Click Import
3. Enter URL: `http://localhost:8080/openapi.json`
4. Your API is now ready to test!

### Validate with oasdiff

Check for breaking changes:

```bash
# Compare two versions of your spec
oasdiff diff old-api.json http://localhost:8080/openapi.json
```

## Multiple Services

Generate specs for multiple services:

```go
todoSvc, _ := contract.Register("todo", &TodoService{})
userSvc, _ := contract.Register("user", &UserService{})

mux := http.NewServeMux()

// Mount REST endpoints
contract.MountREST(mux, todoSvc)  // /todos
contract.MountREST(mux, userSvc)  // /users

// Serve separate OpenAPI specs
contract.ServeOpenAPI(mux, "/api/todo/openapi.json", todoSvc)
contract.ServeOpenAPI(mux, "/api/user/openapi.json", userSvc)
```

## Accessing Schemas Programmatically

You can access the schemas in your code:

```go
svc, _ := contract.Register("todo", &TodoService{})

// Get all schemas
schemas := svc.Types.Schemas()

for _, schema := range schemas {
    fmt.Printf("Schema: %s\n", schema.ID)

    // schema.JSON is the JSON Schema object
    jsonBytes, _ := json.MarshalIndent(schema.JSON, "", "  ")
    fmt.Println(string(jsonBytes))
}
```

## Common Questions

### How do I add descriptions to endpoints?

Currently, descriptions come from the method names. Custom descriptions from doc comments may be added in future versions.

### Can I customize the OpenAPI output?

The current generator is minimal. For extensive customization, you can:
1. Fetch the generated spec
2. Modify it programmatically
3. Serve the modified version

### Does it support authentication schemes?

Not yet. Security definitions will be added in future versions. For now, document authentication separately.

### What OpenAPI version is generated?

OpenAPI 3.1.0, the latest version.

## See Also

- [REST Transport](/contract/rest) - The endpoints documented by OpenAPI
- [Type System](/contract/types) - How Go types become JSON schemas
- [Client Generation](/contract/client-generation) - Using the spec for clients
