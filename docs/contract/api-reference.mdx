---
title: "Reference"
description: "Complete reference for all Contract functions, types, and options"
---

# API Reference

This page documents all public functions, types, and options in the Contract package.

## Main Package

Import: `github.com/go-mizu/mizu/contract`

### Functions

#### Register

Registers a Go struct as a Contract service.

```go
func Register(name string, service any, opts ...Option) (*Service, error)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `name` | `string` | Service name (used in URLs and method prefixes) |
| `service` | `any` | Pointer to your service struct |
| `opts` | `...Option` | Optional configuration |

**Returns:** `*Service` and an error if registration fails.

**Example:**
```go
svc, err := contract.Register("todo", &TodoService{})
if err != nil {
    log.Fatal(err)
}
```

---

#### MountREST

Mounts REST endpoints on an HTTP mux.

```go
func MountREST(mux *http.ServeMux, svc *Service, opts ...RESTOption)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `mux` | `*http.ServeMux` | HTTP router |
| `svc` | `*Service` | Registered service |
| `opts` | `...RESTOption` | Optional configuration |

**Endpoints created:** `/{plural-name}` and `/{plural-name}/{id}`

**Example:**
```go
contract.MountREST(mux, svc)
// Creates: POST /todos, GET /todos, GET /todos/{id}, PUT /todos/{id}, DELETE /todos/{id}
```

---

#### MountJSONRPC

Mounts a JSON-RPC 2.0 endpoint.

```go
func MountJSONRPC(mux *http.ServeMux, path string, svc *Service, opts ...JSONRPCOption)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `mux` | `*http.ServeMux` | HTTP router |
| `path` | `string` | URL path for the endpoint |
| `svc` | `*Service` | Registered service |
| `opts` | `...JSONRPCOption` | Optional configuration |

**Example:**
```go
contract.MountJSONRPC(mux, "/rpc", svc)
```

---

#### ServeOpenAPI

Serves an OpenAPI 3.1 specification.

```go
func ServeOpenAPI(mux *http.ServeMux, path string, svc *Service)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `mux` | `*http.ServeMux` | HTTP router |
| `path` | `string` | URL path for the spec |
| `svc` | `*Service` | Registered service |

**Example:**
```go
contract.ServeOpenAPI(mux, "/openapi.json", svc)
```

---

#### DefaultInvoker

Returns the default transport invoker for a service.

```go
func DefaultInvoker(svc *Service) TransportInvoker
```

Use this when you need to wrap the invoker with middleware.

**Example:**
```go
invoker := contract.DefaultInvoker(svc)
customInvoker := &LoggingInvoker{inner: invoker}
```

---

### Types

#### Service

A registered service with metadata and compiled invokers.

```go
type Service struct {
    Name        string        // Service name
    Description string        // Optional description
    Version     string        // Optional version
    Methods     []*Method     // All discovered methods
    Types       *TypeRegistry // Type information and schemas
}
```

**Methods:**

| Method | Returns | Description |
|--------|---------|-------------|
| `Resolve(name string)` | `*Method` | Find method by name |

---

#### Method

Metadata for a single method.

```go
type Method struct {
    Name        string      // Method name (e.g., "Create")
    FullName    string      // Service.Method (e.g., "todo.Create")
    Description string      // Optional description
    Input       *TypeRef    // Input type reference (nil if no input)
    Output      *TypeRef    // Output type reference (nil if no output)
    Invoker     Invoker     // Pre-compiled method caller
}
```

**Methods:**

| Method | Returns | Description |
|--------|---------|-------------|
| `HasInput()` | `bool` | Whether method accepts input |
| `HasOutput()` | `bool` | Whether method returns output |
| `NewInput()` | `any` | Create new input instance |

---

#### TypeRef

Reference to a type with its schema.

```go
type TypeRef struct {
    ID     string       // Unique identifier (e.g., "todo.CreateInput")
    Name   string       // Type name (e.g., "CreateInput")
    Type   reflect.Type // Go reflect type
    Schema *Schema      // JSON Schema
}
```

---

#### TypeRegistry

Manages Go types and their JSON schemas.

```go
type TypeRegistry struct {
    // ... internal fields
}
```

**Methods:**

| Method | Returns | Description |
|--------|---------|-------------|
| `Schema(id string)` | `*Schema` | Get schema by ID |
| `Schemas()` | `[]*Schema` | Get all schemas |

---

#### Schema

JSON Schema for a type.

```go
type Schema struct {
    ID   string         // Schema identifier
    JSON map[string]any // JSON Schema object
}
```

---

### Interfaces

#### Invoker

Low-level interface for calling methods.

```go
type Invoker interface {
    Call(ctx context.Context, in any) (any, error)
}
```

---

#### TransportInvoker

Higher-level interface for transports (accepts raw bytes).

```go
type TransportInvoker interface {
    Invoke(ctx context.Context, method *Method, input []byte) (any, error)
}
```

---

#### Resolver

Interface for finding methods by name.

```go
type Resolver interface {
    Resolve(name string) *Method
}
```

---

### Options

#### Registration Options

```go
// Set service description
contract.WithDescription("Todo management service")

// Set service version
contract.WithVersion("1.0.0")
```

**Usage:**
```go
svc, err := contract.Register("todo", &TodoService{},
    contract.WithDescription("Manages todo items"),
    contract.WithVersion("2.0.0"),
)
```

---

## MCP Package

Import: `github.com/go-mizu/mizu/contract/transport/mcp`

### Functions

#### Mount

Mounts MCP endpoint.

```go
func Mount(mux *http.ServeMux, path string, svc *contract.Service, opts ...Option)
```

**Example:**
```go
mcp.Mount(mux, "/mcp", svc)
```

---

#### NewHandler

Creates an MCP HTTP handler.

```go
func NewHandler(svc *contract.Service, opts ...Option) http.Handler
```

---

### Options

```go
// Custom method resolver
mcp.WithResolver(resolver)

// Custom invoker (for middleware)
mcp.WithInvoker(invoker)

// Server information
mcp.WithServerInfo(mcp.ServerInfo{
    Name:    "my-api",
    Version: "1.0.0",
})

// Instructions for AI
mcp.WithInstructions("Use these tools to manage todos.")

// Allowed CORS origins
mcp.WithAllowedOrigins("https://claude.ai")
```

---

### Types

#### ServerInfo

```go
type ServerInfo struct {
    Name    string `json:"name"`
    Version string `json:"version"`
}
```

---

## tRPC Package

Import: `github.com/go-mizu/mizu/contract/transport/trpc`

### Functions

#### Mount

Mounts tRPC endpoints.

```go
func Mount(mux *http.ServeMux, path string, svc *contract.Service, opts ...Option)
```

**Creates:** `POST {path}/{method}` and `GET {path}.meta`

**Example:**
```go
trpc.Mount(mux, "/trpc", svc)
// POST /trpc/Create, POST /trpc/List, GET /trpc.meta
```

---

#### NewHandler

Creates a tRPC HTTP handler.

```go
func NewHandler(svc *contract.Service, opts ...Option) http.Handler
```

---

#### NewMetaHandler

Creates handler for the `.meta` endpoint.

```go
func NewMetaHandler(svc *contract.Service) http.Handler
```

---

### Options

```go
// Custom method resolver
trpc.WithResolver(resolver)

// Custom invoker (for middleware)
trpc.WithInvoker(invoker)
```

---

### Types

#### Envelope

Response envelope for all tRPC responses.

```go
type Envelope struct {
    Result *Result `json:"result,omitempty"`
    Error  *Error  `json:"error,omitempty"`
}

type Result struct {
    Data any `json:"data"`
}

type Error struct {
    Code    ErrorCode `json:"code"`
    Message string    `json:"message"`
}
```

#### ErrorCode

```go
type ErrorCode string

const (
    CodeBadRequest    ErrorCode = "BAD_REQUEST"
    CodeInternalError ErrorCode = "INTERNAL_ERROR"
    CodeNotFound      ErrorCode = "NOT_FOUND"
    CodeUnauthorized  ErrorCode = "UNAUTHORIZED"
    CodeForbidden     ErrorCode = "FORBIDDEN"
)
```

---

## JSON-RPC Package

Import: `github.com/go-mizu/mizu/contract/transport/jsonrpc`

### Functions

#### Mount

Mounts JSON-RPC endpoint.

```go
func Mount(mux *http.ServeMux, path string, svc *contract.Service, opts ...Option)
```

---

#### NewHandler

Creates JSON-RPC HTTP handler.

```go
func NewHandler(svc *contract.Service, opts ...Option) http.Handler
```

---

### Options

```go
jsonrpc.WithResolver(resolver)
jsonrpc.WithInvoker(invoker)
```

---

### Types

#### Request

```go
type Request struct {
    JSONRPC string          `json:"jsonrpc"`
    ID      any             `json:"id,omitempty"`
    Method  string          `json:"method"`
    Params  json.RawMessage `json:"params,omitempty"`
}
```

#### Response

```go
type Response struct {
    JSONRPC string `json:"jsonrpc"`
    ID      any    `json:"id,omitempty"`
    Result  any    `json:"result,omitempty"`
    Error   *Error `json:"error,omitempty"`
}
```

#### Error

```go
type Error struct {
    Code    int    `json:"code"`
    Message string `json:"message"`
    Data    any    `json:"data,omitempty"`
}
```

---

## OpenAPI Package

Import: `github.com/go-mizu/mizu/contract/transport/openapi`

### Functions

#### Mount

Mounts OpenAPI spec endpoint.

```go
func Mount(mux *http.ServeMux, path string, svc *contract.Service)
```

---

#### Generate

Generates OpenAPI document from service.

```go
func Generate(svc *contract.Service) *Document
```

---

## Error Types

### Error

Contract error with code and message.

```go
type Error struct {
    Code    ErrorCode      `json:"code"`
    Message string         `json:"message"`
    Details map[string]any `json:"details,omitempty"`
}
```

**Methods:**

| Method | Returns | Description |
|--------|---------|-------------|
| `Error()` | `string` | Error message (implements `error`) |
| `HTTPStatus()` | `int` | HTTP status code |
| `JSONRPCCode()` | `int` | JSON-RPC error code |
| `Unwrap()` | `error` | Wrapped cause |
| `WithDetail(key, value)` | `*Error` | Add detail |
| `WithDetails(map)` | `*Error` | Add multiple details |
| `WithCause(err)` | `*Error` | Wrap underlying error |

---

### Error Constructors

Convenience functions for common errors:

```go
contract.ErrNotFound(message string) *Error           // 404
contract.ErrInvalidArgument(message string) *Error    // 400
contract.ErrPermissionDenied(message string) *Error   // 403
contract.ErrUnauthenticated(message string) *Error    // 401
contract.ErrInternal(message string) *Error           // 500
contract.ErrAlreadyExists(message string) *Error      // 409
contract.ErrResourceExhausted(message string) *Error  // 429
contract.ErrUnimplemented(message string) *Error      // 501
contract.ErrUnavailable(message string) *Error        // 503
```

General constructors:

```go
contract.NewError(code ErrorCode, message string) *Error
contract.Errorf(code ErrorCode, format string, args ...any) *Error
```

---

### ErrorCode

All available error codes:

```go
type ErrorCode string

const (
    ErrCodeOK                 ErrorCode = "OK"
    ErrCodeCanceled           ErrorCode = "CANCELED"
    ErrCodeUnknown            ErrorCode = "UNKNOWN"
    ErrCodeInvalidArgument    ErrorCode = "INVALID_ARGUMENT"
    ErrCodeDeadlineExceeded   ErrorCode = "DEADLINE_EXCEEDED"
    ErrCodeNotFound           ErrorCode = "NOT_FOUND"
    ErrCodeAlreadyExists      ErrorCode = "ALREADY_EXISTS"
    ErrCodePermissionDenied   ErrorCode = "PERMISSION_DENIED"
    ErrCodeResourceExhausted  ErrorCode = "RESOURCE_EXHAUSTED"
    ErrCodeFailedPrecondition ErrorCode = "FAILED_PRECONDITION"
    ErrCodeAborted            ErrorCode = "ABORTED"
    ErrCodeOutOfRange         ErrorCode = "OUT_OF_RANGE"
    ErrCodeUnimplemented      ErrorCode = "UNIMPLEMENTED"
    ErrCodeInternal           ErrorCode = "INTERNAL"
    ErrCodeUnavailable        ErrorCode = "UNAVAILABLE"
    ErrCodeDataLoss           ErrorCode = "DATA_LOSS"
    ErrCodeUnauthenticated    ErrorCode = "UNAUTHENTICATED"
)
```

---

### Helper Functions

```go
// Convert error to Contract error
contract.AsError(err error) *Error

// Convert HTTP status to error code
contract.HTTPStatusToErrorCode(status int) ErrorCode
```

---

## Method Signatures

Contract recognizes these method patterns:

### Pattern 1: Input and Output

```go
func (s *Service) Create(ctx context.Context, in *CreateInput) (*Todo, error)
```

### Pattern 2: Output Only

```go
func (s *Service) List(ctx context.Context) (*ListOutput, error)
```

### Pattern 3: Input Only

```go
func (s *Service) Delete(ctx context.Context, in *DeleteInput) error
```

### Pattern 4: Neither

```go
func (s *Service) Health(ctx context.Context) error
```

**Rules:**
- First parameter must be `context.Context`
- Input (if any) must be a pointer to a struct
- Last return value must be `error`
- Output (if any) must be a pointer to a struct

---

## Complete Example

```go
package main

import (
    "context"
    "log"
    "net/http"

    "github.com/go-mizu/mizu/contract"
    "github.com/go-mizu/mizu/contract/transport/mcp"
    "github.com/go-mizu/mizu/contract/transport/trpc"
)

// Service
type TodoService struct{}

// Types
type CreateInput struct {
    Title string `json:"title"`
}

type Todo struct {
    ID    string `json:"id"`
    Title string `json:"title"`
}

// Methods
func (s *TodoService) Create(ctx context.Context, in *CreateInput) (*Todo, error) {
    if in.Title == "" {
        return nil, contract.ErrInvalidArgument("title is required")
    }
    return &Todo{ID: "1", Title: in.Title}, nil
}

func main() {
    // Register
    svc, err := contract.Register("todo", &TodoService{},
        contract.WithVersion("1.0.0"),
    )
    if err != nil {
        log.Fatal(err)
    }

    // Mount transports
    mux := http.NewServeMux()
    contract.MountREST(mux, svc)
    contract.MountJSONRPC(mux, "/rpc", svc)
    contract.ServeOpenAPI(mux, "/openapi.json", svc)
    trpc.Mount(mux, "/trpc", svc)
    mcp.Mount(mux, "/mcp", svc)

    log.Println("Server running on :8080")
    http.ListenAndServe(":8080", mux)
}
```

## See Also

- [Quick Start](/contract/quick-start) - Get started quickly
- [Service Definition](/contract/service) - Method signatures in detail
- [Error Handling](/contract/errors) - Error patterns
- [Transports Overview](/contract/transports-overview) - All transports
