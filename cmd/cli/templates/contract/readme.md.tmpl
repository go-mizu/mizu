# {{.Name}}

A code-first API service using Mizu's contract/v2 framework.

## Architecture

This project uses a **code-first** approach:

1. `service/todo/api.go` - Go interface defining the API contract
2. `service/todo/todo.go` - Service implementation (business logic)
3. `app/server/` - Mizu app with REST and JSON-RPC transports

The API contract is automatically derived from the Go interface using `contract.Register[API]()`.

## Getting Started

```bash
# Run the server
go run ./cmd/api

# Or with make
make run

# Run with hot reload (requires mizu CLI)
mizu dev
```

## Endpoints

| Endpoint | Description |
|----------|-------------|
| `GET /todos` | List all todos |
| `POST /todos` | Create a new todo |
| `GET /todos/{id}` | Get a todo by ID |
| `PUT /todos/{id}` | Update a todo |
| `DELETE /todos/{id}` | Delete a todo |
| `POST /rpc` | JSON-RPC 2.0 endpoint |
| `GET /openapi.json` | OpenAPI 3.0 specification |

## Testing

```bash
# Run all tests
make test

# Or with go test
go test ./...
```

## API Interface

The API contract is defined in `service/todo/api.go`:

```go
// API defines the Todo service contract.
type API interface {
    Create(ctx context.Context, in *CreateIn) (*Todo, error)
    List(ctx context.Context) (*TodoList, error)
    Get(ctx context.Context, in *GetIn) (*Todo, error)
    Update(ctx context.Context, in *UpdateIn) (*Todo, error)
    Delete(ctx context.Context, in *DeleteIn) error
}
```

HTTP bindings are automatically inferred from method names:
- `Create*` -> POST
- `List*` -> GET (collection)
- `Get*` -> GET (single)
- `Update*` -> PUT
- `Delete*` -> DELETE

## Example Usage

### REST API

```bash
# List todos
curl http://localhost:8080/todos

# Create a todo
curl -X POST http://localhost:8080/todos \
  -H "Content-Type: application/json" \
  -d '{"title": "Learn Mizu", "priority": "high"}'

# Get a todo
curl http://localhost:8080/todos/todo_1

# Update a todo
curl -X PUT http://localhost:8080/todos/todo_1 \
  -H "Content-Type: application/json" \
  -d '{"completed": true}'

# Delete a todo
curl -X DELETE http://localhost:8080/todos/todo_1
```

### JSON-RPC

```bash
# List todos
curl -X POST http://localhost:8080/rpc \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc": "2.0", "method": "todos.list", "id": 1}'

# Create a todo
curl -X POST http://localhost:8080/rpc \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc": "2.0", "method": "todos.create", "params": {"title": "Learn JSON-RPC"}, "id": 2}'
```

## License

{{.License}}
