package {{.Package}}.runtime

import android.annotation.SuppressLint
import android.content.Context
import android.os.Build
import android.provider.Settings
import java.util.*

/**
 * Android device info implementation
 */
class AndroidDeviceInfo(private val context: Context) : DeviceInfo {
    @SuppressLint("HardwareIds")
    override val deviceId: String by lazy {
        Settings.Secure.getString(context.contentResolver, Settings.Secure.ANDROID_ID)
    }

    override val appVersion: String by lazy {
        try {
            context.packageManager.getPackageInfo(context.packageName, 0).versionName ?: "1.0.0"
        } catch (_: Exception) {
            "1.0.0"
        }
    }

    override val appBuild: String by lazy {
        try {
            val pInfo = context.packageManager.getPackageInfo(context.packageName, 0)
            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {
                pInfo.longVersionCode.toString()
            } else {
                @Suppress("DEPRECATION")
                pInfo.versionCode.toString()
            }
        } catch (_: Exception) {
            "1"
        }
    }

    override val model: String = Build.MODEL

    override val platform: String = "android"

    override val osVersion: String = Build.VERSION.RELEASE

    override val timezone: String = TimeZone.getDefault().id

    override val locale: String = Locale.getDefault().toLanguageTag()
}
