package handler

import (
	"sort"

	"github.com/go-mizu/mizu"
	"github.com/go-mizu/mizu/sync"
	"github.com/go-mizu/mizu/view"

	"{{.Module}}/service/todo"
)

// Home returns a handler for the home page.
func Home(store *todo.Store) mizu.Handler {
	return func(c *mizu.Ctx) error {
		scope := sync.DefaultScope

		// Get current todos from store
		todos := store.GetAll(scope)

		// Sort by created time
		sort.Slice(todos, func(i, j int) bool {
			return todos[i].CreatedAt.Before(todos[j].CreatedAt)
		})

		return view.Render(c, "home", view.Data{
			"Todos": todos,
			"Scope": scope,
		})
	}
}
